(function(a){a.widget("ui.grid",{options:{width:500,height:300,limit:false,pagination:true,allocateRows:true,chunk:20,footer:true,toolbar:false,multipleSelection:true},_generateToolbar:function(){this.toolbar=a('<tr class="ui-grid-toolbar"><td>Toolbar</td></tr>').appendTo(this.grid);this.toolbar=a("td",this.toolbar)},_generateColumns:function(){this.columnsContainer=a('<tr class="ui-grid-columns"><td><div class="ui-grid-columns-constrainer"><table cellpadding="0" cellspacing="0"><tbody><tr class="ui-grid-header ui-grid-inner"></tr></tbody></table></div></td></tr>').appendTo(this.grid).find("table tbody tr");a(".ui-grid-columns-constrainer",this.grid).css({width:this.options.width,overflow:"hidden"});this.columnsContainer.gridSortable({instance:this})},_generateFooter:function(){this.footer=a('<tr class="ui-grid-footer"><td><div class="ui-grid-footer-text ui-grid-limits"></div></td></tr>').appendTo(this.grid).find("td")},_generatePagination:function(c){this.pagination=a('<div class="ui-grid-footer-text" style="float: right;"></div>').appendTo(this.footer);var b=Math.round(c.totalRecords/this.options.limit);this._updatePagination(c)},_updatePagination:function(c){var b=Math.round(c.totalRecords/this.options.limit),f=Math.round(this.offset/this.options.limit)+1,e=[];this.pagination.empty();for(var d=f-1;d>0&&d>f-3;d--){this.pagination.prepend('<a href="#" class="ui-grid-pagination">'+d+"</a>");e.push(d)}for(var d=f;d<b+1&&d<f+3;d++){this.pagination.append(d==f?'<span class="ui-grid-pagination-current">'+d+"</span>":'<a href="#" class="ui-grid-pagination">'+d+"</a>");e.push(d)}if(b>1&&a.inArray(2,e)==-1){this.pagination.prepend('<span class="ui-grid-pagination-dots">...</span>')}if(a.inArray(1,e)==-1){this.pagination.prepend('<a href="#" class="ui-grid-pagination">1</a>')}if(a.inArray(b-1,e)==-1){this.pagination.append('<span class="ui-grid-pagination-dots">...</span>')}if(a.inArray(b,e)==-1){this.pagination.append('<a href="#" class="ui-grid-pagination">'+b+"</a>")}this.pagination.prepend(f-1>0?'<a href="#" class="ui-grid-pagination">&lt;&lt;</a>':'<span class="ui-grid-pagination">&lt;&lt;</span>');this.pagination.append(f+1>b?'<span class="ui-grid-pagination">&gt;&gt;</span>':'<a href="#" class="ui-grid-pagination">&gt;&gt;</a>')},_create:function(){var b=this;this.offset=0;this.sortColumn=this.options.sortColumn;this.sortDirection=this.options.sortDirection;this.grid=a('<table class="ui-grid ui-component ui-component-content" cellpadding="0" cellspacing="0" width="100%" height="100%"></table>').css({width:this.options.width}).appendTo(this.element);if(this.options.toolbar){this._generateToolbar()}this._generateColumns();this.content=a('<tr><td><div class="ui-grid-content"><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></td></tr>').appendTo(this.grid).find("tbody");this.contentDiv=a(".ui-grid-content",this.grid);this.contentDiv.height(this.options.height);if(this.options.footer){this._generateFooter()}this.gridmodel=a.ui.grid.model({url:this.options.url});this._initialUpdate();this.grid.bind("click.grid",function(c){return b._handleClick(c)}).bind("mousemove.grid",function(c){return b._handleMove(c)}).bind("mouseleave.grid",function(c){a(b.tableRowHovered).removeClass("ui-grid-row-hover")});this.contentDiv.bind("scroll.grid",function(c){a("div.ui-grid-columns-constrainer",b.grid)[0].scrollLeft=this.scrollLeft});this._makeRowsSelectable()},_initialUpdate:function(){this._update({columns:true})},_handleMove:function(b){if(this.columnHandleHovered){a("td.ui-grid-column-header *",this.grid).css("cursor","");this.columnHandleHovered=false}if(a(b.target).is(".ui-grid-column-header")||a(b.target).parent().is(".ui-grid-column-header")){var d=a(b.target).is(".ui-grid-column-header")?a(b.target):a(b.target).parent();var c=a(d).data("gridResizable");if(!(c&&c._mouseCapture(b))){return}a("td.ui-grid-column-header *",this.grid).css("cursor","e-resize");this.columnHandleHovered=true;return}if(a(b.target).parents(".ui-grid-row").length){var d=a(b.target).parents(".ui-grid-row");if(this.tableRowHovered&&this.tableRowHovered!=d[0]){a(this.tableRowHovered).removeClass("ui-grid-row-hover")}d.addClass("ui-grid-row-hover");this.tableRowHovered=d[0];return}else{if(this.tableRowHovered){a(this.tableRowHovered).removeClass("ui-grid-row-hover")}}},_handleClick:function(c){if(a(c.target.parentNode).is(".ui-grid-column-header")){var d=a.data(c.target.parentNode,"grid-column-header");this.sortDirection=this.sortDirection=="desc"?"asc":"desc";this.sortColumn=d.id;this._update({columns:false,refresh:true})}if(a(c.target).is("a.ui-grid-pagination")){var b=c.target.innerHTML,e=Math.round(this.offset/this.options.limit)+1;if(b=="&gt;&gt;"){e=e+1}if(b=="&lt;&lt;"){e=e-1}if(!isNaN(parseInt(c.target.innerHTML,10))){e=parseInt(c.target.innerHTML,10)}this.offset=(e-1)*this.options.limit;this._update()}return false},_makeRowsSelectable:function(){this.content.parent().parent().selectable({filter:"tr",multiple:this.options.multipleSelection,selectClass:"ui-grid-row-selected",focusClass:"ui-grid-row-focussed",select:function(g,d){var f=d.currentFocus.offset();var h=d.currentFocus.height();var b=a(this).offset();var c=a(this).height();if(f.top-b.top+h>c){this.scrollTop=((f.top+this.scrollTop-b.top+h)-c)}else{if(f.top<b.top){this.scrollTop=f.top+this.scrollTop-b.top}}}})},_update:function(e){var b=this,c=a.extend({},e,{limit:this.options.limit,start:(!(e&&e.refresh)&&this.offset)||0,refresh:(e&&e.refresh)||(e&&e.columns)}),d=a.extend({},c,{fill:null});if(c.refresh){d.start=b.infiniteScrolling?0:(this.offset||0)}if(this.sortColumn){d.sortColumn=this.sortColumn}if(this.sortDirection){d.sortDirection=this.sortDirection}this.gridmodel.fetch(d,function(f){if(b.options.pagination&&!b.pagination){b._generatePagination(f)}else{if(b.options.pagination&&b.pagination){b._updatePagination(f)}}if(!b.infiniteScrolling||c.refresh){b.content.empty()}if(c.refresh){b.columnsContainer.empty();b._addColumns(f.columns)}if(b.infiniteScrolling&&!c.refresh){var h=[];for(var g=0;g<f.records.length;g++){h.push(b._addRow(f.records[g]))}c.fill({chunk:c.chunk,data:h})}else{for(var g=0;g<f.records.length;g++){b._addRow(f.records[g])}b._syncColumnWidth();if(b.infiniteScrolling){b.contentDiv.infiniteScrolling("restart")}}if(!b.infiniteScrolling&&!b.options.pagination&&b.options.limit<f.totalRecords){b.infiniteScrolling=true;b.contentDiv.infiniteScrolling({total:b.options.allocateRows?f.totalRecords:false,chunk:b.options.chunk,scroll:function(l,k){b.offset=k.start;b._update({fill:k.fill,chunk:k.chunk})},update:function(l,k){a("div.ui-grid-limits",b.footer).html("Result "+k.firstItem+"-"+k.lastItem+(k.total?" of "+k.total:""))}})}if(!b.infiniteScrolling){a("div.ui-grid-limits",b.footer).html("Result "+c.start+"-"+(c.start+c.limit)+" of "+f.totalRecords)}})},_syncColumnWidth:function(){var d=a("tr:first td",this.content);var b=0;for(var c=0;c<this.columns.length;c++){a(d[c]).width(a("td:eq("+c+")",this.columnsContainer)[0].style.width);b+=parseInt(a("td:eq("+c+")",this.columnsContainer)[0].style.width,10)}this.content.parent().width(b)},_addColumns:function(e){this.columns=e;var b=25;for(var c=0;c<e.length;c++){var d=a('<td class="ui-grid-column-header ui-state-default"><div>'+e[c].label+"</div></td>").width(e[c].width).data("grid-column-header",e[c]).appendTo(this.columnsContainer).gridResizable();b+=e[c].width}a('<td class="ui-grid-column-header ui-state-default"><div></div></td>').width(25).appendTo(this.columnsContainer);this.columnsContainer.parent().parent().width(b)},_addRow:function(d,c){var e=a('<tr class="ui-grid-row"></tr>');if(!c){e.appendTo(this.content)}for(var b=0;b<this.columns.length;b++){a('<td class="ui-grid-column ui-state-active"><div>'+d[this.columns[b].id]+"</div></td>").appendTo(e)}return e}});a.widget("ui.gridResizable",a.extend({},a.ui.mouse,{options:{handle:false,cancel:":input",delay:0,distance:1},_create:function(){this.table=this.element.parent().parent().parent();this.gridTable=this.element.parents(".ui-grid").find("div.ui-grid-content > table");this._mouseInit()},_mouseCapture:function(b){this.offset=this.element.offset();if((this.offset.left+this.element.width())-b.pageX<5){return true}return false},_mouseStart:function(b){a.extend(this,{startPosition:b.pageX,startWidth:this.element.width(),tableStartWidth:this.table.width(),gridTableStartWidth:this.gridTable.width(),index:this.element.parent().find("td").index(this.element[0])})},_mouseDrag:function(b){this.element.css("width",this.startWidth+(b.pageX-this.startPosition));this.table.css("width",this.tableStartWidth+(b.pageX-this.startPosition));a("tr:eq(0) td:eq("+this.index+")",this.gridTable).css("width",this.startWidth+(b.pageX-this.startPosition));this.gridTable.css("width",this.gridTableStartWidth+(b.pageX-this.startPosition))},_mouseStop:function(b){}}));a.widget("ui.gridSortable",a.extend({},a.ui.mouse,{options:{handle:false,cancel:":input",delay:0,distance:1},_create:function(){this._mouseInit()},_mouseCapture:function(c){var b=a(c.target);this.item=b.hasClass("ui-grid-column-header")?b:b.parents(".ui-grid-column-header");this.offset=this.item.offset();return true},_mouseStart:function(c){var b=this;this.offsets=[];this.items=this.element.find("td").each(function(d){if(b.item[0]!=this){b.offsets.push([this,a(this).offset().left])}});a.extend(this,{startPosition:c.pageX,index:this.items.index(this.item[0])})},_mouseDrag:function(c){var b=this;a(b.offsets).each(function(e){if(a.ui.isOverAxis(c.pageX,this[1],this[0].offsetWidth)){var d=a.ui.isOverAxis(c.pageX,this[1],this[0].offsetWidth/2)?"left":"right";if(!b.lastHovered||b.lastHovered[0]!=this[0]||b.lastHovered[1]!=d){if(b.lastHovered){a(b.lastHovered[0]).removeClass("ui-grid-column-sort-right ui-grid-column-sort-left")}b.lastHovered=[this[0],d];a(b.lastHovered[0]).addClass("ui-grid-column-sort-"+d)}}})},_mouseStop:function(c){var b=this;if(this.lastHovered){a(this.lastHovered[0]).removeClass("ui-grid-column-sort-right ui-grid-column-sort-left");a(this.lastHovered[0])[this.lastHovered[1]=="right"?"after":"before"](this.item);a("tr",this.options.instance.contentDiv).each(function(d){a("> td:eq("+b.items.index(b.lastHovered[0])+")",this)[b.lastHovered[1]=="right"?"after":"before"](a("> td:eq("+b.index+")",this))})}}}))})(jQuery);(function(a){a.extend(a.ui.grid,{model:function(b){b=a.extend({},a.ui.grid.model.defaults,b);return{fetch:function(c,d){a.ajax(a.extend(true,{url:b.url,data:c,success:function(e){d(b.parse(e))}},b.ajax))}}}});a.ui.grid.model.defaults={ajax:{dataType:"json",cache:false},parse:function(c){var b=[];a.each(c.records,function(){var e=this;var d={};a.each(c.columns,function(f){d[this.id]=e[f]});b.push(d)});return{totalRecords:c.totalRecords,columns:c.columns,records:b}}}})(jQuery);(function(a){a.makeTemplate=function(d,c,b){var g=c.replace(/([\]{}[\\])/g,"\\$1");var f=b.replace(/([\]{}[\\])/g,"\\$1");var e="try { with (_context) {var _result = '';"+d.replace(/[\t\r\n]/g," ").replace(/^(.*)$/,b+"$1"+c).replace(new RegExp(f+"(.*?)"+g,"g"),function(h){return h.replace(new RegExp("^"+f+"(.*)"+g+"$"),"$1").replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/^(.*)$/,b+"_result += '$1';"+c)}).replace(new RegExp(g+"=(.*?)"+f,"g"),"_result += ($1);").replace(new RegExp(g+"(.*?)"+f,"g")," $1 ").replace(new RegExp("^"+f+"(.*)"+g+"$"),"$1")+"return _result;} } catch(e) { return '' } ";return new Function("_context",e)}})(jQuery);(function(d){d.ui=d.ui||{};d.ui.autobox=d.ui.autobox||{};d.ui.autobox.ext=d.ui.autobox.ext||{};var c;if(window.console){c=console.log}else{c=function(){}}var a=function(e){this.chainedGetJSON=e.jsonhandler||d.getJSON;this.maxActive=e.maxActive||1;this.maxQueue=e.maxQueue||1;this.active=0;this.queue=[]};d.extend(a.prototype,{getJSON:function(g,l,h){var f=this;var k=function(n){f.active-=1;f.log("MiniRM IN",g,l);h(n);var m=f.queue.shift();if(m!==undefined){f.active+=1;f.log("MiniRM POP/OUT",m[0],m[1]);f.chainedGetJSON.apply(null,m)}};if(this.active<this.maxActive){this.active+=1;this.log("MiniRM OUT",g,l);this.chainedGetJSON(g,l,k)}else{if(this.queue.length==this.maxQueue){var e=this.queue.shift();this.log("MiniRM POP/DISCARD",e[0],e[1])}this.queue.push([g,l,k]);this.log("MiniRM PUSH",g,l)}},log:function(g,e,f){}});var b=new a({});d.ui.autobox.ext.ajax=function(e){var f=e.ajax;return{getList:function(q,l){var k=q.val();var n=this.options.minQueryLength;var h=this.options.minQueryNotice;function o(t,s){return s&&(!t||t.length<s)}var p=k.replace(/\s+/," ").split(" "),m=[],r=[];for(i=0,j=p.length;i<j;i++){var g=p[i];if(g==""){continue}o(g,n)?m.push(g):r.push(g)}k=r.join(" ");if(r.length>0){b.getJSON(f,"val="+k,function(s){if(l){if(m.length>0&&h){s.unshift(h)}s=d(s).filter(function(){return !l[this.text]});q.trigger("updateList",[s])}})}else{if(m.length>0&&h){q.trigger("updateList",[[h]])}}}}};d.ui.autobox.ext.templateText=function(e){var f=d.makeTemplate(e.templateText,"<%","%>");return{template:function(g){return f(g)}}}})(jQuery);(function(d){function b(g){if(console&&console.log){console.log(g)}else{var f=d("#log");if(!f){f=d('<div id="log"></div>')}if(f){f.append(g).append("<br/>\n")}}}d.fn.resizableTextbox=function(h,f){var k=d.extend({min:5,max:500,step:7},f);var g=h.attr("offsetWidth");h.bind("keydown",function(l){d(this).data("rt-value",this.value.length)}).bind("keyup",function(n){var l=d(this);var m=k.step*l.val().length;if(m<=k.min){m=g}if(!(l.val().length==l.data("rt-value")||m<=k.min||m>=k.max)){l.width(m)}})};d.ui=d.ui||{};d.ui.autobox=d.ui.autobox||{};var c=0;var a={ESC:27,RETURN:13,TAB:9,BS:8,DEL:46,LEFT:37,RIGHT:39,UP:38,DOWN:40};function e(f,h,g){throw"Wrong addBox!"}d.widget("ui.autobox3",{options:{timeout:500,template:function(f){return"<li>"+this.options.insertText(f)+"</li>"},insertText:function(f){return f},match:function(f){return this.match(new RegExp(f))},wrapper:'<ul class="autobox-list"></ul>',resizable:{},selectHoverable:"> li",minQueryLength:0,minQueryNotice:null,maxSearchContainerWidth:400},_create:function(){var g=this;var f=this.options;if(d.ui.autobox.ext){for(var h in d.ui.autobox.ext){if(f[h]){this.options=f=d.extend(f,d.ui.autobox.ext[h](f));delete f[h]}}}g._setupWidget();if(f.getList){this._getList=f.getList}if(f.getBoxFromSelection){this._getBoxFromSelection=f.getBoxFromSelection}if(f.getBoxOnEnter){this._getBoxOnEnter=f.getBoxOnEnter}this.active=null;this.hovered=null;this.off()},_bindInput:function(h){var l=this.options;var k=this;var g=this;function m(p){var o=p.which||p.keyCode;if(g.activelist.is_active&&o==a.TAB){p.preventDefault()}}function f(q,o,p){d.data(o,"typingTimeout",window.setTimeout(function(){d(q.target||q.srcElement).trigger("autobox")},p))}function n(p){var o=d.data(p,"typingTimeout");if(o){window.clearInterval(o)}}h.keydown(function(o){m(o)}).keyup(function(p){var o=p.which||p.keyCode;if(!g.activelist.is_active&&(o==a.UP||o==a.DOWN)){n(this);f(p,this,0)}else{m(p)}}).keypress(function(q){var p=q.keyCode||q.which;n(this);if(d.data(document.body,"suppressKey")){d.data(document.body,"suppressKey",false);if(p==a.TAB||p==a.UP||p==a.DOWN){return false}}if(g.activelist.is_active&&p<32&&p!=a.BS&&p!=a.DEL){return false}else{if(p==a.RETURN){var o=k._getBoxOnEnter();if(o){k._addBox(o)}q.preventDefault()}else{if(p==a.BS||p==a.DEL||p>32){f(q,this,l.timeout)}}}}).bind("paste",function(o){f(o,this,0)}).bind("autobox",function(){var o=d(this);o.one("updateList",function(q,p){k._updateList(p)});k._getList(o,k._getCurrentValsHash(o))}).bind("keydown.autobox",function(s){if(!g.activelist.is_active){return true}var p=s.which||s.keyCode;if(p==a.ESC){g.cancel()}else{if(p==a.RETURN){g.activate();s.preventDefault()}else{if(p==a.UP||p==a.TAB||p==a.DOWN){var o=(p==a.UP)?-1:1;var r=-1;var q=g.activelist.hoverable.length;if(g.hovered){r=g.activelist.hoverable.index(g.hovered)}r+=o;if(r>=q){r=0}else{if(r<0){r=q-1}}g._setActive(g.activelist.hoverable.eq(r))}else{return true}}}d.data(document.body,"suppressKey",true)});return h},_updateList:function(k){var g=this;var h=this.options;var n=this.input&&this.input.val()||"";k=d(k).filter(function(){return h.match.call(this,n)}).map(function(){var o=d(h.template.call(g,this))[0];d.data(o,"originalObject",this);return o});this.off();if(!k.length){return false}var f=k.wrapAll(h.wrapper).parents(":last");var m=this.input.offset();this.container=f.css({top:m.top+this.input.outerHeight(),left:m.left}).appendTo("body");var l=Math.max(f.width(),this.input.width());l=Math.min(l,this.options.maxSearchContainerWidth);this.container.css({width:l});this.activelist={is_active:true,original:this.input.val(),list:k,hoverable:f.find(this.options.selectHoverable)};this.activelist.hoverable.hover(function(){g._setActive(this)},function(){g._unsetActive()});f.bind("click.autobox",function(o){g.activate();d.data(document.body,"suppressKey",false)})},_getCurrentValsHash:function(f){var k=f.parent().parent().find("li");var l={};for(var g=0;g<k.length;++g){var h=k[g].innerHTML.match(/^[^<]+/);if(h){l[h]=true}}return l},_createHolder:function(h){var f=this._bindInput(d('<input type="text"></input>'));var g=d('<ul class="autobox-hldr ui-helper-clearfix"></ul>').append(d('<li class="autobox-input"></li>').append(f));d.fn.resizableTextbox(f,d.extend(this.options.resizable,{min:f.outerWidth(),max:g.width()}));return g},_setupWidget:function(){var f=this;var h=this.options;var k=this.element;this.holder=this._createHolder(k).insertAfter(k);this.input=this.holder.find("input");k.removeAttr("name");k.hide();if(h.prevals){for(var g in h.prevals){this._addBox(h.prevals[g],true)}}this.input.attr("autocomplete","off");d(document).bind("click.autobox",function(){f.cancel()})},_getList:function(f,h){var g=this.options.list;if(h){g=d(g).filter(function(){return !h[this.text]})}f.trigger("updateList",[g])},_addBox:function(g,l){var k=this;var h=this.input;var m=this.options.name;var n=d('<input type="hidden"></input>');n.attr("name",m);n.val(g.tag);var f=d('<li class="bit-box"></li>').attr("id","bit-"+c++).text(g.tag);f.append(d('<a href="#" class="closebutton"></a>').bind("click",function(o){k._delBox(f);o.preventDefault()})).append(n);h.parent().before(f);h.val("")},addBox:function(g,f){return this._addBox({tag:g},f)},_getBoxOnEnter:function(){var f=this.input.val();if(f){return{tag:f}}return},_getBoxFromSelection:function(){return{tag:d.data(this.active[0],"originalObject").text}},_delBox:function(f){f.remove()},activate:function(){if(this.active&&this.active[0]&&d.data(this.active[0],"originalObject")){this._addBox(this._getBoxFromSelection())}else{var f=this._getBoxOnEnter();if(f){this._addBox(f)}}if(this.active){this.input.trigger("activate.autobox",[d.data(this.active[0],"originalObject")])}this.off()},off:function(){if(this.container){this.container.remove();this.container=null}this.activelist={is_active:false}},_setActive:function(f){if(!this.activelist.is_active){return}this._unsetActive();f=d(f);this.hovered=f;this.active=f.is("li")?f:f.parents("li").eq(0);this.hovered.addClass("hover");this.active.addClass("active");this.input.trigger("itemSelected.autobox",[d.data(this.active[0],"originalObject")]);this._handleActive()},_handleActive:function(){this.input.val(this.options.insertText(d.data(this.active[0],"originalObject")))},_unsetActive:function(){this.activelist.list.removeClass("active");this.activelist.hoverable.removeClass("hover");this.active=null;this.hovered=null},cancel:function(){this.input.trigger("cancel.autobox");this.input.val(this.activelist.original);this.off()}})})(jQuery);(function(a){a.widget("karl.multistatusbox",{options:{clsContainer:"ui-widget",clsItem:"ui-state-highlight ui-corner-all",hasCloseButton:true},_create:function(){this.queue=[];this.element.addClass(this.options.clsContainer)},clear:function(c){if(c===undefined){this.element.empty();this.queue=[]}else{var b=[];a(this.queue).each(function(){if(this.queueCategory==c){this.item.remove()}else{b.push(this)}});this.queue=b}},append:function(d,b,e){if(b===undefined){b=null}var c=a('<div class="karl-multistatusbox-item ui-helper-clearfix"></div>');if(e===undefined){e=this.options.clsItem}c.addClass(e);c.append(a('<div class="karl-multistatusbox-message"></div>').append(d));if(this.options.hasCloseButton){c.append(a('<a href="#" class="karl-multistatusbox-closebutton"><span class="ui-icon ui-icon-closethick">X</span></a>').hover(function(f){a(this).addClass("ui-state-hover")},function(f){a(this).removeClass("ui-state-hover")}).click(function(f){c.remove();f.preventDefault()}))}this.element.append(c);this.queue.push({item:c,queueCategory:b})},clearAndAppend:function(c,b,d){this.clear(b);this.append(c,b,d)}})})(jQuery);(function(a){a.widget("karl.karlcaptionedimage",{options:{clsWrapper:"karl-captionedimage-wrapper"},_create:function(){var c=this;this.wrapper=a("<div></div>");this.proxy=a("<img>").appendTo(this.wrapper);this.wrapper.append("<br />");this.caption=a("<span></span>").appendTo(this.wrapper);var b=this.element.attr("alt");var d=this.element.attr("width");this.proxy.attr("alt",b).attr("width",d).attr("height",this.element.attr("height")).attr("src",this.element.attr("src")).addClass("karl-captionedimage-image");this.wrapper[0].style.cssText=this.element[0].style.cssText;this.wrapper.attr("class",this.element.attr("class")).removeClass("tiny-imagedrawer-captioned").addClass(this.options.clsWrapper).width(d);var e=this.element.attr("align");if(e=="left"){this.wrapper.css("float","left")}else{if(e=="right"){this.wrapper.css("float","right")}}this.caption.text(b).addClass("karl-captionedimage-caption");this.centerer=a("<div></div>").css("text-align","center").append(this.wrapper);this.element.after(this.centerer);this.element.hide().appendTo(this.centerer)},_destroy:function(){this.centerer.replaceWith(this.element);this.element.show();a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a){a.widget("karl.karlbuttonset",{options:{clsContainer:null},_create:function(){var b=this;if(this.element.is("select")){this.selectionType=this.element.attr("multiple")?"M":"S"}else{this.selectionType=""}this.compact=this.element.is(".compact")||this.element.is(".karl-buttonset-compact");this.iconsOnly=this.element.is(".icons-only")||this.element.is(".karl-buttonset-icons-only");var c="fg-buttonset ui-helper-clearfix ";var d="fg-button ui-state-default";if(this.compact){c+=" fg-buttonset-single"}else{d+=" ui-corner-all"}if(this.options.clsContainer){c+=" "+this.options.clsContainer}this.element.wrap("<div></div>");this.wrapper=this.element.parent();this.wrapper.data(this.widgetName,this);this.originalWasHidden=this.element.hasClass("ui-helper-hidden");this.element.addClass("ui-helper-hidden");this.wrapper.addClass(c);this.buttons=[];this.element.children().each(function(g){var l=a(this);var p=l.text();var o=l.attr("title")||p;var e=l.attr("class");var h=l.attr("selected");var k=l.attr("disabled");var n="";if(e){n='<span class="ui-icon '+e+'"/>'}var f=d;if(k){f+=" ui-state-disabled"}else{if(h){f+=" ui-state-active"}}if(b.iconsOnly){f+=" fg-button-icon-solo"}else{if(e){f+=" fg-button-icon-right"}}var m=a('<span class="'+f+'"><a     title="'+o+'" href="#">'+n+p+"</a></span>");m.appendTo(b.wrapper).click(function(q){if(!m.hasClass("ui-state-disabled")){b._click(g)}q.preventDefault()}).hover(function(){if(!m.hasClass("ui-state-disabled")){m.addClass("ui-state-hover")}},function(){m.removeClass("ui-state-hover")});b.buttons.push(m[0])});this.buttons=a(this.buttons);if(this.compact){this.buttons.eq(0).addClass("ui-corner-left");this.buttons.eq(this.buttons.length-1).addClass("ui-corner-right")}},destroy:function(){if(this.wrapper.parent().length){this.wrapper.removeData(this.widgetName,this);this.element.removeData(this.widgetName,this);if(!this.originalWasHidden){this.element.removeClass("ui-helper-hidden")}this.element.insertAfter(this.wrapper);this.wrapper.remove()}a.Widget.prototype.destroy.call(this)},getButton:function(b){return this.buttons.eq(b)},_click:function(e){var b=this;if(this.selectionType=="M"){var c=this.buttons.eq(e);c.toggleClass("ui-state-active");b._change(e,c.hasClass("ui-state-active"))}else{if(this.selectionType=="S"){var f=false;this.buttons.each(function(g){if(g!=e){var h=a(this);if(h.hasClass("ui-state-active")){h.removeClass("ui-state-active");b._change(g,false)}}});var d=this.buttons.eq(e);if(!d.hasClass("ui-state-active")){d.addClass("ui-state-active");b._change(e,true)}}else{b._change(e,true)}}},_change:function(c,b){if(this.selectionType!=""){this.element.children().eq(c).attr("selected",b)}this.element.trigger("change.karlbuttonset",[c,b])}})})(jQuery);(function(c){var a=c.scrollTo=function(f,e,d){c(window).scrollTo(f,e,d)};a.defaults={axis:"y",duration:1};a.window=function(d){return c(window).scrollable()};c.fn.scrollable=function(){return this.map(function(){var g=this.parentWindow||this.defaultView,e=this.nodeName=="#document"?g.frameElement||g:this,f=e.contentDocument||(e.contentWindow||e).document,d=e.setInterval;return e.nodeName=="IFRAME"||d&&c.browser.safari?f.body:d?f.documentElement:this})};c.fn.scrollTo=function(f,e,d){if(typeof e=="object"){d=e;e=0}if(typeof d=="function"){d={onAfter:d}}d=c.extend({},a.defaults,d);e=e||d.speed||d.duration;d.queue=d.queue&&d.axis.length>1;if(d.queue){e/=2}d.offset=b(d.offset);d.over=b(d.over);return this.scrollable().each(function(){var o=this,m=c(o),n=f,l,h={},p=m.is("html,body");switch(typeof n){case"number":case"string":if(/^([+-]=)?\d+(px)?$/.test(n)){n=b(n);break}n=c(n,this);case"object":if(n.is||n.style){l=(n=c(n)).offset()}}c.each(d.axis.split(""),function(t,u){var v=u=="x"?"Left":"Top",x=v.toLowerCase(),s="scroll"+v,q=o[s],r=u=="x"?"Width":"Height",w=r.toLowerCase();if(l){h[s]=l[x]+(p?0:q-m.offset()[x]);if(d.margin){h[s]-=parseInt(n.css("margin"+v))||0;h[s]-=parseInt(n.css("border"+v+"Width"))||0}h[s]+=d.offset[x]||0;if(d.over[x]){h[s]+=n[w]()*d.over[x]}}else{h[s]=n[x]}if(/^\d+$/.test(h[s])){h[s]=h[s]<=0?0:Math.min(h[s],g(r))}if(!t&&d.queue){if(q!=h[s]){k(d.onAfterFirst)}delete h[s]}});k(d.onAfter);function k(q){m.animate(h,e,d.easing,q&&function(){q.call(this,f,d)})}function g(r){var q="scroll"+r,s=o.ownerDocument;return p?Math.max(s.documentElement[q],s.body[q]):o[q]}}).end()};function b(d){return typeof d=="object"?d:{top:d,left:d}}})(jQuery);new (function(){var f=window.Karl=window.Karl||{};var r=this;f.NAME="Karl";f.VERSION="3.00";var x=function x(){$(".mceEditor").each(function(){var t=this;for(var C=this;C.parentNode;C=C.parentNode){if(C.tagName.toLowerCase()=="form"){C.onsubmit=function(D){tinyMCE.triggerSave()};break}}})};var a=function(){if(jQuery.browser.msie){$("#left li.submenu").each(function(){$(this).mouseover(function(){$(this).addClass("iehover")});$(this).mouseout(function(){$(this).removeClass("iehover")})})}};$.widget("ui.karlstatusbox",{options:{clsItem:"statusbox-item",hasCloseButton:true},_create:function(){this.queue=[]},clear:function(C){if(C===undefined){this.element.empty();this.queue=[]}else{var t=[];$(this.queue).each(function(){if(this.queueCategory==C){this.item.remove()}else{t.push(this)}});this.queue=t}},append:function(D,t){if(t===undefined){t=null}var C=$('<div class="'+this.options.clsItem+'"></div>');C.append($('<div class="message"></div>').append(D));if(this.options.hasCloseButton){C.append($('<a href="#" class="statusbox-closebutton">X</a>').click(function(E){C.remove();E.preventDefault()}))}if(jQuery.browser.msie){C.addClass("clear-ie-container")}else{C.append('<div class="clear"></div>')}this.element.append(C);this.queue.push({item:C,queueCategory:t})},clearAndAppend:function(C,t){this.clear(t);this.append(C,t)}});f.makeSnippets=function(t){var C={};for(var D in t){C[D]=$.makeTemplate(t[D],"<%","%>")}return function(E){var G=E.snippet||"";var F=C[G];return F(E)}};var l=0;f.getJSON=function p(C,D,E,t){return jQuery.ajax({type:"POST",url:C,data:D,success:E,error:t,dataType:"json"})};var d='<span><a class="showtag-link" href="<%= showtag_url %>"><%= tag %></a><span class="count">&nbsp;(<a class="tagusers-link"  href="<%= tagusers_url %>"><%= count %></a>)</span>';var b='<input type="hidden" name="<%= _name %>" value="<%= tag %>" />';var m="</span></li>";$.widget("ui.karltagbox",$.extend({},$.ui.autobox3.prototype,{options:$.extend({},$.ui.autobox3.prototype.options,{match:function(C){this.typed=C;this.pre_match=this.text;this.match=this.post_match="";if(!this.ajax&&!C||C.length===0){return true}var t=this.text.search(new RegExp("\\b"+C,"i"));if(t!=-1){this.pre_match=this.text.slice(0,t);this.match=this.text.slice(t,t+C.length);this.post_match=this.text.slice(t+C.length);return true}return false},insertText:function(t){return t.tag},templateText:"<li><%= pre_match %><span class='matching' ><%= match %></span><%= post_match %></li>",snippets:f.makeSnippets({"":'<li id="<%= _wid %>" class="bit-box">'+d+'<a href="#" class="closebutton"></a>'+b+m,nondeleteable:'<li id="<%= _wid %>" class="bit-box nondeleteable">'+d+m}),strictAdd:false,selectFirst:false,validateRegexp:null}),_addBox:function(E,D){var J=this;var F=E.id||E.tag;var C=this.bubbles[F];if(C){var G=C.record;if(G.snippet!="nondeleteable"){return}G.snippet="";G.count++;this._updateBox(C)}else{var H;if(this.options.docid){H=this.options.tagusers_url+"?tag="+E.tag+"&docid="+this.options.docid}else{H="javascript://return false;"}E=$.extend({count:1,tagusers_url:H},E,{_name:this.options.name||"box",_wid:"bit-"+l,showtag_url:this.options.showtag_url+(E.id||E.tag)});l++;var t=this._renderBox(E);if(!D){var I=this._validateTag(E.tag);if(I){this._appendStatusWithBubble("Adding tag failed: "+I,t);t.remove();return}}this.bubbles[F]=C={record:E,li:t[0]}}if(!D&&this.options.ajaxAdd){f.getJSON(this.options.ajaxAdd,"val="+E.tag,function(K){J._ajaxAddSuccess(C,K)},function(K){J._ajaxAddFailure(C,K)})}},_validateTag:function(t){if(this.options.validateRegexp){if(t.match(this.options.validateRegexp)===null){return"Value contains characters that are not allowed in a tag."}}return},_ajaxAddSuccess:function(D,C){var t=C&&C.error;if(t){this._ajaxAddFailure(D,C)}},_ajaxAddFailure:function(D,C){var t=C&&C.error;if(!t){t="Adding tag failed"}this._appendStatusWithBubble(t,D.li);this._delBox(D.li,true)},_renderBox:function(t){var C=this;var D=this.options.snippets(t);D=this.holder.find(".autobox-input").before(D).prev();this.input.val("");$(".closebutton",D).bind("click",function(E){C._delBox(D);E.preventDefault()});return D},_delBox:function(t,D){var C=this;t=$(t);var G=t.find("input")[0].value;var E=this.bubbles[G];if(E&&E.record.count>1){var F=E.record;F.snippet="nondeleteable";F.count--;this._updateBox(E)}else{$.ui.autobox3.prototype._delBox.call(this,t);delete this.bubbles[G]}if(!D&&this.options.ajaxDel){f.getJSON(this.options.ajaxDel,"val="+G,function(H){C._ajaxDelSuccess(E,H)},function(H){C._ajaxDelFailure(E,H)})}},_ajaxDelSuccess:function(D,C){var t=C&&C.error;if(t){this._ajaxDelFailure(D,C)}},_ajaxDelFailure:function(D,C){var t=C&&C.error;if(!t){t="Deleting tag failed"}this._appendStatusWithBubble(t,D.li);this._addBox(D.record,true)},_updateBox:function(t){var C=this._renderBox(t.record);$(t.li).after(C).remove();t.li=C},_createHolder:function(C){var t=$.ui.autobox3.prototype._createHolder.call(this,C);var D=t.wrap('<div class="statusbox-wrapper"></div>').parent().append($('<div class="statusbox"></div>').karlstatusbox());this.statusbox=$("*:last",D);return D},_clearStatus:function(){this.statusbox.karlstatusbox("clear")},_appendStatus:function(t){this.statusbox.karlstatusbox("append",t)},_appendStatusWithBubble:function(D,t){t=$(t).clone();t.find("input").remove();var E=$('<span class="message-span"></span><span class="bubble-span"></span>');E.eq(0).text(D);E.eq(1).append(t);this._appendStatus(E);var C=this.statusbox.find(">:last-child");$(".closebutton",t).bind("click",function(F){C.remove();F.preventDefault()})},_setupWidget:function(){this.bubbles={};$.ui.autobox3.prototype._setupWidget.call(this);var t=this;this.input.wrap("<span></span>");$('<button class="button primary_button inline addtag-button" type="button"><span>Add</span></button>').bind("click",function(D){var C=t._getBoxOnEnter();if(C){t._addBox(C)}D.preventDefault()}).insertAfter(this.input);if(this.options.validateTag){this._validateTag=this.options.validateTag}},_updateList:function(C){this.cached_result=C;$.ui.autobox3.prototype._updateList.call(this,C);if(this.options.selectFirst){var t=$("> *",this.container);if(t.length>0){this.active=t.eq(0);this.active.addClass("active")}}},_getCurrentValsHash:function(t){var D={};for(var E in this.bubbles){var C=this.bubbles[E].record;if(C.snippet!="nondeleteable"){D[C.tag]=true}}return D}}));$.widget("ui.karlmemberbox",$.extend({},$.ui.karltagbox.prototype,{options:$.extend({},$.ui.karltagbox.prototype.options,{strictAdd:true,selectFirst:true,getBoxFromSelection:function(){var t=this.active&&this.active[0]&&$.data(this.active[0],"originalObject");if(!t){return}return{tag:t.text,id:t.id}},getBoxOnEnter:function(){return this._getBoxFromSelection()},snippets:f.makeSnippets({"":'<li id="<%= _wid %>" class="bit-box"><span><a class="showtag-link" href="<%= showtag_url %>"><%= tag %></a><a href="#" class="closebutton"></a><input type="hidden" name="<%= _name %>" value="<%= id %>" /></span></li>'})})}));$.widget("ui.karlgrid",$.extend({},$.ui.grid.prototype,{options:$.extend({},$.ui.grid.prototype.options,{width:500,height:300,limit:false,pagination:true,allocateRows:true,chunk:20,footer:true,toolbar:false,multipleSelection:true,evenRowClass:"even",oddRowClass:"odd",sortColumn:"",sortDirection:"",initialState:null,allocateWidthForScrollbar:false,scrollbarWidth:15}),_create:function(){if(!this.options.allocateWidthForScrollbar){this.options.scrollbarWidth=0}$.ui.grid.prototype._create.call(this,arguments);this.contentDiv.width(this.options.width)},_generateColumns:function(){this.columnsContainer=$('<tr class="ui-grid-columns"><td><div class="ui-grid-columns-constrainer"><table cellpadding="0" cellspacing="0"><tbody><tr class="ui-grid-header ui-grid-inner"></tr></tbody></table></div></td></tr>').appendTo(this.grid).find("table tbody tr");$(".ui-grid-columns-constrainer",this.grid).css({width:this.options.width,overflow:"hidden"});$("table",this.grid).css({"border-collapse":"collapse"})},_syncColumnWidth:function(){var C=this;var D=[];var t=0;$("td",this.columnsContainer).each(function(){var E=$(this).outerWidth();D.push(E);t+=E});if(this.options.scrollbarWidth>0){t-=this.options.scrollbarWidth}$("> tr",this.content).each(function(){$("> td",this).each(function(E){var G=$(this);var F=D[E];var H=G.outerWidth()-G.width();if(E==0){H-=C.leftBorder}F-=H;G.css("overflow","hidden").width(F)})});this.content.parent().width(t+this.options.scrollbarWidth).css("table-layout","fixed")},_addColumns:function(D){this.columns=D;var G=0;this.columns_by_id={};var t=this.sortColumn||this.options.sortColumn;var J=this.sortDirection||this.options.sortDirection;for(var F=0;F<D.length;F++){var K=D[F];var I="";if(t==K.id){I=" ui-icon "+(J=="asc"?"ui-icon-carat-1-s":"ui-icon-carat-1-n")}var C=$('<td class="ui-grid-column-header ui-state-default">  <div style="position: relative;">    <a href="javascript://return false;">      <span class="ui-grid-column-header-text">'+K.label+'</span>    </a>    <span class="ui-grid-visual-sorting-indicator'+I+'"></span>  </div></td>').data("grid-column-header",K).appendTo(this.columnsContainer);var E=C.outerWidth()-C.width();if(F==0){if(jQuery.browser.msie){this.leftBorder=0}else{this.leftBorder=1}E+=this.leftBorder}C.width(K.width-E);G+=K.width}if(this.options.scrollbarWidth>0){$('<td class="ui-state-default ui-grid-column-scrollbar"><div></div></td>').width(this.options.scrollbarWidth).appendTo(this.columnsContainer)}var H=this.columnsContainer.parent().parent();H.width(G+this.options.scrollbarWidth);this.element.trigger("karlgrid_columns_set")},_handleClick:function(C){var t=$(C.target);if(t.is(".ui-grid-column-header, .ui-grid-column-header *")){return this._onClickHeader(t)}if(t.is(".ui-grid-pagination a, .ui-grid-pagination a *")){var D=Math.floor((this.offset+this.options.limit-1)/this.options.limit)+1;if(t.hasClass("ui-icon-circle-arrow-w")||t.find(".ui-icon-circle-arrow-w").length>0){D--}if(t.hasClass("ui-icon-circle-arrow-e")||t.find(".ui-icon-circle-arrow-e").length>0){D++}if(!isNaN(parseInt(C.target.innerHTML,10))){D=parseInt(C.target.innerHTML,10)}this.offset=(D-1)*this.options.limit;this._update()}return false},_onClickHeader:function(t){var D=t.hasClass("ui-grid-column-header")?t:t.parents(".ui-grid-column-header");var C=D.data("grid-column-header");this.sortDirection=this.sortDirection=="desc"?"asc":"desc";this.sortColumn=C.id;this._update({columns:false,refresh:true});return false},_makeRowsSelectable:function(){var t=this;var C=this.content.parent().parent();C.bind("mousedown",function(D){return t._onClickRow($(D.target))})},_onClickRow:function(F){var C="tr";var E;var D=this.content.parent().parent();F.parents().andSelf().each(function(){if($("tr",D).index(this)!=-1){E=this}});if(E){var t=$("a",E);if(t.length>0){window.location=t[0].href}}return false},_addRow:function(D,C){var E=$.ui.grid.prototype._addRow.call(this,D,C);if(this.options.scrollbarWidth>0){$('<td class="ui-grid-column ui-state-active"><div>&nbsp;</div></td>').width(this.options.scrollbarWidth).appendTo(E)}var t=(this.content.find("tr").length%2==1);if(t&&this.options.oddRowClass){E.addClass(this.options.oddRowClass)}if(!t&&this.options.evenRowClass){E.addClass(this.options.evenRowClass)}return E},_generateFooter:function(){this.footer=$('<tr class="ui-grid-footer ui-widget-header"><td><span class="ui-grid-footer-text ui-grid-limits"></span></td></tr>').appendTo(this.grid).find("td")},_generatePagination:function(t){this.pagination=$('<span class="ui-grid-pagination clearafter"></span>').appendTo(this.footer);this.footerResultsBox=$(".ui-grid-limits, .ui-grid-no-limits",this.footer);this._updatePagination(t)},_updatePagination:function(C){var t=Math.floor((C.totalRecords+this.options.limit-1)/this.options.limit),F=Math.floor((this.offset+this.options.limit-1)/this.options.limit)+1,E=[];this.pagination.empty();if(t<=1){this.footerResultsBox.removeClass("ui-grid-limits").addClass("ui-grid-no-limits").html("");return}this.footerResultsBox.removeClass("ui-grid-no-limits").addClass("ui-grid-limits");for(var D=F-1;D>0&&D>F-3;D--){this.pagination.prepend('<a href="#" class="ui-state-default">'+D+"</a>");E.push(D)}for(var D=F;D<t+1&&D<F+3;D++){this.pagination.append(D==F?'<span class="ui-state-active">'+D+"</span>":'<a href="#" class="ui-state-default">'+D+"</a>");E.push(D)}if(t>1&&$.inArray(2,E)==-1){this.pagination.prepend('<span class="ui-grid-pagination-dots">...</span>')}if($.inArray(1,E)==-1){this.pagination.prepend('<a href="#" class="ui-state-default">1</a>')}if($.inArray(t-1,E)==-1){this.pagination.append('<span class="ui-grid-pagination-dots">...</span>')}if($.inArray(t,E)==-1){this.pagination.append('<a href="#" class="ui-state-default">'+t+"</a>")}this.pagination.prepend(F-1>0?'<a href="#" class="ui-state-default ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-w">Prev</div></a>':'<span class="ui-state-default ui-state-disabled ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-w">Prev</div></span>');this.pagination.append(F+1>t?'<span href="#" class="ui-state-default ui-state-disabled ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-e">Next</div></span>':'<a href="#" class="ui-state-default ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-e">Next</div></a>');this.pagination.find("a.ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})},_extendFetchOptions:function(t){return $.extend({},t,{limit:this.options.limit,start:(!(t&&t.refresh)&&this.offset)||0,refresh:(t&&t.refresh)||(t&&t.columns)})},_update:function(D){var t=this;var C=$.extend({},this._extendFetchOptions(C),{});if(C.refresh){C.start=this.infiniteScrolling?0:(this.offset||0)}if(this.sortColumn){C.sortColumn=this.sortColumn}if(this.sortDirection){C.sortDirection=this.sortDirection}this.gridmodel.fetch(C,function(E){t._doUpdate(E,D)})},_initialUpdate:function(){if(!this._grid_model_parse){this._grid_model_parse=$.ui.grid.model.defaults.parse}this.gridmodel=$.ui.grid.model({url:this.options.url,parse:this._grid_model_parse});var t=this.options.initialState;if(t){t=this._grid_model_parse(t);this._doUpdate(t,{columns:true})}else{this._update({columns:true})}},_doUpdate:function(F,I){var t=this;if(this.options.pagination&&!this.pagination){this._generatePagination(F)}else{if(this.options.pagination&&this.pagination){this._updatePagination(F)}}var t=this;var H=this._extendFetchOptions(I);if(!this.infiniteScrolling||H.refresh){this.content.empty()}if(H.refresh){this.columnsContainer.empty();this._addColumns(F.columns)}if(this.infiniteScrolling&&!H.refresh){var E=[];for(var C=0;C<F.records.length;C++){E.push(this._addRow(F.records[C]))}I.fill({chunk:I.chunk,data:E})}else{for(var C=0;C<F.records.length;C++){this._addRow(F.records[C])}this._syncColumnWidth();if(this.infiniteScrolling){this.contentDiv.infiniteScrolling("restart")}}if(!this.infiniteScrolling&&!this.options.pagination&&H.limit<F.totalRecords){this.infiniteScrolling=true;this.contentDiv.infiniteScrolling({total:t.options.allocateRows?F.totalRecords:false,chunk:t.options.chunk,scroll:function(K,J){t.offset=J.start;t._update({fill:J.fill,chunk:J.chunk})},update:function(K,J){$(".ui-grid-limits",t.footer).html("Result "+J.firstItem+"-"+J.lastItem+(J.total?" of "+J.total:""))}})}if(!this.infiniteScrolling){var G=H.start+1;var D=Math.min(H.start+H.limit,F.totalRecords);$(".ui-grid-limits",this.footer).html("Result "+(G==D?G:G+"-"+D)+" of "+F.totalRecords)}}}));$.widget("ui.karlfilegrid",$.extend({},$.ui.karlgrid.prototype,{options:$.extend({},$.ui.karlgrid.prototype.options,{delete_url:"delete_files.json",moveto_url:"move_files.json",download_url:"download_zipped",selectionColumnId:"sel",folderMenuIndent:16}),_create:function(){var t=this;this.dialogDeleteConfirm=$('<div class="ui-grid-dialog-content"><p>Are you sure you want to delete the selected files and/or folders?</p></div>');this.dialogDeleteConfirm.appendTo("body").hide().karldialog({width:400,buttons:{Cancel:function(){$(this).karldialog("close")},Delete:function(){$(this).karldialog("close");t._onDeleteConfirmed()}},open:function(){},close:function(){}});this.dialogMoveConfirm=$('<div class="ui-grid-dialog-content"><p>Are you sure you want to move these files/folders to "<span></span>"?</p></div>');this.dialogMoveFolderName=this.dialogMoveConfirm.find("span");this.dialogMoveConfirm.appendTo("body").hide().karldialog({width:400,buttons:{Cancel:function(){$(this).karldialog("close")},Move:function(){$(this).karldialog("close");var C=t.dialogMoveFolderName.data("folder");t._onMoveConfirmed(C)}},open:function(){},close:function(){}});this.dialogDownloadConfirm=$('<div class="ui-grid-dialog-content"><p>Are you sure you want to download the <span></span> selected files and/or folders?</p></div>');this.dialogDownloadItems=this.dialogDownloadConfirm.find("span");this.dialogDownloadConfirm.appendTo("body").hide().karldialog({width:400,buttons:{Cancel:function(){$(this).karldialog("close")},Download:function(){$(this).karldialog("close");var C=t.dialogDownloadItems.data("items");t._onDownloadConfirmed(C)}},open:function(){},close:function(){}});$.ui.karlgrid.prototype._create.call(this,arguments)},setTargetFolders:function(C,D){var t=this;if(this.moveToLoading){log("Ignored MoveTo menu update, because the previous update is still in progress");this._enableDisableButtons();return}this.moveToLoading=true;this.button_move.button("option","icons",{primary:"karl-icon-loading"});this._enableDisableButtons();setTimeout(function(){t._do_setTargetFolders(C);t.moveToLoading=false;t.button_move.button("option","icons",{primary:"ui-icon-folder-open"});t._enableDisableButtons();if(D){D.call(this)}},10)},_do_setTargetFolders:function(C){var E=C.targetFolders;var F=C.currentFolder;var N=this;this.menuMove.find("li").remove();function K(P){var Q=0;for(var O=1;O<P.length;O++){if(P.charAt(O)==="/"){Q++}}return Q}window.startTime=(new Date()).valueOf();var H=($.browser.msie?Math.min(E.length,400):E.length);for(var I=0;I<H;I++){var D=E[I];var G=D.path;var J=D.title;if(!G||G.charAt(0)!="/"){throw new Error('Fatal error: folder path must start with a "/"')}var t;if(G=="/"){t=0}else{if(G&&G.charAt(G.length-1)=="/"){throw new Error('Fatal error: folder path must not end with a "/"')}t=K(G)}var M=$("<li></li>").css("textAlign","left").data("folder",D).appendTo(N.menuMove);var L;if(G!=F){L=$("<a></a>")}else{L=$("<span></span>")}L.appendTo(M).text(J).css("marginLeft",""+(t*N.options.folderMenuIndent)+"px")}window.midTime=(new Date()).valueOf();this.menuMove.menu("refresh");window.endTime=(new Date()).valueOf();window.movetoLoadingTime="MoveTo menu loading: "+(window.midTime-window.startTime)+" + "+(window.endTime-window.midTime)},getSelectedFiles:function(){var t=this;var C=[];this.content.find('input.ui-grid-selector[type="checkbox"]:checked').each(function(E,D){var F=$(D).parents(".ui-grid-row").data("karlfilegrid-rowdata");C.push(F._name)});return C},getSelectedTotalSize:function(){var t=this;var C=0;this.content.find('input.ui-grid-selector[type="checkbox"]:checked').each(function(E,D){var F=$(D).parents(".ui-grid-row").data("karlfilegrid-rowdata");C+=F._size});return C},_enableDisableButtons:function(){var D=this.getSelectedFiles().length>0;var C=D&&this.options.initialState.canDelete;this.button_delete.button("option","disabled",!C);this.button_download.button("option","disabled",!D);var t=(D&&!this.moveToLoading);this.button_move.button("option","disabled",!C)},_addColumns:function(D){var t=this;$.ui.karlgrid.prototype._addColumns.call(this,D);var C=this.columnsContainer.find(".ui-grid-column-header").filter(function(F){return D[F].id==t.options.selectionColumnId}).html("");var E=$('<div class="ui-grid-globalselector"></div>').appendTo(C);this.cb_globalselect=$('<input type="checkbox" title="Select/Unselect all items">').change(function(){t._onGlobalSelect($(this).attr("checked"))}).appendTo(E)},_addRow:function(C,t){var D=$.ui.karlgrid.prototype._addRow.call(this,C,t);D.data("karlfilegrid-rowdata",C);return D},_initialUpdate:function(){var t=this;var C=$.ui.grid.model.defaults.parse;this._grid_model_parse=function(D){var E=C(D);E.targetFolders=D.targetFolders;E.currentFolder=D.currentFolder;E.canDelete=D.canDelete;$.each(E.records,function(G,F){record_data=F[t.options.selectionColumnId];F._name=record_data[0];F._size=record_data[1];F[t.options.selectionColumnId]='<input type="checkbox" class="ui-grid-selector" title="Select item">'});return E};this.deferredLoad=this.options.initialState;$.ui.karlgrid.prototype._initialUpdate.call(this);this.deferredLoad=false},_doUpdate:function(C,D){var t=this;$.ui.karlgrid.prototype._doUpdate.call(this,C,D);this.cb_globalselect.removeAttr("checked");if(this.deferredLoad){this.doDeferredLoadState=C;this._enableDisableButtons()}else{this.setTargetFolders(C)}},_onGlobalSelect:function(t){this.content.find('input.ui-grid-selector[type="checkbox"]').each(function(){var C=$(this);if(t){C.attr("checked","checked")}else{C.removeAttr("checked")}});this._enableDisableButtons()},_onClickRow:function(E){var D=E.is('input[type="checkbox"]');if(!D){return $.ui.karlgrid.prototype._onClickRow.call(this,E)}var C=E.attr("checked");var t=!C;if(t){E.attr("checked","checked")}else{E.removeAttr("checked")}this._enableDisableButtons();return false},_onClickHeader:function(D){var E=D.hasClass("ui-grid-column-header")?D:D.parents(".ui-grid-column-header");var C=E.data("grid-column-header");var t=C.id==this.options.selectionColumnId;if(!t){return $.ui.karlgrid.prototype._onClickHeader.call(this,D)}if(!D.is('.ui-grid-globalselector input[type="checkbox"]')){return false}return true},_generateFooter:function(){var C=this;$.ui.karlgrid.prototype._generateFooter.call(this);var t=$('<span class="ui-grid-footer-button-positioner"></span>').appendTo(this.footer);this.button_delete=$("<a>Delete</a>").button({icons:{primary:"ui-icon-trash"}}).click(function(){if(!$(this).button("option","disabled")){C._onDeleteClicked()}return false}).appendTo(t);this.button_move=$("<a>Move To</a>").button({icons:{primary:"ui-icon-folder-open"}}).click(function(){if(!$(this).button("option","disabled")){var D=C.doDeferredLoadState;if(D){C.doDeferredLoadState=false;C.setTargetFolders(D,function(){C._onMoveClicked()})}else{C._onMoveClicked()}}return false}).appendTo(t);this.button_download=$("<a>Download</a>").button({icons:{primary:"ui-icon-circle-arrow-s"}}).click(function(){if(!$(this).button("option","disabled")){C._onDownloadClicked()}return false}).appendTo(t);this.menuMove=$("<ul></ul>").insertAfter(this.button_move).hide().width(250).css("max-height","325px").css("position","absolute").css("overflow-x","hidden").css("overflow-y","auto").menu({select:function(D,G){C.menuMove.hide();var F=G.item;if(F){var E=F.data("folder");C._onMoveSelected(E)}}});this.menuMove.bind("keydown",function(D){if(C.menuMove.menu("option","disabled")){return}switch(D.keyCode){case $.ui.keyCode.ESCAPE:C.menuMove.hide();D.preventDefault();D.stopImmediatePropagation();break}});$("body").bind("mousedown",function(D){if(C.menuMove.menu("option","disabled")||C.menuMove.is(":hidden")||$(D.target).is(".ui-grid-footer .ui-menu")||$(D.target).is(".ui-grid-footer .ui-menu *")){return}C.menuMove.hide();D.preventDefault();D.stopImmediatePropagation()})},_onDeleteClicked:function(){this.dialogDeleteConfirm.karldialog("open")},_onDeleteConfirmed:function(){var t=this;var C=this.getSelectedFiles();$.ajax({url:this.options.delete_url,type:"POST",dataType:"json",timeout:20000,data:{file:C},success:function(E,F,D){if(E&&E.result=="OK"){t._onDeleteSuccess(E)}else{t._onDeleteError(E)}},error:function(D,F,E){t._onDeleteError({result:"ERROR",error:"Unknown server error: "+F})}})},_onDeleteSuccess:function(C){var t=""+C.deleted+" file(s) succesfully deleted";$(".statusbox").karlstatusbox("clearAndAppend",t);this._update({columns:false,refresh:true})},_onDeleteError:function(C){var t="Deletion failed: "+C.error;$(".statusbox").karlstatusbox("clearAndAppend",t)},_onMoveClicked:function(){this.menuMove.show();this.menuMove.position({my:"left bottom",at:"left top",of:this.button_move,collision:"fit"});this.menuMove.focus()},_onMoveSelected:function(t){this.dialogMoveFolderName.text(t.title).data("folder",t);this.dialogMoveConfirm.karldialog("open")},_onMoveConfirmed:function(C){var t=this;var D=this.getSelectedFiles();$.ajax({url:this.options.moveto_url,type:"POST",dataType:"json",timeout:20000,data:{file:D,target_folder:C.path},success:function(F,G,E){if(F&&F.result=="OK"){t._onMoveSuccess(F)}else{t._onMoveError(F)}},error:function(E,G,F){t._onMoveError({result:"ERROR",error:"Unknown server error: "+G})}})},_onMoveSuccess:function(C){var t="Moved "+C.moved+' selected files/folders to <a href="'+C.targetFolderUrl+'">'+C.targetFolderTitle+"</a>";$(".statusbox").karlstatusbox("clearAndAppend",t);this._update({columns:false,refresh:true})},_onMoveError:function(C){var t="Move To failed: "+C.error;$(".statusbox").karlstatusbox("clearAndAppend",t)},_onDownloadClicked:function(){var C=this.getSelectedTotalSize();if(C<20971520){var t=this.getSelectedFiles().length;this.dialogDownloadItems.text(t).data("items",t);this.dialogDownloadConfirm.karldialog("open")}else{alert("Maximum download size is 20 MB. Total size for selected files is "+parseInt(C/1000000)+" MB.")}},_onDownloadConfirmed:function(){var C=this.getSelectedFiles();var t=this.options.download_url;var D=$.param({filenames:C});window.location.href=t+"?"+D}}));$.widget("ui.karldialog",$.extend({},$.ui.dialog.prototype,{options:$.extend({},$.ui.dialog.prototype.options,{autoOpen:false,modal:true,draggable:false,resizable:false,bgiframe:true,hide:"fold"}),open:function(){if(this._isOpen){return}var C=this.options,t=this.uiDialog;this.overlay=C.modal?new $.ui.dialog.overlay(this):null;(t.next().length&&t.appendTo("body"));this._size();this._position(C.position);t.show(C.show);this.moveToTop(true);(C.modal&&t.bind("keypress.ui-dialog",function(F){if(F.keyCode!=$.ui.keyCode.TAB){return}var E=$(":tabbable",this),G=E.filter(":first")[0],D=E.filter(":last")[0];if(F.target==D&&!F.shiftKey){setTimeout(function(){G.focus()},1)}else{if(F.target==G&&F.shiftKey){setTimeout(function(){D.focus()},1)}}}));t.focus();this._trigger("open");this._isOpen=true},position:function(t){return this.uiDialog.position(t)}}));$.widget("ui.karlmultiupload",{options:{selectorStub:".muf-stub",selectorCloseButton:".muf-closebutton",selectorAddButton:".muf-addbutton"},_create:function(){var C=this;this.stub=this.element.find(this.options.selectorStub);var t=this.stub.hide().find("input");this.name=t.attr("name");t.removeAttr("name");this.element.find(this.options.selectorAddButton).click(function(D){C._add();D.preventDefault()})},_add:function(){var t=this.stub.clone().insertBefore(this.stub);var C=t.find("input");C.attr("name",this.name+this._getCounter());t.find(this.options.selectorCloseButton).click(function(D){t.remove();D.preventDefault()});t.show()},_getCounter:function(){this.counter=this.counter||0;return this.counter++}});$.widget("ui.karlsingleupload",{options:{selectorStub:".sif-stub",selectorNoChange:".sif-nochange",selectorUpload:".sif-upload"},_create:function(){var C=this;this.stub=this.element.find(this.options.selectorStub);var t=this.stub.hide().find("input");this.name=t.attr("name");t.removeAttr("name");this.element.find(this.options.selectorNoChange).click(function(D){if(C.real){C._del()}});this.element.find(this.options.selectorUpload).click(function(D){if(!C.real){C._add()}})},_add:function(){var C=this.real=this.stub.clone().insertBefore(this.stub);var t=C.find("input");t.attr("name",this.name);C.show()},_del:function(){this.real.remove();this.real=null}});$.widget("ui.karlquotablecomment",{options:{selectorText:".commentText",selectorPasteButton:".quo-paste",wrapperPre:'<div class="quotedreplytext">',wrapperPost:"</div><div><p></p></div>"},_create:function(){var t=this;this.text=this.element.find(this.options.selectorText);this.element.find(this.options.selectorPasteButton).click(function(C){t.pasteToActiveTiny();C.preventDefault()})},pasteToActiveTiny:function(){var t=this.text.html();var C=tinyMCE.activeEditor;C.focus();C.selection.setContent(this.options.wrapperPre+t+this.options.wrapperPost)}});$.widget("ui.karldatetimepicker",{options:{zIndex:undefined},_create:function(){var C=this;if(!jQuery.nodeName(this.element[0],"input")){throw new Error("ui.karldatetimepicker can only be bound to <input> nodes.")}this.container=$('<span class="ui-karldatetimepicker-container"></span>');this.element.hide().after(this.container);this.dateinput=$('<input class="ui-karldatetimepicker-dateinput"></input>').appendTo(this.container);if(this.options.zIndex){this.dateinput.css("position","relative").zIndex(this.options.zIndex-1)}var t=this.options.dateFormat||undefined;this.dateinput.datepicker({dateFormat:t}).change(function(F){C.setDate($(F.target).val())});this.hourinput=$('<select class="ui-karldatetimepicker-hourinput"></input>').appendTo(this.container).change(function(F){C.setHour($(F.target).val())});for(var E=0;E<24;E++){$("<option>").val(E).text(E).appendTo(this.hourinput)}this.container.append('<span class="ui-karldatetimepicker-colon">:</span>');this.minuteinput=$('<select class="ui-karldatetimepicker-hourinput"></input>').appendTo(this.container).change(function(F){C.setMinute($(F.target).val())});for(var E=0;E<4;E++){var D=("0"+E*15).slice(-2);$("<option>").val(D).text(D).appendTo(this.minuteinput)}this.set(this.element.val())},set:function(D){var E=D.search(" ");var t=D.substr(E+1);var C=t.search(":");this.composite_value={datestr:D.substr(0,E),hourstr:D.substr(E+1,C).replace(/^0/,""),minutestr:D.substr(E+C+2)};this.dateinput.val(this.composite_value.datestr);this.hourinput.val(this.composite_value.hourstr);this.minuteinput.val(this.composite_value.minutestr);this.element.val(D);this.element.trigger("change.karldatetimepicker")},setDate:function(t){this.composite_value.datestr=t;this.dateinput.val(this.composite_value.datestr);this._updateComposite()},setHour:function(t){this.composite_value.hourstr=t;this.hourinput.val(this.composite_value.hourstr);this._updateComposite()},setMinute:function(t){this.composite_value.minutestr=t;this.minuteinput.val(this.composite_value.minutestr);this._updateComposite()},_updateComposite:function(){var t=this.composite_value.datestr+" "+this.composite_value.hourstr+":"+this.composite_value.minutestr;this.element.val(t);this.element.trigger("change.karldatetimepicker")},getAsDate:function(){var F=this.element.val();var H=F.lastIndexOf(" ");var D=F.lastIndexOf(":");var E=F.substring(0,H);var C=F.substring(H+1,D);var G=F.substring(D+1);var t=$.datepicker.parseDate(this.options.dateFormat,E);var I=new Date(t.getFullYear(),t.getMonth(),t.getDate(),Number(C),Number(G));return I},setAsDate:function(t){var E=function(F){var G="0"+F;return G.substr(G.length-2,2)};var D=$.datepicker.formatDate(this.options.dateFormat,t);var C=D+" "+E(t.getHours())+":"+E(t.getMinutes());this.set(C)},limitMinMax:function(D,t){var E=this.getAsDate();var C=null;if(D&&E<D){C=D}if(t&&E>t){C=t}if(C!=null){this.setAsDate(C);this.dateinput.effect("pulsate",{times:1},800);if(this.hourinput.is(":visible")){this.hourinput.effect("pulsate",{times:1},800);this.minuteinput.effect("pulsate",{times:1},800)}}}});$.widget("ui.karldropdown",{options:{},_create:function(){var t=this;this._locate();this.menu.hide();$("<div>").attr("class","karldropdown-indicator ui-icon ui-icon-triangle-1-s").insertBefore(this.menu);this.element.mouseenter(function(){t.show()}).mouseleave(function(){t.hide()});this.items.mouseover(function(){t.hoverItem(this)});this.current_item=null;this.padding_left=0},_locate:function(){this.heading=this.element.find("> .karldropdown-heading");this.menu=this.element.find("> .karldropdown-menu");this.items=this.menu.find("> li")},show:function(){var C=this.element.height();this.menu.css("position","absolute").css("left",0).css("top",C);var D=this.element.find(":first");this.padding_left=Math.round(D.position().left+parseFloat(D.css("padding-left"))||0);this.resetAllItems();this.menu.stop(true,true).slideDown(150);var t=0;this.items.each(function(){var E;if(jQuery.browser.msie){E=this.offsetWidth}else{E=$(this).width()}t=Math.max(t,E)}).each(function(){$(this).width(t)})},hide:function(){this.resetAllItems();this.current_item=null;this.menu.stop(true,true).fadeOut(50)},resetAllItems:function(){var t=this;this.items.each(function(){t.resetItem(this)})},resetItem:function(t){$(t).stop(true,true).css("backgroundColor","#666666").css("color","#000000").css("paddingLeft",this.padding_left).css("paddingRight","11px")},hoverItem:function(C){var t=this;if(this.items.index(this.current_item)==this.items.index(C)){return}if(this.current_item){this.leaveItem(this.current_item)}var C=$(C);C.stop(true,true).animate({backgroundColor:"#cecece",color:"#ffffff"},100).animate({paddingLeft:t.padding_left+6,paddingRight:"5px"},150);this.current_item=C},leaveItem:function(C){var t=this;var C=$(C);C.stop(true,true).animate({paddingLeft:t.padding_left,paddingRight:"11px"},50).css("backgroundColor","#666666").css("color","#000000");this.current_item=null}});jQuery.fn.identify=function(){var t=0;return this.each(function(){if($(this).attr("id")){return}do{t++;var C="anon_"+t}while($("#"+C).length>0);$(this).attr("id",C)}).attr("id")};var w={};function A(t){var C=$(t.target);if(!C.hasClass("cal_hour_event")){var C=C.parents(".cal_hour_event")}if(!C){return}var D=C.identify("a");w[D]=true;setTimeout(function(){if(w[D]){C.addClass("hov");C.next().addClass("hov_below")}},200)}function q(t){var C=$(t.target);if(!C.hasClass("cal_hour_event")){var C=C.parents(".cal_hour_event")}if(!C){return}var D=C.identify("a");delete w[D];setTimeout(function(){if(!w[D]){C.removeClass("hov");C.next().removeClass("hov_below")}},200)}function z(t){var C=$(this);var D=C.identify("a");w[D]=true;setTimeout(function(){if(w[D]){C.addClass("hov")}},200)}function u(t){var C=$(this);var D=C.identify("a");delete w[D];setTimeout(function(){if(!w[D]){C.removeClass("hov")}},200)}function s(){var E=$("#cal_time");if(E.length==0){return}if(E.hasClass("today")){var F=new Date();var t=F.getHours()*60+F.getMinutes();var G=1000}else{var t=740;var G=0;E.css("visibility","hidden")}var I=1440;var J=parseInt(t/I*100);var D=$("#cal_scroll").height();var H=parseInt(D*J/100);E.css("top",H+"px").show();var C=H-250>0?H-250:0;$("#cal_hours_scroll").scrollTo(C,{duration:G})}$.fn.myTooltip=function(t){return this.each(function(){var D=$(this);var C=D.next();var E=$("<div></div>").height(C.height()).css("overflow","hidden");C.wrapInner(E);D.tooltip(t)})};function n(){$("#cal_picker").change(function(){var E=this.options[this.selectedIndex].value.split("?filter=");javascript:document.location=E[0]+"?filter="+escape(E[1])});$("#cal_month td").hover(z,u);$("#cal_month .with_tooltip").myTooltip({tip:".tooltip",offset:[8,50],predelay:250});var D=$("#cal_hours_scroll");D.mouseover(A);D.mouseout(q);$("#all_day td").hover(z,u);var t=$("#cal_scroll");if(t.hasClass("cal_week")){$("#all_day .with_tooltip").myTooltip({tip:".tooltip",offset:[8,-48],predelay:250});$("#cal_scroll .cal_hour_event .with_tooltip").myTooltip({tip:".tooltip",offset:[12,5],predelay:250})}var C=$("#karl-here-url").eq(0).attr("content");$(".cal-buttonbar").karlcalendarbuttons({selection:window.karl_client_data&&karl_client_data.calendar_selection||null,change:function(E,H){var I;var G="";if(H.viewtype=="list"){I="list.html";G="&term="+H.term}else{I={month:"month.html",week:"week.html",day:"day.html"}[H.term]}var F=C+I+"?year="+H.year+"&month="+H.month+"&day="+H.day+G;$(this).karlcalendarbuttons("disable");document.location.href=F}});$(".cal_actions a.cal_print").click(function(){var F=$(".cal_scroll");var H=$(".cal_hours_scroll");var G=F.height();var E=H.height();H.height(G);var I=$(".karl-calendar-narrow").removeClass("karl-calendar-narrow").addClass("karl-calendar-wide");$("body").addClass("karl-calendar-printing");window.focus();window.print();H.height(E);I.removeClass("karl-calendar-wide").addClass("karl-calendar-narrow");$("body").removeClass("karl-calendar-printing");return false});s()}function o(){if($("#save-start_date").length==0||$("#save-end_date").length==0){return}y();k();if($("#save-all_day").val()=="True"){var t='checked="checked"';B()}else{var t="";e()}var C='<span class="all_day"><input type="checkbox" id="cal_all_day" name="allDay" '+t+' /><label for="cal_all_day">All-day</label></span>';$("div.save-start_date > div.inputs").append(C);$("#cal_all_day").click(function(){c();if(this.checked){$("#save-all_day").val("True");B()}else{$("#save-all_day").val("False");e()}})}function y(){$("#save-start_date").karldatetimepicker({dateFormat:karl_client_data.js_date_format,zIndex:20000}).bind("change.karldatetimepicker",function(){$("#save-end_date").karldatetimepicker("limitMinMax",new Date($(this).karldatetimepicker("getAsDate").valueOf()+3600000),null)})}function k(){$("#save-end_date").karldatetimepicker({dateFormat:karl_client_data.js_date_format,zIndex:20000}).bind("change.karldatetimepicker",function(){$(this).karldatetimepicker("limitMinMax",$("#save-start_date").karldatetimepicker("getAsDate"),null)})}function B(){$("div.save-start_date select").hide();$("div.save-start_date .ui-karldatetimepicker-colon").hide();$("div.save-end_date select").hide();$("div.save-end_date .ui-karldatetimepicker-colon").hide()}function e(){$("div.save-start_date select").show();$("div.save-start_date .ui-karldatetimepicker-colon").show();$("div.save-end_date select").show();$("div.save-end_date .ui-karldatetimepicker-colon").show()}function c(){$("div.save-start_date").removeClass("error");$("div.save-start_date > span.error").remove();$("div.save-end_date").removeClass("error");$("div.save-end_date > span.error").remove()}function h(){$(".add_button").click(function(D){D.preventDefault();var E=$(D.target).parents(".setup_group");E.find(".add_button").hide("fast");E.find(".cal_add").show("slow")});$('.cal_add button[name="form.cancel"]').click(function(E){E.preventDefault();var D=$("div.portalMessage");if(D){D.remove()}var F=$(E.target).parents(".setup_group");F.find(".add_button").show("fast");F.find(".cal_add").hide("slow");$(this).parents("form")[0].reset()});var t=$("#fielderrors_target").val();if(t.length>0){if(t=="__add_category__"){var C="#setup_add_category_form"}else{if(t=="__add_layer__"){var C="#setup_add_layer_form"}else{var C="#edit_"+t+"_form"}}$(C).show()}$(".cal_all .edit_action").click(function(D){D.preventDefault();var E=$(D.target).parents(".setup_group");E.find("form").hide("slow");E.find(".add_button").hide("fast");var F="#"+$(this).identify()+"_form";$(F).show("slow")});$('.cal_edit button[name="form.cancel"]').click(function(E){E.preventDefault();var D=$("div.portalMessage");if(D){D.remove()}var F=$(E.target).parents(".setup_group");F.find(".add_button").show("fast");F.find("form").hide("slow");$(this).parents("form")[0].reset()});g();if($("select.category_paths").length>0){v()}}function v(){$("a.add").click(function(C){C.preventDefault();var D=$(this).parents("fieldset").find(".layers");var E=D.find("tr:last");E.clone().appendTo(D).find("option").removeAttr("selected");t()});$("a.remove").live("click",function(C){C.preventDefault();$(this).parents("tr").remove();t()});function t(){$(".layers").each(function(){var C=$(this).find("td a.remove");C.css("display",C.length>1?"inline":"none")})}t()}function g(){$("a.delete_category_action").bind("click",function(C){if(confirm("Are you sure?")){var t=this.id.substring(16);$("#cal_delete_category_form > input[name=form.delete]").val(t);$("#cal_delete_category_form").submit()}return false});$("a.delete_layer_action").bind("click",function(C){if(confirm("Are you sure?")){var t=this.id.substring(13);$("#cal_delete_layer_form > input[name=form.delete]").val(t);$("#cal_delete_layer_form").submit()}return false})}$(document).ready(function(){x();var D=$("#karl-app-url").eq(0).attr("content");var E=$("#karl-here-url").eq(0).attr("content");var H=window.karl_client_data&&karl_client_data.tagbox||{};var J=function(){if(!H.records){throw"karl_client_data.tagbox not specified or has no records."}};var L=$("#tagsearch-input");if(L.length>0){J()}L.karltagbox({validateRegexp:"^[a-zA-Z0-9-._]+$",ajax:D+"/jquery_tag_search",ajaxAdd:E+"jquery_tag_add",ajaxDel:E+"jquery_tag_del",prevals:H.records,docid:H.docid,showtag_url:D+"/showtag/",tagusers_url:D+"/tagusers.html"});var F=$("#membersearch-input");F.karlmemberbox({ajax:E+"jquery_member_search",showtag_url:D+"/profiles/",name:"users"});$(".blogComment").karlquotablecomment({});$("img.tiny-imagedrawer-captioned").karlcaptionedimage({});a();if($(".button").length>0){$("#form-submit").click(function(){$("#form-cancel").attr("disabled","disabled")});$("#form-cancel").click(function(){$("#form-submit").attr("disabled","disabled")});$("form.k3_genericForm").keyup(function(M){if(M.keyCode==13){$("#form-cancel").attr("disabled","disabled")}})}var G=$(".search-community-button").button({}).css("verticalAlign","top");var K=$(".search-community-input");var C=G.outerHeight();var t=$("<span></span>");t.css("display","inline-block").css("margin","0").css("padding","0").css("border","0").css("height",C+"px").css("verticalAlign","top");K.wrap(t).css("margin","0").css("padding","0 3px").css("height",""+(C-2)+"px").css("lineHeight",""+(C-2)+"px");var I=G.css("marginTop");K.css("marginTop",I);if($.browser.msie&&parseInt($.browser.version)==7){G.css("marginTop","1px")}if($.browser.msie&&parseInt($.browser.version)==8){G.css("marginTop","1px")}rcol=$(".generic-layout .rightcol").html();if($.trim(rcol)==""){$(".generic-layout #center").addClass("fill-width")}if($("table.cal").length>0){n()}if($("div.save-category").length>0){o()}if($("#setup_add_cal").length>0){h()}$(".generic-portlet .portlet-item").hover(function(){$(this).css("background-color","#f0f2f4")},function(){$(this).css("background-color","transparent")})});f.themeroller=function(){if(window.jquitr){jquitr.addThemeRoller()}else{jquitr={};jquitr.s=document.createElement("script");jquitr.s.src="http://jqueryui.com/themeroller/developertool/developertool.js.php";document.getElementsByTagName("head")[0].appendChild(jquitr.s)}};f.log=function(){if(window.console&&console.log){console.log(Array.prototype.slice.call(arguments))}};jQuery.fn.extend({outerHtml:function(D){if(D){return this.each(function(){$(this).replaceWith(D)})}var C=$("<div></div>").append($(this).clone());var t=C.html();C.remove();return t}});f.clear_lock_on_unload=function(){var D=$("#karl-here-url").eq(0).attr("content");var t=D.match(/\/$/)?"":"/";var C=D+t+"unlock.html";$(window).bind("unload",function(){if(!window.preventUnlock){$.ajax({type:"POST",url:C,data:{},async:false})}})}})();