/* 
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(d){d.fn.drag=function(c,f,i){var h=typeof c=="string"?c:"",g=d.isFunction(c)?c:d.isFunction(f)?f:null;if(h.indexOf("drag")!==0){h="drag"+h}i=(c==g?f:i)||{};return g?this.bind(h,i,g):this.trigger(h)};var a=d.event,b=a.special,e=b.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",livekey:"livedrag",add:function(c){var f=d.data(this,e.datakey),g=c.data||{};f.related+=1;if(!f.live&&c.selector){f.live=true;a.add(this,"draginit."+e.livekey,e.delegate)}d.each(e.defaults,function(h){if(g[h]!==undefined){f[h]=g[h]}})},remove:function(){d.data(this,e.datakey).related-=1},setup:function(){if(!d.data(this,e.datakey)){var c=d.extend({related:0},e.defaults);d.data(this,e.datakey,c);a.add(this,"mousedown",e.init,c);this.attachEvent&&this.attachEvent("ondragstart",e.dontstart)}},teardown:function(){if(!d.data(this,e.datakey).related){d.removeData(this,e.datakey);a.remove(this,"mousedown",e.init);a.remove(this,"draginit",e.delegate);e.textselect(true);this.detachEvent&&this.detachEvent("ondragstart",e.dontstart)}},init:function(c){var f=c.data,g;if(!(f.which>0&&c.which!=f.which)){if(!d(c.target).is(f.not)){if(!(f.handle&&!d(c.target).closest(f.handle,c.currentTarget).length)){f.propagates=1;f.interactions=[e.interaction(this,f)];f.target=c.target;f.pageX=c.pageX;f.pageY=c.pageY;f.dragging=null;g=e.hijack(c,"draginit",f);if(f.propagates){if((g=e.flatten(g))&&g.length){f.interactions=[];d.each(g,function(){f.interactions.push(e.interaction(this,f))})}f.propagates=f.interactions.length;f.drop!==false&&b.drop&&b.drop.handler(c,f);e.textselect(false);a.add(document,"mousemove mouseup",e.handler,f);return false}}}}},interaction:function(c,f){return{drag:c,callback:new e.callback,droppable:[],offset:d(c)[f.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(c){var f=c.data;switch(c.type){case !f.dragging&&"mousemove":if(Math.pow(c.pageX-f.pageX,2)+Math.pow(c.pageY-f.pageY,2)<Math.pow(f.distance,2)){break}c.target=f.target;e.hijack(c,"dragstart",f);if(f.propagates){f.dragging=true}case"mousemove":if(f.dragging){e.hijack(c,"drag",f);if(f.propagates){f.drop!==false&&b.drop&&b.drop.handler(c,f);break}c.type="mouseup"}case"mouseup":a.remove(document,"mousemove mouseup",e.handler);if(f.dragging){f.drop!==false&&b.drop&&b.drop.handler(c,f);e.hijack(c,"dragend",f)}e.textselect(true);if(f.click===false&&f.dragging){jQuery.event.triggered=true;setTimeout(function(){jQuery.event.triggered=false},20);f.dragging=false}break}},delegate:function(c){var f=[],h,g=d.data(this,"events")||{};d.each(g.live||[],function(i,l){if(l.preType.indexOf("drag")===0){if(h=d(c.target).closest(l.selector,c.currentTarget)[0]){a.add(h,l.origType+"."+e.livekey,l.origHandler,l.data);d.inArray(h,f)<0&&f.push(h)}}});if(!f.length){return false}return d(f).bind("dragend."+e.livekey,function(){a.remove(this,"."+e.livekey)})},hijack:function(u,v,t,s,p){if(t){var q={event:u.originalEvent,type:u.type},f=v.indexOf("drop")?"drag":"drop",i,c=s||0,r,h;s=!isNaN(s)?s:t.interactions.length;u.type=v;u.originalEvent=null;t.results=[];do{if(r=t.interactions[c]){if(!(v!=="dragend"&&r.cancelled)){h=e.properties(u,t,r);r.results=[];d(p||r[f]||t.droppable).each(function(g,j){i=(h.target=j)?a.handle.call(j,u,h):null;if(i===false){if(f=="drag"){r.cancelled=true;t.propagates-=1}if(v=="drop"){r[f][g]=null}}else{if(v=="dropinit"){r.droppable.push(e.element(i)||j)}}if(v=="dragstart"){r.proxy=d(e.element(i)||r.drag)[0]}r.results.push(i);delete u.result;if(v!=="dropinit"){return i}});t.results[c]=e.flatten(r.results);if(v=="dropinit"){r.droppable=e.flatten(r.droppable)}v=="dragstart"&&!r.cancelled&&h.update()}}}while(++c<s);u.type=q.type;u.originalEvent=q.event;return e.flatten(t.results)}},properties:function(c,f,h){var g=h.callback;g.drag=h.drag;g.proxy=h.proxy||h.drag;g.startX=f.pageX;g.startY=f.pageY;g.deltaX=c.pageX-f.pageX;g.deltaY=c.pageY-f.pageY;g.originalX=h.offset.left;g.originalY=h.offset.top;g.offsetX=c.pageX-(f.pageX-g.originalX);g.offsetY=c.pageY-(f.pageY-g.originalY);g.drop=e.flatten((h.drop||[]).slice());g.available=e.flatten((h.droppable||[]).slice());return g},element:function(c){if(c&&(c.jquery||c.nodeType==1)){return c}},flatten:function(c){return d.map(c,function(f){return f&&f.jquery?d.makeArray(f):f&&f.length?e.flatten(f):f})},textselect:function(c){d(document)[c?"unbind":"bind"]("selectstart",e.dontstart).attr("unselectable",c?"off":"on").css("MozUserSelect",c?"":"none")},dontstart:function(){return false},callback:function(){}};e.callback.prototype={update:function(){b.drop&&this.available.length&&d.each(this.available,function(c){b.drop.locate(this,c)})}};b.draginit=b.dragstart=b.dragend=e})(jQuery);
/* 
 * jquery.event.drop - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(e){e.fn.drop=function(j,b,i){var f=typeof j=="string"?j:"",h=e.isFunction(j)?j:e.isFunction(b)?b:null;if(f.indexOf("drop")!==0){f="drop"+f}i=(j==h?b:i)||{};return h?this.bind(f,i,h):this.trigger(f)};e.drop=function(b){b=b||{};a.multi=b.multi===true?Infinity:b.multi===false?1:!isNaN(b.multi)?b.multi:a.multi;a.delay=b.delay||a.delay;a.tolerance=e.isFunction(b.tolerance)?b.tolerance:b.tolerance===null?null:a.tolerance;a.mode=b.mode||a.mode||"intersect"};var c=e.event,d=c.special,a=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",livekey:"livedrop",add:function(f){var b=e.data(this,a.datakey);b.related+=1;if(!b.live&&f.selector){b.live=true;c.add(this,"dropinit."+a.livekey,a.delegate)}},remove:function(){e.data(this,a.datakey).related-=1},setup:function(){if(!e.data(this,a.datakey)){e.data(this,a.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}});a.targets.push(this)}},teardown:function(){if(!e.data(this,a.datakey).related){e.removeData(this,a.datakey);c.remove(this,"dropinit",a.delegate);var b=this;a.targets=e.grep(a.targets,function(f){return f!==b})}},handler:function(g,b){var f;if(b){switch(g.type){case"mousedown":f=e(a.targets);if(typeof b.drop=="string"){f=f.filter(b.drop)}f.each(function(){var h=e.data(this,a.datakey);h.active=[];h.anyactive=0;h.winner=0});b.droppable=f;a.delegates=[];d.drag.hijack(g,"dropinit",b);a.delegates=e.unique(d.drag.flatten(a.delegates));break;case"mousemove":a.event=g;a.timer||a.tolerate(b);break;case"mouseup":a.timer=clearTimeout(a.timer);if(b.propagates){d.drag.hijack(g,"drop",b);d.drag.hijack(g,"dropend",b);e.each(a.delegates||[],function(){c.remove(this,"."+a.livekey)})}break}}},delegate:function(i){var b=[],h,f=e.data(this,"events")||{};e.each(f.live||[],function(j,g){if(g.preType.indexOf("drop")===0){h=e(i.currentTarget).find(g.selector);h.length&&h.each(function(){c.add(this,g.origType+"."+a.livekey,g.origHandler,g.data);e.inArray(this,b)<0&&b.push(this)})}});a.delegates.push(b);return b.length?e(b):false},locate:function(l,b){var k=e.data(l,a.datakey),i=e(l),j=i.offset()||{},f=i.outerHeight();i=i.outerWidth();j={elem:l,width:i,height:f,top:j.top,left:j.left,right:j.left+i,bottom:j.top+f};if(k){k.location=j;k.index=b;k.elem=l}return j},contains:function(f,b){return(b[0]||b.left)>=f.left&&(b[0]||b.right)<=f.right&&(b[1]||b.top)>=f.top&&(b[1]||b.bottom)<=f.bottom},modes:{intersect:function(g,b,f){return this.contains(f,[g.pageX,g.pageY])?1000000000:this.modes.overlap.apply(this,arguments)},overlap:function(g,b,f){return Math.max(0,Math.min(f.bottom,b.bottom)-Math.max(f.top,b.top))*Math.max(0,Math.min(f.right,b.right)-Math.max(f.left,b.left))},fit:function(g,b,f){return this.contains(f,b)?1:0},middle:function(g,b,f){return this.contains(f,[b.left+b.width*0.5,b.top+b.height*0.5])?1:0}},sort:function(f,b){return b.winner-f.winner||f.index-b.index},tolerate:function(w){var x,v,t,u,s,l,r=0,q,b=w.interactions.length,i=[a.event.pageX,a.event.pageY],f=a.tolerance||a.modes[a.mode];do{if(q=w.interactions[r]){if(!q){return}q.drop=[];s=[];l=q.droppable.length;if(f){t=a.locate(q.proxy)}x=0;do{if(v=q.droppable[x]){u=e.data(v,a.datakey);if(v=u.location){u.winner=f?f.call(a,a.event,t,v):a.contains(v,i)?1:0;s.push(u)}}}while(++x<l);s.sort(a.sort);x=0;do{if(u=s[x]){if(u.winner&&q.drop.length<a.multi){if(!u.active[r]&&!u.anyactive){if(d.drag.hijack(a.event,"dropstart",w,r,u.elem)[0]!==false){u.active[r]=1;u.anyactive+=1}else{u.winner=0}}u.winner&&q.drop.push(u.elem)}else{if(u.active[r]&&u.anyactive==1){d.drag.hijack(a.event,"dropend",w,r,u.elem);u.active[r]=0;u.anyactive-=1}}}}while(++x<l)}}while(++r<b);if(a.last&&i[0]==a.last.pageX&&i[1]==a.last.pageY){delete a.timer}else{a.timer=setTimeout(function(){a.tolerate(w)},a.delay)}a.last=a.event}};d.dropinit=d.dropstart=d.dropend=a})(jQuery);(function(c){c.extend(true,window,{Slick:{Event:h,EventData:g,EventHandler:i,Range:b,NonDataRow:e,Group:f,GroupTotals:d,EditorLock:a,GlobalEditorLock:new a()}});function g(){var j=false;var k=false;this.stopPropagation=function(){j=true};this.isPropagationStopped=function(){return j};this.stopImmediatePropagation=function(){k=true};this.isImmediatePropagationStopped=function(){return k}}function h(){var j=[];this.subscribe=function(k){j.push(k)};this.unsubscribe=function(l){for(var k=j.length-1;k>=0;k--){if(j[k]===l){j.splice(k,1)}}};this.notify=function(k,o,n){o=o||new g();n=n||this;var m;for(var l=0;l<j.length&&!(o.isPropagationStopped()||o.isImmediatePropagationStopped());l++){m=j[l].call(n,o,k)}return m}}function i(){var j=[];this.subscribe=function(l,k){j.push({event:l,handler:k});l.subscribe(k)};this.unsubscribe=function(m,l){var k=j.length;while(k--){if(j[k].event===m&&j[k].handler===l){j.splice(k,1);m.unsubscribe(l);return}}};this.unsubscribeAll=function(){var k=j.length;while(k--){j[k].event.unsubscribe(j[k].handler)}j=[]}}function b(k,j,l,m){if(l===undefined&&m===undefined){l=k;m=j}this.fromRow=Math.min(k,l);this.fromCell=Math.min(j,m);this.toRow=Math.max(k,l);this.toCell=Math.max(j,m);this.isSingleRow=function(){return this.fromRow==this.toRow};this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell};this.contains=function(o,n){return o>=this.fromRow&&o<=this.toRow&&n>=this.fromCell&&n<=this.toCell};this.toString=function(){if(this.isSingleCell()){return"("+this.fromRow+":"+this.fromCell+")"}else{return"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}}function e(){this.__nonDataRow=true}function f(){this.__group=true;this.__updated=false;this.count=0;this.value=null;this.title=null;this.collapsed=false;this.totals=null}f.prototype=new e();f.prototype.equals=function(j){return this.value===j.value&&this.count===j.count&&this.collapsed===j.collapsed};function d(){this.__groupTotals=true;this.group=null}d.prototype=new e();function a(){var j=null;this.isActive=function(l){return(l?j===l:j!==null)};this.activate=function(l){if(l===j){return}if(j!==null){throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController"}if(!l.commitCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()"}if(!l.cancelCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()"}j=l};this.deactivate=function(l){if(j!==l){throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one"}j=null};this.commitCurrentEdit=function(){return(j?j.commitCurrentEdit():true)};this.cancelCurrentEdit=function k(){return(j?j.cancelCurrentEdit():true)}}})(jQuery);(function(b){b.extend(true,window,{Slick:{RowSelectionModel:a}});function a(f){var r;var o=[];var i=this;var n=new Slick.EventHandler();var m;var q;var s={selectActiveRow:true};function t(x){q=b.extend(true,{},s,f);r=x;n.subscribe(r.onActiveCellChanged,e(v));n.subscribe(r.onKeyDown,e(l));n.subscribe(r.onClick,e(k))}function w(){n.unsubscribeAll()}function e(x){return function(){if(!m){m=true;x.apply(this,arguments);m=false}}}function g(x){var A=[];for(var z=0;z<x.length;z++){for(var y=x[z].fromRow;y<=x[z].toRow;y++){A.push(y)}}return A}function h(A){var y=[];var x=r.getColumns().length-1;for(var z=0;z<A.length;z++){y.push(new Slick.Range(A[z],0,A[z],x))}return y}function u(A,z){var x,y=[];for(x=A;x<=z;x++){y.push(x)}for(x=z;x<A;x++){y.push(x)}return y}function d(){return g(o)}function j(x){c(h(x))}function c(x){o=x;i.onSelectedRangesChanged.notify(o)}function p(){return o}function v(y,x){if(q.selectActiveRow){c([new Slick.Range(x.row,0,x.row,r.getColumns().length-1)])}}function l(C){var y=r.getActiveCell();if(y&&C.shiftKey&&!C.ctrlKey&&!C.altKey&&!C.metaKey&&(C.which==38||C.which==40)){var B=d();B.sort(function(D,E){return D-E});if(!B.length){B=[y.row]}var A=B[0];var x=B[B.length-1];var z;if(C.which==40){z=y.row<x||A==x?++x:++A}else{z=y.row<x?--x:--A}if(z>=0&&z<r.getDataLength()){r.scrollRowIntoView(z);o=h(u(A,x));c(o)}C.preventDefault();C.stopPropagation()}}function k(C){var y=r.getCellFromEvent(C);if(!y||!r.canCellBeActive(y.row,y.cell)){return false}var A=g(o);var x=b.inArray(y.row,A);if(!C.ctrlKey&&!C.shiftKey&&!C.metaKey){return false}else{if(r.getOptions().multiSelect){if(x===-1&&(C.ctrlKey||C.metaKey)){A.push(y.row);r.setActiveCell(y.row,y.cell)}else{if(x!==-1&&(C.ctrlKey||C.metaKey)){A=b.grep(A,function(G,F){return(G!==y.row)});r.setActiveCell(y.row,y.cell)}else{if(A.length&&C.shiftKey){var B=A.pop();var E=Math.min(y.row,B);var D=Math.max(y.row,B);A=[];for(var z=E;z<=D;z++){if(z!==B){A.push(z)}}A.push(B);r.setActiveCell(y.row,y.cell)}}}}}o=h(A);c(o);C.stopImmediatePropagation();return true}b.extend(this,{getSelectedRows:d,setSelectedRows:j,getSelectedRanges:p,setSelectedRanges:c,init:t,destroy:w,onSelectedRangesChanged:new Slick.Event()})}})(jQuery);(function(a){a.extend(true,window,{Slick:{CheckboxSelectColumn:b}});function b(q){var i;var h=this;var p={};var f={columnId:"_checkbox_selector",cssClass:null,toolTip:"Select/Deselect All",width:30};var n=a.extend(true,{},f,q);function o(r){i=r;i.onSelectedRowsChanged.subscribe(j);i.onClick.subscribe(g);i.onHeaderClick.subscribe(m);i.onKeyDown.subscribe(c)}function k(){i.onSelectedRowsChanged.unsubscribe(j);i.onClick.unsubscribe(g);i.onHeaderClick.unsubscribe(m);i.onKeyDown.unsubscribe(c)}function j(v,r){var u=i.getSelectedRows();var t={},w,s;for(s=0;s<u.length;s++){w=u[s];t[w]=true;if(t[w]!==p[w]){i.invalidateRow(w);delete p[w]}}for(s in p){i.invalidateRow(s)}p=t;i.render();if(u.length==i.getDataLength()){i.updateColumnHeader(n.columnId,"<input type='checkbox' checked='checked'>",n.toolTip)}else{i.updateColumnHeader(n.columnId,"<input type='checkbox'>",n.toolTip)}}function c(s,r){if(s.which==32){if(i.getColumns()[r.cell].id===n.columnId){if(!i.getEditorLock().isActive()||i.getEditorLock().commitCurrentEdit()){l(r.row)}s.preventDefault();s.stopImmediatePropagation()}}}function g(s,r){if(i.getColumns()[r.cell].id===n.columnId&&a(s.target).is(":checkbox")){if(i.getEditorLock().isActive()&&!i.getEditorLock().commitCurrentEdit()){s.preventDefault();s.stopImmediatePropagation();return}l(r.row);s.stopPropagation();s.stopImmediatePropagation()}}function l(r){if(p[r]){i.setSelectedRows(a.grep(i.getSelectedRows(),function(s){return s!=r}))}else{i.setSelectedRows(i.getSelectedRows().concat(r))}}function m(u,r){if(r.column.id==n.columnId&&a(u.target).is(":checkbox")){if(i.getEditorLock().isActive()&&!i.getEditorLock().commitCurrentEdit()){u.preventDefault();u.stopImmediatePropagation();return}if(a(u.target).is(":checked")){var t=[];for(var s=0;s<i.getDataLength();s++){t.push(s)}i.setSelectedRows(t)}else{i.setSelectedRows([])}u.stopPropagation();u.stopImmediatePropagation()}}function d(){return{id:n.columnId,name:"<input type='checkbox'>",toolTip:n.toolTip,field:"sel",width:n.width,resizable:false,sortable:false,cssClass:n.cssClass,formatter:e}}function e(v,s,u,t,r){if(r){return p[v]?"<input type='checkbox' checked='checked'>":"<input type='checkbox'>"}return null}a.extend(this,{init:o,destroy:k,getColumnDefinition:d})}})(jQuery);if(typeof jQuery==="undefined"){throw"SlickGrid requires jquery module to be loaded"}if(!jQuery.fn.drag){throw"SlickGrid requires jquery.event.drag module to be loaded"}if(typeof Slick==="undefined"){throw"slick.core.js not loaded"}(function($){$.extend(true,window,{Slick:{Grid:SlickGrid}});var scrollbarDimensions;var maxSupportedCssHeight;function SlickGrid(container,data,columns,options){var defaults={explicitInitialization:false,rowHeight:25,defaultColumnWidth:80,enableAddRow:false,leaveSpaceForNewRows:false,editable:false,autoEdit:true,enableCellNavigation:true,enableColumnReorder:true,asyncEditorLoading:false,asyncEditorLoadDelay:100,forceFitColumns:false,enableAsyncPostRender:false,asyncPostRenderDelay:60,autoHeight:false,editorLock:Slick.GlobalEditorLock,showHeaderRow:false,headerRowHeight:25,showTopPanel:false,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:true,enableTextSelectionOnCells:false,dataItemColumnValueExtractor:null,fullWidthRows:false,multiColumnSort:false,defaultFormatter:defaultFormatter};var columnDefaults={name:"",resizable:true,sortable:false,minWidth:30,rerenderOnResize:false,headerCssClass:null};var th;var h;var ph;var n;var cj;var page=0;var offset=0;var scrollDir=1;var initialized=false;var $container;var uid="slickgrid_"+Math.round(1000000*Math.random());var self=this;var $focusSink;var $headerScroller;var $headers;var $headerRow,$headerRowScroller;var $topPanelScroller;var $topPanel;var $viewport;var $canvas;var $style;var stylesheet,columnCssRulesL,columnCssRulesR;var viewportH,viewportW;var canvasWidth;var viewportHasHScroll,viewportHasVScroll;var headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0;var absoluteColumnMinWidth;var numberOfRows=0;var activePosX;var activeRow,activeCell;var activeCellNode=null;var currentEditor=null;var serializedEditorValue;var editController;var rowsCache={};var renderedRows=0;var numVisibleRows;var prevScrollTop=0;var scrollTop=0;var lastRenderedScrollTop=0;var prevScrollLeft=0;var avgRowRenderTime=10;var selectionModel;var selectedRows=[];var plugins=[];var cellCssClasses={};var columnsById={};var sortColumns=[];var h_editorLoader=null;var h_render=null;var h_postrender=null;var postProcessedRows={};var postProcessToRow=null;var postProcessFromRow=null;var counter_rows_rendered=0;var counter_rows_removed=0;function init(){$container=$(container);if($container.length<1){throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.")}maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight();scrollbarDimensions=scrollbarDimensions||measureScrollbar();options=$.extend({},defaults,options);columnDefaults.width=options.defaultColumnWidth;if(options.enableColumnReorder&&!$.fn.sortable){throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded")}editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit};$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget");if(!/relative|absolute|fixed/.test($container.css("position"))){$container.css("position","relative")}$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container);$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headers=$("<div class='slick-header-columns' style='width:10000px; left:-1000px' />").appendTo($headerScroller);$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller);$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller);if(!options.showTopPanel){$topPanelScroller.hide()}if(!options.showHeaderRow){$headerRowScroller.hide()}$viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container);$viewport.css("overflow-y",options.autoHeight?"hidden":"auto");$canvas=$("<div class='grid-canvas' />").appendTo($viewport);if(!options.explicitInitialization){finishInitialization()}}function finishInitialization(){if(!initialized){initialized=true;viewportW=parseFloat($.css($container[0],"width",true));measureCellPaddingAndBorder();disableSelection($headers);if(!options.enableTextSelectionOnCells){$viewport.bind("selectstart.ui",function(event){return $(event.target).is("input,textarea")})}createColumnHeaders();setupColumnSort();createCssRules();resizeCanvas();bindAncestorScrollEvents();$container.bind("resize.slickgrid",resizeCanvas);$viewport.bind("scroll.slickgrid",handleScroll);$headerScroller.bind("contextmenu.slickgrid",handleHeaderContextMenu).bind("click.slickgrid",handleHeaderClick);$focusSink.bind("keydown.slickgrid",handleKeyDown);$canvas.bind("keydown.slickgrid",handleKeyDown).bind("click.slickgrid",handleClick).bind("dblclick.slickgrid",handleDblClick).bind("contextmenu.slickgrid",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave)}}function registerPlugin(plugin){plugins.unshift(plugin);plugin.init(self)}function unregisterPlugin(plugin){for(var i=plugins.length;i>=0;i--){if(plugins[i]===plugin){if(plugins[i].destroy){plugins[i].destroy()}plugins.splice(i,1);break}}}function setSelectionModel(model){if(selectionModel){selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged);if(selectionModel.destroy){selectionModel.destroy()}}selectionModel=model;if(selectionModel){selectionModel.init(self);selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged)}}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var $c=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");var dim={width:$c.width()-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};$c.remove();return dim}function getCanvasWidth(){var availableWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;var rowWidth=0;var i=columns.length;while(i--){rowWidth+=(columns[i].width||columnDefaults.width)}return options.fullWidthRows?Math.max(rowWidth,availableWidth):rowWidth}function updateCanvasWidth(forceColumnWidthsUpdate){var oldCanvasWidth=canvasWidth;canvasWidth=getCanvasWidth();if(canvasWidth!=oldCanvasWidth){$canvas.width(canvasWidth);$headerRow.width(canvasWidth);viewportHasHScroll=(canvasWidth>viewportW-scrollbarDimensions.width)}if(canvasWidth!=oldCanvasWidth||forceColumnWidthsUpdate){applyColumnWidths()}}function disableSelection($target){if($target&&$target.jquery){$target.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}}function getMaxSupportedCssHeight(){var increment=1000000;var supportedHeight=increment;var testUpTo=($.browser.mozilla)?5000000:1000000000;var div=$("<div style='display:none' />").appendTo(document.body);while(supportedHeight<=testUpTo){div.css("height",supportedHeight+increment);if(div.height()!==supportedHeight+increment){break}else{supportedHeight+=increment}}div.remove();return supportedHeight}function bindAncestorScrollEvents(){var elem=$canvas[0];while((elem=elem.parentNode)!=document.body&&elem!=null){if(elem==$viewport[0]||elem.scrollWidth!=elem.clientWidth||elem.scrollHeight!=elem.clientHeight){$(elem).bind("scroll.slickgrid",handleActiveCellPositionChange)}}}function unbindAncestorScrollEvents(){$canvas.parents().unbind("scroll.slickgrid")}function updateColumnHeader(columnId,title,toolTip){if(!initialized){return}var idx=getColumnIndex(columnId);var $header=$headers.children().eq(idx);if($header){columns[idx].name=title;columns[idx].toolTip=toolTip;$header.attr("title",toolTip||title||"").children().eq(0).html(title)}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(columnId){var idx=getColumnIndex(columnId);var $header=$headerRow.children().eq(idx);return $header&&$header[0]}function createColumnHeaders(){function hoverBegin(){$(this).addClass("ui-state-hover")}function hoverEnd(){$(this).removeClass("ui-state-hover")}$headers.empty();$headerRow.empty();columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;var header=$("<div class='ui-state-default slick-header-column' id='"+uid+m.id+"' />").html("<span class='slick-column-name'>"+m.name+"</span>").width(m.width-headerColumnWidthDiff).attr("title",m.toolTip||m.name||"").data("fieldId",m.id).addClass(m.headerCssClass||"").appendTo($headers);if(options.enableColumnReorder||m.sortable){header.hover(hoverBegin,hoverEnd)}if(m.sortable){header.append("<span class='slick-sort-indicator' />")}if(options.showHeaderRow){$("<div class='ui-state-default slick-headerrow-column l"+i+" r"+i+"'></div>").appendTo($headerRow)}}if(options.showHeaderRow){$("<div style='display:block;height:1px;width:10000px;position:absolute;top:0;left:0;'></div>").appendTo($headerRowScroller)}setSortColumns(sortColumns);setupColumnResize();if(options.enableColumnReorder){setupColumnReorder()}}function setupColumnSort(){$headers.click(function(e){e.metaKey=e.metaKey||e.ctrlKey;if($(e.target).hasClass("slick-resizable-handle")){return}var $col=$(e.target).closest(".slick-header-column");if(!$col.length){return}var column=columns[getColumnIndex($col.data("fieldId"))];if(column.sortable){if(!getEditorLock().commitCurrentEdit()){return}var sortOpts=null;var i=0;for(;i<sortColumns.length;i++){if(sortColumns[i].columnId==column.id){sortOpts=sortColumns[i];sortOpts.sortAsc=!sortOpts.sortAsc;break}}if(e.metaKey&&options.multiColumnSort){if(sortOpts){sortColumns.splice(i,1)}}else{if((!e.shiftKey&&!e.metaKey)||!options.multiColumnSort){sortColumns=[]}if(!sortOpts){sortOpts={columnId:column.id,sortAsc:true};sortColumns.push(sortOpts)}else{if(sortColumns.length==0){sortColumns.push(sortOpts)}}}setSortColumns(sortColumns);if(!options.multiColumnSort){trigger(self.onSort,{multiColumnSort:false,sortCol:column,sortAsc:sortOpts.sortAsc},e)}else{trigger(self.onSort,{multiColumnSort:true,sortCols:$.map(sortColumns,function(col){return{sortCol:columns[getColumnIndex(col.columnId)],sortAsc:col.sortAsc}})},e)}}})}function setupColumnReorder(){$headers.sortable({containment:"parent",axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:true,start:function(e,ui){$(ui.helper).addClass("slick-header-column-active")},beforeStop:function(e,ui){$(ui.helper).removeClass("slick-header-column-active")},stop:function(e){if(!getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}var reorderedIds=$headers.sortable("toArray");var reorderedColumns=[];for(var i=0;i<reorderedIds.length;i++){reorderedColumns.push(columns[getColumnIndex(reorderedIds[i].replace(uid,""))])}setColumns(reorderedColumns);trigger(self.onColumnsReordered,{});e.stopPropagation();setupColumnResize()}})}function setupColumnResize(){var $col,j,c,pageX,columnElements,minPageX,maxPageX,firstResizable,lastResizable;columnElements=$headers.children();columnElements.find(".slick-resizable-handle").remove();columnElements.each(function(i,e){if(columns[i].resizable){if(firstResizable===undefined){firstResizable=i}lastResizable=i}});if(firstResizable===undefined){return}columnElements.each(function(i,e){if(i<firstResizable||(options.forceFitColumns&&i>=lastResizable)){return}$col=$(e);$("<div class='slick-resizable-handle' />").appendTo(e).bind("dragstart",function(e,dd){if(!getEditorLock().commitCurrentEdit()){return false}pageX=e.pageX;$(this).parent().addClass("slick-header-column-active");var shrinkLeewayOnRight=null,stretchLeewayOnRight=null;columnElements.each(function(i,e){columns[i].previousWidth=$(e).outerWidth()});if(options.forceFitColumns){shrinkLeewayOnRight=0;stretchLeewayOnRight=0;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnRight!==null){if(c.maxWidth){stretchLeewayOnRight+=c.maxWidth-c.previousWidth}else{stretchLeewayOnRight=null}}shrinkLeewayOnRight+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}}var shrinkLeewayOnLeft=0,stretchLeewayOnLeft=0;for(j=0;j<=i;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnLeft!==null){if(c.maxWidth){stretchLeewayOnLeft+=c.maxWidth-c.previousWidth}else{stretchLeewayOnLeft=null}}shrinkLeewayOnLeft+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}if(shrinkLeewayOnRight===null){shrinkLeewayOnRight=100000}if(shrinkLeewayOnLeft===null){shrinkLeewayOnLeft=100000}if(stretchLeewayOnRight===null){stretchLeewayOnRight=100000}if(stretchLeewayOnLeft===null){stretchLeewayOnLeft=100000}maxPageX=pageX+Math.min(shrinkLeewayOnRight,stretchLeewayOnLeft);minPageX=pageX-Math.min(shrinkLeewayOnLeft,stretchLeewayOnRight)}).bind("drag",function(e,dd){var actualMinWidth,d=Math.min(maxPageX,Math.max(minPageX,e.pageX))-pageX,x;if(d<0){x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}}}else{x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}}}applyColumnHeaderWidths();if(options.syncColumnCellResize){applyColumnWidths()}}).bind("dragend",function(e,dd){var newWidth;$(this).parent().removeClass("slick-header-column-active");for(j=0;j<columnElements.length;j++){c=columns[j];newWidth=$(columnElements[j]).outerWidth();if(c.previousWidth!==newWidth&&c.rerenderOnResize){invalidateAllRows()}}updateCanvasWidth(true);render();trigger(self.onColumnsResized,{})})})}function getVBoxDelta($el){var p=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];var delta=0;$.each(p,function(n,val){delta+=parseFloat($el.css(val))||0});return delta}function measureCellPaddingAndBorder(){var el;var h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"];var v=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];el=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers);headerColumnWidthDiff=headerColumnHeightDiff=0;$.each(h,function(n,val){headerColumnWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){headerColumnHeightDiff+=parseFloat(el.css(val))||0});el.remove();var r=$("<div class='slick-row' />").appendTo($canvas);el=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(r);cellWidthDiff=cellHeightDiff=0;$.each(h,function(n,val){cellWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){cellHeightDiff+=parseFloat(el.css(val))||0});r.remove();absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));var rowHeight=(options.rowHeight-cellHeightDiff);var rules=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+rowHeight+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"];for(var i=0;i<columns.length;i++){rules.push("."+uid+" .l"+i+" { }");rules.push("."+uid+" .r"+i+" { }")}if($style[0].styleSheet){$style[0].styleSheet.cssText=rules.join(" ")}else{$style[0].appendChild(document.createTextNode(rules.join(" ")))}}function getColumnCssRules(idx){if(!stylesheet){var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){if((sheets[i].ownerNode||sheets[i].owningElement)==$style[0]){stylesheet=sheets[i];break}}if(!stylesheet){throw new Error("Cannot find stylesheet.")}columnCssRulesL=[];columnCssRulesR=[];var cssRules=(stylesheet.cssRules||stylesheet.rules);var matches,columnIdx;for(var i=0;i<cssRules.length;i++){var selector=cssRules[i].selectorText;if(matches=/\.l\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesL[columnIdx]=cssRules[i]}else{if(matches=/\.r\d+/.exec(selector)){columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10);columnCssRulesR[columnIdx]=cssRules[i]}}}}return{left:columnCssRulesL[idx],right:columnCssRulesR[idx]}}function removeCssRules(){$style.remove();stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit();trigger(self.onBeforeDestroy,{});for(var i=0;i<plugins.length;i++){unregisterPlugin(plugins[i])}if(options.enableColumnReorder&&$headers.sortable){$headers.sortable("destroy")}unbindAncestorScrollEvents();$container.unbind(".slickgrid");removeCssRules();$canvas.unbind("draginit dragstart dragend drag");$container.empty().removeClass(uid)}function trigger(evt,args,e){e=e||new Slick.EventData();args=args||{};args.grid=self;return evt.notify(args,e,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(id){return columnsById[id]}function autosizeColumns(){var i,c,widths=[],shrinkLeeway=0,total=0,prevTotal,availWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(i=0;i<columns.length;i++){c=columns[i];widths.push(c.width);total+=c.width;if(c.resizable){shrinkLeeway+=c.width-Math.max(c.minWidth,absoluteColumnMinWidth)}}prevTotal=total;while(total>availWidth&&shrinkLeeway){var shrinkProportion=(total-availWidth)/shrinkLeeway;for(i=0;i<columns.length&&total>availWidth;i++){c=columns[i];var width=widths[i];if(!c.resizable||width<=c.minWidth||width<=absoluteColumnMinWidth){continue}var absMinWidth=Math.max(c.minWidth,absoluteColumnMinWidth);var shrinkSize=Math.floor(shrinkProportion*(width-absMinWidth))||1;shrinkSize=Math.min(shrinkSize,width-absMinWidth);total-=shrinkSize;shrinkLeeway-=shrinkSize;widths[i]-=shrinkSize}if(prevTotal==total){break}prevTotal=total}prevTotal=total;while(total<availWidth){var growProportion=availWidth/total;for(i=0;i<columns.length&&total<availWidth;i++){c=columns[i];if(!c.resizable||c.maxWidth<=c.width){continue}var growSize=Math.min(Math.floor(growProportion*c.width)-c.width,(c.maxWidth-c.width)||1000000)||1;total+=growSize;widths[i]+=growSize}if(prevTotal==total){break}prevTotal=total}var reRender=false;for(i=0;i<columns.length;i++){if(columns[i].rerenderOnResize&&columns[i].width!=widths[i]){reRender=true}columns[i].width=widths[i]}applyColumnHeaderWidths();updateCanvasWidth(true);if(reRender){invalidateAllRows();render()}}function applyColumnHeaderWidths(){if(!initialized){return}var h;for(var i=0,headers=$headers.children(),ii=headers.length;i<ii;i++){h=$(headers[i]);if(h.width()!==columns[i].width-headerColumnWidthDiff){h.width(columns[i].width-headerColumnWidthDiff)}}}function applyColumnWidths(){var x=0,w,rule;for(var i=0;i<columns.length;i++){w=columns[i].width;rule=getColumnCssRules(i);rule.left.style.left=x+"px";rule.right.style.right=(canvasWidth-x-w)+"px";x+=columns[i].width}}function setSortColumn(columnId,ascending){setSortColumns([{columnId:columnId,sortAsc:ascending}])}function setSortColumns(cols){sortColumns=cols;var headerColumnEls=$headers.children();headerColumnEls.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc");$.each(sortColumns,function(i,col){if(col.sortAsc==null){col.sortAsc=true}var columnIndex=getColumnIndex(col.columnId);if(columnIndex!=null){headerColumnEls.eq(columnIndex).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(col.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")}})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(e,ranges){selectedRows=[];var hash={};for(var i=0;i<ranges.length;i++){for(var j=ranges[i].fromRow;j<=ranges[i].toRow;j++){if(!hash[j]){selectedRows.push(j)}hash[j]={};for(var k=ranges[i].fromCell;k<=ranges[i].toCell;k++){if(canCellBeSelected(j,k)){hash[j][columns[k].id]=options.selectedCellCssClass}}}}setCellCssStyles(options.selectedCellCssClass,hash);trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},e)}function getColumns(){return columns}function setColumns(columnDefinitions){columns=columnDefinitions;if(initialized){invalidateAllRows();createColumnHeaders();removeCssRules();createCssRules();resizeCanvas();applyColumnWidths();handleScroll()}}function getOptions(){return options}function setOptions(args){if(!getEditorLock().commitCurrentEdit()){return}makeActiveCellNormal();if(options.enableAddRow!==args.enableAddRow){invalidateRow(getDataLength())}options=$.extend(options,args);$viewport.css("overflow-y",options.autoHeight?"hidden":"auto");render()}function setData(newData,scrollToTop){data=newData;invalidateAllRows();updateRowCount();if(scrollToTop){scrollTo(0)}}function getData(){return data}function getDataLength(){if(data.getLength){return data.getLength()}else{return data.length}}function getDataItem(i){if(data.getItem){return data.getItem(i)}else{return data[i]}}function getTopPanel(){return $topPanel[0]}function showTopPanel(){options.showTopPanel=true;$topPanelScroller.slideDown("fast",resizeCanvas)}function hideTopPanel(){options.showTopPanel=false;$topPanelScroller.slideUp("fast",resizeCanvas)}function showHeaderRowColumns(){options.showHeaderRow=true;$headerRowScroller.slideDown("fast",resizeCanvas)}function hideHeaderRowColumns(){options.showHeaderRow=false;$headerRowScroller.slideUp("fast",resizeCanvas)}function scrollTo(y){var oldOffset=offset;page=Math.min(n-1,Math.floor(y/ph));offset=Math.round(page*cj);var newScrollTop=y-offset;if(offset!=oldOffset){var range=getVisibleRange(newScrollTop);cleanupRows(range.top,range.bottom);updateRowPositions()}if(prevScrollTop!=newScrollTop){scrollDir=(prevScrollTop+oldOffset<newScrollTop+offset)?1:-1;$viewport[0].scrollTop=(lastRenderedScrollTop=scrollTop=prevScrollTop=newScrollTop);trigger(self.onViewportChanged,{})}}function defaultFormatter(row,cell,value,columnDef,dataContext){if(value==null){return""}else{return value.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}function getFormatter(row,column){var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnOverrides=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[column.id]||rowMetadata.columns[getColumnIndex(column.id)]);return(columnOverrides&&columnOverrides.formatter)||(rowMetadata&&rowMetadata.formatter)||column.formatter||(options.formatterFactory&&options.formatterFactory.getFormatter(column))||options.defaultFormatter}function getEditor(row,cell){var column=columns[cell];var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[column.id]&&columnMetadata[column.id].editor!==undefined){return columnMetadata[column.id].editor}if(columnMetadata&&columnMetadata[cell]&&columnMetadata[cell].editor!==undefined){return columnMetadata[cell].editor}return column.editor||(options.editorFactory&&options.editorFactory.getEditor(column))}function getDataItemValueForColumn(item,columnDef){if(options.dataItemColumnValueExtractor){return options.dataItemColumnValueExtractor(item,columnDef)}return item[columnDef.field]}function appendRowHtml(stringArray,row){var d=getDataItem(row);var dataLoading=row<getDataLength()&&!d;var cellCss;var rowCss="slick-row "+(dataLoading?" loading":"")+(row%2==1?" odd":" even");var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(metadata&&metadata.cssClasses){rowCss+=" "+metadata.cssClasses}stringArray.push("<div class='ui-widget-content "+rowCss+"' row='"+row+"' style='top:"+(options.rowHeight*row-offset)+"px'>");var colspan,m;for(var i=0,cols=columns.length;i<cols;i++){m=columns[i];colspan=getColspan(row,i);cellCss="slick-cell l"+i+" r"+Math.min(columns.length-1,i+colspan-1)+(m.cssClass?" "+m.cssClass:"");if(row===activeRow&&i===activeCell){cellCss+=(" active")}for(var key in cellCssClasses){if(cellCssClasses[key][row]&&cellCssClasses[key][row][m.id]){cellCss+=(" "+cellCssClasses[key][row][m.id])}}stringArray.push("<div class='"+cellCss+"'>");if(d){stringArray.push(getFormatter(row,m)(row,i,getDataItemValueForColumn(d,m),m,d))}stringArray.push("</div>");if(colspan){i+=(colspan-1)}}stringArray.push("</div>")}function cleanupRows(rangeToKeep){for(var i in rowsCache){if(((i=parseInt(i,10))!==activeRow)&&(i<rangeToKeep.top||i>rangeToKeep.bottom)){removeRowFromCache(i)}}}function invalidate(){updateRowCount();invalidateAllRows();render()}function invalidateAllRows(){if(currentEditor){makeActiveCellNormal()}for(var row in rowsCache){removeRowFromCache(row)}}function removeRowFromCache(row){var node=rowsCache[row];if(!node){return}$canvas[0].removeChild(node);delete rowsCache[row];delete postProcessedRows[row];renderedRows--;counter_rows_removed++}function invalidateRows(rows){var i,rl;if(!rows||!rows.length){return}scrollDir=0;for(i=0,rl=rows.length;i<rl;i++){if(currentEditor&&activeRow===rows[i]){makeActiveCellNormal()}if(rowsCache[rows[i]]){removeRowFromCache(rows[i])}}}function invalidateRow(row){invalidateRows([row])}function updateCell(row,cell){var cellNode=getCellNode(row,cell);if(!cellNode){return}var m=columns[cell],d=getDataItem(row);if(currentEditor&&activeRow===row&&activeCell===cell){currentEditor.loadValue(d)}else{cellNode.innerHTML=d?getFormatter(row,m)(row,cell,getDataItemValueForColumn(d,m),m,d):"";invalidatePostProcessingResults(row)}}function updateRow(row){if(!rowsCache[row]){return}var columnIndex=0;$(rowsCache[row]).children().each(function(i){var m=columns[columnIndex],d=getDataItem(row);if(row===activeRow&&i===activeCell&&currentEditor){currentEditor.loadValue(getDataItem(activeRow))}else{if(d){this.innerHTML=getFormatter(row,m)(row,columnIndex,getDataItemValueForColumn(d,m),m,getDataItem(row))}else{this.innerHTML=""}}columnIndex+=getColspan(row,i)});invalidatePostProcessingResults(row)}function getViewportHeight(){return parseFloat($.css($container[0],"height",true))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function resizeCanvas(){if(!initialized){return}if(options.autoHeight){viewportH=options.rowHeight*(getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0))}else{viewportH=getViewportHeight()}numVisibleRows=Math.ceil(viewportH/options.rowHeight);viewportW=parseFloat($.css($container[0],"width",true));$viewport.height(viewportH);if(options.forceFitColumns){autosizeColumns()}updateRowCount();render()}function updateRowCount(){if(!initialized){return}numberOfRows=getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var oldViewportHasVScroll=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&(numberOfRows*options.rowHeight>viewportH);var l=options.enableAddRow?getDataLength():getDataLength()-1;for(var i in rowsCache){if(i>=l){removeRowFromCache(i)}}var oldH=h;th=Math.max(options.rowHeight*numberOfRows,viewportH-scrollbarDimensions.height);if(th<maxSupportedCssHeight){h=ph=th;n=1;cj=0}else{h=maxSupportedCssHeight;ph=h/100;n=Math.floor(th/ph);cj=(th-h)/(n-1)}if(h!==oldH){$canvas.css("height",h);scrollTop=$viewport[0].scrollTop}var oldScrollTopInRange=(scrollTop+offset<=th-viewportH);if(th==0||scrollTop==0){page=offset=0}else{if(oldScrollTopInRange){scrollTo(scrollTop+offset)}else{scrollTo(th-viewportH)}}if(h!=oldH&&options.autoHeight){resizeCanvas()}if(options.forceFitColumns&&oldViewportHasVScroll!=viewportHasVScroll){autosizeColumns()}updateCanvasWidth(false)}function getVisibleRange(viewportTop){if(viewportTop==null){viewportTop=scrollTop}return{top:Math.floor((viewportTop+offset)/options.rowHeight),bottom:Math.ceil((viewportTop+offset+viewportH)/options.rowHeight)}}function getRenderedRange(viewportTop){var range=getVisibleRange(viewportTop);var buffer=Math.round(viewportH/options.rowHeight);var minBuffer=3;if(scrollDir==-1){range.top-=buffer;range.bottom+=minBuffer}else{if(scrollDir==1){range.top-=minBuffer;range.bottom+=buffer}else{range.top-=minBuffer;range.bottom+=minBuffer}}range.top=Math.max(0,range.top);range.bottom=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,range.bottom);return range}function renderRows(range){var i,l,parentNode=$canvas[0],rowsBefore=renderedRows,stringArray=[],rows=[],startTimestamp=new Date(),needToReselectCell=false;for(i=range.top;i<=range.bottom;i++){if(rowsCache[i]){continue}renderedRows++;rows.push(i);appendRowHtml(stringArray,i);if(activeCellNode&&activeRow===i){needToReselectCell=true}counter_rows_rendered++}if(!rows.length){return}var x=document.createElement("div");x.innerHTML=stringArray.join("");for(i=0,l=x.childNodes.length;i<l;i++){rowsCache[rows[i]]=parentNode.appendChild(x.firstChild)}if(needToReselectCell){activeCellNode=getCellNode(activeRow,activeCell)}if(renderedRows-rowsBefore>5){avgRowRenderTime=(new Date()-startTimestamp)/(renderedRows-rowsBefore)}}function startPostProcessing(){if(!options.enableAsyncPostRender){return}clearTimeout(h_postrender);h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay)}function invalidatePostProcessingResults(row){delete postProcessedRows[row];postProcessFromRow=Math.min(postProcessFromRow,row);postProcessToRow=Math.max(postProcessToRow,row);startPostProcessing()}function updateRowPositions(){for(var row in rowsCache){rowsCache[row].style.top=(row*options.rowHeight-offset)+"px"}}function render(){if(!initialized){return}var visible=getVisibleRange();var rendered=getRenderedRange();cleanupRows(rendered);renderRows(rendered);postProcessFromRow=visible.top;postProcessToRow=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,visible.bottom);startPostProcessing();lastRenderedScrollTop=scrollTop;h_render=null}function handleScroll(){scrollTop=$viewport[0].scrollTop;var scrollLeft=$viewport[0].scrollLeft;var scrollDist=Math.abs(scrollTop-prevScrollTop);if(scrollLeft!==prevScrollLeft){prevScrollLeft=scrollLeft;$headerScroller[0].scrollLeft=scrollLeft;$topPanelScroller[0].scrollLeft=scrollLeft;$headerRowScroller[0].scrollLeft=scrollLeft}if(scrollDist){scrollDir=prevScrollTop<scrollTop?1:-1;prevScrollTop=scrollTop;if(scrollDist<viewportH){scrollTo(scrollTop+offset)}else{var oldOffset=offset;page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph)));offset=Math.round(page*cj);if(oldOffset!=offset){invalidateAllRows()}}if(h_render){clearTimeout(h_render)}if(Math.abs(lastRenderedScrollTop-scrollTop)<viewportH){render()}else{h_render=setTimeout(render,50)}trigger(self.onViewportChanged,{})}trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){while(postProcessFromRow<=postProcessToRow){var row=(scrollDir>=0)?postProcessFromRow++:postProcessToRow--;var rowNode=rowsCache[row];if(!rowNode||postProcessedRows[row]||row>=getDataLength()){continue}var d=getDataItem(row),cellNodes=rowNode.childNodes;for(var i=0,j=0,l=columns.length;i<l;++i){var m=columns[i];if(m.asyncPostRender){m.asyncPostRender(cellNodes[j],postProcessFromRow,d,m)}++j}postProcessedRows[row]=true;h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay);return}}function updateCellCssStylesOnRenderedRows(addedHash,removedHash){var node,columnId,addedRowHash,removedRowHash;for(var row in rowsCache){removedRowHash=removedHash&&removedHash[row];addedRowHash=addedHash&&addedHash[row];if(removedRowHash){for(columnId in removedRowHash){if(!addedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).removeClass(removedRowHash[columnId])}}}}if(addedRowHash){for(columnId in addedRowHash){if(!removedRowHash||removedRowHash[columnId]!=addedRowHash[columnId]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).addClass(addedRowHash[columnId])}}}}}}function addCellCssStyles(key,hash){if(cellCssClasses[key]){throw"addCellCssStyles: cell CSS hash with key '"+key+"' already exists."}cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,null);trigger(self.onCellCssStylesChanged,{key:key,hash:hash})}function removeCellCssStyles(key){if(!cellCssClasses[key]){return}updateCellCssStylesOnRenderedRows(null,cellCssClasses[key]);delete cellCssClasses[key];trigger(self.onCellCssStylesChanged,{key:key,hash:null})}function setCellCssStyles(key,hash){var prevHash=cellCssClasses[key];cellCssClasses[key]=hash;updateCellCssStylesOnRenderedRows(hash,prevHash);trigger(self.onCellCssStylesChanged,{key:key,hash:hash})}function getCellCssStyles(key){return cellCssClasses[key]}function flashCell(row,cell,speed){speed=speed||100;if(rowsCache[row]){var $cell=$(getCellNode(row,cell));function toggleCellClass(times){if(!times){return}setTimeout(function(){$cell.queue(function(){$cell.toggleClass(options.cellFlashingCssClass).dequeue();toggleCellClass(times-1)})},speed)}toggleCellClass(4)}}function handleDragInit(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}retval=trigger(self.onDragInit,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDragStart(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}var retval=trigger(self.onDragStart,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDrag(e,dd){return trigger(self.onDrag,dd,e)}function handleDragEnd(e,dd){trigger(self.onDragEnd,dd,e)}function handleKeyDown(e){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},e);var handled=e.isImmediatePropagationStopped();if(!handled){if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){if(e.which==27){if(!getEditorLock().isActive()){return}cancelEditAndSetFocus()}else{if(e.which==37){navigateLeft()}else{if(e.which==39){navigateRight()}else{if(e.which==38){navigateUp()}else{if(e.which==40){navigateDown()}else{if(e.which==9){navigateNext()}else{if(e.which==13){if(options.editable){if(currentEditor){if(activeRow===getDataLength()){navigateDown()}else{commitEditAndSetFocus()}}else{if(getEditorLock().commitCurrentEdit()){makeActiveCellEditable()}}}}else{return}}}}}}}}else{if(e.which==9&&e.shiftKey&&!e.ctrlKey&&!e.altKey){navigatePrev()}else{return}}}e.stopPropagation();e.preventDefault();try{e.originalEvent.keyCode=0}catch(error){}}function handleClick(e){if(!currentEditor){setFocus()}var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if(canCellBeActive(cell.row,cell.cell)){if(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit()){scrollRowIntoView(cell.row,false);setActiveCellInternal(getCellNode(cell.row,cell.cell),(cell.row===getDataLength())||options.autoEdit)}}}function handleContextMenu(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if($cell.length===0){return}if(activeCellNode===$cell[0]&&currentEditor!==null){return}trigger(self.onContextMenu,{},e)}function handleDblClick(e){var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onDblClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if(options.editable){gotoCell(cell.row,cell.cell,true)}}function handleHeaderContextMenu(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&columns[self.getColumnIndex($header.data("fieldId"))];trigger(self.onHeaderContextMenu,{column:column},e)}function handleHeaderClick(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&columns[self.getColumnIndex($header.data("fieldId"))];if(column){trigger(self.onHeaderClick,{column:column},e)}}function handleMouseEnter(e){trigger(self.onMouseEnter,{},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{},e)}function cellExists(row,cell){return !(row<0||row>=getDataLength()||cell<0||cell>=columns.length)}function getCellFromPoint(x,y){var row=Math.floor((y+offset)/options.rowHeight);var cell=0;var w=0;for(var i=0;i<columns.length&&w<x;i++){w+=columns[i].width;cell++}if(cell<0){cell=0}return{row:row,cell:cell-1}}function getCellFromNode(node){var cls=/l\d+/.exec(node.className);if(!cls){throw"getCellFromNode: cannot get cell - "+node.className}return parseInt(cls[0].substr(1,cls[0].length-1),10)}function getCellFromEvent(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if(!$cell.length){return null}return{row:$cell.parent().attr("row")|0,cell:getCellFromNode($cell[0])}}function getCellNodeBox(row,cell){if(!cellExists(row,cell)){return null}var y1=row*options.rowHeight-offset;var y2=y1+options.rowHeight-1;var x1=0;for(var i=0;i<cell;i++){x1+=columns[i].width}var x2=x1+columns[cell].width;return{top:y1,left:x1,bottom:y2,right:x2}}function resetActiveCell(){setActiveCellInternal(null,false)}function setFocus(){$focusSink[0].focus()}function scrollActiveCellIntoView(){if(activeCellNode){var left=$(activeCellNode).position().left,right=left+$(activeCellNode).outerWidth(),scrollLeft=$viewport.scrollLeft(),scrollRight=scrollLeft+$viewport.width();if(left<scrollLeft){$viewport.scrollLeft(left)}else{if(right>scrollRight){$viewport.scrollLeft(Math.min(left,right-$viewport[0].clientWidth))}}}}function setActiveCellInternal(newCell,editMode){if(activeCellNode!==null){makeActiveCellNormal();$(activeCellNode).removeClass("active")}var activeCellChanged=(activeCellNode!==newCell);activeCellNode=newCell;if(activeCellNode!=null){activeRow=parseInt($(activeCellNode).parent().attr("row"));activeCell=activePosX=getCellFromNode(activeCellNode);$(activeCellNode).addClass("active");if(options.editable&&editMode&&isCellPotentiallyEditable(activeRow,activeCell)){clearTimeout(h_editorLoader);if(options.asyncEditorLoading){h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay)}else{makeActiveCellEditable()}}else{setFocus()}}else{activeRow=activeCell=null}if(activeCellChanged){scrollActiveCellIntoView();trigger(self.onActiveCellChanged,getActiveCell())}}function clearTextSelection(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var sel=window.getSelection();if(sel&&sel.removeAllRanges){sel.removeAllRanges()}}}}function isCellPotentiallyEditable(row,cell){if(row<getDataLength()&&!getDataItem(row)){return false}if(columns[cell].cannotTriggerInsert&&row>=getDataLength()){return false}if(!getEditor(row,cell)){return false}return true}function makeActiveCellNormal(){if(!currentEditor){return}trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor});currentEditor.destroy();currentEditor=null;if(activeCellNode){var d=getDataItem(activeRow);$(activeCellNode).removeClass("editable invalid");if(d){var column=columns[activeCell];var formatter=getFormatter(activeRow,column);activeCellNode.innerHTML=formatter(activeRow,activeCell,getDataItemValueForColumn(d,column),column,getDataItem(activeRow));invalidatePostProcessingResults(activeRow)}}if($.browser.msie){clearTextSelection()}getEditorLock().deactivate(editController)}function makeActiveCellEditable(editor){if(!activeCellNode){return}if(!options.editable){throw"Grid : makeActiveCellEditable : should never get called when options.editable is false"}clearTimeout(h_editorLoader);if(!isCellPotentiallyEditable(activeRow,activeCell)){return}var columnDef=columns[activeCell];var item=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:item,column:columnDef})===false){setFocus();return}getEditorLock().activate(editController);$(activeCellNode).addClass("editable");if(!editor){activeCellNode.innerHTML=""}currentEditor=new (editor||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:columnDef,item:item||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus});if(item){currentEditor.loadValue(item)}serializedEditorValue=currentEditor.serializeValue();if(currentEditor.position){handleActiveCellPositionChange()}}function commitEditAndSetFocus(){if(getEditorLock().commitCurrentEdit()){setFocus();if(options.autoEdit){navigateDown()}}}function cancelEditAndSetFocus(){if(getEditorLock().cancelCurrentEdit()){setFocus()}}function absBox(elem){var box={top:elem.offsetTop,left:elem.offsetLeft,bottom:0,right:0,width:$(elem).outerWidth(),height:$(elem).outerHeight(),visible:true};box.bottom=box.top+box.height;box.right=box.left+box.width;var offsetParent=elem.offsetParent;while((elem=elem.parentNode)!=document.body){if(box.visible&&elem.scrollHeight!=elem.offsetHeight&&$(elem).css("overflowY")!="visible"){box.visible=box.bottom>elem.scrollTop&&box.top<elem.scrollTop+elem.clientHeight}if(box.visible&&elem.scrollWidth!=elem.offsetWidth&&$(elem).css("overflowX")!="visible"){box.visible=box.right>elem.scrollLeft&&box.left<elem.scrollLeft+elem.clientWidth}box.left-=elem.scrollLeft;box.top-=elem.scrollTop;if(elem===offsetParent){box.left+=elem.offsetLeft;box.top+=elem.offsetTop;offsetParent=elem.offsetParent}box.bottom=box.top+box.height;box.right=box.left+box.width}return box}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(!activeCellNode){return}trigger(self.onActiveCellPositionChanged,{});if(currentEditor){var cellBox=getActiveCellPosition();if(currentEditor.show&&currentEditor.hide){if(!cellBox.visible){currentEditor.hide()}else{currentEditor.show()}}if(currentEditor.position){currentEditor.position(cellBox)}}}function getCellEditor(){return currentEditor}function getActiveCell(){if(!activeCellNode){return null}else{return{row:activeRow,cell:activeCell}}}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(row,doPaging){var rowAtTop=row*options.rowHeight;var rowAtBottom=(row+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);if((row+1)*options.rowHeight>scrollTop+viewportH+offset){scrollTo(doPaging?rowAtTop:rowAtBottom);render()}else{if(row*options.rowHeight<scrollTop+offset){scrollTo(doPaging?rowAtBottom:rowAtTop);render()}}}function getColspan(row,cell){var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(!metadata||!metadata.columns){return 1}var columnData=metadata.columns[columns[cell].id]||metadata.columns[cell];var colspan=(columnData&&columnData.colspan);if(colspan==="*"){colspan=columns.length-cell}return(colspan||1)}function findFirstFocusableCell(row){var cell=0;while(cell<columns.length){if(canCellBeActive(row,cell)){return cell}cell+=getColspan(row,cell)}return null}function findLastFocusableCell(row){var cell=0;var lastFocusableCell=null;while(cell<columns.length){if(canCellBeActive(row,cell)){lastFocusableCell=cell}cell+=getColspan(row,cell)}return lastFocusableCell}function gotoRight(row,cell,posX){if(cell>=columns.length){return null}do{cell+=getColspan(row,cell)}while(cell<columns.length&&!canCellBeActive(row,cell));if(cell<columns.length){return{row:row,cell:cell,posX:cell}}return null}function gotoLeft(row,cell,posX){if(cell<=0){return null}var firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell===null||firstFocusableCell>=cell){return null}var prev={row:row,cell:firstFocusableCell,posX:firstFocusableCell};var pos;while(true){pos=gotoRight(prev.row,prev.cell,prev.posX);if(!pos){return null}if(pos.cell>=cell){return prev}prev=pos}}function gotoDown(row,cell,posX){var prevCell;while(true){if(++row>=getDataLength()+(options.enableAddRow?1:0)){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoUp(row,cell,posX){var prevCell;while(true){if(--row<0){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoNext(row,cell,posX){var pos=gotoRight(row,cell,posX);if(pos){return pos}var firstFocusableCell=null;while(++row<getDataLength()+(options.enableAddRow?1:0)){firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell!==null){return{row:row,cell:firstFocusableCell,posX:firstFocusableCell}}}return null}function gotoPrev(row,cell,posX){var pos;var lastSelectableCell;while(!pos){pos=gotoLeft(row,cell,posX);if(pos){break}if(--row<0){return null}cell=0;lastSelectableCell=findLastFocusableCell(row);if(lastSelectableCell!==null){pos={row:row,cell:lastSelectableCell,posX:lastSelectableCell}}}return pos}function navigateRight(){navigate("right")}function navigateLeft(){navigate("left")}function navigateDown(){navigate("down")}function navigateUp(){navigate("up")}function navigateNext(){navigate("next")}function navigatePrev(){navigate("prev")}function navigate(dir){if(!activeCellNode||!options.enableCellNavigation){return}if(!getEditorLock().commitCurrentEdit()){return}setFocus();var stepFunctions={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext};var stepFn=stepFunctions[dir];var pos=stepFn(activeRow,activeCell,activePosX);if(pos){var isAddNewRow=(pos.row==getDataLength());scrollRowIntoView(pos.row,!isAddNewRow);setActiveCellInternal(getCellNode(pos.row,pos.cell),isAddNewRow||options.autoEdit);activePosX=pos.posX}else{setActiveCellInternal(getCellNode(activeRow,activeCell),(activeRow==getDataLength())||options.autoEdit)}}function getCellNode(row,cell){if(rowsCache[row]){var cells=$(rowsCache[row]).children();var nodeCell;for(var i=0;i<cells.length;i++){nodeCell=getCellFromNode(cells[i]);if(nodeCell===cell){return cells[i]}else{if(nodeCell>cell){return null}}}}return null}function setActiveCell(row,cell){if(!initialized){return}if(row>getDataLength()||row<0||cell>=columns.length||cell<0){return}if(!options.enableCellNavigation){return}scrollRowIntoView(row,false);setActiveCellInternal(getCellNode(row,cell),false)}function canCellBeActive(row,cell){if(!options.enableCellNavigation||row>=getDataLength()+(options.enableAddRow?1:0)||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.focusable==="boolean"){return rowMetadata.focusable}var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[columns[cell].id]&&typeof columnMetadata[columns[cell].id].focusable==="boolean"){return columnMetadata[columns[cell].id].focusable}if(columnMetadata&&columnMetadata[cell]&&typeof columnMetadata[cell].focusable==="boolean"){return columnMetadata[cell].focusable}if(typeof columns[cell].focusable==="boolean"){return columns[cell].focusable}return true}function canCellBeSelected(row,cell){if(row>=getDataLength()||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.selectable==="boolean"){return rowMetadata.selectable}var columnMetadata=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[columns[cell].id]||rowMetadata.columns[cell]);if(columnMetadata&&typeof columnMetadata.selectable==="boolean"){return columnMetadata.selectable}if(typeof columns[cell].selectable==="boolean"){return columns[cell].selectable}return true}function gotoCell(row,cell,forceEdit){if(!initialized){return}if(!canCellBeActive(row,cell)){return}if(!getEditorLock().commitCurrentEdit()){return}scrollRowIntoView(row,false);var newCell=getCellNode(row,cell);setActiveCellInternal(newCell,forceEdit||(row===getDataLength())||options.autoEdit);if(!currentEditor){setFocus()}}function commitCurrentEdit(){var item=getDataItem(activeRow);var column=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var validationResults=currentEditor.validate();if(validationResults.valid){if(activeRow<getDataLength()){var editCommand={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(item,this.serializedValue);updateRow(this.row)},undo:function(){this.editor.applyValue(item,this.prevSerializedValue);updateRow(this.row)}};if(options.editCommandHandler){makeActiveCellNormal();options.editCommandHandler(item,column,editCommand)}else{editCommand.execute();makeActiveCellNormal()}trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:item})}else{var newItem={};currentEditor.applyValue(newItem,currentEditor.serializeValue());makeActiveCellNormal();trigger(self.onAddNewRow,{item:newItem,column:column})}return !getEditorLock().isActive()}else{$(activeCellNode).addClass("invalid");$(activeCellNode).stop(true,true).effect("highlight",{color:"red"},300);trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:validationResults,row:activeRow,cell:activeCell,column:column});currentEditor.focus();return false}}makeActiveCellNormal()}return true}function cancelCurrentEdit(){makeActiveCellNormal();return true}function rowsToRanges(rows){var ranges=[];var lastCell=columns.length-1;for(var i=0;i<rows.length;i++){ranges.push(new Slick.Range(rows[i],0,rows[i],lastCell))}return ranges}function getSelectedRows(){if(!selectionModel){throw"Selection model is not set"}return selectedRows}function setSelectedRows(rows){if(!selectionModel){throw"Selection model is not set"}selectionModel.setSelectedRanges(rowsToRanges(rows))}this.debug=function(){var s="";s+=("\ncounter_rows_rendered:  "+counter_rows_rendered);s+=("\ncounter_rows_removed:  "+counter_rows_removed);s+=("\nrenderedRows:  "+renderedRows);s+=("\nnumVisibleRows:  "+numVisibleRows);s+=("\nmaxSupportedCssHeight:  "+maxSupportedCssHeight);s+=("\nn(umber of pages):  "+n);s+=("\n(current) page:  "+page);s+=("\npage height (ph):  "+ph);s+=("\nscrollDir:  "+scrollDir);alert(s)};this.eval=function(expr){return eval(expr)};$.extend(this,{slickGridVersion:"2.0",onScroll:new Slick.Event(),onSort:new Slick.Event(),onHeaderContextMenu:new Slick.Event(),onHeaderClick:new Slick.Event(),onMouseEnter:new Slick.Event(),onMouseLeave:new Slick.Event(),onClick:new Slick.Event(),onDblClick:new Slick.Event(),onContextMenu:new Slick.Event(),onKeyDown:new Slick.Event(),onAddNewRow:new Slick.Event(),onValidationError:new Slick.Event(),onViewportChanged:new Slick.Event(),onColumnsReordered:new Slick.Event(),onColumnsResized:new Slick.Event(),onCellChange:new Slick.Event(),onBeforeEditCell:new Slick.Event(),onBeforeCellEditorDestroy:new Slick.Event(),onBeforeDestroy:new Slick.Event(),onActiveCellChanged:new Slick.Event(),onActiveCellPositionChanged:new Slick.Event(),onDragInit:new Slick.Event(),onDragStart:new Slick.Event(),onDrag:new Slick.Event(),onDragEnd:new Slick.Event(),onSelectedRowsChanged:new Slick.Event(),onCellCssStylesChanged:new Slick.Event(),registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,gotoCell:gotoCell,getTopPanel:getTopPanel,showTopPanel:showTopPanel,hideTopPanel:hideTopPanel,showHeaderRowColumns:showHeaderRowColumns,hideHeaderRowColumns:hideHeaderRowColumns,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController});init()}}(jQuery));(function(d){d.extend(true,window,{Slick:{Data:{DataView:f,Aggregators:{Avg:c,Min:b,Max:a,Sum:e}}}});function f(Z){var ar=this;var M={groupItemMetadataProvider:null,inlineFilters:false};var q="id";var at=[];var W=[];var aB={};var au=null;var v=null;var aq=null;var E=false;var j=true;var aL;var y;var ag={};var O={};var aG;var n=[];var G;var z;var ak=[];var L;var av;var ad;var aA;var h=[];var m={};var J;var aF=false;var T;var C=0;var D=0;var g=0;var aD=new Slick.Event();var N=new Slick.Event();var aM=new Slick.Event();Z=d.extend(true,{},M,Z);function p(){E=true}function r(){E=false;aw()}function ay(aP){ag=aP}function P(aP){aG=aP}function aH(aR){aR=aR||0;var aS;for(var aQ=aR,aP=at.length;aQ<aP;aQ++){aS=at[aQ][q];if(aS===undefined){throw"Each data element must implement a unique 'id' property"}aB[aS]=aQ}}function F(){var aR;for(var aQ=0,aP=at.length;aQ<aP;aQ++){aR=at[aQ][q];if(aR===undefined||aB[aR]!==aQ){throw"Each data element must implement a unique 'id' property"}}}function aN(){return at}function U(aQ,aP){if(aP!==undefined){q=aP}at=n=aQ;aB={};aH();F();aw()}function A(aP){if(aP.pageSize!=undefined){C=aP.pageSize;D=C?Math.min(D,Math.max(0,Math.ceil(g/C)-1)):0}if(aP.pageNum!=undefined){D=Math.min(aP.pageNum,Math.max(0,Math.ceil(g/C)-1))}aM.notify(al(),null,ar);aw()}function al(){var aP=C?Math.max(1,Math.ceil(g/C)):1;return{pageSize:C,pageNum:D,totalRows:g,totalPages:aP}}function H(aQ,aP){j=aP;y=aQ;aL=null;if(aP===false){at.reverse()}at.sort(aQ);if(aP===false){at.reverse()}aB={};aH();aw()}function aI(aR,aQ){j=aQ;aL=aR;y=null;var aP=Object.prototype.toString;Object.prototype.toString=(typeof aR=="function")?aR:function(){return this[aR]};if(aQ===false){at.reverse()}at.sort();Object.prototype.toString=aP;if(aQ===false){at.reverse()}aB={};aH();aw()}function x(){if(y){H(y,j)}else{if(aL){aI(aL,j)}}}function ab(aP){v=aP;if(Z.inlineFilters){G=aj();z=B()}aw()}function ac(aP,aQ,aR){if(!Z.groupItemMetadataProvider){Z.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider()}L=aP;av=typeof L==="function";ad=aQ;aA=aR;m={};h=[];aw()}function aK(aR,aQ){J=aR;aF=(aQ!==undefined)?aQ:aF;T=[];var aP=J.length;while(aP--){T[aP]=an(J[aP])}aw()}function az(aP){return at[aP]}function I(aP){return aB[aP]}function u(){if(!au){au={};for(var aQ=0,aP=W.length;aQ<aP;aQ++){au[W[aQ][q]]=aQ}}}function ah(aP){u();return au[aP]}function X(aP){return at[aB[aP]]}function aE(aQ){var aR=[];u();for(var aP=0;aP<aQ.length;aP++){var aS=au[aQ[aP]];if(aS!=null){aR[aR.length]=aS}}return aR}function S(aR){var aQ=[];for(var aP=0;aP<aR.length;aP++){if(aR[aP]<W.length){aQ[aQ.length]=W[aR[aP]][q]}}return aQ}function l(aQ,aP){if(aB[aQ]===undefined||aQ!==aP[q]){throw"Invalid or non-matching id"}at[aB[aQ]]=aP;if(!aq){aq={}}aq[aQ]=true;aw()}function aJ(aP,aQ){at.splice(aP,0,aQ);aH(aP);aw()}function ao(aP){at.push(aP);aH(at.length-1);aw()}function aO(aQ){var aP=aB[aQ];if(aP===undefined){throw"Invalid id"}delete aB[aQ];at.splice(aP,1);aH(aP);aw()}function ax(){return W.length}function aC(aP){return W[aP]}function K(aP){var aQ=W[aP];if(aQ===undefined){return null}if(aQ.__group){return Z.groupItemMetadataProvider.getGroupRowMetadata(aQ)}if(aQ.__groupTotals){return Z.groupItemMetadataProvider.getTotalsRowMetadata(aQ)}return null}function ai(aP){m[aP]=true;aw()}function ae(aP){delete m[aP];aw()}function am(){return h}function Y(aU){var aV;var aW;var aP=[];var aT=[];var aS;for(var aR=0,aQ=aU.length;aR<aQ;aR++){aS=aU[aR];aW=(av)?L(aS):aS[L];aW=aW||0;aV=aT[aW];if(!aV){aV=new Slick.Group();aV.count=0;aV.value=aW;aV.rows=[];aP[aP.length]=aV;aT[aW]=aV}aV.rows[aV.count++]=aS}return aP}function ap(aS){if(aS.collapsed&&!aF){return}var aR=new Slick.GroupTotals();var aQ,aP=J.length;while(aP--){aQ=J[aP];aQ.init();T[aP].call(aQ,aS.rows);aQ.storeResult(aR)}aR.group=aS;aS.totals=aR}function af(aQ){var aP=aQ.length;while(aP--){ap(aQ[aP])}}function t(aQ){var aP=aQ.length,aR;while(aP--){aR=aQ[aP];aR.collapsed=(aR.value in m);aR.title=ad?ad(aR):aR.value}}function i(aP){var aT=[],aW=0,aV;for(var aS=0,aQ=aP.length;aS<aQ;aS++){aV=aP[aS];aT[aW++]=aV;if(!aV.collapsed){for(var aR=0,aU=aV.rows.length;aR<aU;aR++){aT[aW++]=aV.rows[aR]}}if(aV.totals&&(!aV.collapsed||aF)){aT[aW++]=aV.totals}}return aT}function R(aQ){var aP=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/;var aR=aQ.toString().match(aP);return{params:aR[1].split(","),body:aR[2]}}function an(aR){var aQ=R(aR.accumulate);var aP=new Function("_items","for (var "+aQ.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+aQ.params[0]+" = _items[_i]; "+aQ.body+"}");aP.displayName=aP.name="compiledAccumulatorLoop";return aP}function aj(){var aS=R(v);var aP=aS.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }");var aQ=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");aQ=aQ.replace(/\$filter\$/gi,aP);aQ=aQ.replace(/\$item\$/gi,aS.params[0]);aQ=aQ.replace(/\$args\$/gi,aS.params[1]);var aR=new Function("_items,_args",aQ);aR.displayName=aR.name="compiledFilter";return aR}function B(){var aS=R(v);var aP=aS.body.replace(/return false[;}]/gi,"{ continue _coreloop; }").replace(/return true[;}]/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }").replace(/return ([^;}]+?);/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }");var aQ=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");aQ=aQ.replace(/\$filter\$/gi,aP);aQ=aQ.replace(/\$item\$/gi,aS.params[0]);aQ=aQ.replace(/\$args\$/gi,aS.params[1]);var aR=new Function("_items,_args,_cache",aQ);aR.displayName=aR.name="compiledFilterWithCaching";return aR}function o(aR,aS){var aQ=[],aP=0;for(var aT=0,aU=aR.length;aT<aU;aT++){if(v(aR[aT],aS)){aQ[aP++]=aR[aT]}}return aQ}function Q(aS,aT,aR){var aQ=[],aP=0,aW;for(var aU=0,aV=aS.length;aU<aV;aU++){aW=aS[aU];if(aR[aU]){aQ[aP++]=aW}else{if(v(aW,aT)){aQ[aP++]=aW;aR[aU]=true}}}return aQ}function w(aQ){if(v){var aP=Z.inlineFilters?G:o;var aS=Z.inlineFilters?z:Q;if(ag.isFilterNarrowing){n=aP(n,aG)}else{if(ag.isFilterExpanding){n=aS(aQ,aG,ak)}else{if(!ag.isFilterUnchanged){n=aP(aQ,aG)}}}}else{n=C?aQ:aQ.concat()}var aR;if(C){if(n.length<D*C){D=Math.floor(n.length/C)}aR=n.slice(C*D,C*D+C)}else{aR=n}return{totalRows:n.length,rows:aR}}function k(aY,aS){var aX,aP,aQ,aW=[];var aU=0,aV=aS.length;if(ag&&ag.ignoreDiffsBefore){aU=Math.max(0,Math.min(aS.length,ag.ignoreDiffsBefore))}if(ag&&ag.ignoreDiffsAfter){aV=Math.min(aS.length,Math.max(0,ag.ignoreDiffsAfter))}for(var aR=aU,aT=aY.length;aR<aV;aR++){if(aR>=aT){aW[aW.length]=aR}else{aX=aS[aR];aP=aY[aR];if((L&&(aQ=(aX.__nonDataRow)||(aP.__nonDataRow))&&aX.__group!==aP.__group||aX.__updated||aX.__group&&!aX.equals(aP))||(J&&aQ&&(aX.__groupTotals||aP.__groupTotals))||aX[q]!=aP[q]||(aq&&aq[aX[q]])){aW[aW.length]=aR}}}return aW}function s(aS){au=null;if(ag.isFilterNarrowing!=O.isFilterNarrowing||ag.isFilterExpanding!=O.isFilterExpanding){ak=[]}var aQ=w(aS);g=aQ.totalRows;var aP=aQ.rows;h=[];if(L!=null){h=Y(aP);if(h.length){t(h);if(J){af(h)}h.sort(aA);aP=i(h)}}var aR=k(W,aP);W=aP;return aR}function aw(){if(E){return}var aP=W.length;var aQ=g;var aR=s(at,v);if(C&&g<D*C){D=Math.max(0,Math.ceil(g/C)-1);aR=s(at,v)}aq=null;O=ag;ag={};if(aQ!=g){aM.notify(al(),null,ar)}if(aP!=W.length){aD.notify({previous:aP,current:W.length},null,ar)}if(aR.length>0){N.notify({rows:aR},null,ar)}}function V(aS,aR){var aQ=this;var aP=aQ.mapRowsToIds(aS.getSelectedRows());var aT;aS.onSelectedRowsChanged.subscribe(function(aV,aU){if(aT){return}aP=aQ.mapRowsToIds(aS.getSelectedRows())});this.onRowsChanged.subscribe(function(aW,aU){if(aP.length>0){aT=true;var aV=aQ.mapIdsToRows(aP);if(!aR){aP=aQ.mapRowsToIds(aV)}aS.setSelectedRows(aV);aT=false}})}function aa(aR,aQ){var aP;var aT;aS(aR.getCellCssStyles(aQ));function aS(aU){aP={};for(var aV in aU){var aW=W[aV][q];aP[aW]=aU[aV]}}aR.onCellCssStylesChanged.subscribe(function(aV,aU){if(aT){return}if(aQ!=aU.key){return}if(aU.hash){aS(aU.hash)}});this.onRowsChanged.subscribe(function(aW,aU){if(aP){aT=true;u();var aV={};for(var aY in aP){var aX=au[aY];if(aX!=undefined){aV[aX]=aP[aY]}}aR.setCellCssStyles(aQ,aV);aT=false}})}return{beginUpdate:p,endUpdate:r,setPagingOptions:A,getPagingInfo:al,getItems:aN,setItems:U,setFilter:ab,sort:H,fastSort:aI,reSort:x,groupBy:ac,setAggregators:aK,collapseGroup:ai,expandGroup:ae,getGroups:am,getIdxById:I,getRowById:ah,getItemById:X,getItemByIdx:az,mapRowsToIds:S,mapIdsToRows:aE,setRefreshHints:ay,setFilterArgs:P,refresh:aw,updateItem:l,insertItem:aJ,addItem:ao,deleteItem:aO,syncGridSelection:V,syncGridCellCssStyles:aa,getLength:ax,getItem:aC,getItemMetadata:K,onRowCountChanged:aD,onRowsChanged:N,onPagingInfoChanged:aM}}function c(g){this.field_=g;this.init=function(){this.count_=0;this.nonNullCount_=0;this.sum_=0};this.accumulate=function(h){var i=h[this.field_];this.count_++;if(i!=null&&i!=""&&i!=NaN){this.nonNullCount_++;this.sum_+=parseFloat(i)}};this.storeResult=function(h){if(!h.avg){h.avg={}}if(this.nonNullCount_!=0){h.avg[this.field_]=this.sum_/this.nonNullCount_}}}function b(g){this.field_=g;this.init=function(){this.min_=null};this.accumulate=function(h){var i=h[this.field_];if(i!=null&&i!=""&&i!=NaN){if(this.min_==null||i<this.min_){this.min_=i}}};this.storeResult=function(h){if(!h.min){h.min={}}h.min[this.field_]=this.min_}}function a(g){this.field_=g;this.init=function(){this.max_=null};this.accumulate=function(h){var i=h[this.field_];if(i!=null&&i!=""&&i!=NaN){if(this.max_==null||i>this.max_){this.max_=i}}};this.storeResult=function(h){if(!h.max){h.max={}}h.max[this.field_]=this.max_}}function e(g){this.field_=g;this.init=function(){this.sum_=null};this.accumulate=function(h){var i=h[this.field_];if(i!=null&&i!=""&&i!=NaN){this.sum_+=parseFloat(i)}};this.storeResult=function(h){if(!h.sum){h.sum={}}h.sum[this.field_]=this.sum_}}})(jQuery);(function(b){b.extend(true,window,{Slick:{Data:{GroupItemMetadataProvider:a}}});function a(m){var i;var f={groupCssClass:"slick-group",totalsCssClass:"slick-group-totals",groupFocusable:true,totalsFocusable:false,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:true};m=b.extend(true,{},f,m);function h(r,n,q,o,p){if(!m.enableExpandCollapse){return p.title}return"<span class='"+m.toggleCssClass+" "+(p.collapsed?m.toggleCollapsedCssClass:m.toggleExpandedCssClass)+"'></span>"+p.title}function d(r,n,q,o,p){return(o.groupTotalsFormatter&&o.groupTotalsFormatter(p,o))||""}function l(n){i=n;i.onClick.subscribe(e);i.onKeyDown.subscribe(j)}function k(){if(i){i.onClick.unsubscribe(e);i.onKeyDown.unsubscribe(j)}}function e(p,n){var o=this.getDataItem(n.row);if(o&&o instanceof Slick.Group&&b(p.target).hasClass(m.toggleCssClass)){if(o.collapsed){this.getData().expandGroup(o.value)}else{this.getData().collapseGroup(o.value)}p.stopImmediatePropagation();p.preventDefault()}}function j(q,o){if(m.enableExpandCollapse&&(q.which==b.ui.keyCode.SPACE)){var n=this.getActiveCell();if(n){var p=this.getDataItem(n.row);if(p&&p instanceof Slick.Group){if(p.collapsed){this.getData().expandGroup(p.value)}else{this.getData().collapseGroup(p.value)}q.stopImmediatePropagation();q.preventDefault()}}}}function c(n){return{selectable:false,focusable:m.groupFocusable,cssClasses:m.groupCssClass,columns:{0:{colspan:"*",formatter:h,editor:null}}}}function g(n){return{selectable:false,focusable:m.totalsFocusable,cssClasses:m.totalsCssClass,formatter:d,editor:null}}return{init:l,destroy:k,getGroupRowMetadata:c,getTotalsRowMetadata:g}}})(jQuery);(function(d){var c=function(){if(window.console&&console.log){console.log(Array.prototype.slice.call(arguments))}};var b=function(l,h,k,i,g){var j="./"+g.name;var f='<a href="'+j+'">'+k+"</a>";return f};var a=function(l,h,k,i,g){var j=g.profile_url;var f='<a href="'+j+'">'+k+"</a>";return f};var e=function(p,o,n,i,g){var l=n.substring(0,4);var j=n.substring(5,7);var m=n.substring(8,10);if(j.charAt(0)=="0"){j=j.substring(1)}if(m.charAt(0)=="0"){m=m.substring(1)}var f=(window.head_data||{}).date_format;if(!f){f=karl_client_data.date_format}var k=new Date(l,j-1,m);var h=Globalize.format(k,"d",Globalize.culture(f));return h};d.widget("karl.karlwikitoc",{options:{},_create:function(){var n=this;var j=this.options.ux2?'<button class="btn karl-wikitoc-button-inspector">Options</button>':'<a href="#" class="karl-wikitoc-button-inspector">Options</a>';var k=this.options.ux2?"karl-wikitoc-footer paginationBar":"karl-wikitoc-footer ui-widget-header";this.element.append('<div class="karl-wikitoc-gridwrapper ui-helper-clearfix"><div class="karl-wikitoc-widthconstrainer"><div class="karl-wikitoc-grid"></div></div><div class="karl-wikitoc-inspector"><div class="karl-wikitoc-inspector-wrapper"><div class="karl-wikitoc-inspector-wrapper2"><fieldset class="karl-wikitoc-livesearch"><legend>Find in text</legend><div><p>Letters anywhere in title, tags, or author</p><div><span class="karl-wikitoc-icon-search ui-icon ui-icon-search"></span><input class="karl-wikitoc-input-livesearch" type="text"></input></div><div class="ui-helper-clearfix"></div></div></fieldset><fieldset class="karl-wikitoc-grouping"><legend>Grouping</legend><div><p>Column, if any, to group by</p><div><input type="checkbox" class="karl-wikitoc-cb-grouping"></input><label>Group by tags</label></div></div></fieldset><fieldset class="karl-wikitoc-columnselectors"><legend>Columns</legend><div><p>Which columns to show in the grid, in addition to title</p><div><input class="karl-wikitoc-cb-title" type="checkbox" checked="checked"></input><label>Title</label></div><div><input class="karl-wikitoc-cb-author_name" type="checkbox" checked="checked"></input><label>Author</label></div><div><input class="karl-wikitoc-cb-tags" type="checkbox"></input><label>Tags</label></div><div><input class="karl-wikitoc-cb-created" type="checkbox" checked="checked"></input><label>Created</label></div><div><input class="karl-wikitoc-cb-modified" type="checkbox"></input><label>Modified</label></div></div></fieldset></div></div></div></div><div class="'+k+'"><span class="karl-wikitoc-items"><span class="karl-wikitoc-items-num">0</span> items</span>'+j+"</div>");this.el_gridwrapper=this.element.find(".karl-wikitoc-gridwrapper");this.el_widthconstrainer=this.element.find(".karl-wikitoc-widthconstrainer");this.el_grid=this.el_gridwrapper.find(".karl-wikitoc-grid");this.el_inspector=this.el_gridwrapper.find(".karl-wikitoc-inspector");this.el_columnselectors=this.el_inspector.find(".karl-wikitoc-columnselectors");this.el_footer=this.element.find(".karl-wikitoc-footer");this.el_button_inspector=this.el_footer.find(".karl-wikitoc-button-inspector");this.el_input_livesearch=this.el_inspector.find(".karl-wikitoc-input-livesearch");this.el_cb_grouping=this.el_inspector.find(".karl-wikitoc-cb-grouping");this.el_label_items_num=this.el_footer.find(".karl-wikitoc-items-num");this.inspector_width=d(".karl-wikitoc-inspector-wrapper").width();this.el_column_selectors={title:this.el_inspector.find(".karl-wikitoc-cb-title"),author_name:this.el_inspector.find(".karl-wikitoc-cb-author_name"),tags:this.el_inspector.find(".karl-wikitoc-cb-tags"),created:this.el_inspector.find(".karl-wikitoc-cb-created"),modified:this.el_inspector.find(".karl-wikitoc-cb-modified")};d.each(this.el_column_selectors,function(r,q){q.click(function(){n.grid_columns=n.grid.getColumns();n.filterGridColumns();n.grid.setColumns(n.grid_columns)})});if(!this.options.ux2){this.el_button_inspector.button({icons:{primary:"ui-icon-triangle-1-w"}})}this.el_button_inspector.click(function(q){n.grid_columns=n.grid.getColumns();n.toggleInspector(q);return false});this.searchString="";this.el_input_livesearch.keyup(function(q){Slick.GlobalEditorLock.cancelCurrentEdit();if(q.which==27){this.value=""}n.searchString=this.value;n.dataView.refresh()});this.el_cb_grouping.click(function(q){var r=d(this).is(":checked");if(r){n.enableGrouping()}else{n.disableGrouping()}});this.el_grid.find(".slick-row").live("mouseenter mouseleave",function(q){var r=d(this);if(r.is(".slick-group")){return}if(q.type=="mouseenter"){r.addClass("karl-wikitoc-grid-row-hover")}else{r.removeClass("karl-wikitoc-grid-row-hover")}});this.inactive_columns={};this.grid_columns=[{id:"title",name:"Title",field:"title",formatter:b,width:320,minWidth:20,sortable:true},{id:"author_name",name:"Author",field:"author_name",formatter:a,width:80,minWidth:20,sortable:true},{id:"tags",name:"Tags",field:"tags",width:140,minWidth:20,sortable:false},{id:"created",name:"Created",field:"created",formatter:e,width:60,minWidth:20,sortable:true},{id:"modified",name:"Modified",field:"modified",formatter:e,width:60,minWidth:20,sortable:true}];this.filterGridColumns();var h=this.grid_columns;var p={enableCellNavigation:true,editable:false,forceFitColumns:true,rowHeight:this.options.rowHeight,headerHeight:this.options.headerHeight};var o=new Slick.Data.GroupItemMetadataProvider();var m=this.dataView=new Slick.Data.DataView({groupItemMetadataProvider:o});var g=this.grid=new Slick.Grid(this.el_grid,m,h,p);g.registerPlugin(o);function i(r,q){var t=r[n.sortCol].toLowerCase();var s=q[n.sortCol].toLowerCase();return(t==s?0:(t>s?1:-1))}this.sortCol="title";this.sortDir=1;g.onSort.subscribe(function(r,q){n.sortDir=q.sortAsc?1:-1;n.sortCol=q.sortCol.field;m.sort(i,q.sortAsc)});m.onRowCountChanged.subscribe(function(r,q){g.updateRowCount();g.render()});m.onRowsChanged.subscribe(function(r,q){g.invalidateRows(q.rows);g.render()});m.beginUpdate();m.setItems(this.options.items);m.setFilter(function f(q){return n._contentFilter(q)});g.setSortColumn(this.sortCol,this.sortDir);m.sort(i,this.sortDir==1);m.endUpdate();this.el_label_items_num.text(this.options.items.length);if(this.options.ux2){this.element.find(".ui-widget").removeClass("ui-widget");this.element.find(".ui-widget-header").removeClass("ui-widget-header");this.element.find(".ui-widget-content").removeClass("ui-widget-content")}var l=this.element.find(".slick-header-column").eq(0);this.headerColumnPadding=parseInt(l.css("padding-left"),10)+parseInt(l.css("padding-right"),10);this.grid.setColumns(this.grid_columns)},_addFakeRecords:function(){var g=this;if(!this._fake_records_added){this._fake_records_added=true;this.dataView.beginUpdate();var f=this.dataView.getItems();d.each(f,function(i,j){var h=j.tags;j.original=true;if(h.length===0){j.effective_tag=""}else{j.effective_tag=h[0];d.each(h,function(l,k){if(l===0){return}var m=d.extend({},j,{effective_tag:k,original:false});g.dataView.addItem(m)})}});this.dataView.endUpdate()}},enableGrouping:function(){var f=this;this.groupingEnabled=true;this._addFakeRecords();this.dataView.groupBy("effective_tag",function(h){if(h.value!==""){return'<span class="karl-wikitoc-groupheader">Tag: '+h.value+"</span>"}else{return'<span class="karl-wikitoc-groupheader">Untagged:</span>'}},function(h,g){var j=h.value.toLowerCase();var i=g.value.toLowerCase();if(j==i){return 0}if(j===""){return +1}if(i===""){return -1}return j<i?-1:+1})},disableGrouping:function(){this.groupingEnabled=false;this.dataView.groupBy(null)},_contentFilter:function(h){if(!this.groupingEnabled&&this._fake_records_added&&!h.original){return false}var g=this.searchString.toLowerCase();if(g===""){return true}if(h.title.toLowerCase().indexOf(g)!=-1){return true}if(h.author_name.toLowerCase().indexOf(g)!=-1){return true}var f=false;d.each(h.tags,function(j,i){if(i.toLowerCase().indexOf(g)!=-1){f=true;return false}});return f},filterGridColumns:function(){var h=this;var f=this.inactive_columns;d.each(f,function(o,m){var n=m.data;var k=h.el_column_selectors[o].is(":checked");if(k){var l=[];var j=false;if(!m.prev_column){l.push(n);j=true}d.each(h.grid_columns,function(p,q){l.push(q);if(m.prev_column&&q.id==m.prev_column.id){l.push(n);j=true}});if(!j){l.push(n)}delete f[o];h.grid_columns=l}});var g=[];var i=null;d.each(this.grid_columns,function(j,l){var m=l.id;var k=h.el_column_selectors[m].is(":checked");if(k){g.push(l)}else{f[l.id]={data:l,prev_column:i}}i=l});this.grid_columns=g},toggleInspector:function(f){var g=this;if(this.inspector_button_locked){return}this.inspector_button_locked=true;var k=this.inspector_width;var i=this._inspector_open;var l=this._inspector_open=!i;var h=this.el_widthconstrainer.width();if(l){if(!this.options.ux2){this.el_button_inspector.button("option","icons",{primary:"ui-icon-triangle-1-e"})}this.el_inspector.animate({width:""+k+"px"},{complete:function(){var m=(h-k)/h;d.each(g.grid_columns,function(n,o){o.width=Math.round(o.width*m)});g.el_widthconstrainer.width(h-k);g.grid.resizeCanvas();g.grid.setColumns(g.grid_columns);g.inspector_button_locked=false}})}else{if(!this.options.ux2){this.el_button_inspector.button("option","icons",{primary:"ui-icon-triangle-1-w"})}this.el_inspector.animate({width:"0px"},{complete:function(){g.inspector_button_locked=false}});this.el_widthconstrainer.css("width","100%");this.grid.resizeCanvas();var j=(h+k)/h;d.each(this.grid_columns,function(m,n){n.width=Math.round(n.width*j)});this.grid.setColumns(this.grid_columns)}},resizeColumns:function(m){var n=this;if(this.inspector_button_locked){return}this.inspector_button_locked=true;var i=this.el_gridwrapper.width();if(this._inspector_open){i=i-this.inspector_width;this.el_widthconstrainer.width(i)}var g=0;d.each(this.grid_columns,function(o,p){g+=p.width});var k=i/g;this.grid.autosizeColumns();this.grid.resizeCanvas();this.grid.setColumns(this.grid_columns);var h=this.element.find(".slick-header-column");var l=h.eq(0);var f=parseInt(l.css("padding-left"),10)+parseInt(l.css("padding-right"),10);var j=this.headerColumnPadding-f;this.element.find(".slick-header-column").each(function(){var o=d(this);o.width(o.width()+j)});this.inspector_button_locked=false}})})(jQuery);(function(f){var d=function(){var h=window.console;if(h&&h.log){h.log(Array.prototype.slice.call(arguments))}};var e={base:function(m,j,l,k,i){var h="<table><tr><td>";h+=l;h+="</td></tr></table>";return h},icon:function(n,j,m,k,i){var h="<table><tr><td>";var l=i[k.field+"_icon_url"];h+='<img src="'+l+'" alt="icon" title="'+m+'"/>';h+="</td></tr></table>";return h},link:function(n,j,m,k,i){var h="<table><tr><td>";var l=i[k.field+"_url"];h+='<a href="'+l+'">'+m+"</a>";h+="</td></tr></table>";return h}};var g={filetype:"icon",title:"link"};f.widget("popper.poppergrid",{options:{url:null,manageQueue:true,minimumLoad:null,loadData:null,columns:[],focus:false,rowHeight:34,checkboxSelectColumn:false,autoResizeColumns:true},_create:function(){var o=this;this.gridColumns=[];if(this.options.checkboxSelectColumn){this.checkboxSelector=new Slick.CheckboxSelectColumn({});this.saveSelectedColumns=null}f.each(this.options.columns,function(q,s){var t;var u=s.field;var r=s.formatterName||g[u];if(u=="sel"&&o.options.checkboxSelectColumn){t=o.checkboxSelector.getColumnDefinition();t.cssClass="cell-"+u;t.cbFormatter=t.formatter;if(r){t.formatter=e[r];t.cssClass+=" cellformatter-"+r}}else{if(!r){r="base"}t={id:u,formatter:e[r],cssClass:"cell-"+u+" cellformatter-"+r,sortable:true}}o.gridColumns.push(f.extend({},t,s))});var p={enableCellNavigation:true,editable:false,forceFitColumns:true,rowHeight:this.options.rowHeight};var i=this.el_wrapper=f('<div class="pp-grid-wrapper"><div class="pp-grid"></div></div>').appendTo(this.element);this.data={length:0};this.el_grid=this.element.find(".pp-grid");var k=null;var l=1;if(this.options.loadData){k=this.options.loadData.sortCol;l=this.options.loadData.sortDir}this.grid=new Slick.Grid(this.el_grid,this.data,this.gridColumns,p);var n=this.element.find(".slick-viewport");if(k){this.grid.setSortColumn(k,l);this._updateSortColumn(k)}if(this.options.focus){n.focus()}this.element.poppergridloader({url:this.options.url,manageQueue:this.options.manageQueue,sortCol:k,sortDir:l,extraQuery:this.options.extraQuery,minimumLoad:this.options.minimumLoad,dataLoading:function(q){o.createLoadingIndicator();o.loadingIndicator.show()},dataLoaded:function(q,s){if(s.from!==undefined){var r;for(r=s.from;r<s.to;r++){o.grid.invalidateRow(r)}o.grid.updateRowCount();o.grid.render();o._displayTotal(s.total);o._restoreSelection()}if(o.loadingIndicator){o.loadingIndicator.hide()}}});this.loader=this.element.data("poppergridloader");this.loader.setData(this.data);this.grid.onSort.subscribe(function(q,t){var s=t.sortAsc?1:-1;var r=t.sortCol.field;o.sortingChange(r,s)});this.scrollPosition=-1;this.grid.onViewportChanged.subscribe(function(q,t){var s=o.grid.getViewport();var v=s.top;var r=s.bottom;var u=v>=o.scrollPosition?+1:-1;o.loader.ensureData(v,r,u);o.scrollPosition=v});if(this.options.checkboxSelectColumn){this.grid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:false}));this.grid.registerPlugin(this.checkboxSelector)}this.grid.onSelectedRowsChanged.subscribe(function(q){o._trigger("selectedRowsChanged",q,null)});this.element.find(".ui-widget").removeClass("ui-widget");this.element.find(".ui-widget-header").removeClass("ui-widget-header");this.element.find(".ui-widget-content").removeClass("ui-widget-content");var m=this.element.find(".slick-header-column").eq(0);this.headerColumnPadding=parseInt(m.css("padding-left"),10)+parseInt(m.css("padding-right"),10);var j=this.options.loadData;if(j){this.loader.loadData(j);this.grid.updateRowCount();this.grid.render();this._displayTotal(j.total)}else{this.grid.onViewportChanged.notify()}if(this.options.autoResizeColumns){var h;f(window).resize(function(q){if(h!==null){clearTimeout(h)}h=setTimeout(function(){o.resizeColumns();h=null},400)})}},destroy:function(){this.loader.destroy();f.Widget.prototype.destroy.call(this);this.data=null},createLoadingIndicator:function(){if(!this.loadingIndicator){this.loadingIndicator=f('<span class="loading-indicator"><label>Buffering...</label></span>').appendTo(document.body);this.loadingIndicator.position({my:"center center",at:"center center",of:this.element})}},_displayTotal:function(i){i=""+i;var k="";while(i.length>0){var j=i.length-3;if(j<0){j=0}var h=i.substring(j);i=i.substring(0,j);if(k.length>0){k=h+","+k}else{k=h}}this._trigger("updateTotal",null,{total:k})},_updateSortColumn:function(h){var i=this.el_grid.find(".slick-header-columns");var j=i.children();j.each(function(l){var m=f(this);var k=m.data("fieldId");if(k==h){m.addClass("ui-state-focus")}else{m.removeClass("ui-state-focus")}})},sortingChange:function(i,h){this._updateSortColumn(i);this.loader.option({sortCol:i,sortDir:h});this.clearData()},clearData:function(){this._clearData();this.grid.onViewportChanged.notify()},_setOption:function(h,i){f.Widget.prototype._setOption.call(this,h,i);if(h=="extraQuery"){this._reFilter()}},setExtraQueryKey:function(i,h){if(this.options.extraQuery===undefined){this.options.extraQuery={}}this.options.extraQuery[i]=h;this._reFilter()},_reFilter:function(){this.loader.option({extraQuery:this.options.extraQuery});this._clearData();this.grid.onViewportChanged.notify()},getSelectedRows:function(){return this.grid.getSelectedRows()},getSelectedRowIds:function(){var i=this.getSelectedRows();var j=this.getData();var h=[];if(i.length>100){return false}f.each(i,function(k,l){var m=j[l];if(m!==undefined){h.push(m.id)}else{d("MISSED and IGNORED selection of uncached row #"+l)}});return h},getTotalSelectedRowSize:function(){var i=this.getSelectedRows();var j=this.getData();var h=0;if(i.length>100){return false}f.each(i,function(k,l){var m=j[l];if(m!==undefined){h+=m.size}else{d("MISSED and IGNORED selection of uncached row #"+l)}});return h},getData:function(){return this.grid.getData()},_clearData:function(){if(this.options.checkboxSelectColumn&&this.saveSelectedColumns===null){var j=this.getData();var i=this.grid.getSelectedRows();var h=this.saveSelectedColumns={};f.each(i,function(k,m){var l=j[m];h[l.id]=true})}this.loader.clearData()},_restoreSelection:function(){var h=this;if(this.options.checkboxSelectColumn&&this.saveSelectedColumns!==null){var i=[];var j=this.getData();f.each(j,function(k,l){if(l!==undefined&&h.saveSelectedColumns[l.id]){i.push(k)}});this.grid.setSelectedRows(i);this.saveSelectedColumns=null}},resizeColumns:function(o){var p=this;var k=this.el_wrapper.width();var i=0;f.each(this.gridColumns,function(q,r){i+=r.width});var m=k/i;this.grid.autosizeColumns();this.grid.resizeCanvas();this.grid.setColumns(this.gridColumns);var j=this.element.find(".slick-header-column");var n=j.eq(0);var h=parseInt(n.css("padding-left"),10)+parseInt(n.css("padding-right"),10);var l=this.headerColumnPadding-h;this.element.find(".slick-header-column").each(function(){var q=f(this);q.width(q.width()+l)})}});var b=false;var a="poppergridloaderQueue";function c(){if(!b){f.manageAjax.create(a,{queue:true,maxRequests:1});b=true}}f.widget("popper.poppergridloader",{options:{url:null,manageQueue:true,sortCol:null,sortDir:1,reallyAbort:false},_create:function(){if(this.options.manageQueue){if(!f.manageAjax){throw new Error("The jquery.ajaxmanager.js must be loaded, if the grid is created with the default option manageQueue=true.")}c()}this._active_request=null},setData:function(h){this.data=h},getData:function(h){return this.data},destroy:function(){f.Widget.prototype.destroy.call(this);this._abortRequest(true);this.data=null},clearData:function(){var h=this.data;f.each(h,function(i,j){delete h[i]});this._abortRequest(true)},_abortRequest:function(h){if(this._active_request!==null){if(this.options.manageQueue){f.manageAjax.clear(a,h||this.options.reallyAbort)}else{if(h||this.options.reallyAbort){this._active_request.abort()}}}this._active_request=null},ensureData:function(p,q,o){var r=this;this._abortRequest();if(p<0){throw new Error('"from" must not be negative')}if(p>=q){throw new Error('"to" must be greater than "from"')}var h;var k;if(o==+1){h=p;k=q-1}else{h=q-1;k=p}var l=h;var n=null;var m=null;while(true){if(!this.data[l]){if(n===null){n=l}m=l}if(l==k){break}l+=o}if(n===null){this._trigger("dataLoaded",null,null);return}h=n;k=m;if(this.options.minimumLoad&&(q-p)<this.options.minimumLoad){k=h+o*this.options.minimumLoad}if(h>k){p=k;q=h}else{p=h;q=k}if(p<0){p=0}q+=1;this._trigger("dataLoading",null,{from:p,to:q});var j={type:"GET",url:this.options.url,data:f.extend({from:p,to:q,sortCol:this.options.sortCol,sortDir:this.options.sortDir},(this.options.extraQuery||{})),success:function(i){if(i!==null){r._ajaxSuccess(i)}r._active_request=null;r._trigger("dataLoaded",null,i)},error:function(s,t,i){r._active_request=null;r._ajaxError(s,t,i)},dataType:"json"};if(this.options.manageQueue){this._active_request=f.manageAjax.add(a,j)}else{this._active_request=f.ajax(j)}},loadData:function(j){var l=j.from,k=j.to,h;for(h=l;h<k;h++){this.data[h]=j.records[h-l]}this.data.length=j.total},_ajaxSuccess:function(h){this.loadData(h)},_ajaxError:function(i,j,h){if(j!="abort"){d("error: "+j)}}});f.widget("popper.poppergridbox",{options:{},_create:function(){var h=this;this.menuMove=f("<ul></ul>").insertAfter(this.element).hide().width(250).addClass("karl-gridbox-menu").css("max-height","325px").css("position","absolute").css("overflow-x","hidden").css("overflow-y","auto").menu({select:function(i,k){h.menuMove.hide();var j=k.item;if(j){var l=j.data("folder");h._onMoveSelected(i,l)}}});this.menuMove.bind("keydown",function(i){if(h.menuMove.menu("option","disabled")){return}if(i.keyCode==f.ui.keyCode.ESCAPE){h.menuMove.hide();i.preventDefault();i.stopImmediatePropagation()}});f("body").bind("mousedown",function(i){if(h.menuMove.menu("option","disabled")||h.menuMove.is(":hidden")||f(i.target).is(".karl-gridbox-menu")||f(i.target).is(".karl-gridbox-menu *")){return}h.menuMove.hide();i.preventDefault();i.stopImmediatePropagation()})},deleteFiles:function(h){var i=this;var k=this.el.grid.poppergrid("getSelectedRowIds");if(k===false){alert("You have selected more than 100 rows. Please select less rows.");return}var j=confirm("Are you sure you want to delete the selected files and/or folders?");if(j){f.ajax({url:this.options.deleteUrl,type:"POST",dataType:"json",timeout:20000,data:{file:k},success:function(m,n,l){if(m&&m.result=="OK"){i.deleteSuccess(m)}else{i.deleteError(m)}},error:function(l,n,m){i.deleteError({result:"ERROR",error:"Unknown server error: "+n})}})}},deleteSuccess:function(i){var h=""+i.deleted+" file(s) succesfully deleted";alert(h);this.el.grid.poppergrid("clearData")},deleteError:function(i){var h="Deletion failed: "+i.error;alert(h)},moveFiles:function(h){var i=this;var j=this.el.grid.poppergrid("getSelectedRowIds");if(j===false){alert("You have selected more than 100 rows. Please select less rows.");return}this.menuMove.show();this.menuMove.position({my:"left bottom",at:"left top",of:h.target,collision:"fit"});this.menuMove.focus()},setTargetFolders:function(j){if(j.targetFolders===undefined){return}var l=j.targetFolders;var m=j.currentFolder;var u=this;this.menuMove.find("li").remove();function r(w){var x=0;var v;for(v=1;v<w.length;v++){if(w.charAt(v)==="/"){x++}}return x}var o=(f.browser.msie?Math.min(l.length,400):l.length);var p;for(p=0;p<o;p++){var k=l[p];var n=k.path;var q=k.title;if(!n||n.charAt(0)!="/"){throw new Error('Fatal error: folder path must start with a "/"')}var h;if(n=="/"){h=0}else{if(n&&n.charAt(n.length-1)=="/"){throw new Error('Fatal error: folder path must not end with a "/"')}h=r(n)}var t=f("<li></li>").css("textAlign","left").data("folder",k).appendTo(u.menuMove);var s;if(n!=m){s=f("<a></a>")}else{s=f("<span></span>")}s.appendTo(t).text(q).css("marginLeft",""+(h*u.options.folderMenuIndent)+"px")}window.midTime=(new Date()).valueOf();this.menuMove.menu("refresh")},_onMoveSelected:function(h,l){var i=this;var k=this.el.grid.poppergrid("getSelectedRowIds");if(k===false){alert("You have selected more than 100 rows. Please select less rows.");return}var j=confirm('Are you sure you want to move these selected files/folders to "'+l.title+'"?');if(j){f.ajax({url:this.options.moveToUrl,type:"POST",dataType:"json",timeout:20000,data:{file:k,target_folder:l.path},success:function(n,o,m){if(n&&n.result=="OK"){i.moveToSuccess(n)}else{i.moveToError(n)}},error:function(m,o,n){i.moveToError({result:"ERROR",error:"Unknown server error: "+o})}})}},moveToSuccess:function(i){var h=""+i.moved+" file(s) succesfully moved.";alert(h);this.el.grid.poppergrid("clearData")},moveToError:function(i){var h="Moving files failed: "+i.error;alert(h)},downloadFiles:function(h){var i=this;var m=this.el.grid.poppergrid("getSelectedRowIds");if(m===false){alert("You have selected more than 100 rows. Please select less rows.");return}var l=this.el.grid.poppergrid("getTotalSelectedRowSize");if(l>20971520){alert("Maximum download size is 20 MB. Total size for selected files is "+parseInt(l/1000000)+" MB.");return}var k=confirm("Are you sure you want to download the "+m.length+" selected files and/or folders?");if(k){var j=this.options.downloadUrl;var n=f.param({filenames:m});window.location.href=j+"?"+n}}})})(jQuery);