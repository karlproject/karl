/*
 * KARL karl-contentfeeds.min.js generated resources http://github.com/karlproject/karl %>
*/
!function(){var t={};this.tmpl=function e(i,s){var n=/\W/.test(i)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+i.replace(/[\r\t\n]/g," ").split("{%").join("	").replace(/((^|%})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%}/g,"',$1,'").split("	").join("');").split("%}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):t[i]=t[i]||e(document.getElementById(i).innerHTML);return s?n(s):n}}(),function(t){function e(){var e=i(this);return isNaN(e.datetime)||t(this).text(s(e.datetime)),this}function i(e){if(e=t(e),!e.data("timeago")){e.data("timeago",{datetime:a.datetime(e)});var i=t.trim(e.text());i.length>0&&e.attr("title",i)}return e.data("timeago")}function s(t){return a.inWords(n(t))}function n(t){return(new Date).getTime()-t.getTime()}t.timeago=function(e){return s(e instanceof Date?e:"string"==typeof e?t.timeago.parse(e):t.timeago.datetime(e))};var a=t.timeago;t.extend(t.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(e){function i(i,n){var a=t.isFunction(i)?i(n,e):i,r=s.numbers&&s.numbers[n]||n;return a.replace(/%d/i,r)}var s=this.settings.strings,n=s.prefixAgo,a=s.suffixAgo;this.settings.allowFuture&&(0>e&&(n=s.prefixFromNow,a=s.suffixFromNow),e=Math.abs(e));var r=e/1e3,o=r/60,l=o/60,c=l/24,f=c/365,u=45>r&&i(s.seconds,Math.round(r))||90>r&&i(s.minute,1)||45>o&&i(s.minutes,Math.round(o))||90>o&&i(s.hour,1)||24>l&&i(s.hours,Math.round(l))||48>l&&i(s.day,1)||30>c&&i(s.days,Math.floor(c))||60>c&&i(s.month,1)||365>c&&i(s.months,Math.floor(c/30))||2>f&&i(s.year,1)||i(s.years,Math.floor(f));return t.trim([n,u,a].join(" "))},parse:function(e){var i=t.trim(e);return i=i.replace(/\.\d\d\d+/,""),i=i.replace(/-/,"/").replace(/-/,"/"),i=i.replace(/T/," ").replace(/Z/," UTC"),i=i.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(i)},datetime:function(e){var i="time"===t(e).get(0).tagName.toLowerCase(),s=t(e).attr(i?"datetime":"title");return a.parse(s)}}),t.fn.timeago=function(){var t=this;t.each(e);var i=a.settings;return i.refreshMillis>0&&setInterval(function(){t.each(e)},i.refreshMillis),t},document.createElement("abbr"),document.createElement("time")}(jQuery),function(t){var e=function(){var t=!1;t&&window.console&&console.log&&console.log(Array.prototype.slice.call(arguments))};t.widget("karl.karlcontentfeeds",{options:{selectTimeAgo:"abbr.timeago",ajax_url:"",filter:""},_create:function(){this._templates={},this._summary_info={},this._gen_feed_url(),this._ajax_state="on",this._ajax_base_state=this._ajax_state},destroy:function(){t.Widget.prototype.destroy.call(this),this._active_request&&this._active_request.abort(),this._active_request=null},start_over:function(){this.element.empty(),this._summary_info={},this._gen_feed_url(),this._active_request&&this._active_request.abort(),this.setAjaxState(this._ajax_base_state,{notify:!0}),this.element.trigger("changed.karlcontentfeeds",[this._summary_info])},get_items:function(t){var i=this;t=t||{};var s=["polling","error"];return t.force||s.push("off"),jQuery.inArray(i._ajax_state,s)>-1?void e("bailout: "+i._ajax_state):(i.setAjaxState("polling",{notify:!0}),this._active_request=jQuery.ajax({type:"GET",url:this._summary_info.feed_url,success:function(t){null!==t&&i._ajaxSuccess(t)},error:function(t,e,s){i._ajaxError(t,e,s)},cache:!1,dataType:"json"}),this._active_request)},_getTemplate:function(t){var e=this,i=e._templates[t];return i||(i=tmpl(t),e._templates[t]=i),i},_ajaxSuccess:function(e){var i=this,s=e[0],n=e[1],a=e[2],r=e[3],o=e[4],l=this._getTemplate("item_row");t.each(o.reverse(),function(e,s){var n=i._getTemplate(s.flavor);s.flavor=n({item:s}),t(l({item:s})).prependTo(i.element).find(i.options.selectTimeAgo).timeago()});var c=this._summary_info;void 0!==c.earliest_gen&&this._animate(o.length),void 0!==c.earliest_gen&&(a=Math.min(c.earliest_gen,a),r=Math.min(c.earliest_index,r));var f=this._now();this._summary_info={last_gen:s,last_index:n,earliest_gen:a,earliest_index:r,last_update:f},this._gen_feed_url(),this._ajax_state!=this._ajax_base_state&&this.setAjaxState(this._ajax_base_state,{notify:!0}),this.element.trigger("changed.karlcontentfeeds",[this._summary_info])},_animate:function(e){var i=this,s=0;this.element.children().each(function(i){return i==e?!1:void(s+=t(this).outerHeight(!0))});var n=this.element.css("clear"),a=t("<div></div>").css({overflow:"hidden",clear:n});this.element.wrap(a).css({marginTop:-s,clear:"none"}),this.element.animate({marginTop:0},{queue:!1,duration:4*s,complete:function(){i.element.unwrap()}})},_gen_feed_url:function(){var e={},i=this._summary_info;void 0!==i.last_gen&&(e.newer_than=i.last_gen+":"+i.last_index),this.options.filter&&(e.filter=this.options.filter);var s=t.param(e);i.feed_url=this.options.ajax_url+(s&&"?")+s},summary_info:function(){return this._summary_info},_now:function(){return(new Date).toString()},_ajaxError:function(t,i){e("error: "+i);var s=i+": "+t.statusText;this.setAjaxState("error",{errormsg:s,notify:!0})},setFilter:function(t){this.options.filter=t,this.start_over(),this.get_items({force:!0})},setAjaxState:function(t,i){e('Changing state from "'+this._ajax_state+'" to "'+t+'"'),this._ajax_state=t,("on"==t||"off"==t)&&(this._ajax_base_state=t),i&&i.notify&&this.element.trigger("ajaxstatechanged.karlcontentfeeds",[t,i.errormsg])}}),t.widget("karl.karlcontentfeeds_info",{options:{selectLastUpdate:".last-update",selectLastGen:".last-gen",selectLastIndex:".last-index",selectFeedUrl:".feed-url"},_create:function(){this.lastUpdate=this.element.find(this.options.selectLastUpdate),this.lastGen=this.element.find(this.options.selectLastGen),this.lastIndex=this.element.find(this.options.selectLastIndex),this.feedUrl=this.element.find(this.options.selectFeedUrl)},update:function(t){this.lastGen.text(t.last_gen),this.lastIndex.text(t.last_index),this.lastUpdate.text(t.last_update),this.feedUrl.text(t.feed_url).attr("href",t.feed_url)}}),t.widget("karl.karlcontentfeeds_polling",{options:{selectInfoButton:"#polling-info",selectDetailsInfo:".polling-details.info",selectError:".polling-details.errormessage",selectErrorDetails:"#kf-errordetail",selectCloseButton:".close",selectIndicator:"#poll-indicator"},_create:function(){var e=this;this.infoButton=this.element.find(this.options.selectInfoButton),this.detailsInfo=this.element.find(this.options.selectDetailsInfo),this.error=this.element.find(this.options.selectError),this.errorDetails=this.element.find(this.options.selectErrorDetails),this.closeButton=this.element.find(this.options.selectCloseButton),this.indicator=this.element.find(this.options.selectIndicator),this.info_active=!1,this.infoButton.click(function(){e._openDetailsInfo()}),t("body").click(function(t){e.info_active&&e.infoButton[0]!==t.target&&e.detailsInfo[0]!==t.target&&!jQuery.contains(e.detailsInfo[0],t.target)&&e._closeDetailsInfo()}),this.closeButton.click(function(){e._closeDetailsInfo()});var i=this.indicator;i.click(function(){i.hasClass("on")||i.hasClass("polling")?(i.removeClass("on polling"),i.addClass("off"),e.element.trigger("ajaxstatechanged.karlcontentfeeds",["off"])):e.indicator.hasClass("off")?(i.removeClass("off"),i.addClass("on"),e.element.trigger("ajaxstatechanged.karlcontentfeeds",["on"])):i.hasClass("error")&&e.error.fadeIn("fast")})},_openDetailsInfo:function(){this.detailsInfo.fadeIn("fast"),this.info_active=!0},_closeDetailsInfo:function(){this.detailsInfo.fadeOut("fast"),this.error.fadeOut("fast"),this.info_active=!1},destroy:function(){t.Widget.prototype.destroy.call(this),this.infoButton.unbind("click"),this.closeButton.unbind("click"),this.indicator.unbind("click")},setAjaxState:function(t,e){this.indicator.removeClass("on off polling error"),this.indicator.addClass(t),"error"==t&&this.errorDetails.text(e.errormsg),e&&e.notify&&this.element.trigger("ajaxstatechanged.karlcontentfeeds",[t,e.errormsg])}})}(jQuery);
//# sourceMappingURL=karl-contentfeeds.min.js.map