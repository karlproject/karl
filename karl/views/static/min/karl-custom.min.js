/*
 * KARL karl-custom.min.js generated resources http://github.com/karlproject/karl %>
*/
!function(){"use strict";function e(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}function t(e){window.onload=function(){var t=document.createElement("div");t.style.width="100%",t.style.background="#eddb33",t.style.color="black",t.style.padding="0.75em",t.style.fontSize="14px",t.style.zIndex="99999",t.style.position="relative",t.innerHTML=e,document.body.insertBefore(t,document.body.firstChild)}}function i(){var e=Array.prototype.slice.call(arguments,0).join(" ");t(['<table style="width: 100%; height: 30px;">',"<tr>",'<td style="text-align: center; vertical-align: middle;">',e,"</td>","</tr>","</table>"].join(" "))}var n=document.getElementById("karl-browser-upgrade-url"),a=n?n.getAttribute("content")||"":"",s="#bad-browser"==document.location.hash;if(a||s){var o=e(navigator.userAgent),r="msie"==o.browser&&parseInt(o.version,10)<9;s&&""===a?i("The browser compatibility check is not enabled","(see browser_upgrade_url configuration option)."):(r||s)&&i("You are using an unsupported version of Internet Explorer.","Please ",'<a href="'+a+'">',"click here to learn more</a>.")}}(),function(e){function t(t,i){return function(n){return i?t+"?kind="+escape(e.trim(i))+"&val="+escape(e.trim(n)):t+"?val="+escape(e.trim(n))}}function i(e){var t={profile:{name:"people",title:"People"},page:{name:"wiki",title:"Wikis"},post:{name:"blog",title:"Blogs"},file:{name:"files",title:"Files"},community:{name:"communities",title:"Communities"},calendarevent:{name:"events",title:"Events"}};return t[e]||{name:null,title:null}}function n(){return e(".bc-livesearch-autocomplete").val()}function a(t,i){i||(i=e.trim(e(".bc-livesearch-btn-select").parent().attr("name"))),i=escape(i);var n="all_content"===i?"":"&kind="+(D[i]||i),a="?body="+escape(t)+n;return T+a}function s(){var e=this.errorDisplayer();e&&B&&e.show("We encountered an error. Please try your search again ... and contact a KARL admin if the problem persists.")}function o(t){return e.timeago(t)}function r(t,s){var o=this,r="";e.each(s,function(s,l){if(l.data_value=l.value,l.value=o.term,l.type!==r){var d=e('<li class="bc-livesearch-autocomplete-category"></li>');d.append(e('<span class="bc-livesearch-category-text"></span>').text(i(l.type).title||l.type||"Unknown")),d.append(e('<span class="bc-livesearch-more"></span>').attr("href","/search/more").text("more").click(function(t){return function(){var s=e.trim(n()),o=i(t).name||"all_content";return window.location=a(s,o),!1}}(l.type))),t.append(d),r=l.type}x(t,l)}),t.find("li:first").addClass("bc-livesearch-autocomplete-first");var l=0,d=null;t.find("li").each(function(){e(this).hasClass("bc-livesearch-autocomplete-category")?(1===l&&d.css("margin-bottom","1em"),d=null,l=0):(l+=1,d=e(this))})}function l(t,i){var n=i.el,a=n.errorDisplayer(),s=(i.query.replace("*",""),e("<span />").text("No results found. ")),o=n.selectButtonText,r=e.trim(o.text());"All Content"!==r&&s.append("Try searching in ").append(e("<a />").attr("href","#").attr("class","bc-livesearch-all-content").text("All Content").click(function(){return a.hide(),o.text("All Content").attr("name","all_content"),n.menuSelected(0,{item:o}),!1})).append("."),a.replaceWith(s)}function d(e){return e&&"None"!==e&&"null"!==e?e:""}function c(t){var i=e('<a class="bc-livesearch-profile" />'),n=e("<div />").append(e("<span />").text(t.title));d(t.department)&&n.append(e('<span class="discreet" />').text(" - "+t.department));var a=e("<div />");return d(e.trim(t.extension))&&a.append(e('<span class="extension" />').text("x"+t.extension)),d(t.email)&&a.append(e('<a class="email" />').attr("href","mailto:"+t.email).text(t.email).click(function(){return window.location=e(this).attr("href"),!1})),i.append(e("<img />").attr("src",t.thumbnail)).append(n).append(a),i}function u(t){return e("<a></a>").text(t.title)}function h(e,t){var i=d(e)?" - by "+e+" ":" - ";return i+o(t)}function p(t){var i=e('<a class="bc-livesearch-page" />');return i.append(e("<div />").append(e("<span />").text(t.title)).append(e('<span class="discreet" />').text(h(t.modified_by,t.modified))).append(e('<div class="discreet" />').text(d(t.community)))),i}function m(t){var i=e('<a class="bc-livesearch-blog" />');return i.append(e("<div />").append(e("<span />").text(t.title)).append(e('<span class="discreet" />').text(h(t.modified_by,t.modified))).append(e('<div class="discreet" />').text(d(t.community)))),i}function f(t){var i=e('<a class="bc-livesearch-forum" />');return i.append(e("<div />").append(e("<span />").text(t.title)).append(e('<span class="discreet" />').text(h(t.creator,t.created)))),i}function v(t){var i=e('<a class="bc-livesearch-forumtopic" />');return i.append(e("<div />").append(e("<span />").text(t.title)).append(e('<span class="discreet" />').text(h(t.creator,t.created)))).append(e('<div class="discreet" />').append(t.forum)),i}function g(t){var i=e('<a class="bc-livesearch-comment" />');return i.append(e("<div />").append(e("<span />").text(t.title)).append(e('<span class="discreet" />').text(h(t.creator,t.created)))).append(e('<div class="discreet" />').text(d(t.blog)||d(t.forum)||d(t.community))),i}function _(t){var i=e('<a class="bc-livesearch-file" />');return i.append(e('<img class="icon" />').attr("src",t.icon)).append(e("<div />").append(e("<span />").text(t.title)).append(e('<span class="discreet" />').text(h(t.modified_by,t.modified)))).append(e('<div class="discreet" />').text(d(t.community))),i}function b(t){var i=e.timeago.parse(t),n=""+i.getMinutes();return 1===n.length&&(n="0"+n),i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()+" "+i.getHours()+":"+n}function w(t){var i=e('<a class="bc-livesearch-calendarevent" />'),n=e("<div />").text(t.title);return d(t.location)&&n.append(e('<span class="discreet" />').text(" - at "+t.location)),i.append(n).append(e('<div class="discreet" />').text(b(t.start)+" -> "+b(t.end))).append(e('<div class="discreet" />').text(d(t.community))),i}function y(t){var i=e('<a class="bc-livesearch-community" />');return i.append(e("<div />").text(t.title).append(e('<span class="discreet" />').text(" - "+t.num_members+" member"+(1===t.num_members?"":"s")))),i}function k(t){function i(t){var i=e.grep(t,function(e){return null!==e});return i.join(", ")}var n=e('<a class="bc-livesearch-office" />');return n.append(e("<div />").text(t.title+" Office").append(e('<span class="discreet telephone" />').text(t.telephone)).append(e('<div class="discreet" />').text(t.address)).append(e('<div class="discreet" />').text(i([t.city,t.state]))).append(e('<div class="discreet" />').text(t.zipcode))),n}function x(t,i){var n=i.category,a=S[n]||u,s=a(i);return e("<li></li>").data("item.autocomplete",i).append(s).appendTo(t)}var $=e("#karl-app-url").eq(0).attr("content"),C=$+"/jquery_livesearch",T=$+"/searchresults.html",D={},B=!0;e(function(){e("#searchbox li").each(function(){var t=e(this),i=t.attr("advanced_search");i&&(D[t.attr("name")]=i)}),e(".bc-livesearch").livesearch({urlFn:t(C),search:function(t,i){var s=e.trim(n());B=!1,window.location=a(s,i.item.name)},menu:function(i,n){var a=e.trim(n.name),s="all_content"===a?t(C):t(C,a);e(".bc-livesearch").livesearch("option","urlFn",s)},validationFn:e.bottlecap.livesearch.prototype.numCharsValidate,queryTransformFn:e.bottlecap.livesearch.prototype.globQueryTransform,errorFn:e.bottlecap.livesearch.prototype.displayError,ajaxErrorFn:s,selectedFn:function(e,t){return t.url?(window.location=t.url,!1):!0},renderCompletions:r,noresults:l}),e.browser.msie&&7==parseInt(e.browser.version)&&e(".bc-livesearch-btn-select").css("width","120px")});var S={profile:c,page:p,reference:p,blogentry:m,forum:f,forumtopic:v,comment:g,file:_,calendarevent:w,community:y,office:k}}(jQuery),function(e){e.widget("ui.selectmenu",{getter:"value",version:"1.8",eventPrefix:"selectmenu",options:{transferClasses:!0,typeAhead:"sequential",style:"dropdown",positionOptions:{my:"left top",at:"left bottom",offset:null},width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,bgImage:function(){},wrapperElement:""},_create:function(){var t=this,i=this.options,n=this.element.attr("id")||"ui-selectmenu-"+Math.random().toString(16).slice(2,10);this.ids=[n+"-button",n+"-menu"],this._safemouseup=!0,this.newelement=e('<a class="'+this.widgetBaseClass+' ui-widget ui-state-default ui-corner-all" id="'+this.ids[0]+'" role="button" href="#" tabindex="0" aria-haspopup="true" aria-owns="'+this.ids[1]+'"></a>').insertAfter(this.element),this.newelement.wrap(i.wrapperElement);var a=this.element.attr("tabindex");a&&this.newelement.attr("tabindex",a),this.newelement.data("selectelement",this.element),this.selectmenuIcon=e('<span class="'+this.widgetBaseClass+'-icon ui-icon"></span>').prependTo(this.newelement),this.newelement.prepend('<span class="'+t.widgetBaseClass+'-status" />'),e('label[for="'+n+'"]').attr("for",this.ids[0]).bind("click.selectmenu",function(){return t.newelement[0].focus(),!1}),this.newelement.bind("mousedown.selectmenu",function(e){return t._toggle(e,!0),"popup"==i.style&&(t._safemouseup=!1,setTimeout(function(){t._safemouseup=!0},300)),!1}).bind("click.selectmenu",function(){return!1}).bind("keydown.selectmenu",function(i){var n=!1;switch(i.keyCode){case e.ui.keyCode.ENTER:n=!0;break;case e.ui.keyCode.SPACE:t._toggle(i);break;case e.ui.keyCode.UP:i.altKey?t.open(i):t._moveSelection(-1);break;case e.ui.keyCode.DOWN:i.altKey?t.open(i):t._moveSelection(1);break;case e.ui.keyCode.LEFT:t._moveSelection(-1);break;case e.ui.keyCode.RIGHT:t._moveSelection(1);break;case e.ui.keyCode.TAB:n=!0;break;default:n=!0}return n}).bind("keypress.selectmenu",function(e){return t._typeAhead(e.which,"mouseup"),!0}).bind("mouseover.selectmenu focus.selectmenu",function(){i.disabled||e(this).addClass(t.widgetBaseClass+"-focus ui-state-hover")}).bind("mouseout.selectmenu blur.selectmenu",function(){i.disabled||e(this).removeClass(t.widgetBaseClass+"-focus ui-state-hover")}),e(document).bind("mousedown.selectmenu",function(e){t.close(e)}),this.element.bind("click.selectmenu",function(){t._refreshValue()}).bind("focus.selectmenu",function(){t.newelement&&t.newelement[0].focus()}),i.width||(i.width=this.element.outerWidth()),this.newelement.width(i.width),this.element.hide(),this.list=e('<ul class="'+t.widgetBaseClass+'-menu ui-widget ui-widget-content" aria-hidden="true" role="listbox" aria-labelledby="'+this.ids[0]+'" id="'+this.ids[1]+'"></ul>').appendTo("body"),this.list.wrap(i.wrapperElement),this.list.bind("keydown.selectmenu",function(i){var n=!1;switch(i.keyCode){case e.ui.keyCode.UP:i.altKey?t.close(i,!0):t._moveFocus(-1);break;case e.ui.keyCode.DOWN:i.altKey?t.close(i,!0):t._moveFocus(1);break;case e.ui.keyCode.LEFT:t._moveFocus(-1);break;case e.ui.keyCode.RIGHT:t._moveFocus(1);break;case e.ui.keyCode.HOME:t._moveFocus(":first");break;case e.ui.keyCode.PAGE_UP:t._scrollPage("up");break;case e.ui.keyCode.PAGE_DOWN:t._scrollPage("down");break;case e.ui.keyCode.END:t._moveFocus(":last");break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:t.close(i,!0),e(i.target).parents("li:eq(0)").trigger("mouseup");break;case e.ui.keyCode.TAB:n=!0,t.close(i,!0),e(i.target).parents("li:eq(0)").trigger("mouseup");break;case e.ui.keyCode.ESCAPE:t.close(i,!0);break;default:n=!0}return n}).bind("keypress.selectmenu",function(e){return t._typeAhead(e.which,"focus"),!0}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return!1}),e(window).bind("resize.selectmenu",e.proxy(t._refreshPosition,this))},_init:function(){var t=this,i=this.options,n=[];this.element.find("option").each(function(){n.push({value:e(this).attr("value"),text:t._formatText(e(this).text()),selected:e(this).attr("selected"),disabled:e(this).attr("disabled"),classes:e(this).attr("class"),typeahead:e(this).attr("typeahead"),parentOptGroup:e(this).parent("optgroup"),bgImage:i.bgImage.call(e(this))})});var a="popup"==t.options.style?" ui-state-active":"";this.list.html("");for(var s=0;s<n.length;s++){var o=e('<li role="presentation"'+(n[s].disabled?' class="'+this.namespace+'-state-disabled"':"")+'><a href="#" tabindex="-1" role="option"'+(n[s].disabled?' aria-disabled="true"':"")+' aria-selected="false"'+(n[s].typeahead?' typeahead="'+n[s].typeahead+'"':"")+">"+n[s].text+"</a></li>").data("index",s).addClass(n[s].classes).data("optionClasses",n[s].classes||"").bind("mouseup.selectmenu",function(i){if(t._safemouseup&&!t._disabled(i.currentTarget)&&!t._disabled(e(i.currentTarget).parents("ul>li."+t.widgetBaseClass+"-group "))){var n=e(this).data("index")!=t._selectedIndex();t.index(e(this).data("index")),t.select(i),n&&t.change(i),t.close(i,!0)}return!1}).bind("click.selectmenu",function(){return!1}).bind("mouseover.selectmenu focus.selectmenu",function(i){e(i.currentTarget).hasClass(t.namespace+"-state-disabled")||e(i.currentTarget).parent("ul").parent("li").hasClass(t.namespace+"-state-disabled")||(t._selectedOptionLi().addClass(a),t._focusedOptionLi().removeClass(t.widgetBaseClass+"-item-focus ui-state-hover"),e(this).removeClass("ui-state-active").addClass(t.widgetBaseClass+"-item-focus ui-state-hover"))}).bind("mouseout.selectmenu blur.selectmenu",function(){e(this).is(t._selectedOptionLi().selector)&&e(this).addClass(a),e(this).removeClass(t.widgetBaseClass+"-item-focus ui-state-hover")});if(n[s].parentOptGroup.length){var r=t.widgetBaseClass+"-group-"+this.element.find("optgroup").index(n[s].parentOptGroup);this.list.find("li."+r).length?this.list.find("li."+r+":last ul").append(o):e(' <li role="presentation" class="'+t.widgetBaseClass+"-group "+r+(n[s].parentOptGroup.attr("disabled")?" "+this.namespace+'-state-disabled" aria-disabled="true"':'"')+'><span class="'+t.widgetBaseClass+'-group-label">'+n[s].parentOptGroup.attr("label")+"</span><ul></ul></li> ").appendTo(this.list).find("ul").append(o)}else o.appendTo(this.list);if(i.icons)for(var l in i.icons)if(o.is(i.icons[l].find)){o.data("optionClasses",n[s].classes+" "+t.widgetBaseClass+"-hasIcon").addClass(t.widgetBaseClass+"-hasIcon");var d=i.icons[l].icon||"";o.find("a:eq(0)").prepend('<span class="'+t.widgetBaseClass+"-item-icon ui-icon "+d+'"></span>'),n[s].bgImage&&o.find("span").css("background-image",n[s].bgImage)}}var c="dropdown"==i.style;if(this.newelement.toggleClass(t.widgetBaseClass+"-dropdown",c).toggleClass(t.widgetBaseClass+"-popup",!c),this.list.toggleClass(t.widgetBaseClass+"-menu-dropdown ui-corner-bottom",c).toggleClass(t.widgetBaseClass+"-menu-popup ui-corner-all",!c).find("li:first").toggleClass("ui-corner-top",!c).end().find("li:last").addClass("ui-corner-bottom"),this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",c).toggleClass("ui-icon-triangle-2-n-s",!c),i.transferClasses){var u=this.element.attr("class")||"";this.newelement.add(this.list).addClass(u)}this.list.width("dropdown"==i.style?i.menuWidth?i.menuWidth:i.width:i.menuWidth?i.menuWidth:i.width-i.handleWidth),this.list.css("height","auto");var h=this.list.height();if(i.maxHeight&&i.maxHeight<h)this.list.height(i.maxHeight);else{var p=e(window).height()/3;h>p&&this.list.height(p)}this._optionLis=this.list.find("li:not(."+t.widgetBaseClass+"-group)"),this.element.attr("disabled")===!0?this.disable():this.enable(),this.index(this._selectedIndex()),window.setTimeout(function(){t._refreshPosition()},200)},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu"),e(window).unbind(".selectmenu"),e(document).unbind(".selectmenu"),e("label[for="+this.newelement.attr("id")+"]").attr("for",this.element.attr("id")).unbind(".selectmenu"),this.options.wrapperElement?(this.newelement.find(this.options.wrapperElement).remove(),this.list.find(this.options.wrapperElement).remove()):(this.newelement.remove(),this.list.remove()),this.element.show(),e.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(t,i){function n(t,n,a){o=!0,e(t).trigger(i),"undefined"==typeof s._prevChar?s._prevChar=[a]:s._prevChar[s._prevChar.length]=a}function a(t,n){o=!0,e(t).trigger(i),s._prevChar[1]=n}var s=this,o=!1,r=String.fromCharCode(t).toUpperCase();if(c=r.toLowerCase(),"sequential"==s.options.typeAhead){window.clearTimeout("ui.selectmenu-"+s.selectmenuId);var l="undefined"==typeof s._prevChar?"":s._prevChar.join("");this.list.find("li a").each(function(t){if(!o){var i=e(this).attr("typeahead")||e(this).text();0==i.indexOf(l+r)?n(this,t,r):0==i.indexOf(l+c)&&n(this,t,c)}}),window.setTimeout(function(){s._prevChar=void 0},1e3,s)}else{s._prevChar||(s._prevChar=["",0]);var o=!1;this.list.find("li a").each(function(t){if(!o){var i=e(this).text();(0==i.indexOf(r)||0==i.indexOf(c))&&(s._prevChar[0]==r?s._prevChar[1]<t&&a(this,t):a(this,t))}}),this._prevChar[0]=r}},_uiHash:function(){var t=this.index();return{index:t,option:e("option",this.element).get(t),value:this.element[0].value}},open:function(e){var t=this;"true"!=this.newelement.attr("aria-disabled")&&(this._closeOthers(e),this.newelement.addClass("ui-state-active"),t.options.wrapperElement?this.list.parent().appendTo("body"):this.list.appendTo("body"),this.list.addClass(t.widgetBaseClass+"-open").attr("aria-hidden",!1).find("li:not(."+t.widgetBaseClass+"-group):eq("+this._selectedIndex()+") a")[0].focus(),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"),this._refreshPosition(),this._trigger("open",e,this._uiHash()))},close:function(e,t){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.list.attr("aria-hidden",!0).removeClass(this.widgetBaseClass+"-open"),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),t&&this.newelement.focus(),this._trigger("close",e,this._uiHash()))},change:function(e){this.element.trigger("change"),this._trigger("change",e,this._uiHash())},select:function(e){return this._disabled(e.currentTarget)?!1:void this._trigger("select",e,this._uiHash())},_closeOthers:function(t){e("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){e(this).data("selectelement").selectmenu("close",t)}),e("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},_toggle:function(e,t){this.list.is("."+this.widgetBaseClass+"-open")?this.close(e,t):this.open(e)},_formatText:function(e){return this.options.format?this.options.format(e):e},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},_moveSelection:function(e,t){if(!this.options.disabled){var i=parseInt(this._selectedOptionLi().data("index")||0,10),n=i+e;if(0>n&&(n=0),n>this._optionLis.size()-1&&(n=this._optionLis.size()-1),n===t)return!1;if(!this._optionLis.eq(n).hasClass(this.namespace+"-state-disabled"))return this._optionLis.eq(n).trigger("mouseup");e>0?++e:--e,this._moveSelection(e,n)}},_moveFocus:function(e,t){if(isNaN(e))var i=parseInt(this._optionLis.filter(e).data("index"),10);else var n=parseInt(this._focusedOptionLi().data("index")||0,10),i=n+e;if(0>i&&(i=0),i>this._optionLis.size()-1&&(i=this._optionLis.size()-1),i===t)return!1;var a=this.widgetBaseClass+"-item-"+Math.round(1e3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id",""),this._optionLis.eq(i).hasClass(this.namespace+"-state-disabled")?(e>0?++e:--e,this._moveFocus(e,i)):this._optionLis.eq(i).find("a:eq(0)").attr("id",a).focus(),this.list.attr("aria-activedescendant",a)},_scrollPage:function(e){var t=Math.floor(this.list.outerHeight()/this.list.find("li:first").outerHeight());t="up"==e?-t:t,this._moveFocus(t)},_setOption:function(e,t){this.options[e]=t,"disabled"==e&&(this.close(),this.element.add(this.newelement).add(this.list)[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",t))},disable:function(e,t){"undefined"==typeof e?this._setOption("disabled",!0):"optgroup"==t?this._disableOptgroup(e):this._disableOption(e)},enable:function(e,t){"undefined"==typeof e?this._setOption("disabled",!1):"optgroup"==t?this._enableOptgroup(e):this._enableOption(e)},_disabled:function(t){return e(t).hasClass(this.namespace+"-state-disabled")},_disableOption:function(e){var t=this._optionLis.eq(e);t&&(t.addClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!0),this.element.find("option").eq(e).attr("disabled","disabled"))},_enableOption:function(e){var t=this._optionLis.eq(e);t&&(t.removeClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!1),this.element.find("option").eq(e).removeAttr("disabled"))},_disableOptgroup:function(e){var t=this.list.find("li."+this.widgetBaseClass+"-group-"+e);t&&(t.addClass(this.namespace+"-state-disabled").attr("aria-disabled",!0),this.element.find("optgroup").eq(e).attr("disabled","disabled"))},_enableOptgroup:function(e){var t=this.list.find("li."+this.widgetBaseClass+"-group-"+e);t&&(t.removeClass(this.namespace+"-state-disabled").attr("aria-disabled",!1),this.element.find("optgroup").eq(e).removeAttr("disabled"))},index:function(t){return arguments.length?this._disabled(e(this._optionLis[t]))?!1:(this.element[0].selectedIndex=t,void this._refreshValue()):this._selectedIndex()},value:function(e){return arguments.length?(this.element[0].value=e,void this._refreshValue()):this.element[0].value},_refreshValue:function(){var e="popup"==this.options.style?" ui-state-active":"",t=this.widgetBaseClass+"-item-"+Math.round(1e3*Math.random());this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+e).find("a").attr("aria-selected","false").attr("id",""),this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+e).find("a").attr("aria-selected","true").attr("id",t);var i=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",n=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(i).data("optionClasses",n).addClass(n).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html()),this.list.attr("aria-activedescendant",t)},_refreshPosition:function(){var e=this.options;if("popup"==e.style&&!e.positionOptions.offset)var t=this._selectedOptionLi(),i="0 -"+(t.outerHeight()+t.offset().top-this.list.offset().top);var n=this.element.zIndex();n&&this.list.css({zIndex:n}),this.list.position({of:e.positionOptions.of||this.newelement,my:e.positionOptions.my,at:e.positionOptions.at,offset:e.positionOptions.offset||i,collision:e.positionOptions.collision||"flip"})}})}(jQuery),function(e){e.widget("karl.karlcalendarbuttons",{options:{ddRoundies:!1,ie8OnePixelCompensate:!0},_create:function(){var t=this;this.element.append('<span class="karl-calendar-buttonset-term"><input type="radio" name="karl-calendar-buttonset-term" id="karl-calendar-button-day" class="karl-calendar-button-day"></input><label for="karl-calendar-button-day">Day</label><input type="radio" name="karl-calendar-buttonset-term" id="karl-calendar-button-week" class="karl-calendar-button-week"></input><label for="karl-calendar-button-week">Week</label><input type="radio" name="karl-calendar-buttonset-term" id="karl-calendar-button-month" class="karl-calendar-button-month"></input><label for="karl-calendar-button-month">Month</label></span><span class="karl-calendar-buttonset-viewtype"><input type="radio" name="karl-calendar-buttonset-viewtype" id="karl-calendar-button-calendar" class="karl-calendar-button-calendar"></input><label for="karl-calendar-button-calendar">Calendar</label><input type="radio" name="karl-calendar-buttonset-viewtype" id="karl-calendar-button-list" class="karl-calendar-button-list"></input><label for="karl-calendar-button-list">List</label></span><button class="karl-calendar-button-today">Today</button><span class="karl-calendar-buttonset-navigate"><input type="radio" name="karl-calendar-buttonset-navigate" id="karl-calendar-button-prev" class="karl-calendar-button-prev"></input><label for="karl-calendar-button-prev" class="karl-calendar-label-prev">&nbsp;</label><input type="radio" name="karl-calendar-buttonset-navigate" id="karl-calendar-button-next" class="karl-calendar-button-next"></input><label for="karl-calendar-button-next" class="karl-calendar-label-next">&nbsp;</label></span><select class="karl-calendar-dropdown-year"></select><select class="karl-calendar-dropdown-month"><option value="1">Jan</option><option value="2">Feb</option><option value="3">Mar</option><option value="4">Apr</option><option value="5">May</option><option value="6">Jun</option><option value="7">Jul</option><option value="8">Aug</option><option value="9">Sep</option><option value="10">Oct</option><option value="11">Nov</option><option value="12">Dec</option></select><select class="karl-calendar-dropdown-day"></select>'),this.el_b_today=this.element.find(".karl-calendar-button-today"),this.el_bs_navigate=this.element.find(".karl-calendar-buttonset-navigate"),this.el_b_prev=this.element.find(".karl-calendar-button-prev"),this.el_b_next=this.element.find(".karl-calendar-button-next"),this.el_dd_year=this.element.find(".karl-calendar-dropdown-year"),this.el_dd_month=this.element.find(".karl-calendar-dropdown-month"),this.el_dd_day=this.element.find(".karl-calendar-dropdown-day"),this.el_bs_viewtype=this.element.find(".karl-calendar-buttonset-viewtype"),this.el_b_calendar=this.element.find(".karl-calendar-button-calendar"),this.el_b_list=this.element.find(".karl-calendar-button-list"),this.el_bs_term=this.element.find(".karl-calendar-buttonset-term"),this.el_b_day=this.element.find(".karl-calendar-button-day"),this.el_b_week=this.element.find(".karl-calendar-button-week"),this.el_b_month=this.element.find(".karl-calendar-button-month"),this.el_b_today.button({}),this.el_b_today.click(function(e){var i=new Date,n=t.options.selection||{},a=i.getFullYear(),s=i.getMonth()+1,o=i.getDate();return n.year!=a||n.month!=s||n.day!=o?(t.options.selection.year=a,t.options.selection.month=s,t.options.selection.day=o,t._change(e)):void 0}),this.el_bs_navigate.buttonset({}),this.el_b_prev.button("option","icons",{primary:"ui-icon-triangle-1-w"}).change(function(e){return t._navigate(e,-1)}),this.el_b_next.button("option","icons",{primary:"ui-icon-triangle-1-e"}).change(function(e){return t._navigate(e,1)});for(var i=2e3;2025>i;i++)this.el_dd_year.append('<option value="'+i+'">'+i+"</option>");if(this.el_dd_year.find("option").addClass("karl-calendar-dropdown-item"),this.el_dd_year.selectmenu({type:"dropdown",select:function(e,i){var n=Number(i.value);return n>0&&t.options.selection.year!=n?(t.options.selection.year=n,t._change(e)):void 0}}),this.el_dd_month.find("option").addClass("karl-calendar-dropdown-item"),this.el_dd_month.selectmenu({type:"dropdown",select:function(e,i){var n=Number(i.value);return n>0&&t.options.selection.month!=n?(t.options.selection.month=n,t._change(e)):void 0}}),this.el_bs_viewtype.buttonset({}),this.el_b_calendar.change(function(e){return"calendar"!=t.options.selection.viewtype?(t.options.selection.viewtype="calendar",t._change(e)):void 0}),this.el_b_list.change(function(e){return"list"!=t.options.selection.viewtype?(t.options.selection.viewtype="list",t._change(e)):void 0}),this.el_bs_term.buttonset({}),this.el_b_day.change(function(e){return"day"!=t.options.selection.term?(t.options.selection.term="day",t._change(e)):void 0}),this.el_b_week.change(function(e){return"week"!=t.options.selection.term?(t.options.selection.term="week",t._change(e)):void 0}),this.el_b_month.change(function(e){return"month"!=t.options.selection.term?(t.options.selection.term="month",t._change(e)):void 0}),this._updateSelection(),this.element.find("a.ui-selectmenu").each(function(){e(this).css("margin-top","-4px")}),e.browser.msie&&e.browser.version<=7&&(this.element.find("a.ui-selectmenu").each(function(){e(this).css("top","-2px")}),this.element.find(".karl-calendar-label-prev, .karl-calendar-label-next").each(function(){e(this).css("top","-2px").height(e(this).height()+1)})),this.options.ddRoundies){if(!DD_roundies)throw new Error("DD_roundies must be present, or ddRoundies=false option must be specified.");DD_roundies.addRule(".cal-buttonbar .ui-corner-left","4px 0 0 4px"),DD_roundies.addRule(".cal-buttonbar .ui-corner-right","0 4px 4px 0"),DD_roundies.addRule(".cal-buttonbar .ui-corner-all","4px 4px 4px 4px")}this.options.ddRoundies&&this.options.ie8OnePixelCompensate&&e.browser.msie&&8==e.browser.version&&this.element.find(".ui-corner-left, .ui-corner-right, .ui-corner-all").each(function(){e(this).css("top","1px").css("left","1px").children().each(function(){var t=e(this);"static"==t.css("position")&&t.css("position","relative").css("top",""+(this.offsetTop-2)+"px").css("left",""+(this.offsetLeft-2)+"px")})})},disable:function(){this.el_b_today.button("option","disabled",!0),this.el_bs_navigate.buttonset("option","disabled",!0),this.el_dd_year.selectmenu("option","disabled",!0),this.el_dd_month.selectmenu("option","disabled",!0),this.el_dd_day.selectmenu("option","disabled",!0),this.el_bs_viewtype.buttonset("option","disabled",!0),this.el_bs_term.buttonset("option","disabled",!0)},_navigate:function(e,t){var i,n,a=this.options.selection||{},s=a.term,o=864e5;return"month"==s?(this.options.selection.month+=t,0===this.options.selection.month?(this.options.selection.month=12,this.options.selection.year-=1):13==this.options.selection.month&&(this.options.selection.month=1,this.options.selection.year+=1)):"week"==s?(i=new Date(a.year,a.month-1,a.day),n=new Date(i.getTime()+7*t*o),this.options.selection.year=n.getFullYear(),this.options.selection.month=n.getMonth()+1,this.options.selection.day=n.getDate()):"day"==s&&(i=new Date(a.year,a.month-1,a.day),n=new Date(i.getTime()+t*o),this.options.selection.year=n.getFullYear(),this.options.selection.month=n.getMonth()+1,this.options.selection.day=n.getDate()),this._change(e)},_change:function(e){this._updateSelection(),this._trigger("change",e,this.options.selection)},_setOption:function(t,i){var n="selection"==t&&this._isSelectionChanged(this.options.selection,i);e.Widget.prototype._setOption.call(this,t,i),n&&this._updateSelection()},_isSelectionChanged:function(e,t){return e||t?e&&t?e.viewtype!=t.viewtype||e.term!=t.term||e.year!=t.year||e.month!=t.month||e.day!=t.day:!0:!1},_updateDays:function(){var t=this;this.el_dd_day.data("selectmenu")&&this.el_dd_day.selectmenu("destroy");var i=this.options.selection||{};this.el_dd_day.empty();var n,a=i.month;if(2==a){var s=i.year;n=s%4===0&&(2e3==s||s%100>0)?29:28}else n=4==a||6==a||9==a||11==a?30:31;for(var o=1;n>=o;o++)this.el_dd_day.append('<option value="'+o+'">'+o+"</option>");this.el_dd_day.find("option").addClass("karl-calendar-dropdown-item"),this.el_dd_day.selectmenu({type:"dropdown",select:function(e,i){var n=Number(i.value);return n>0&&t.options.selection.day!=n?(t.options.selection.day=n,t._change(e)):void 0}}),this.element.find("a.ui-selectmenu").each(function(){e(this).css("margin-top","-4px")}),this.options.selection.day>n&&(this.options.selection.day=n)},_updateSelection:function(){var e=this.options.selection||{};this._updateDays();var t=new Date,i=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),s=e.year==i&&e.month==n&&e.day==a;this.el_b_today.button("option","disabled",s),this.el_dd_year.selectmenu("value",""+e.year),this.el_dd_month.selectmenu("value",""+e.month),this.el_dd_day.selectmenu("value",""+e.day);var o={calendar:this.el_b_calendar,list:this.el_b_list}[e.viewtype];o&&o.attr("checked","checked"),this.el_bs_viewtype.buttonset("refresh");var r={day:this.el_b_day,week:this.el_b_week,month:this.el_b_month}[e.term];
r&&r.attr("checked","checked"),this.el_bs_term.buttonset("refresh")},destroy:function(){this.el_b_today.button("destroy"),this.el_bs_navigate.buttonset("destroy"),this.el_dd_year.selectmenu("destroy"),this.el_dd_month.selectmenu("destroy"),this.el_dd_day.data("selectmenu")&&this.el_dd_day.selectmenu("destroy"),this.el_bs_viewtype.buttonset("destroy"),this.el_bs_term.buttonset("destroy"),e.Widget.prototype.destroy.call(this)}})}(jQuery),new function(){function e(e){var t=$(e.target);if(!t.hasClass("cal_hour_event"))var t=t.parents(".cal_hour_event");if(t){var i=t.identify("a");k[i]=!0,setTimeout(function(){k[i]&&(t.addClass("hov"),t.next().addClass("hov_below"))},200)}}function t(e){var t=$(e.target);if(!t.hasClass("cal_hour_event"))var t=t.parents(".cal_hour_event");if(t){var i=t.identify("a");delete k[i],setTimeout(function(){k[i]||(t.removeClass("hov"),t.next().removeClass("hov_below"))},200)}}function i(){var e=$(this),t=e.identify("a");k[t]=!0,setTimeout(function(){k[t]&&e.addClass("hov")},200)}function n(){var e=$(this),t=e.identify("a");delete k[t],setTimeout(function(){k[t]||e.removeClass("hov")},200)}function a(){var e=$("#cal_time");if(0!=e.length){if(e.hasClass("today"))var t=new Date,i=60*t.getHours()+t.getMinutes(),n=1e3;else{var i=740,n=0;e.css("visibility","hidden")}var a=1440,s=parseInt(i/a*100),o=$("#cal_scroll").height(),r=parseInt(o*s/100);e.css("top",r+"px").show();var l=r-250>0?r-250:0;$("#cal_hours_scroll").scrollTo(l,{duration:n})}}function s(){$("#cal_picker").change(function(){var e=this.options[this.selectedIndex].value.split("?filter=");document.location=e[0]+"?filter="+escape(e[1])}),$("#cal_month td").hover(i,n),$("#cal_month .with_tooltip").myTooltip({tip:".tooltip",offset:[8,50],predelay:250});var s=$("#cal_hours_scroll");s.mouseover(e),s.mouseout(t),$("#all_day td").hover(i,n);var o=$("#cal_scroll");o.hasClass("cal_week")&&($("#all_day .with_tooltip").myTooltip({tip:".tooltip",offset:[8,-48],predelay:250}),$("#cal_scroll .cal_hour_event .with_tooltip").myTooltip({tip:".tooltip",offset:[12,5],predelay:250}));var r=$("#karl-here-url").eq(0).attr("content");$(".cal-buttonbar").karlcalendarbuttons({selection:window.karl_client_data&&karl_client_data.calendar_selection||null,change:function(e,t){var i,n="";"list"==t.viewtype?(i="list.html",n="&term="+t.term):i={month:"month.html",week:"week.html",day:"day.html"}[t.term];var a=r+i+"?year="+t.year+"&month="+t.month+"&day="+t.day+n;$(this).karlcalendarbuttons("disable"),document.location.href=a}}),$(".cal_actions a.cal_print").click(function(){var e=$(".cal_scroll"),t=$(".cal_hours_scroll"),i=e.height(),n=t.height();t.height(i);var a=$(".karl-calendar-narrow").removeClass("karl-calendar-narrow").addClass("karl-calendar-wide");return $("body").addClass("karl-calendar-printing"),window.focus(),window.print(),t.height(n),a.removeClass("karl-calendar-wide").addClass("karl-calendar-narrow"),$("body").removeClass("karl-calendar-printing"),!1}),a()}function o(){if(0!=$("#save-start_date").length&&0!=$("#save-end_date").length){if(r(),l(),"True"==$("#save-all_day").val()){var e='checked="checked"';d()}else{var e="";c()}var t='<span class="all_day"><input type="checkbox" id="cal_all_day" name="allDay" '+e+' /><label for="cal_all_day">All-day</label></span>';$("div.save-start_date > div.inputs").append(t),$("#cal_all_day").click(function(){u(),this.checked?($("#save-all_day").val("True"),d()):($("#save-all_day").val("False"),c())})}}function r(){$("#save-start_date").karldatetimepicker({dateFormat:karl_client_data.js_date_format,zIndex:2e4}).bind("change.karldatetimepicker",function(){$("#save-end_date").karldatetimepicker("limitMinMax",new Date($(this).karldatetimepicker("getAsDate").valueOf()+36e5),null)})}function l(){$("#save-end_date").karldatetimepicker({dateFormat:karl_client_data.js_date_format,zIndex:2e4}).bind("change.karldatetimepicker",function(){$(this).karldatetimepicker("limitMinMax",$("#save-start_date").karldatetimepicker("getAsDate"),null)})}function d(){$("div.save-start_date select").hide(),$("div.save-start_date .ui-karldatetimepicker-colon").hide(),$("div.save-end_date select").hide(),$("div.save-end_date .ui-karldatetimepicker-colon").hide()}function c(){$("div.save-start_date select").show(),$("div.save-start_date .ui-karldatetimepicker-colon").show(),$("div.save-end_date select").show(),$("div.save-end_date .ui-karldatetimepicker-colon").show()}function u(){$("div.save-start_date").removeClass("error"),$("div.save-start_date > span.error").remove(),$("div.save-end_date").removeClass("error"),$("div.save-end_date > span.error").remove()}function h(){$(".add_button").click(function(e){e.preventDefault();var t=$(e.target).parents(".setup_group");t.find(".add_button").hide("fast"),t.find(".cal_add").show("slow")}),$('.cal_add button[name="form.cancel"]').click(function(e){e.preventDefault();var t=$("div.portalMessage");t&&t.remove();var i=$(e.target).parents(".setup_group");i.find(".add_button").show("fast"),i.find(".cal_add").hide("slow"),$(this).parents("form")[0].reset()});var e=$("#fielderrors_target").val();if(e.length>0){if("__add_category__"==e)var t="#setup_add_category_form";else if("__add_layer__"==e)var t="#setup_add_layer_form";else var t="#edit_"+e+"_form";$(t).show()}$(".cal_all .edit_action").click(function(e){e.preventDefault();var t=$(e.target).parents(".setup_group");t.find("form").hide("slow"),t.find(".add_button").hide("fast");var i="#"+$(this).identify()+"_form";$(i).show("slow")}),$('.cal_edit button[name="form.cancel"]').click(function(e){e.preventDefault();var t=$("div.portalMessage");t&&t.remove();var i=$(e.target).parents(".setup_group");i.find(".add_button").show("fast"),i.find("form").hide("slow"),$(this).parents("form")[0].reset()}),m(),$("select.category_paths").length>0&&p()}function p(){function e(){$(".layers").each(function(){var e=$(this).find("td a.remove");e.css("display",e.length>1?"inline":"none")})}$("a.add").click(function(t){t.preventDefault();var i=$(this).parents("fieldset").find(".layers"),n=i.find("tr:last");n.clone().appendTo(i).find("option").removeAttr("selected"),e()}),$("a.remove").live("click",function(t){t.preventDefault(),$(this).parents("tr").remove(),e()}),e()}function m(){$("a.delete_category_action").bind("click",function(){if(confirm("Are you sure?")){var e=this.id.substring(16);$("#cal_delete_category_form > input[name=form.delete]").val(e),$("#cal_delete_category_form").submit()}return!1}),$("a.delete_layer_action").bind("click",function(){if(confirm("Are you sure?")){var e=this.id.substring(13);$("#cal_delete_layer_form > input[name=form.delete]").val(e),$("#cal_delete_layer_form").submit()}return!1})}var f=window.Karl=window.Karl||{};window.Karl.loadTinyMCE=function(){};f.NAME="Karl",f.VERSION="3.00";var v=function(){$(".mceEditor").each(function(){for(var e=this;e.parentNode;e=e.parentNode)if("form"==e.tagName.toLowerCase()){e.onsubmit=function(){tinyMCE.triggerSave()};break}})},g=function(){jQuery.browser.msie&&$("#left li.submenu").each(function(){$(this).mouseover(function(){$(this).addClass("iehover")}),$(this).mouseout(function(){$(this).removeClass("iehover")})})};$.widget("ui.karlstatusbox",{options:{clsItem:"statusbox-item",hasCloseButton:!0},_create:function(){this.queue=[]},clear:function(e){if(void 0===e)this.element.empty(),this.queue=[];else{var t=[];$(this.queue).each(function(){this.queueCategory==e?this.item.remove():t.push(this)}),this.queue=t}},append:function(e,t){void 0===t&&(t=null);var i=$('<div class="'+this.options.clsItem+'"></div>');i.append($('<div class="message"></div>').append(e)),this.options.hasCloseButton&&i.append($('<a href="#" class="statusbox-closebutton">X</a>').click(function(e){i.remove(),e.preventDefault()})),jQuery.browser.msie?i.addClass("clear-ie-container"):i.append('<div class="clear"></div>'),this.element.append(i),this.queue.push({item:i,queueCategory:t})},clearAndAppend:function(e,t){this.clear(t),this.append(e,t)}}),f.makeSnippets=function(e){var t={};for(var i in e)t[i]=$.makeTemplate(e[i],"<%","%>");return function(e){var i=e.snippet||"",n=t[i];return n(e)}};var _=0;f.getJSON=function(e,t,i,n){return jQuery.ajax({type:"POST",url:e,data:t,success:i,error:n,dataType:"json"})};var b='<span><a class="showtag-link" href="<%= showtag_url %>"><%= tag %></a><span class="count">&nbsp;(<a class="tagusers-link"  href="<%= tagusers_url %>"><%= count %></a>)</span>',w='<input type="hidden" name="<%= _name %>" value="<%= tag %>" />',y="</span></li>";$.widget("ui.karltagbox",$.extend({},$.ui.autobox3.prototype,{options:$.extend({},$.ui.autobox3.prototype.options,{match:function(e){if(this.typed=e,this.pre_match=this.text,this.match=this.post_match="",!this.ajax&&!e||0===e.length)return!0;var t=this.text.search(new RegExp("\\b"+e,"i"));return-1!=t?(this.pre_match=this.text.slice(0,t),this.match=this.text.slice(t,t+e.length),this.post_match=this.text.slice(t+e.length),!0):!1},insertText:function(e){return e.tag},templateText:"<li><%= pre_match %><span class='matching' ><%= match %></span><%= post_match %></li>",snippets:f.makeSnippets({"":'<li id="<%= _wid %>" class="bit-box">'+b+'<a href="#" class="closebutton"></a>'+w+y,nondeleteable:'<li id="<%= _wid %>" class="bit-box nondeleteable">'+b+y}),strictAdd:!1,selectFirst:!1,validateRegexp:null}),_addBox:function(e,t){var i=this,n=e.id||e.tag,a=this.bubbles[n];if(a){var s=a.record;if("nondeleteable"!=s.snippet)return;s.snippet="",s.count++,this._updateBox(a)}else{var o;o=this.options.docid?this.options.tagusers_url+"?tag="+e.tag+"&docid="+this.options.docid:"javascript://return false;",e=$.extend({count:1,tagusers_url:o},e,{_name:this.options.name||"box",_wid:"bit-"+_,showtag_url:this.options.showtag_url+(e.id||e.tag)}),_++;var r=this._renderBox(e);if(!t){var l=this._validateTag(e.tag);if(l)return this._appendStatusWithBubble("Adding tag failed: "+l,r),void r.remove()}this.bubbles[n]=a={record:e,li:r[0]}}!t&&this.options.ajaxAdd&&f.getJSON(this.options.ajaxAdd,"val="+e.tag,function(e){i._ajaxAddSuccess(a,e)},function(e){i._ajaxAddFailure(a,e)})},_validateTag:function(e){return this.options.validateRegexp&&null===e.match(this.options.validateRegexp)?"Value contains characters that are not allowed in a tag.":void 0},_ajaxAddSuccess:function(e,t){var i=t&&t.error;i&&this._ajaxAddFailure(e,t)},_ajaxAddFailure:function(e,t){var i=t&&t.error;i||(i="Adding tag failed"),this._appendStatusWithBubble(i,e.li),this._delBox(e.li,!0)},_renderBox:function(e){var t=this,i=this.options.snippets(e);return i=this.holder.find(".autobox-input").before(i).prev(),this.input.val(""),$(".closebutton",i).bind("click",function(e){t._delBox(i),e.preventDefault()}),i},_delBox:function(e,t){var i=this;e=$(e);var n=e.find("input")[0].value,a=this.bubbles[n];if(a&&a.record.count>1){var s=a.record;s.snippet="nondeleteable",s.count--,this._updateBox(a)}else $.ui.autobox3.prototype._delBox.call(this,e),delete this.bubbles[n];!t&&this.options.ajaxDel&&f.getJSON(this.options.ajaxDel,"val="+n,function(e){i._ajaxDelSuccess(a,e)},function(e){i._ajaxDelFailure(a,e)})},_ajaxDelSuccess:function(e,t){var i=t&&t.error;i&&this._ajaxDelFailure(e,t)},_ajaxDelFailure:function(e,t){var i=t&&t.error;i||(i="Deleting tag failed"),this._appendStatusWithBubble(i,e.li),this._addBox(e.record,!0)},_updateBox:function(e){var t=this._renderBox(e.record);$(e.li).after(t).remove(),e.li=t},_createHolder:function(e){var t=$.ui.autobox3.prototype._createHolder.call(this,e),i=t.wrap('<div class="statusbox-wrapper"></div>').parent().append($('<div class="statusbox"></div>').karlstatusbox());return this.statusbox=$("*:last",i),i},_clearStatus:function(){this.statusbox.karlstatusbox("clear")},_appendStatus:function(e){this.statusbox.karlstatusbox("append",e)},_appendStatusWithBubble:function(e,t){t=$(t).clone(),t.find("input").remove();var i=$('<span class="message-span"></span><span class="bubble-span"></span>');i.eq(0).text(e),i.eq(1).append(t),this._appendStatus(i);var n=this.statusbox.find(">:last-child");$(".closebutton",t).bind("click",function(e){n.remove(),e.preventDefault()})},_setupWidget:function(){this.bubbles={},$.ui.autobox3.prototype._setupWidget.call(this);var e=this;this.input.wrap("<span></span>"),$('<button class="button primary_button inline addtag-button" type="button"><span>Add</span></button>').bind("click",function(t){var i=e._getBoxOnEnter();i&&e._addBox(i),t.preventDefault()}).insertAfter(this.input),this.options.validateTag&&(this._validateTag=this.options.validateTag)},_updateList:function(e){if(this.cached_result=e,$.ui.autobox3.prototype._updateList.call(this,e),this.options.selectFirst){var t=$("> *",this.container);t.length>0&&(this.active=t.eq(0),this.active.addClass("active"))}},_getCurrentValsHash:function(){var e={};for(var t in this.bubbles){var i=this.bubbles[t].record;"nondeleteable"!=i.snippet&&(e[i.tag]=!0)}return e}})),$.widget("ui.karlmemberbox",$.extend({},$.ui.karltagbox.prototype,{options:$.extend({},$.ui.karltagbox.prototype.options,{strictAdd:!0,selectFirst:!0,getBoxFromSelection:function(){var e=this.active&&this.active[0]&&$.data(this.active[0],"originalObject");if(e)return{tag:e.text,id:e.id}},getBoxOnEnter:function(){return this._getBoxFromSelection()},snippets:f.makeSnippets({"":'<li id="<%= _wid %>" class="bit-box"><span><a class="showtag-link" href="<%= showtag_url %>"><%= tag %></a><a href="#" class="closebutton"></a><input type="hidden" name="<%= _name %>" value="<%= id %>" /></span></li>'})})})),$.widget("ui.karlgrid",$.extend({},$.ui.grid.prototype,{options:$.extend({},$.ui.grid.prototype.options,{width:500,height:300,limit:!1,pagination:!0,allocateRows:!0,chunk:20,footer:!0,toolbar:!1,multipleSelection:!0,evenRowClass:"even",oddRowClass:"odd",sortColumn:"",sortDirection:"",initialState:null,allocateWidthForScrollbar:!1,scrollbarWidth:15}),_create:function(){this.options.allocateWidthForScrollbar||(this.options.scrollbarWidth=0),$.ui.grid.prototype._create.call(this,arguments),this.contentDiv.width(this.options.width)},_generateColumns:function(){this.columnsContainer=$('<tr class="ui-grid-columns"><td><div class="ui-grid-columns-constrainer"><table cellpadding="0" cellspacing="0"><tbody><tr class="ui-grid-header ui-grid-inner"></tr></tbody></table></div></td></tr>').appendTo(this.grid).find("table tbody tr"),$(".ui-grid-columns-constrainer",this.grid).css({width:this.options.width,overflow:"hidden"}),$("table",this.grid).css({"border-collapse":"collapse"})},_syncColumnWidth:function(){var e=this,t=[],i=0;$("td",this.columnsContainer).each(function(){var e=$(this).outerWidth();t.push(e),i+=e}),this.options.scrollbarWidth>0&&(i-=this.options.scrollbarWidth),$("> tr",this.content).each(function(){$("> td",this).each(function(i){var n=$(this),a=t[i],s=n.outerWidth()-n.width();0==i&&(s-=e.leftBorder),a-=s,n.css("overflow","hidden").width(a)})}),this.content.parent().width(i+this.options.scrollbarWidth).css("table-layout","fixed")},_addColumns:function(e){this.columns=e;var t=0;this.columns_by_id={};for(var i=this.sortColumn||this.options.sortColumn,n=this.sortDirection||this.options.sortDirection,a=0;a<e.length;a++){var s=e[a],o="";i==s.id&&(o=" ui-icon "+("asc"==n?"ui-icon-carat-1-s":"ui-icon-carat-1-n"));var r=$('<td class="ui-grid-column-header ui-state-default">  <div style="position: relative;">    <a href="javascript://return false;">      <span class="ui-grid-column-header-text">'+s.label+'</span>    </a>    <span class="ui-grid-visual-sorting-indicator'+o+'"></span>  </div></td>').data("grid-column-header",s).appendTo(this.columnsContainer),l=r.outerWidth()-r.width();0==a&&(this.leftBorder=jQuery.browser.msie?0:1,l+=this.leftBorder),r.width(s.width-l),t+=s.width}this.options.scrollbarWidth>0&&$('<td class="ui-state-default ui-grid-column-scrollbar"><div></div></td>').width(this.options.scrollbarWidth).appendTo(this.columnsContainer);var d=this.columnsContainer.parent().parent();d.width(t+this.options.scrollbarWidth),this.element.trigger("karlgrid_columns_set")},_handleClick:function(e){var t=$(e.target);if(t.is(".ui-grid-column-header, .ui-grid-column-header *"))return this._onClickHeader(t);if(t.is(".ui-grid-pagination a, .ui-grid-pagination a *")){var i=Math.floor((this.offset+this.options.limit-1)/this.options.limit)+1;(t.hasClass("ui-icon-circle-arrow-w")||t.find(".ui-icon-circle-arrow-w").length>0)&&i--,(t.hasClass("ui-icon-circle-arrow-e")||t.find(".ui-icon-circle-arrow-e").length>0)&&i++,isNaN(parseInt(e.target.innerHTML,10))||(i=parseInt(e.target.innerHTML,10)),this.offset=(i-1)*this.options.limit,this._update()}return!1},_onClickHeader:function(e){var t=e.hasClass("ui-grid-column-header")?e:e.parents(".ui-grid-column-header"),i=t.data("grid-column-header");return this.sortDirection="desc"==this.sortDirection?"asc":"desc",this.sortColumn=i.id,this._update({columns:!1,refresh:!0}),!1},_makeRowsSelectable:function(){var e=this,t=this.content.parent().parent();t.bind("mousedown",function(t){return e._onClickRow($(t.target))})},_onClickRow:function(e){var t,i=this.content.parent().parent();if(e.parents().andSelf().each(function(){-1!=$("tr",i).index(this)&&(t=this)}),t){var n=$("a",t);n.length>0&&(window.location=n[0].href)}return!1},_addRow:function(e,t){var i=$.ui.grid.prototype._addRow.call(this,e,t);this.options.scrollbarWidth>0&&$('<td class="ui-grid-column ui-state-active"><div>&nbsp;</div></td>').width(this.options.scrollbarWidth).appendTo(i);var n=this.content.find("tr").length%2==1;return n&&this.options.oddRowClass&&i.addClass(this.options.oddRowClass),!n&&this.options.evenRowClass&&i.addClass(this.options.evenRowClass),i},_generateFooter:function(){this.footer=$('<tr class="ui-grid-footer ui-widget-header"><td><span class="ui-grid-footer-text ui-grid-limits"></span></td></tr>').appendTo(this.grid).find("td")},_generatePagination:function(e){this.pagination=$('<span class="ui-grid-pagination clearafter"></span>').appendTo(this.footer),this.footerResultsBox=$(".ui-grid-limits, .ui-grid-no-limits",this.footer),this._updatePagination(e)},_updatePagination:function(e){var t=Math.floor((e.totalRecords+this.options.limit-1)/this.options.limit),i=Math.floor((this.offset+this.options.limit-1)/this.options.limit)+1,n=[];if(this.pagination.empty(),1>=t)return void this.footerResultsBox.removeClass("ui-grid-limits").addClass("ui-grid-no-limits").html("");this.footerResultsBox.removeClass("ui-grid-no-limits").addClass("ui-grid-limits");for(var a=i-1;a>0&&a>i-3;a--)this.pagination.prepend('<a href="#" class="ui-state-default">'+a+"</a>"),n.push(a);for(var a=i;t+1>a&&i+3>a;a++)this.pagination.append(a==i?'<span class="ui-state-active">'+a+"</span>":'<a href="#" class="ui-state-default">'+a+"</a>"),n.push(a);t>1&&-1==$.inArray(2,n)&&this.pagination.prepend('<span class="ui-grid-pagination-dots">...</span>'),-1==$.inArray(1,n)&&this.pagination.prepend('<a href="#" class="ui-state-default">1</a>'),-1==$.inArray(t-1,n)&&this.pagination.append('<span class="ui-grid-pagination-dots">...</span>'),-1==$.inArray(t,n)&&this.pagination.append('<a href="#" class="ui-state-default">'+t+"</a>"),this.pagination.prepend(i-1>0?'<a href="#" class="ui-state-default ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-w">Prev</div></a>':'<span class="ui-state-default ui-state-disabled ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-w">Prev</div></span>'),this.pagination.append(i+1>t?'<span href="#" class="ui-state-default ui-state-disabled ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-e">Next</div></span>':'<a href="#" class="ui-state-default ui-grid-pagination-icon"><div class="ui-icon ui-icon-circle-arrow-e">Next</div></a>'),this.pagination.find("a.ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})},_extendFetchOptions:function(e){return $.extend({},e,{limit:this.options.limit,start:!(e&&e.refresh)&&this.offset||0,refresh:e&&e.refresh||e&&e.columns})},_update:function(e){var t=this,i=$.extend({},this._extendFetchOptions(i),{});i.refresh&&(i.start=this.infiniteScrolling?0:this.offset||0),this.sortColumn&&(i.sortColumn=this.sortColumn),this.sortDirection&&(i.sortDirection=this.sortDirection),this.gridmodel.fetch(i,function(i){t._doUpdate(i,e)})},_initialUpdate:function(){this._grid_model_parse||(this._grid_model_parse=$.ui.grid.model.defaults.parse),this.gridmodel=$.ui.grid.model({url:this.options.url,parse:this._grid_model_parse});var e=this.options.initialState;e?(e=this._grid_model_parse(e),this._doUpdate(e,{columns:!0})):this._update({columns:!0})},_doUpdate:function(e,t){var i=this;this.options.pagination&&!this.pagination?this._generatePagination(e):this.options.pagination&&this.pagination&&this._updatePagination(e);var i=this,n=this._extendFetchOptions(t);if((!this.infiniteScrolling||n.refresh)&&this.content.empty(),n.refresh&&(this.columnsContainer.empty(),this._addColumns(e.columns)),this.infiniteScrolling&&!n.refresh){for(var a=[],s=0;s<e.records.length;s++)a.push(this._addRow(e.records[s]));t.fill({chunk:t.chunk,data:a})}else{for(var s=0;s<e.records.length;s++)this._addRow(e.records[s]);this._syncColumnWidth(),this.infiniteScrolling&&this.contentDiv.infiniteScrolling("restart")}if(!this.infiniteScrolling&&!this.options.pagination&&n.limit<e.totalRecords&&(this.infiniteScrolling=!0,this.contentDiv.infiniteScrolling({total:i.options.allocateRows?e.totalRecords:!1,chunk:i.options.chunk,scroll:function(e,t){i.offset=t.start,i._update({fill:t.fill,chunk:t.chunk})},update:function(e,t){$(".ui-grid-limits",i.footer).html("Result "+t.firstItem+"-"+t.lastItem+(t.total?" of "+t.total:""))}})),!this.infiniteScrolling){var o=n.start+1,r=Math.min(n.start+n.limit,e.totalRecords);$(".ui-grid-limits",this.footer).html("Result "+(o==r?o:o+"-"+r)+" of "+e.totalRecords)}}})),$.widget("ui.karlfilegrid",$.extend({},$.ui.karlgrid.prototype,{options:$.extend({},$.ui.karlgrid.prototype.options,{delete_url:"delete_files.json",moveto_url:"move_files.json",download_url:"download_zipped",selectionColumnId:"sel",folderMenuIndent:16}),_create:function(){var e=this;this.dialogDeleteConfirm=$('<div class="ui-grid-dialog-content"><p>Are you sure you want to delete the selected files and/or folders?</p></div>'),this.dialogDeleteConfirm.appendTo("body").hide().karldialog({width:400,buttons:{Cancel:function(){$(this).karldialog("close")},Delete:function(){$(this).karldialog("close"),e._onDeleteConfirmed()}},open:function(){},close:function(){}}),this.dialogMoveConfirm=$('<div class="ui-grid-dialog-content"><p>Are you sure you want to move these files/folders to "<span></span>"?</p></div>'),this.dialogMoveFolderName=this.dialogMoveConfirm.find("span"),this.dialogMoveConfirm.appendTo("body").hide().karldialog({width:400,buttons:{Cancel:function(){$(this).karldialog("close")},Move:function(){$(this).karldialog("close");var t=e.dialogMoveFolderName.data("folder");e._onMoveConfirmed(t)}},open:function(){},close:function(){}}),this.dialogDownloadConfirm=$('<div class="ui-grid-dialog-content"><p>Are you sure you want to download the <span></span> selected files and/or folders?</p></div>'),this.dialogDownloadItems=this.dialogDownloadConfirm.find("span"),this.dialogDownloadConfirm.appendTo("body").hide().karldialog({width:400,buttons:{Cancel:function(){$(this).karldialog("close")},Download:function(){$(this).karldialog("close");var t=e.dialogDownloadItems.data("items");e._onDownloadConfirmed(t)}},open:function(){},close:function(){}}),$.ui.karlgrid.prototype._create.call(this,arguments)},setTargetFolders:function(e,t){var i=this;return this.moveToLoading?(log("Ignored MoveTo menu update, because the previous update is still in progress"),void this._enableDisableButtons()):(this.moveToLoading=!0,this.button_move.button("option","icons",{primary:"karl-icon-loading"}),this._enableDisableButtons(),void setTimeout(function(){i._do_setTargetFolders(e),i.moveToLoading=!1,i.button_move.button("option","icons",{primary:"ui-icon-folder-open"}),i._enableDisableButtons(),t&&t.call(this)},10))},_do_setTargetFolders:function(e){function t(e){for(var t=0,i=1;i<e.length;i++)"/"===e.charAt(i)&&t++;return t}var i=e.targetFolders,n=e.currentFolder,a=this;this.menuMove.find("li").remove(),window.startTime=(new Date).valueOf();for(var s=$.browser.msie?Math.min(i.length,400):i.length,o=0;s>o;o++){var r=i[o],l=r.path,d=r.title;if(!l||"/"!=l.charAt(0))throw new Error('Fatal error: folder path must start with a "/"');var c;if("/"==l)c=0;else{if(l&&"/"==l.charAt(l.length-1))throw new Error('Fatal error: folder path must not end with a "/"');c=t(l)}var u,h=$("<li></li>").css("textAlign","left").data("folder",r).appendTo(a.menuMove);u=$(l!=n?"<a></a>":"<span></span>"),u.appendTo(h).text(d).css("marginLeft",""+c*a.options.folderMenuIndent+"px")}window.midTime=(new Date).valueOf(),this.menuMove.menu("refresh"),window.endTime=(new Date).valueOf(),window.movetoLoadingTime="MoveTo menu loading: "+(window.midTime-window.startTime)+" + "+(window.endTime-window.midTime)},getSelectedFiles:function(){var e=[];return this.content.find('input.ui-grid-selector[type="checkbox"]:checked').each(function(t,i){var n=$(i).parents(".ui-grid-row").data("karlfilegrid-rowdata");e.push(n._name)}),e},getSelectedTotalSize:function(){var e=0;return this.content.find('input.ui-grid-selector[type="checkbox"]:checked').each(function(t,i){var n=$(i).parents(".ui-grid-row").data("karlfilegrid-rowdata");e+=n._size}),e},_enableDisableButtons:function(){var e=this.getSelectedFiles().length>0,t=e&&this.options.initialState.canDelete;this.button_delete.button("option","disabled",!t),this.button_download.button("option","disabled",!e);e&&!this.moveToLoading;this.button_move.button("option","disabled",!t)},_addColumns:function(e){var t=this;$.ui.karlgrid.prototype._addColumns.call(this,e);var i=this.columnsContainer.find(".ui-grid-column-header").filter(function(i){return e[i].id==t.options.selectionColumnId}).html(""),n=$('<div class="ui-grid-globalselector"></div>').appendTo(i);this.cb_globalselect=$('<input type="checkbox" title="Select/Unselect all items">').change(function(){t._onGlobalSelect($(this).attr("checked"))}).appendTo(n)},_addRow:function(e,t){var i=$.ui.karlgrid.prototype._addRow.call(this,e,t);return i.data("karlfilegrid-rowdata",e),i},_initialUpdate:function(){var e=this,t=$.ui.grid.model.defaults.parse;this._grid_model_parse=function(i){var n=t(i);return n.targetFolders=i.targetFolders,n.currentFolder=i.currentFolder,n.canDelete=i.canDelete,$.each(n.records,function(t,i){record_data=i[e.options.selectionColumnId],i._name=record_data[0],i._size=record_data[1],i[e.options.selectionColumnId]='<input type="checkbox" class="ui-grid-selector" title="Select item">'}),n},this.deferredLoad=this.options.initialState,$.ui.karlgrid.prototype._initialUpdate.call(this),this.deferredLoad=!1},_doUpdate:function(e,t){$.ui.karlgrid.prototype._doUpdate.call(this,e,t),this.cb_globalselect.removeAttr("checked"),this.deferredLoad?(this.doDeferredLoadState=e,this._enableDisableButtons()):this.setTargetFolders(e)},_onGlobalSelect:function(e){this.content.find('input.ui-grid-selector[type="checkbox"]').each(function(){var t=$(this);e?t.attr("checked","checked"):t.removeAttr("checked")}),this._enableDisableButtons()},_onClickRow:function(e){var t=e.is('input[type="checkbox"]');if(!t)return $.ui.karlgrid.prototype._onClickRow.call(this,e);var i=e.attr("checked"),n=!i;return n?e.attr("checked","checked"):e.removeAttr("checked"),this._enableDisableButtons(),!1},_onClickHeader:function(e){var t=e.hasClass("ui-grid-column-header")?e:e.parents(".ui-grid-column-header"),i=t.data("grid-column-header"),n=i.id==this.options.selectionColumnId;return n?e.is('.ui-grid-globalselector input[type="checkbox"]')?!0:!1:$.ui.karlgrid.prototype._onClickHeader.call(this,e)},_generateFooter:function(){var e=this;$.ui.karlgrid.prototype._generateFooter.call(this);var t=$('<span class="ui-grid-footer-button-positioner"></span>').appendTo(this.footer);this.button_delete=$("<a>Delete</a>").button({icons:{primary:"ui-icon-trash"}}).click(function(){return $(this).button("option","disabled")||e._onDeleteClicked(),!1}).appendTo(t),this.button_move=$("<a>Move To</a>").button({icons:{primary:"ui-icon-folder-open"}}).click(function(){if(!$(this).button("option","disabled")){var t=e.doDeferredLoadState;t?(e.doDeferredLoadState=!1,e.setTargetFolders(t,function(){e._onMoveClicked()})):e._onMoveClicked()}return!1}).appendTo(t),this.button_download=$("<a>Download</a>").button({icons:{primary:"ui-icon-circle-arrow-s"}}).click(function(){return $(this).button("option","disabled")||e._onDownloadClicked(),!1}).appendTo(t),this.menuMove=$("<ul></ul>").insertAfter(this.button_move).hide().width(250).css("max-height","325px").css("position","absolute").css("overflow-x","hidden").css("overflow-y","auto").menu({select:function(t,i){e.menuMove.hide();var n=i.item;if(n){var a=n.data("folder");e._onMoveSelected(a)}}}),this.menuMove.bind("keydown",function(t){if(!e.menuMove.menu("option","disabled"))switch(t.keyCode){case $.ui.keyCode.ESCAPE:e.menuMove.hide(),t.preventDefault(),t.stopImmediatePropagation()}}),$("body").bind("mousedown",function(t){e.menuMove.menu("option","disabled")||e.menuMove.is(":hidden")||$(t.target).is(".ui-grid-footer .ui-menu")||$(t.target).is(".ui-grid-footer .ui-menu *")||(e.menuMove.hide(),t.preventDefault(),t.stopImmediatePropagation())})},_onDeleteClicked:function(){this.dialogDeleteConfirm.karldialog("open")},_onDeleteConfirmed:function(){var e=this,t=this.getSelectedFiles();$.ajax({url:this.options.delete_url,type:"POST",dataType:"json",timeout:2e4,data:{file:t},success:function(t){t&&"OK"==t.result?e._onDeleteSuccess(t):e._onDeleteError(t)},error:function(t,i){e._onDeleteError({result:"ERROR",error:"Unknown server error: "+i})}})},_onDeleteSuccess:function(e){var t=""+e.deleted+" file(s) succesfully deleted";$(".statusbox").karlstatusbox("clearAndAppend",t),this._update({columns:!1,refresh:!0})},_onDeleteError:function(e){var t="Deletion failed: "+e.error;$(".statusbox").karlstatusbox("clearAndAppend",t)},_onMoveClicked:function(){this.menuMove.show(),this.menuMove.position({my:"left bottom",at:"left top",of:this.button_move,collision:"fit"}),this.menuMove.focus()},_onMoveSelected:function(e){this.dialogMoveFolderName.text(e.title).data("folder",e),this.dialogMoveConfirm.karldialog("open")},_onMoveConfirmed:function(e){var t=this,i=this.getSelectedFiles();$.ajax({url:this.options.moveto_url,type:"POST",dataType:"json",timeout:2e4,data:{file:i,target_folder:e.path},success:function(e){e&&"OK"==e.result?t._onMoveSuccess(e):t._onMoveError(e)},error:function(e,i){t._onMoveError({result:"ERROR",error:"Unknown server error: "+i})}})},_onMoveSuccess:function(e){var t="Moved "+e.moved+' selected files/folders to <a href="'+e.targetFolderUrl+'">'+e.targetFolderTitle+"</a>";$(".statusbox").karlstatusbox("clearAndAppend",t),this._update({columns:!1,refresh:!0})},_onMoveError:function(e){var t="Move To failed: "+e.error;$(".statusbox").karlstatusbox("clearAndAppend",t)},_onDownloadClicked:function(){var e=this.getSelectedTotalSize();if(20971520>e){var t=this.getSelectedFiles().length;this.dialogDownloadItems.text(t).data("items",t),this.dialogDownloadConfirm.karldialog("open")}else alert("Maximum download size is 20 MB. Total size for selected files is "+parseInt(e/1e6)+" MB.")},_onDownloadConfirmed:function(){var e=this.getSelectedFiles(),t=this.options.download_url,i=$.param({filenames:e});window.location.href=t+"?"+i}})),$.widget("ui.karldialog",$.extend({},$.ui.dialog.prototype,{options:$.extend({},$.ui.dialog.prototype.options,{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,bgiframe:!0,hide:"fold"}),open:function(){if(!this._isOpen){var e=this.options,t=this.uiDialog;this.overlay=e.modal?new $.ui.dialog.overlay(this):null,t.next().length&&t.appendTo("body"),this._size(),this._position(e.position),t.show(e.show),this.moveToTop(!0),e.modal&&t.bind("keypress.ui-dialog",function(e){if(e.keyCode==$.ui.keyCode.TAB){var t=$(":tabbable",this),i=t.filter(":first")[0],n=t.filter(":last")[0];
e.target!=n||e.shiftKey?e.target==i&&e.shiftKey&&setTimeout(function(){n.focus()},1):setTimeout(function(){i.focus()},1)}}),t.focus(),this._trigger("open"),this._isOpen=!0}},position:function(e){return this.uiDialog.position(e)}})),$.widget("ui.karlmultiupload",{options:{selectorStub:".muf-stub",selectorCloseButton:".muf-closebutton",selectorAddButton:".muf-addbutton"},_create:function(){var e=this;this.stub=this.element.find(this.options.selectorStub);var t=this.stub.hide().find("input");this.name=t.attr("name"),t.removeAttr("name"),this.element.find(this.options.selectorAddButton).click(function(t){e._add(),t.preventDefault()})},_add:function(){var e=this.stub.clone().insertBefore(this.stub),t=e.find("input");t.attr("name",this.name+this._getCounter()),e.find(this.options.selectorCloseButton).click(function(t){e.remove(),t.preventDefault()}),e.show()},_getCounter:function(){return this.counter=this.counter||0,this.counter++}}),$.widget("ui.karlsingleupload",{options:{selectorStub:".sif-stub",selectorNoChange:".sif-nochange",selectorUpload:".sif-upload"},_create:function(){var e=this;this.stub=this.element.find(this.options.selectorStub);var t=this.stub.hide().find("input");this.name=t.attr("name"),t.removeAttr("name"),this.element.find(this.options.selectorNoChange).click(function(){e.real&&e._del()}),this.element.find(this.options.selectorUpload).click(function(){e.real||e._add()})},_add:function(){var e=this.real=this.stub.clone().insertBefore(this.stub),t=e.find("input");t.attr("name",this.name),e.show()},_del:function(){this.real.remove(),this.real=null}}),$.widget("ui.karlquotablecomment",{options:{selectorText:".commentText",selectorPasteButton:".quo-paste",wrapperPre:'<div class="quotedreplytext">',wrapperPost:"</div><div><p></p></div>"},_create:function(){var e=this;this.text=this.element.find(this.options.selectorText),this.element.find(this.options.selectorPasteButton).click(function(t){e.pasteToActiveTiny(),t.preventDefault()})},pasteToActiveTiny:function(){var e=this.text.html(),t=tinyMCE.activeEditor;t.focus(),t.selection.setContent(this.options.wrapperPre+e+this.options.wrapperPost)}}),$.widget("ui.karldatetimepicker",{options:{zIndex:void 0},_create:function(){var e=this;if(!jQuery.nodeName(this.element[0],"input"))throw new Error("ui.karldatetimepicker can only be bound to <input> nodes.");this.container=$('<span class="ui-karldatetimepicker-container"></span>'),this.element.hide().after(this.container),this.dateinput=$('<input class="ui-karldatetimepicker-dateinput"></input>').appendTo(this.container),this.options.zIndex&&this.dateinput.css("position","relative").zIndex(this.options.zIndex-1);var t=this.options.dateFormat||void 0;this.dateinput.datepicker({dateFormat:t}).change(function(t){e.setDate($(t.target).val())}),this.hourinput=$('<select class="ui-karldatetimepicker-hourinput"></input>').appendTo(this.container).change(function(t){e.setHour($(t.target).val())});for(var i=0;24>i;i++)$("<option>").val(i).text(i).appendTo(this.hourinput);this.container.append('<span class="ui-karldatetimepicker-colon">:</span>'),this.minuteinput=$('<select class="ui-karldatetimepicker-hourinput"></input>').appendTo(this.container).change(function(t){e.setMinute($(t.target).val())});for(var i=0;4>i;i++){var n=("0"+15*i).slice(-2);$("<option>").val(n).text(n).appendTo(this.minuteinput)}this.set(this.element.val())},set:function(e){var t=e.search(" "),i=e.substr(t+1),n=i.search(":");this.composite_value={datestr:e.substr(0,t),hourstr:e.substr(t+1,n).replace(/^0/,""),minutestr:e.substr(t+n+2)},this.dateinput.val(this.composite_value.datestr),this.hourinput.val(this.composite_value.hourstr),this.minuteinput.val(this.composite_value.minutestr),this.element.val(e),this.element.trigger("change.karldatetimepicker")},setDate:function(e){this.composite_value.datestr=e,this.dateinput.val(this.composite_value.datestr),this._updateComposite()},setHour:function(e){this.composite_value.hourstr=e,this.hourinput.val(this.composite_value.hourstr),this._updateComposite()},setMinute:function(e){this.composite_value.minutestr=e,this.minuteinput.val(this.composite_value.minutestr),this._updateComposite()},_updateComposite:function(){var e=this.composite_value.datestr+" "+this.composite_value.hourstr+":"+this.composite_value.minutestr;this.element.val(e),this.element.trigger("change.karldatetimepicker")},getAsDate:function(){var e=this.element.val(),t=e.lastIndexOf(" "),i=e.lastIndexOf(":"),n=e.substring(0,t),a=e.substring(t+1,i),s=e.substring(i+1),o=$.datepicker.parseDate(this.options.dateFormat,n),r=new Date(o.getFullYear(),o.getMonth(),o.getDate(),Number(a),Number(s));return r},setAsDate:function(e){var t=function(e){var t="0"+e;return t.substr(t.length-2,2)},i=$.datepicker.formatDate(this.options.dateFormat,e),n=i+" "+t(e.getHours())+":"+t(e.getMinutes());this.set(n)},limitMinMax:function(e,t){var i=this.getAsDate(),n=null;e&&e>i&&(n=e),t&&i>t&&(n=t),null!=n&&(this.setAsDate(n),this.dateinput.effect("pulsate",{times:1},800),this.hourinput.is(":visible")&&(this.hourinput.effect("pulsate",{times:1},800),this.minuteinput.effect("pulsate",{times:1},800)))}}),$.widget("ui.karldropdown",{options:{},_create:function(){var e=this;this._locate(),this.menu.hide(),$("<div>").attr("class","karldropdown-indicator ui-icon ui-icon-triangle-1-s").insertBefore(this.menu),this.element.mouseenter(function(){e.show()}).mouseleave(function(){e.hide()}),this.items.mouseover(function(){e.hoverItem(this)}),this.current_item=null,this.padding_left=0},_locate:function(){this.heading=this.element.find("> .karldropdown-heading"),this.menu=this.element.find("> .karldropdown-menu"),this.items=this.menu.find("> li")},show:function(){var e=this.element.height();this.menu.css("position","absolute").css("left",0).css("top",e);var t=this.element.find(":first");this.padding_left=Math.round(t.position().left+parseFloat(t.css("padding-left"))||0),this.resetAllItems(),this.menu.stop(!0,!0).slideDown(150);var i=0;this.items.each(function(){var e;e=jQuery.browser.msie?this.offsetWidth:$(this).width(),i=Math.max(i,e)}).each(function(){$(this).width(i)})},hide:function(){this.resetAllItems(),this.current_item=null,this.menu.stop(!0,!0).fadeOut(50)},resetAllItems:function(){var e=this;this.items.each(function(){e.resetItem(this)})},resetItem:function(e){$(e).stop(!0,!0).css("backgroundColor","#666666").css("color","#000000").css("paddingLeft",this.padding_left).css("paddingRight","11px")},hoverItem:function(e){var t=this;if(this.items.index(this.current_item)!=this.items.index(e)){this.current_item&&this.leaveItem(this.current_item);var e=$(e);e.stop(!0,!0).animate({backgroundColor:"#cecece",color:"#ffffff"},100).animate({paddingLeft:t.padding_left+6,paddingRight:"5px"},150),this.current_item=e}},leaveItem:function(e){var t=this,e=$(e);e.stop(!0,!0).animate({paddingLeft:t.padding_left,paddingRight:"11px"},50).css("backgroundColor","#666666").css("color","#000000"),this.current_item=null}}),jQuery.fn.identify=function(){var e=0;return this.each(function(){if(!$(this).attr("id")){do{e++;var t="anon_"+e}while($("#"+t).length>0);$(this).attr("id",t)}}).attr("id")};var k={};$.fn.myTooltip=function(e){return this.each(function(){var t=$(this),i=t.next(),n=$("<div></div>").height(i.height()).css("overflow","hidden");i.wrapInner(n),t.tooltip(e)})},$(document).ready(function(){function e(e){var t=document.createElement("a");return t.href=e,t}v();var t=$("#karl-app-url").eq(0).attr("content"),i=$("#karl-here-url").eq(0).attr("content"),n=window.karl_client_data&&karl_client_data.tagbox||{},a=function(){if(!n.records)throw"karl_client_data.tagbox not specified or has no records."},r=$("#tagsearch-input");r.length>0&&a(),r.karltagbox({validateRegexp:"^[a-zA-Z0-9-._]+$",ajax:t+"/jquery_tag_search",ajaxAdd:i+"jquery_tag_add",ajaxDel:i+"jquery_tag_del",prevals:n.records,docid:n.docid,showtag_url:t+"/showtag/",tagusers_url:t+"/tagusers.html"});var l=$("#membersearch-input");l.karlmemberbox({ajax:i+"jquery_member_search",showtag_url:t+"/profiles/",name:"users"}),$(".blogComment").karlquotablecomment({}),$("img.tiny-imagedrawer-captioned").karlcaptionedimage({}),g(),$(".button").length>0&&($("#form-submit").click(function(){$("#form-cancel").attr("disabled","disabled")}),$("#form-cancel").click(function(){$("#form-submit").attr("disabled","disabled")}),$("form.k3_genericForm").keyup(function(e){13==e.keyCode&&$("#form-cancel").attr("disabled","disabled")}));var d=$(".search-community-button").button({}).css("verticalAlign","top"),c=$(".search-community-input"),u=d.outerHeight(),p=$("<span></span>");p.css("display","inline-block").css("margin","0").css("padding","0").css("border","0").css("height",u+"px").css("verticalAlign","top"),c.wrap(p).css("margin","0").css("padding","0 3px").css("height",""+(u-2)+"px").css("lineHeight",""+(u-2)+"px");var m=d.css("marginTop");c.css("marginTop",m),$.browser.msie&&7==parseInt($.browser.version)&&d.css("marginTop","1px"),$.browser.msie&&8==parseInt($.browser.version)&&d.css("marginTop","1px"),rcol=$(".generic-layout .rightcol").html(),""==$.trim(rcol)&&$(".generic-layout #center").addClass("fill-width"),$("table.cal").length>0&&s(),$("div.save-category").length>0&&o(),$("#setup_add_cal").length>0&&h(),$(".generic-portlet .portlet-item").hover(function(){$(this).css("background-color","#f0f2f4")},function(){$(this).css("background-color","transparent")}),$("#calendarnotes").sortable({handle:".notehandle",update:function(){var e=$(this),t=e.data("posturl"),i=$("#calendarnotes tr").map(function(e,t){return $(t).data("noteid")});$.ajax({type:"POST",url:t,data:{"form.reorder":!0,order_ids:jQuery.makeArray(i).join(",")},success:function(){console.log(99)},error:function(){alert("Failed to save re-ordering data")},dataType:null})}});var f=function(e){for(var t=[],i=e.substring(1),n=i.split("&"),a=0;a<n.length;a++){var s=n[a].split("=");t.push(s)}return t};$("a.force-post").click(function(t){t.preventDefault();for(var i=$(this),n=$('<form name="forcePost" method="post"></form>').appendTo("body"),a=f(e(i.attr("href")).search),s=0;s<a.length;s++){var o=a[s];$('<input type="hidden"></input>').attr("name",o[0]).attr("value",o[1]).appendTo(n)}n[0].submit()})}),f.themeroller=function(){window.jquitr?jquitr.addThemeRoller():(jquitr={},jquitr.s=document.createElement("script"),jquitr.s.src="http://jqueryui.com/themeroller/developertool/developertool.js.php",document.getElementsByTagName("head")[0].appendChild(jquitr.s))},f.log=function(){window.console&&console.log&&console.log(Array.prototype.slice.call(arguments))},jQuery.fn.extend({outerHtml:function(e){if(e)return this.each(function(){$(this).replaceWith(e)});var t=$("<div></div>").append($(this).clone()),i=t.html();return t.remove(),i}}),f.clear_lock_on_unload=function(){var e=$("#karl-here-url").eq(0).attr("content"),t=e.match(/\/$/)?"":"/",i=e+t+"unlock.html";$(window).bind("unload",function(){window.preventUnlock||$.ajax({type:"POST",url:i,data:{},async:!1})})}};
//# sourceMappingURL=karl-custom.min.js.map