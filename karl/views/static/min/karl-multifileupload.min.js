/*
 * KARL karl-multifileupload.min.js resources generated at 2014-09-25T14:42:26.627Z
*/
!function(){if(!window.google||!google.gears){var e=null;if("undefined"!=typeof GearsFactory)e=new GearsFactory;else try{e=new ActiveXObject("Gears.Factory"),-1!=e.getBuildInfo().indexOf("ie_mobile")&&e.privateSetGlobalObject(this)}catch(t){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(e=document.createElement("object"),e.style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}e&&(window.google||(google={}),google.gears||(google.gears={factory:e}))}}(),function(){function e(){this.returnValue=!1}function t(){this.cancelBubble=!0}var i,n,a=0,o=[],r={},s={},l={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},d=/[<>&\"\']/g,u=window.setTimeout,p={};!function(e){var t,i,n,a=e.split(/,/);for(t=0;t<a.length;t+=2)for(n=a[t+1].split(/ /),i=0;i<n.length;i++)s[n[i]]=a[t]}("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/html,htm html xhtml,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/vnd.rn-realvideo,rv,text/plain,asc txt text diff log,application/octet-stream,exe");var c={VERSION:"dev",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:s,extend:function(e){return c.each(arguments,function(t,i){i>0&&c.each(t,function(t,i){e[i]=t})}),e},cleanName:function(e){var t,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(e,t){return t.name=e,o[e]=t,o.push(t),t},guid:function(){var e,t=(new Date).getTime().toString(32);for(e=0;5>e;e++)t+=Math.floor(65535*Math.random()).toString(32);return(c.guidPrefix||"p")+t+(a++).toString(32)},buildUrl:function(e,t){var i="";return c.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),i&&(e+=(e.indexOf("?")>0?"&":"?")+i),e},each:function(e,t){var n,a,o;if(e)if(n=e.length,n===i){for(a in e)if(e.hasOwnProperty(a)&&t(e[a],a)===!1)return}else for(o=0;n>o;o++)if(t(e[o],o)===!1)return},formatSize:function(e){return e===i||/\D/.test(e)?c.translate("N/A"):e>1073741824?Math.round(e/1073741824,1)+" GB":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"},getPos:function(e,t){function i(e){var t,i,n=0,a=0;return e&&(i=e.getBoundingClientRect(),t="CSS1Compat"===l.compatMode?l.documentElement:l.body,n=i.left+t.scrollLeft,a=i.top+t.scrollTop),{x:n,y:a}}var n,a,o,r=0,s=0,l=document;if(e=e,t=t||l.body,e&&e.getBoundingClientRect&&navigator.userAgent.indexOf("MSIE")>0&&8!==l.documentMode)return a=i(e),o=i(t),{x:a.x-o.x,y:a.y-o.y};for(n=e;n&&n!=t&&n.nodeType;)r+=n.offsetLeft||0,s+=n.offsetTop||0,n=n.offsetParent;for(n=e.parentNode;n&&n!=t&&n.nodeType;)r-=n.scrollLeft||0,s-=n.scrollTop||0,n=n.parentNode;return{x:r,y:s}},getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}},parseSize:function(e){var t;return"string"==typeof e&&(e=/^([0-9]+)([mgk]+)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],"g"==t&&(e*=1073741824),"m"==t&&(e*=1048576),"k"==t&&(e*=1024)),e},xmlEncode:function(e){return e?(""+e).replace(d,function(e){return l[e]?"&"+l[e]+";":e}):e},toArray:function(e){var t,i=[];for(t=0;t<e.length;t++)i[t]=e[t];return i},addI18n:function(e){return c.extend(r,e)},translate:function(e){return r[e]||e},hasClass:function(e,t){var i;return""==e.className?!1:(i=new RegExp("(^|\\s+)"+t+"(\\s+|$)"),i.test(e.className))},addClass:function(e,t){c.hasClass(e,t)||(e.className=""==e.className?t:e.className.replace(/\s+$/,"")+" "+t)},removeClass:function(e,t){var i=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(i,function(e,t,i){return" "===t&&" "===i?" ":""})},addEvent:function(a,o,r){var s,l,d;d=arguments[3],o=o.toLowerCase(),n===i&&(n="Plupload_"+c.guid()),a.attachEvent?(s=function(){var i=window.event;i.target||(i.target=i.srcElement),i.preventDefault=e,i.stopPropagation=t,r(i)},a.attachEvent("on"+o,s)):a.addEventListener&&(s=r,a.addEventListener(o,s,!1)),a[n]===i&&(a[n]=c.guid()),p.hasOwnProperty(a[n])||(p[a[n]]={}),l=p[a[n]],l.hasOwnProperty(o)||(l[o]=[]),l[o].push({func:s,orig:r,key:d})},removeEvent:function(e,t){var a,o,r,s=function(e){for(var t in e)return!1;return!0};if("function"==typeof arguments[2]?o=arguments[2]:r=arguments[2],t=t.toLowerCase(),e[n]&&p[e[n]]&&p[e[n]][t]){a=p[e[n]][t];for(var l=a.length-1;l>=0&&(a[l].key!==r&&a[l].orig!==o||(e.detachEvent?e.detachEvent("on"+t,a[l].func):e.removeEventListener&&e.removeEventListener(t,a[l].func,!1),a[l].orig=null,a[l].func=null,a.splice(l,1),o===i));l--);if(a.length||delete p[e[n]][t],s(p[e[n]])){delete p[e[n]];try{delete e[n]}catch(d){e[n]=i}}}},removeAllEvents:function(e){var t=arguments[1];e[n]!==i&&e[n]&&c.each(p[e[n]],function(i,n){c.removeEvent(e,n,t)})}};c.Uploader=function(e){function t(){var e,t,i=0;if(this.state==c.STARTED){for(t=0;t<l.length;t++)e||l[t].status!=c.QUEUED?i++:(e=l[t],e.status=c.UPLOADING,this.trigger("BeforeUpload",e),this.trigger("UploadFile",e));i==l.length&&(this.trigger("UploadComplete",l),this.stop())}}function n(){var e,t;for(a.reset(),e=0;e<l.length;e++)t=l[e],t.size!==i?(a.size+=t.size,a.loaded+=t.loaded):a.size=i,t.status==c.DONE?a.uploaded++:t.status==c.FAILED?a.failed++:a.queued++;a.size===i?a.percent=l.length>0?Math.ceil(a.uploaded/l.length*100):0:(a.bytesPerSec=Math.ceil(a.loaded/((+new Date-r||1)/1e3)),a.percent=a.size>0?Math.ceil(a.loaded/a.size*100):0)}var a,r,s={},l=[];a=new c.QueueProgress,e=c.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},e),c.extend(this,{state:c.STOPPED,runtime:"",features:{},files:l,settings:e,total:a,id:c.guid(),init:function(){function a(){var e,t,i,n=d[f++];if(n){if(e=n.getFeatures(),t=g.settings.required_features)for(t=t.split(","),i=0;i<t.length;i++)if(!e[t[i]])return void a();n.init(g,function(t){t&&t.success?(g.features=e,g.runtime=n.name,g.trigger("Init",{runtime:n.name}),g.trigger("PostInit"),g.refresh()):a()})}else g.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")})}var s,d,p,g=this,f=0;if("function"==typeof e.preinit?e.preinit(g):c.each(e.preinit,function(e,t){g.bind(t,e)}),e.page_url=e.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(e.url)||(e.url=e.page_url+e.url),e.chunk_size=c.parseSize(e.chunk_size),e.max_file_size=c.parseSize(e.max_file_size),g.bind("FilesAdded",function(t,n){var a,o,r,s=0,d=e.filters;for(d&&d.length&&(r=[],c.each(d,function(e){c.each(e.extensions.split(/,/),function(e){r.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),r=new RegExp(r.join("|")+"$","i")),a=0;a<n.length;a++)o=n[a],o.loaded=0,o.percent=0,o.status=c.QUEUED,o.size!==i&&o.size>e.max_file_size?t.trigger("Error",{code:c.FILE_SIZE_ERROR,message:c.translate("File size error."),file:o}):(l.push(o),s++);return s?void u(function(){g.trigger("QueueChanged"),g.refresh()},1):!1}),e.unique_names&&g.bind("UploadFile",function(e,t){var i=t.name.match(/\.([^.]+)$/),n="tmp";i&&(n=i[1]),t.target_name=t.id+"."+n}),g.bind("UploadProgress",function(e,t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100,n()}),g.bind("StateChanged",function(e){e.state==c.STARTED&&(r=+new Date)}),g.bind("QueueChanged",n),g.bind("Error",function(e,i){i.file&&(i.file.status=c.FAILED,n(),e.state==c.STARTED&&u(function(){t.call(g)},1))}),g.bind("FileUploaded",function(e,i){i.status=c.DONE,i.loaded=i.size,e.trigger("UploadProgress",i),u(function(){t.call(g)},1)}),e.runtimes)for(d=[],p=e.runtimes.split(/\s?,\s?/),s=0;s<p.length;s++)o[p[s]]&&d.push(o[p[s]]);else d=o;a(),"function"==typeof e.init?e.init(g):c.each(e.init,function(e,t){g.bind(t,e)})},refresh:function(){this.trigger("Refresh")},start:function(){this.state!=c.STARTED&&(this.state=c.STARTED,this.trigger("StateChanged"),t.call(this))},stop:function(){this.state!=c.STOPPED&&(this.state=c.STOPPED,this.trigger("StateChanged"))},getFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e)return l[t]},removeFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e.id)return this.splice(t,1)[0]},splice:function(e,t){var n;return n=l.splice(e===i?0:e,t===i?l.length:t),this.trigger("FilesRemoved",n),this.trigger("QueueChanged"),n},trigger:function(e){var t,i,n=s[e.toLowerCase()];if(n)for(i=Array.prototype.slice.call(arguments),i[0]=this,t=0;t<n.length;t++)if(n[t].func.apply(n[t].scope,i)===!1)return!1;return!0},bind:function(e,t,i){var n;e=e.toLowerCase(),n=s[e]||[],n.push({func:t,scope:i||this}),s[e]=n},unbind:function(e){e=e.toLowerCase();var t,n=s[e],a=arguments[1];if(n){if(a!==i){for(t=n.length-1;t>=0;t--)if(n[t].func===a){n.splice(t,1);break}}else n=[];n.length||delete s[e]}},unbindAll:function(){var e=this;c.each(s,function(t,i){e.unbind(i)})},destroy:function(){this.trigger("Destroy"),this.unbindAll()}})},c.File=function(e,t,i){var n=this;n.id=e,n.name=t,n.size=i,n.loaded=0,n.percent=0,n.status=0},c.Runtime=function(){this.getFeatures=function(){},this.init=function(){}},c.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},c.runtimes={},window.plupload=c}(),function(e,t,i){function n(e,t,i,n,a){var o,r;o=google.gears.factory.create("beta.canvas");try{if(o.decode(e),r=Math.min(t/o.width,i/o.height),1>r)return o.resize(Math.round(o.width*r),Math.round(o.height*r)),o.encode(a,{quality:n/100})}catch(s){}return e}var a={};i.runtimes.Gears=i.addRuntime("gears",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0}},init:function(o,r){function s(e){var t,n,r,s=[];for(n=0;n<e.length;n++)t=e[n],r=i.guid(),a[r]=t.blob,s.push(new i.File(r,t.name,t.blob.length));o.trigger("FilesAdded",s)}var l;if(!e.google||!google.gears)return r({success:!1});try{l=google.gears.factory.create("beta.desktop")}catch(d){return r({success:!1})}o.bind("PostInit",function(){var e=o.settings,n=t.getElementById(e.drop_element);n&&(i.addEvent(n,"dragover",function(e){l.setDropEffect(e,"copy"),e.preventDefault()},o.id),i.addEvent(n,"drop",function(e){var t=l.getDragData(e,"application/x-gears-files");t&&s(t.files),e.preventDefault()},o.id),n=0),i.addEvent(t.getElementById(e.browse_button),"click",function(t){var i,n,a,o=[];for(t.preventDefault(),i=0;i<e.filters.length;i++)for(a=e.filters[i].extensions.split(","),n=0;n<a.length;n++)o.push("."+a[n]);l.openFiles(s,{singleFile:!e.multi_selection,filter:o})},o.id)}),o.bind("UploadFile",function(e,t){function o(){function n(n){var a,o,r,s="----pluploadboundary"+i.guid(),l="--",d="\r\n";g&&(p.setRequestHeader("Content-Type","multipart/form-data; boundary="+s),a=google.gears.factory.create("beta.blobbuilder"),i.each(i.extend(h,e.settings.multipart_params),function(e,t){a.append(l+s+d+'Content-Disposition: form-data; name="'+t+'"'+d+d),a.append(e+d)}),r=i.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1")]||"application/octet-stream",a.append(l+s+d+'Content-Disposition: form-data; name="'+e.settings.file_data_name+'"; filename="'+t.name+'"'+d+"Content-Type: "+r+d+d),a.append(n),a.append(d+l+s+l+d),o=a.getAsBlob(),f=o.length-n.length,n=o),p.send(n)}var p,c,g=e.settings.multipart,f=0,h={name:t.target_name||t.name},m=e.settings.url;t.status!=i.DONE&&t.status!=i.FAILED&&e.state!=i.STOPPED&&(l&&(h.chunk=d,h.chunks=r),c=Math.min(s,t.size-d*s),g||(m=i.buildUrl(e.settings.url,h)),p=google.gears.factory.create("beta.httprequest"),p.open("POST",m),g||(p.setRequestHeader("Content-Disposition",'attachment; filename="'+t.name+'"'),p.setRequestHeader("Content-Type","application/octet-stream")),i.each(e.settings.headers,function(e,t){p.setRequestHeader(t,e)}),p.upload.onprogress=function(i){t.loaded=u+i.loaded-f,e.trigger("UploadProgress",t)},p.onreadystatechange=function(){var n;if(4==p.readyState)if(200==p.status){if(n={chunk:d,chunks:r,response:p.responseText,status:p.status},e.trigger("ChunkUploaded",t,n),n.cancelled)return void(t.status=i.FAILED);u+=c,++d>=r?(t.status=i.DONE,e.trigger("FileUploaded",t,{response:p.responseText,status:p.status})):o()}else e.trigger("Error",{code:i.HTTP_ERROR,message:i.translate("HTTP Error."),file:t,chunk:d,chunks:r,status:p.status})},r>d&&n(a[t.id].slice(d*s,c)))}var r,s,l,d=0,u=0,p=e.settings.resize;p&&/\.(png|jpg|jpeg)$/i.test(t.name)&&(a[t.id]=n(a[t.id],p.width,p.height,p.quality||90,/\.png$/i.test(t.name)?"image/png":"image/jpeg")),t.size=a[t.id].length,s=e.settings.chunk_size,l=s>0,r=Math.ceil(t.size/s),l||(s=t.size,r=1),o()}),o.bind("Destroy",function(e){var n,a,o={browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(n in o)a=t.getElementById(o[n]),a&&i.removeAllEvents(a,e.id)}),r({success:!0})}})}(window,document,plupload),function(e,t,i,n){function a(e){var t,i,o,r,s=typeof e;if("string"===s)return t="\bb	t\nn\ff\rr\"\"''\\\\",'"'+e.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(e,i){var n=t.indexOf(i);return n+1?"\\"+t.charAt(n+1):(e=i.charCodeAt().toString(16),"\\u"+"0000".substring(e.length)+e)})+'"';if("object"==s){if(i=e.length!==n,t="",i){for(o=0;o<e.length;o++)t&&(t+=","),t+=a(e[o]);t="["+t+"]"}else{for(r in e)e.hasOwnProperty(r)&&(t&&(t+=","),t+=a(r)+":"+a(e[r]));t="{"+t+"}"}return t}return e===n?"null":""+e}function o(e){var t,i,n,a,o,r=!1,s=null,l=0;try{try{s=new ActiveXObject("AgControl.AgControl"),s.IsVersionSupported(e)&&(r=!0),s=null}catch(d){var u=navigator.plugins["Silverlight Plug-In"];if(u){for(t=u.description,"1.0.30226.2"===t&&(t="2.0.30226.2"),i=t.split(".");i.length>3;)i.pop();for(;i.length<4;)i.push(0);for(n=e.split(".");n.length>4;)n.pop();do a=parseInt(n[l],10),o=parseInt(i[l],10),l++;while(l<n.length&&a===o);o>=a&&!isNaN(a)&&(r=!0)}}}catch(p){r=!1}return r}var r={},s={};i.silverlight={trigger:function(e,t){var n,a=r[e];a&&(n=i.toArray(arguments).slice(1),n[0]="Silverlight:"+t,setTimeout(function(){a.trigger.apply(a,n)},0))}},i.runtimes.Silverlight=i.addRuntime("silverlight",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0}},init:function(n,l){function d(){return t.getElementById(n.id+"_silverlight").content.Upload}var u,p,c="",g=n.settings.filters,f=t.body;if(!o("2.0.31005.0")||e.opera&&e.opera.buildNumber)return void l({success:!1});for(s[n.id]=!1,r[n.id]=n,u=t.createElement("div"),u.id=n.id+"_silverlight_container",i.extend(u.style,{position:"absolute",top:"0px",background:n.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100px",height:"100px",overflow:"hidden",opacity:n.settings.shim_bgcolor||t.documentMode>8?"":.01}),u.className="plupload silverlight",n.settings.container&&(f=t.getElementById(n.settings.container),f.style.position="relative"),f.appendChild(u),p=0;p<g.length;p++)c+=(""!=c?"|":"")+g[p].title+" | *."+g[p].extensions.replace(/,/g,";*.");u.innerHTML='<object id="'+n.id+'_silverlight" data="data:application/x-silverlight," type="application/x-silverlight-2" style="outline:none;" width="1024" height="1024"><param name="source" value="'+n.settings.silverlight_xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="id='+n.id+",filter="+c+",multiselect="+n.settings.multi_selection+'"/></object>',n.bind("Silverlight:Init",function(){var e,o={};s[n.id]||(s[n.id]=!0,n.bind("Silverlight:StartSelectFiles",function(){e=[]}),n.bind("Silverlight:SelectFile",function(t,n,a,r){var s;s=i.guid(),o[s]=n,o[n]=s,e.push(new i.File(s,a,r))}),n.bind("Silverlight:SelectSuccessful",function(){e.length&&n.trigger("FilesAdded",e)}),n.bind("Silverlight:UploadChunkError",function(e,t,a,r,s){n.trigger("Error",{code:i.IO_ERROR,message:"IO Error.",details:s,file:e.getFile(o[t])})}),n.bind("Silverlight:UploadFileProgress",function(e,t,n,a){var r=e.getFile(o[t]);r.status!=i.FAILED&&(r.size=a,r.loaded=n,e.trigger("UploadProgress",r))}),n.bind("Refresh",function(e){var n,a,o;n=t.getElementById(e.settings.browse_button),n&&(a=i.getPos(n,t.getElementById(e.settings.container)),o=i.getSize(n),i.extend(t.getElementById(e.id+"_silverlight_container").style,{top:a.y+"px",left:a.x+"px",width:o.w+"px",height:o.h+"px"}))}),n.bind("Silverlight:UploadChunkSuccessful",function(e,t,n,a,r){var s,l=e.getFile(o[t]);s={chunk:n,chunks:a,response:r},e.trigger("ChunkUploaded",l,s),l.status!=i.FAILED&&d().UploadNextChunk(),n==a-1&&(l.status=i.DONE,e.trigger("FileUploaded",l,{response:r}))}),n.bind("Silverlight:UploadSuccessful",function(e,t,n){var a=e.getFile(o[t]);a.status=i.DONE,e.trigger("FileUploaded",a,{response:n})}),n.bind("FilesRemoved",function(e,t){var i;for(i=0;i<t.length;i++)d().RemoveFile(o[t[i].id])}),n.bind("UploadFile",function(e,t){var n=e.settings,r=n.resize||{};d().UploadFile(o[t.id],e.settings.url,a({name:t.target_name||t.name,mime:i.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1")]||"application/octet-stream",chunk_size:n.chunk_size,image_width:r.width,image_height:r.height,image_quality:r.quality||90,multipart:!!n.multipart,multipart_params:n.multipart_params||{},file_data_name:n.file_data_name,headers:n.headers}))}),n.bind("Silverlight:MouseEnter",function(e){var a,o;a=t.getElementById(n.settings.browse_button),o=e.settings.browse_button_hover,a&&o&&i.addClass(a,o)}),n.bind("Silverlight:MouseLeave",function(e){var a,o;a=t.getElementById(n.settings.browse_button),o=e.settings.browse_button_hover,a&&o&&i.removeClass(a,o)}),n.bind("Silverlight:MouseLeftButtonDown",function(e){var a,o;a=t.getElementById(n.settings.browse_button),o=e.settings.browse_button_active,a&&o&&(i.addClass(a,o),i.addEvent(t.body,"mouseup",function(){i.removeClass(a,o)}))}),n.bind("Sliverlight:StartSelectFiles",function(e){var a,o;a=t.getElementById(n.settings.browse_button),o=e.settings.browse_button_active,a&&o&&i.removeClass(a,o)}),n.bind("Destroy",function(e){var n;i.removeAllEvents(t.body,e.id),delete s[e.id],delete r[e.id],n=t.getElementById(e.id+"_silverlight_container"),n&&f.removeChild(n)}),l({success:!0}))})}})}(window,document,plupload),function(e,t,i){function n(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}var a={},o={};i.flash={trigger:function(e,t,i){setTimeout(function(){var n=a[e];n&&n.trigger("Flash:"+t,i)},0)}},i.runtimes.Flash=i.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0}},init:function(e,r){function s(){return t.getElementById(e.id+"_flash")}function l(){return c++>5e3?void r({success:!1}):void(o[e.id]||setTimeout(l,1))}var d,u,p,c=0,g=t.body;return n()<10?void r({success:!1}):(o[e.id]=!1,a[e.id]=e,d=t.getElementById(e.settings.browse_button),u=t.createElement("div"),u.id=e.id+"_flash_container",i.extend(u.style,{position:"absolute",top:"0px",background:e.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),u.className="plupload flash",e.settings.container&&(g=t.getElementById(e.settings.container),g.style.position="relative"),g.appendChild(u),p="id="+escape(e.id),u.innerHTML='<object id="'+e.id+'_flash" width="100%" height="100%" style="outline:0" type="application/x-shockwave-flash" data="'+e.settings.flash_swf_url+'"><param name="movie" value="'+e.settings.flash_swf_url+'" /><param name="flashvars" value="'+p+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',l(),d=u=null,void e.bind("Flash:Init",function(){var n={},l=e.settings.resize||{};s().setFileFilters(e.settings.filters,e.settings.multi_selection),o[e.id]||(o[e.id]=!0,e.bind("UploadFile",function(e,t){var a=e.settings;s().uploadFile(n[t.id],a.url,{name:t.target_name||t.name,mime:i.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1")]||"application/octet-stream",chunk_size:a.chunk_size,width:l.width,height:l.height,quality:l.quality||90,multipart:a.multipart,multipart_params:a.multipart_params||{},file_data_name:a.file_data_name,format:/\.(jpg|jpeg)$/i.test(t.name)?"jpg":"png",headers:a.headers,urlstream_upload:a.urlstream_upload})}),e.bind("Flash:UploadProcess",function(e,t){var a=e.getFile(n[t.id]);a.status!=i.FAILED&&(a.loaded=t.loaded,a.size=t.size,e.trigger("UploadProgress",a))}),e.bind("Flash:UploadChunkComplete",function(e,t){var a,o=e.getFile(n[t.id]);a={chunk:t.chunk,chunks:t.chunks,response:t.text},e.trigger("ChunkUploaded",o,a),o.status!=i.FAILED&&s().uploadNextChunk(),t.chunk==t.chunks-1&&(o.status=i.DONE,e.trigger("FileUploaded",o,{response:t.text}))}),e.bind("Flash:SelectFiles",function(t,a){var o,r,s,l=[];for(r=0;r<a.length;r++)o=a[r],s=i.guid(),n[s]=o.id,n[o.id]=s,l.push(new i.File(s,o.name,o.size));l.length&&e.trigger("FilesAdded",l)}),e.bind("Flash:SecurityError",function(t,a){e.trigger("Error",{code:i.SECURITY_ERROR,message:i.translate("Security error."),details:a.message,file:e.getFile(n[a.id])})}),e.bind("Flash:GenericError",function(t,a){e.trigger("Error",{code:i.GENERIC_ERROR,message:i.translate("Generic error."),details:a.message,file:e.getFile(n[a.id])})}),e.bind("Flash:IOError",function(t,a){e.trigger("Error",{code:i.IO_ERROR,message:i.translate("IO error."),details:a.message,file:e.getFile(n[a.id])})}),e.bind("Flash:ImageError",function(t,a){e.trigger("Error",{code:parseInt(a.code),message:i.translate("Image error."),file:e.getFile(n[a.id])})}),e.bind("Flash:StageEvent:rollOver",function(n){var a,o;a=t.getElementById(e.settings.browse_button),o=n.settings.browse_button_hover,a&&o&&i.addClass(a,o)}),e.bind("Flash:StageEvent:rollOut",function(n){var a,o;a=t.getElementById(e.settings.browse_button),o=n.settings.browse_button_hover,a&&o&&i.removeClass(a,o)}),e.bind("Flash:StageEvent:mouseDown",function(n){var a,o;a=t.getElementById(e.settings.browse_button),o=n.settings.browse_button_active,a&&o&&(i.addClass(a,o),i.addEvent(t.body,"mouseup",function(){i.removeClass(a,o)},n.id))}),e.bind("Flash:StageEvent:mouseUp",function(n){var a,o;a=t.getElementById(e.settings.browse_button),o=n.settings.browse_button_active,a&&o&&i.removeClass(a,o)}),e.bind("QueueChanged",function(){e.refresh()}),e.bind("FilesRemoved",function(e,t){var i;for(i=0;i<t.length;i++)s().removeFile(n[t[i].id])}),e.bind("StateChanged",function(){e.refresh()}),e.bind("Refresh",function(n){var a,o,r;s().setFileFilters(e.settings.filters,e.settings.multi_selection),a=t.getElementById(n.settings.browse_button),a&&(o=i.getPos(a,t.getElementById(n.settings.container)),r=i.getSize(a),i.extend(t.getElementById(n.id+"_flash_container").style,{top:o.y+"px",left:o.x+"px",width:r.w+"px",height:r.h+"px"}))}),e.bind("Destroy",function(e){var n;i.removeAllEvents(t.body,e.id),delete o[e.id],delete a[e.id],n=t.getElementById(e.id+"_flash_container"),n&&g.removeChild(n)}),r({success:!0}))}))}})}(window,document,plupload),function(e,t,i){function n(e){return t.getElementById(e)}i.runtimes.Html4=i.addRuntime("html4",{getFeatures:function(){return{multipart:!0,canOpenDialog:-1!==navigator.userAgent.indexOf("WebKit")}},init:function(a,o){a.bind("Init",function(o){function r(){var e,s,l,d;u=i.guid(),_.push(u),e=t.createElement("form"),e.setAttribute("id","form_"+u),e.setAttribute("method","post"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("encoding","multipart/form-data"),e.setAttribute("target",o.id+"_iframe"),e.style.position="absolute",s=t.createElement("input"),s.setAttribute("id","input_"+u),s.setAttribute("type","file"),s.setAttribute("accept",v),s.setAttribute("size",1),d=n(o.settings.browse_button),o.features.canOpenDialog&&d&&i.addEvent(n(o.settings.browse_button),"click",function(e){s.click(),e.preventDefault()},o.id),i.extend(s.style,{width:"100%",height:"100%",opacity:0,fontSize:"2em"}),i.extend(e.style,{overflow:"hidden"}),l=o.settings.shim_bgcolor,l&&(e.style.background=l),b&&i.extend(s.style,{filter:"alpha(opacity=0)"}),i.addEvent(s,"change",function(t){var l,p=t.target,c=[];p.value&&(n("form_"+u).style.top="-1048575px",l=p.value.replace(/\\/g,"/"),l=l.substring(l.length,l.lastIndexOf("/")+1),c.push(new i.File(u,l)),o.features.canOpenDialog?i.removeEvent(d,"click",o.id):i.removeAllEvents(e,o.id),i.removeEvent(s,"change",o.id),r(),c.length&&a.trigger("FilesAdded",c))},o.id),e.appendChild(s),h.appendChild(e),o.refresh()}function s(){var n=t.createElement("div");n.innerHTML='<iframe id="'+o.id+'_iframe" name="'+o.id+'_iframe" src="'+m+':&quot;&quot;" style="display:none"></iframe>',l=n.firstChild,h.appendChild(l),i.addEvent(l,"load",function(t){var n,a,r=t.target;if(d){try{n=r.contentWindow.document||r.contentDocument||e.frames[r.id].document}catch(s){return void o.trigger("Error",{code:i.SECURITY_ERROR,message:i.translate("Security error."),file:d})}a=n.documentElement.innerText||n.documentElement.textContent,a&&(d.status=i.DONE,d.loaded=1025,d.percent=100,o.trigger("UploadProgress",d),o.trigger("FileUploaded",d,{response:a}))}},o.id)}var l,d,u,p,c,g,f,h=t.body,m="javascript",_=[],b=/MSIE/.test(navigator.userAgent),v=[],y=o.settings.filters;for(p=0;p<y.length;p++)for(c=y[p].extensions.split(/,/),f=0;f<c.length;f++)g=i.mimeTypes[c[f]],g&&v.push(g);v=v.join(","),o.settings.container&&(h=n(o.settings.container),h.style.position="relative"),o.bind("UploadFile",function(e,a){var o,r;a.status!=i.DONE&&a.status!=i.FAILED&&e.state!=i.STOPPED&&(o=n("form_"+a.id),r=n("input_"+a.id),r.setAttribute("name",e.settings.file_data_name),o.setAttribute("action",e.settings.url),i.each(i.extend({name:a.target_name||a.name},e.settings.multipart_params),function(e,n){var a=t.createElement("input");i.extend(a,{type:"hidden",name:n,value:e}),o.insertBefore(a,o.firstChild)}),d=a,n("form_"+u).style.top="-1048575px",o.submit(),o.parentNode.removeChild(o))}),o.bind("FileUploaded",function(e){e.refresh()}),o.bind("StateChanged",function(t){t.state==i.STARTED&&s(),t.state==i.STOPPED&&e.setTimeout(function(){i.removeEvent(l,"load",t.id),l.parentNode.removeChild(l)},0)}),o.bind("Refresh",function(e){var a,o,r,s,l,d,p,c,g;a=n(e.settings.browse_button),a&&(l=i.getPos(a,n(e.settings.container)),d=i.getSize(a),p=n("form_"+u),c=n("input_"+u),i.extend(p.style,{top:l.y+"px",left:l.x+"px",width:d.w+"px",height:d.h+"px"}),e.features.canOpenDialog&&(g=parseInt(a.parentNode.style.zIndex,10),isNaN(g)&&(g=0),i.extend(a.style,{position:"relative",zIndex:g}),i.extend(p.style,{zIndex:g-1})),r=e.settings.browse_button_hover,s=e.settings.browse_button_active,o=e.features.canOpenDialog?a:p,r&&(i.addEvent(o,"mouseover",function(){i.addClass(a,r)},e.id),i.addEvent(o,"mouseout",function(){i.removeClass(a,r)},e.id)),s&&(i.addEvent(o,"mousedown",function(){i.addClass(a,s)},e.id),i.addEvent(t.body,"mouseup",function(){i.removeClass(a,s)},e.id)))}),a.bind("FilesRemoved",function(e,t){var i,a;for(i=0;i<t.length;i++)a=n("form_"+t[i].id),a&&a.parentNode.removeChild(a)}),a.bind("Destroy",function(e){var a,o,r,s={inputContainer:"form_"+u,inputFile:"input_"+u,browseButton:e.settings.browse_button};for(a in s)o=n(s[a]),o&&i.removeAllEvents(o,e.id);i.removeAllEvents(t.body,e.id),i.each(_,function(e){r=n("form_"+e),r&&h.removeChild(r)})}),r()}),o({success:!0})}})}(window,document,plupload),function(e,t,i,n){function a(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsDataURL(t),n.onload=function(){i(n.result)},void 0):i(t.getAsDataURL())}function o(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsBinaryString(t),n.onload=function(){i(n.result)},void 0):i(t.getAsBinary())}function r(e,i,n,o,r){var s,d,u,p;a(e,function(e){s=t.createElement("canvas"),s.style.display="none",t.body.appendChild(s),d=s.getContext("2d"),u=new Image,u.onload=function(){var t,a,c,g;p=Math.min(i/u.width,n/u.height),1>p?(t=Math.round(u.width*p),a=Math.round(u.height*p),s.width=t,s.height=a,d.drawImage(u,0,0,t,a),g=new l,g.init(atob(e.substring(e.indexOf("base64,")+7))),c=g.APP1({width:t,height:a}),e=s.toDataURL(o),e=e.substring(e.indexOf("base64,")+7),e=atob(e),c&&(g.init(e),g.setAPP1(c),e=g.getBinary()),s.parentNode.removeChild(s),r({success:!0,data:e})):r({success:!1})},u.src=e})}var s,l;i.runtimes.Html5=i.addRuntime("html5",{getFeatures:function(){var t,i,a,o,r,l=e;return i=a=o=r=!1,l.Uint8Array&&l.ArrayBuffer&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(e){var t,i,n,a;t=new ArrayBuffer(e.length),i=new Uint8Array(t,0);for(var o=0;o<e.length;o++)i[o]=255&e.charCodeAt(o);n=new BlobBuilder,n.append(t),a=n.getBlob(),this.send(a)}),l.XMLHttpRequest&&(t=new XMLHttpRequest,a=!!t.upload,i=!(!t.sendAsBinary&&!t.upload)),i&&(o=!(!File||!File.prototype.getAsDataURL&&!l.FileReader||!t.sendAsBinary),r=!(!File||!File.prototype.slice)),s=navigator.userAgent.indexOf("Safari")>0&&-1!==navigator.vendor.indexOf("Apple"),{html5:i,dragdrop:l.mozInnerScreenX!==n||r||s,jpgresize:o,pngresize:o,multipart:o||!!l.FileReader||!!l.FormData,progress:a,chunking:r||o,canOpenDialog:-1!==navigator.userAgent.indexOf("WebKit")}},init:function(e,n){function a(t){var n,a,o,r=[],s={};for(a=0;a<t.length;a++)n=t[a],s[n.name]||(s[n.name]=!0,o=i.guid(),d[o]=n,r.push(new i.File(o,n.fileName||n.name,n.fileSize||n.size)));r.length&&e.trigger("FilesAdded",r)}var l,d={};return l=this.getFeatures(),l.html5?(e.bind("Init",function(n){var o,r,s,l,d,u,p,c=[],g=n.settings.filters,f=t.body;for(o=t.createElement("div"),o.id=n.id+"_html5_container",s=0;s<g.length;s++)for(d=g[s].extensions.split(/,/),l=0;l<d.length;l++)u=i.mimeTypes[d[l]],u&&c.push(u);if(i.extend(o.style,{position:"absolute",background:e.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:e.settings.shim_bgcolor?"":0}),o.className="plupload html5",e.settings.container&&(f=t.getElementById(e.settings.container),f.style.position="relative"),f.appendChild(o),o.innerHTML='<input id="'+e.id+'_html5" style="width:100%;height:100%;" type="file" accept="'+c.join(",")+'" '+(e.settings.multi_selection?'multiple="multiple"':"")+" />",p=t.getElementById(e.id+"_html5"),p.onchange=function(){a(this.files),this.value=""},r=t.getElementById(n.settings.browse_button)){var h=n.settings.browse_button_hover,m=n.settings.browse_button_active,_=n.features.canOpenDialog?r:o;h&&(i.addEvent(_,"mouseover",function(){i.addClass(r,h)},n.id),i.addEvent(_,"mouseout",function(){i.removeClass(r,h)},n.id)),m&&(i.addEvent(_,"mousedown",function(){i.addClass(r,m)},n.id),i.addEvent(t.body,"mouseup",function(){i.removeClass(r,m)},n.id)),n.features.canOpenDialog&&i.addEvent(r,"click",function(e){t.getElementById(n.id+"_html5").click(),e.preventDefault()},n.id)}}),e.bind("PostInit",function(){var n=t.getElementById(e.settings.drop_element);if(n){if(s)return void i.addEvent(n,"dragenter",function(){var o,r,s;o=t.getElementById(e.id+"_drop"),o||(o=t.createElement("input"),o.setAttribute("type","file"),o.setAttribute("id",e.id+"_drop"),o.setAttribute("multiple","multiple"),i.addEvent(o,"change",function(){a(this.files),i.removeEvent(o,"change",e.id),o.parentNode.removeChild(o)
},e.id),n.appendChild(o)),r=i.getPos(n,t.getElementById(e.settings.container)),s=i.getSize(n),i.extend(n.style,{position:"relative"}),i.extend(o.style,{position:"absolute",display:"block",top:0,left:0,width:s.w+"px",height:s.h+"px",opacity:0})},e.id);i.addEvent(n,"dragover",function(e){e.preventDefault()},e.id),i.addEvent(n,"drop",function(e){var t=e.dataTransfer;t&&t.files&&a(t.files),e.preventDefault()},e.id)}}),e.bind("Refresh",function(n){var a,o,r,s,l;a=t.getElementById(e.settings.browse_button),a&&(o=i.getPos(a,t.getElementById(n.settings.container)),r=i.getSize(a),s=t.getElementById(e.id+"_html5_container"),i.extend(s.style,{top:o.y+"px",left:o.x+"px",width:r.w+"px",height:r.h+"px"}),e.features.canOpenDialog&&(l=parseInt(a.parentNode.style.zIndex,10),isNaN(l)&&(l=0),i.extend(a.style,{position:"relative",zIndex:l}),i.extend(s.style,{zIndex:l-1})))}),e.bind("UploadFile",function(e,t){function n(n){function o(){var p,c,g,f,h,m,_,b,v=n,y=0,E="----pluploadboundary"+i.guid(),w="--",S="\r\n",F="",x=e.settings.url;if(t.status!=i.DONE&&t.status!=i.FAILED&&e.state!=i.STOPPED){if(f={name:t.target_name||t.name},u.chunk_size&&l.chunking?(h=u.chunk_size,g=Math.ceil(t.size/h),m=Math.min(h,t.size-r*h),v="string"==typeof n?n.substring(r*h,r*h+m):n.slice(r*h,m),f.chunk=r,f.chunks=g):m=t.size,p=new XMLHttpRequest,c=p.upload,c&&(c.onprogress=function(i){t.loaded=Math.min(t.size,s+i.loaded-y),e.trigger("UploadProgress",t)}),e.settings.multipart&&l.multipart?f.name=t.target_name||t.name:x=i.buildUrl(e.settings.url,f),p.open("post",x,!0),p.onreadystatechange=function(){var l,u;if(4==p.readyState){try{l=p.status}catch(c){l=0}if(l>=400)e.trigger("Error",{code:i.HTTP_ERROR,message:i.translate("HTTP Error."),file:t,status:l});else{if(g){if(u={chunk:r,chunks:g,response:p.responseText,status:l},e.trigger("ChunkUploaded",t,u),s+=m,u.cancelled)return void(t.status=i.FAILED);t.loaded=Math.min(t.size,(r+1)*h)}else t.loaded=t.size;e.trigger("UploadProgress",t),!g||++r>=g?(t.status=i.DONE,e.trigger("FileUploaded",t,{response:p.responseText,status:l}),a=n=d[t.id]=null):o()}p=v=_=F=null}},i.each(e.settings.headers,function(e,t){p.setRequestHeader(t,e)}),e.settings.multipart&&l.multipart){if(!p.sendAsBinary)return _=new FormData,i.each(i.extend(f,e.settings.multipart_params),function(e,t){_.append(t,e)}),_.append(e.settings.file_data_name,v),void p.send(_);p.setRequestHeader("Content-Type","multipart/form-data; boundary="+E),i.each(i.extend(f,e.settings.multipart_params),function(e,t){F+=w+E+S+'Content-Disposition: form-data; name="'+t+'"'+S+S,F+=unescape(encodeURIComponent(e))+S}),b=i.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1")]||"application/octet-stream",F+=w+E+S+'Content-Disposition: form-data; name="'+e.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(t.name))+'"'+S+"Content-Type: "+b+S+S+v+S+w+E+w+S,y=F.length-v.length,v=F}else p.setRequestHeader("Content-Type","application/octet-stream");p.sendAsBinary?p.sendAsBinary(v):p.send(v)}}var r=0,s=0;o()}var a,s,u=e.settings;a=d[t.id],s=e.settings.resize,l.jpgresize?s&&/\.(png|jpg|jpeg)$/i.test(t.name)?r(a,s.width,s.height,/\.png$/i.test(t.name)?"image/png":"image/jpeg",function(e){e.success?(t.size=e.data.length,n(e.data)):o(a,n)}):o(a,n):n(a)}),e.bind("Destroy",function(e){var n,a,o=t.body,r={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(n in r)a=t.getElementById(r[n]),a&&i.removeAllEvents(a,e.id);i.removeAllEvents(t.body,e.id),e.settings.container&&(o=t.getElementById(e.settings.container)),o.removeChild(t.getElementById(r.inputContainer))}),void n({success:!0})):void n({success:!1})}}),l=function(){function e(){function e(e,t){var i,o=a?0:-8*(t-1),r=0;for(i=0;t>i;i++)r|=n.charCodeAt(e+i)<<Math.abs(o+8*i);return r}function t(e,t,i){n=n.substr(0,e)+t+n.substr((i===!0?t.length:0)+e)}function i(e,i,n){var o,r="",s=a?0:-8*(n-1);for(o=0;n>o;o++)r+=String.fromCharCode(i>>Math.abs(s+8*o)&255);t(e,r,!0)}var n,a=!1;return{II:function(e){return e===v?a:void(a=e)},init:function(e){n=e},SEGMENT:function(e,i,a){return arguments.length?"number"==typeof i?n.substr(parseInt(e,10),i):void t(e,i,a):n},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,n){return n===v?e(t,4):void i(t,n,4)},SLONG:function(t){var i=e(t,4);return i>2147483647?i-4294967296:i},STRING:function(t,i){var n="";for(i+=t;i>t;t++)n+=String.fromCharCode(e(t,1));return n}}}function t(e,t){var i,n,a,o,r,s,l,d,u=g.SHORT(e),p=[],c={};for(i=0;u>i;i++)if(l=s=e+12*i+2,a=t[g.SHORT(l)],a!==v){switch(o=g.SHORT(l+=2),r=g.LONG(l+=2),l+=4,p=[],o){case 1:case 7:for(r>4&&(l=g.LONG(l)+b),n=0;r>n;n++)p[n]=g.BYTE(l+n);break;case 2:r>4&&(l=g.LONG(l)+b),c[a]=g.STRING(l,r-1);continue;case 3:for(r>2&&(l=g.LONG(l)+b),n=0;r>n;n++)p[n]=g.SHORT(l+2*n);break;case 4:for(r>1&&(l=g.LONG(l)+b),n=0;r>n;n++)p[n]=g.LONG(l+4*n);break;case 5:for(l=g.LONG(l)+b,n=0;r>n;n++)p[n]=g.LONG(l+4*n)/g.LONG(l+4*n+4);break;case 9:for(l=g.LONG(l)+b,n=0;r>n;n++)p[n]=g.SLONG(l+4*n);break;case 10:for(l=g.LONG(l)+b,n=0;r>n;n++)p[n]=g.SLONG(l+4*n)/g.SLONG(l+4*n+4);break;default:continue}d=1==r?p[0]:p,c[a]=S.hasOwnProperty(a)&&"object"!=typeof d?S[a][d]:d}return c}function i(){var e=c+4;return b+=c,"EXIF"===g.STRING(e,4).toUpperCase()&&0===g.SHORT(e+=4)&&(g.II(18761==g.SHORT(e+=2)),42===g.SHORT(e+=2))?(_=b+g.LONG(e+=2),o=t(_,y),h="ExifIFDPointer"in o?b+o.ExifIFDPointer:v,m="GPSInfoIFDPointer"in o?b+o.GPSInfoIFDPointer:v,!0):void 0}function n(e,t,i){var n,a,o=e.SHORT(i);for(a=0;o>a;a++)if(n=i+12*a+2,e.SHORT(n)==t)return n+8}function a(t,i){var a,o,r=h!=v?h-c:v,s=new e;s.init(p),s.II(g.II()),r!==v&&(a=n(s,40962,r),a!==v&&s.LONG(a,t),o=n(s,40963,r),o!==v&&s.LONG(o,i),p=s.SEGMENT())}var o,r,s,l,d,u,p,c,g,f,h,m,_,b,v,y,E,w,S;return g=new e,y={274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},E={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},w={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},S={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){if(b=10,o=r=s=l=d=u=p=c=f=v,g.init(e),65496!==g.SHORT(0))return!1;switch(g.SHORT(2)){case 65504:d=2,u=g.SHORT(4)+2,65505==g.SHORT(u)&&(c=u,f=g.SHORT(u+2)+2);break;case 65505:c=2,f=g.SHORT(4)+2;break;default:return!1}f!==v&&i()},APP1:function(e){return c!==v||f!==v?(p=p||(p=g.SEGMENT(c,f)),e!==v&&"width"in e&&"height"in e&&a(e.width,e.height),p):void 0},EXIF:function(){return r=t(h,E),r.ExifVersion=String.fromCharCode(r.ExifVersion[0],r.ExifVersion[1],r.ExifVersion[2],r.ExifVersion[3]),r},GPS:function(){return s=t(m,w),s.GPSVersionID=s.GPSVersionID.join("."),s},setAPP1:function(e){return c!==v?!1:void g.SEGMENT(d?d+u:2,e)},getBinary:function(){return g.SEGMENT()}}}}(window,document,plupload),function(e,t,i,n){function a(e){return i.translate(e)||e}function o(e){e.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="plupload"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+a("Select files")+'</div><div class="plupload_header_text">'+a("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><table class="plupload_filelist"><tr class="ui-widget-header plupload_filelist_header"><td class="plupload_cell plupload_file_name">'+a("Filename")+'</td><td class="plupload_cell plupload_file_status">'+a("Status")+'</td><td class="plupload_cell plupload_file_size">'+a("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_scroll"><table class="plupload_filelist_content"></table></div><table class="plupload_filelist"><tr class="ui-widget-header ui-widget-content plupload_filelist_footer"><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+a("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+a("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+a("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div></div></div><input class="plupload_count" value="0" type="hidden"></div>')}var r={};n.widget("ui.plupload",{contents_bak:"",runtime:null,options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:!0,multiple_queues:!0,buttons:{browse:!0,start:!0,stop:!0},autostart:!1,sortable:!1,rename:!1,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var e,t,s=this;e=this.element.attr("id"),e||(e=i.guid(),this.element.attr("id",e)),this.id=e,this.contents_bak=this.element.html(),o(this.element),this.container=n(".plupload_container",this.element).attr("id",e+"_container"),this.filelist=n(".plupload_filelist_content",this.container).attr("id",e+"_filelist"),this.browse_button=n(".plupload_add",this.container).attr("id",e+"_browse"),this.start_button=n(".plupload_start",this.container).attr("id",e+"_start"),this.stop_button=n(".plupload_stop",this.container).attr("id",e+"_stop"),n.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"}}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}})),this.options.buttons.browse||(this.browse_button.button("disable").hide(),n("#"+e+s.runtime+"_container").hide()),this.options.buttons.start||this.start_button.button("disable").hide(),this.options.buttons.stop||this.stop_button.button("disable").hide(),this.progressbar=n(".plupload_progress_container",this.container),n.ui.progressbar&&this.progressbar.progressbar(),this.counter=n(".plupload_count",this.element).attr({id:e+"_count",name:e+"_count"}),t=this.uploader=r[e]=new i.Uploader(n.extend({container:e,browse_button:e+"_browse"},this.options)),t.bind("Init",function(e,i){!s.options.unique_names&&s.options.rename&&s._enableRenaming(),t.features.dragdrop&&s.options.dragdrop&&s._enableDragAndDrop(),s.container.attr("title",a("Using runtime: ")+(s.runtime=i.runtime)),s.start_button.click(function(e){n(this).button("option","disabled")||s.start(),e.preventDefault()}),s.stop_button.click(function(e){t.stop(),e.preventDefault()})}),s.options.max_file_count&&t.bind("FilesAdded",function(e,t){var i=t.length,n=[];i>s.options.max_file_count&&(n=t.splice(s.options.max_file_count),e.trigger("Error",{code:s.FILE_COUNT_ERROR,message:a("File count error."),file:n}))}),t.init(),t.bind("FilesAdded",function(e,t){s._trigger("selected",null,{up:e,files:t}),s.options.autostart&&s.start()}),t.bind("FilesRemoved",function(e,t){s._trigger("removed",null,{up:e,files:t})}),t.bind("QueueChanged",function(){s._updateFileList()}),t.bind("StateChanged",function(){s._handleState()}),t.bind("UploadFile",function(e,t){s._handleFileStatus(t)}),t.bind("FileUploaded",function(e,t){s._handleFileStatus(t),s._trigger("uploaded",null,{up:e,file:t})}),t.bind("UploadProgress",function(e,t){n("#"+t.id+" .plupload_file_status",s.element).html(t.percent+"%"),s._handleFileStatus(t),s._updateTotalProgress(),s._trigger("progress",null,{up:e,file:t})}),t.bind("UploadComplete",function(e,t){s._trigger("complete",null,{up:e,files:t})}),t.bind("Error",function(e,t){var n,o,r=t.file;if(r){if(n="<strong>"+t.message+"</strong>",o=t.details)n+=" <br /><i>"+t.details+"</i>";else{switch(t.code){case i.FILE_EXTENSION_ERROR:o=a("File: %s").replace("%s",r.name);break;case i.FILE_SIZE_ERROR:o=a("File: %f, size: %s, max file size: %m").replace(/%([fsm])/g,function(e,t){switch(t){case"f":return r.name;case"s":return r.size;case"m":return i.parseSize(s.options.max_file_size)}});break;case s.FILE_COUNT_ERROR:o=a("Upload element accepts only %d file(s) at a time. Extra files were stripped.").replace("%d",s.options.max_file_count);break;case i.IMAGE_FORMAT_ERROR:o=i.translate("Image format either wrong or not supported.");break;case i.IMAGE_MEMORY_ERROR:o=i.translate("Runtime ran out of available memory.");break;case i.IMAGE_DIMENSIONS_ERROR:o=i.translate("Resoultion out of boundaries! <b>%s</b> runtime supports images only up to %wx%hpx.").replace(/%([swh])/g,function(t,i){switch(i){case"s":return e.runtime;case"w":return e.features.maxWidth;case"h":return e.features.maxHeight}});break;case i.HTTP_ERROR:o=a("Upload URL might be wrong or doesn't exist")}n+=" <br /><i>"+o+"</i>"}s._notify("error",n)}})},_setOption:function(e,t){"buttons"==e&&"object"==typeof t&&(t=n.extend(this.options.buttons,t),t.browse?(this.browse_button.button("enable").show(),n("#"+this.id+self.runtime+"_container").show()):(this.browse_button.button("disable").hide(),n("#"+this.id+self.runtime+"_container").hide()),t.start?this.start_button.button("enable").show():this.start_button.button("disable").hide(),t.stop?this.start_button.button("enable").show():this.stop_button.button("disable").hide()),this.uploader.settings[e]=t},start:function(){this.uploader.start(),this._trigger("start",null)},stop:function(){this.uploader.stop(),this._trigger("stop",null)},getFile:function(e){var t;return t="number"==typeof e?this.uploader.files[e]:this.uploader.getFile(e)},removeFile:function(e){var t=this.getFile(e);t&&this.uploader.removeFile(t)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},_handleState:function(){var e=this,t=this.uploader;t.state===i.STARTED?(n(e.start_button).button("disable"),n([]).add(e.stop_button).add(".plupload_started").removeClass("plupload_hidden"),n(".plupload_upload_status",e.element).text(a("Uploaded %d/%d files").replace("%d/%d",t.total.uploaded+"/"+t.files.length)),n(".plupload_header_content",e.element).addClass("plupload_header_content_bw")):(n([]).add(e.stop_button).add(".plupload_started").addClass("plupload_hidden"),e.options.multiple_queues&&(n(e.start_button).button("enable"),n(".plupload_header_content",e.element).removeClass("plupload_header_content_bw")),e._updateFileList())},_handleFileStatus:function(e){var t,a;switch(e.status){case i.DONE:t="plupload_done",a="ui-icon ui-icon-circle-check";break;case i.FAILED:t="ui-state-error plupload_failed",a="ui-icon ui-icon-alert";break;case i.QUEUED:t="plupload_delete",a="ui-icon ui-icon-circle-minus";break;case i.UPLOADING:t="ui-state-highlight plupload_uploading",a="ui-icon ui-icon-circle-arrow-w";var o=n(".plupload_scroll",this.container),r=o.scrollTop(),s=o.height(),l=n("#"+e.id).position().top+n("#"+e.id).height();l>s&&o.scrollTop(r+l-s)}t+=" ui-state-default plupload_file",n("#"+e.id).attr("class",t).find(".ui-icon").attr("class",a)},_updateTotalProgress:function(){var e=this.uploader;this.progressbar.progressbar("value",e.total.percent),n(".plupload_total_status",this.element).html(e.total.percent+"%"),n(".plupload_upload_status",this.element).text(a("Uploaded %d/%d files").replace("%d/%d",e.total.uploaded+"/"+e.files.length)),e.total.uploaded===e.files.length&&e.stop()},_updateFileList:function(){var e,t,o=this,r=this.uploader,s=this.filelist,l=0,d=this.id+"_";n.ui.sortable&&this.options.sortable&&n("tbody",s).sortable("destroy"),s.empty(),n.each(r.files,function(a,u){t="",e=d+l,u.status===i.DONE&&(u.target_name&&(t+='<input type="hidden" name="'+e+'_tmpname" value="'+i.xmlEncode(u.target_name)+'" />'),t+='<input type="hidden" name="'+e+'_name" value="'+i.xmlEncode(u.name)+'" />',t+='<input type="hidden" name="'+e+'_status" value="'+(u.status===i.DONE?"done":"failed")+'" />',l++,o.counter.val(l)),s.append('<tr class="ui-state-default plupload_file" id="'+u.id+'"><td class="plupload_cell plupload_file_name"><span>'+u.name+'</span></td><td class="plupload_cell plupload_file_status">'+u.percent+'%</td><td class="plupload_cell plupload_file_size">'+i.formatSize(u.size)+'</td><td class="plupload_cell plupload_file_action"><div class="ui-icon"></div>'+t+"</td></tr>"),o._handleFileStatus(u),n("#"+u.id+".plupload_delete .ui-icon, #"+u.id+".plupload_done .ui-icon").click(function(e){n("#"+u.id).remove(),r.removeFile(u),e.preventDefault()}),o._trigger("updatelist",null,s)}),n(".plupload_total_file_size",o.element).html(i.formatSize(r.total.size)),n(".ui-button-text",o.browse_button).text(0===r.total.queued?a("Add Files"):a("%d files queued").replace("%d",r.total.queued)),o.start_button.button(r.files.length===r.total.uploaded+r.total.failed?"disable":"enable"),s[0].scrollTop=s[0].scrollHeight,o._updateTotalProgress(),!r.files.length&&r.features.dragdrop&&r.settings.dragdrop?n("#"+e+"_filelist").append('<tr><td class="plupload_droptext">'+a("Drag files here.")+"</td></tr>"):o.options.sortable&&n.ui.sortable&&o._enableSortingList()},_enableRenaming:function(){var e=this;n(".plupload_file_name span",this.filelist).live("click",function(t){var i,a,o,r=n(t.target),s="";i=e.uploader.getFile(r.parents("tr")[0].id),o=i.name,a=/^(.+)(\.[^.]+)$/.exec(o),a&&(o=a[1],s=a[2]),r.hide().after('<input class="plupload_file_rename" type="text" />'),r.next().val(o).focus().blur(function(){r.show().next().remove()}).keydown(function(e){var t=n(this);-1!==n.inArray(e.keyCode,[13,27])&&(e.preventDefault(),13===e.keyCode&&(i.name=t.val()+s,r.text(i.name)),t.blur())})})},_enableDragAndDrop:function(){this.filelist.append('<tr><td class="plupload_droptext">'+a("Drag files here.")+"</td></tr>"),this.filelist.parent().attr("id",this.id+"_dropbox"),this.uploader.settings.drop_element=this.options.drop_element=this.id+"_dropbox"},_enableSortingList:function(){var e,t=this;n("tbody tr",this.filelist).length<2||n("tbody",this.filelist).sortable({containment:"parent",items:".plupload_delete",helper:function(e,t){return t.clone(!0).find("td:not(.plupload_file_name)").remove().end().css("width","100%")},start:function(t,i){e=n("tr",this).index(i.item)},stop:function(i,a){var o,r,s,l=[],d=n("tr",this).index(a.item);for(o=0,r=t.uploader.files.length;r>o;o++)s=o===d?e:o===e?d:o,l[l.length]=t.uploader.files[s];l.unshift(l.length),l.unshift(0),Array.prototype.splice.apply(t.uploader.files,l)}})},_notify:function(e,t){var i=n('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+a("Close")+'"></span><p><span class="ui-icon"></span>'+t+"</p></div>");i.addClass("ui-state-"+("error"===e?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+("error"===e?"alert":"info")).end().find(".plupload_message_close").click(function(){i.remove()}).end().appendTo(".plupload_header_content",this.container)},destroy:function(){n(".plupload_button",this.element).unbind(),n.ui.button&&n(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy"),n.ui.progressbar&&this.progressbar.progressbar("destroy"),n.ui.sortable&&this.options.sortable&&n("tbody",this.filelist).sortable("destroy"),this.uploader.destroy(),this.element.empty().html(this.contents_bak),this.contents_bak="",n.Widget.prototype.destroy.apply(this)}})}(window,document,plupload,jQuery),this.JSON||(JSON={}),function(){function k(e){return 10>e?"0"+e:e}function n(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=q[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function l(e,t){var i,a,o,r=g,s=t[e];switch(s&&"object"==typeof s&&"function"==typeof s.toJSON&&(s=s.toJSON(e)),"function"==typeof j&&(s=j.call(t,e,s)),typeof s){case"string":return n(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(g+=m,o=[],"[object Array]"===Object.prototype.toString.apply(s)){for(a=s.length,e=0;a>e;e+=1)o[e]=l(e,s)||"null";return t=0===o.length?"[]":g?"[\n"+g+o.join(",\n"+g)+"\n"+r+"]":"["+o.join(",")+"]",g=r,t}if(j&&"object"==typeof j)for(a=j.length,e=0;a>e;e+=1)i=j[e],"string"==typeof i&&(t=l(i,s))&&o.push(n(i)+(g?": ":":")+t);else for(i in s)Object.hasOwnProperty.call(s,i)&&(t=l(i,s))&&o.push(n(i)+(g?": ":":")+t);return t=0===o.length?"{}":g?"{\n"+g+o.join(",\n"+g)+"\n"+r+"}":"{"+o.join(",")+"}",g=r,t}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+k(this.getUTCMonth()+1)+"-"+k(this.getUTCDate())+"T"+k(this.getUTCHours())+":"+k(this.getUTCMinutes())+":"+k(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var p=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,m,q={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var n;if(m=g="","number"==typeof i)for(n=0;i>n;n+=1)m+=" ";else"string"==typeof i&&(m=i);if((j=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return l("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a,c){function d(e,t){var i,n,a=e[t];if(a&&"object"==typeof a)for(i in a)Object.hasOwnProperty.call(a,i)&&(n=d(a,i),void 0!==n?a[i]=n:delete a[i]);return c.call(e,t,a)}if(p.lastIndex=0,p.test(a)&&(a=a.replace(p,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+a+")"),"function"==typeof c?d({"":a},""):a;throw new SyntaxError("JSON.parse")})}(),function(e){var t=function(){window.console&&console.log&&console.log(Array.prototype.slice.call(arguments))};e.widget("karl.karlmultifileupload",{options:{plupload_src:"",upload_url:""},_create:function(){var i=this;this.refreshNeeded=!1,this.reset_batch();var n="html5,gears,flash,silverlight,html4";e.browser.webkit&&(n="flash,gears,html4"),this.dialogSnippet=e('<div class="karl-multifileupload-dialog-content"><div class="uploader"><p>You browser doesn\'t have Flash, Silverlight, Gears, BrowserPlus or HTML5 support.</p></div></div>'),this.dialogSnippet.appendTo("body").hide().karldialog({width:800,open:function(){if(i.uploader){i._flash_closed&&(i._bind_uploader(n),i._flash_closed=!1,t("Flash uploader recreated"));var a=i.dialogSnippet.find(".plupload_header_content");if(!a.data("plupload_mogrified")){var o=a.css("background-image").replace(/"/g,"").replace(/url\(|\)$/gi,"");a.css("background-image","url()");var r=new Image;r.src=o;var s=e("<table></table>").insertBefore(a),l=e("<tr></tr>").appendTo(s),d=e('<td valign="middle"></td>').appendTo(l),u=e('<td valign="middle"></td>').appendTo(l);d.append(r),u.append(a),a.data("plupload_mogrified",!0)}i.uploader.refresh()}},close:function(n){"flash"==i.uploader.runtime&&(t("Destroying flash uploader"),i._flash_closed=!0,i.uploader.stop(),i.uploader.destroy(),i.plupload_widget.destroy(),setTimeout(function(){e(i.uploader.id+"_flash").remove()},10)),i._trigger("close",n,{refreshNeeded:i.refreshNeeded,runtime:i.uploader.runtime}),i.refreshNeeded=!1}}),this._bind_uploader(n)},_bind_uploader:function(i){var n=this;this.dialogSnippet.find(".uploader").plupload({runtimes:i,url:this.options.upload_url,max_file_size:"100mb",chunk_size:"5mb",multipart_params:{},flash_swf_url:this.options.plupload_src+"/js/plupload.flash.swf",silverlight_xap_url:this.options.plupload_src+"/js/plupload.silverlight.xap"}),this.plupload_widget=this.dialogSnippet.find(".uploader").data("plupload"),this.uploader=this.plupload_widget.uploader,this.dialogSnippet.find(".plupload_container").addClass("ui-corner-all"),this.cancelButton=e('<a class="plupload_start plupload_dialog_close">Close</a>'),this.cancelButton.insertAfter(this.dialogSnippet.find(".plupload_stop")).button({icons:{primary:"ui-icon-circle-close"}}).click(function(){n.close()}),this.uploader.bind("BeforeUpload",function(e,t){var i=e.settings.multipart_params;1==e.total.queued?i.end_batch=JSON.stringify(n.get_batch()):void 0!==i.end_batch&&delete i.end_batch,i.client_id=t.id}),this.uploader.bind("ChunkUploaded",function(e,t,i){n.checkResponse(e,t,i),n.refreshNeeded=!0}),this.uploader.bind("FileUploaded",function(e,t,i){n.checkResponse(e,t,i),n.refreshNeeded=!0}),this.uploader.bind("FilesAdded",function(i,a){"flash"==n.uploader.runtime&&e.each(a,function(){if(0===this.size){t("Zero-sized file problem, ignoring",this),n.plupload_widget.removeFile(this.id);var e="<strong>Cannot upload a zero-sized file: "+this.name+"</strong><br>";n.plupload_widget._notify("error",e)}})})},destroy:function(){this.dialogSnippet.karldialog("destroy"),this.uploader.stop(),this.uploader.destroy(),this.plupload_widget.destroy(),e.Widget.prototype.destroy.call(this)},open:function(){this.dialogSnippet.karldialog("open")},close:function(){this.dialogSnippet.karldialog("close")},position:function(e){return this.dialogSnippet.karldialog("position",e)},checkResponse:function(e,t,i){var n=JSON.parse(i.response);if(n.error){var a;a=n.client_id?e.getFile(n.client_id):t;var o="<strong>Error during upload of "+a.name+":</strong><br>"+n.error;this.plupload_widget._notify("error",o),a.status=plupload.FAILED,this.plupload_widget._handleFileStatus(a),this.uploader.stop(),this.reset_batch()}else n.batch_completed?this.reset_batch():this.add_to_batch(t.id)},reset_batch:function(){this._batch=[],this._batch_by_ids={}},get_batch:function(){return this._batch},add_to_batch:function(e){this._batch_by_ids[e]||(this._batch.push(e),this._batch_by_ids[e]=!0)}})}(jQuery);