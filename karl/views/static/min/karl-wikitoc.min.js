/*! 
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(d){d.fn.drag=function(i,e,h){var g=typeof i=="string"?i:"",f=d.isFunction(i)?i:d.isFunction(e)?e:null;if(g.indexOf("drag")!==0){g="drag"+g}h=(i==f?e:h)||{};return f?this.bind(g,h,f):this.trigger(g)};var b=d.event,a=b.special,c=a.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",livekey:"livedrag",add:function(g){var f=d.data(this,c.datakey),e=g.data||{};f.related+=1;if(!f.live&&g.selector){f.live=true;b.add(this,"draginit."+c.livekey,c.delegate)}d.each(c.defaults,function(h,i){if(e[h]!==undefined){f[h]=e[h]}})},remove:function(){d.data(this,c.datakey).related-=1},setup:function(){if(d.data(this,c.datakey)){return}var e=d.extend({related:0},c.defaults);d.data(this,c.datakey,e);b.add(this,"mousedown",c.init,e);if(this.attachEvent){this.attachEvent("ondragstart",c.dontstart)}},teardown:function(){if(d.data(this,c.datakey).related){return}d.removeData(this,c.datakey);b.remove(this,"mousedown",c.init);b.remove(this,"draginit",c.delegate);c.textselect(true);if(this.detachEvent){this.detachEvent("ondragstart",c.dontstart)}},init:function(g){var e=g.data,f;if(e.which>0&&g.which!=e.which){return}if(d(g.target).is(e.not)){return}if(e.handle&&!d(g.target).closest(e.handle,g.currentTarget).length){return}e.propagates=1;e.interactions=[c.interaction(this,e)];e.target=g.target;e.pageX=g.pageX;e.pageY=g.pageY;e.dragging=null;f=c.hijack(g,"draginit",e);if(!e.propagates){return}f=c.flatten(f);if(f&&f.length){e.interactions=[];d.each(f,function(){e.interactions.push(c.interaction(this,e))})}e.propagates=e.interactions.length;if(e.drop!==false&&a.drop){a.drop.handler(g,e)}c.textselect(false);b.add(document,"mousemove mouseup",c.handler,e);return false},interaction:function(f,e){return{drag:f,callback:new c.callback(),droppable:[],offset:d(f)[e.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(f){var e=f.data;switch(f.type){case !e.dragging&&"mousemove":if(Math.pow(f.pageX-e.pageX,2)+Math.pow(f.pageY-e.pageY,2)<Math.pow(e.distance,2)){break}f.target=e.target;c.hijack(f,"dragstart",e);if(e.propagates){e.dragging=true}case"mousemove":if(e.dragging){c.hijack(f,"drag",e);if(e.propagates){if(e.drop!==false&&a.drop){a.drop.handler(f,e)}break}f.type="mouseup"}case"mouseup":b.remove(document,"mousemove mouseup",c.handler);if(e.dragging){if(e.drop!==false&&a.drop){a.drop.handler(f,e)}c.hijack(f,"dragend",e)}c.textselect(true);if(e.click===false&&e.dragging){jQuery.event.triggered=true;setTimeout(function(){jQuery.event.triggered=false},20);e.dragging=false}break}},delegate:function(g){var e=[],h,f=d.data(this,"events")||{};d.each(f.live||[],function(j,k){if(k.preType.indexOf("drag")!==0){return}h=d(g.target).closest(k.selector,g.currentTarget)[0];if(!h){return}b.add(h,k.origType+"."+c.livekey,k.origHandler,k.data);if(d.inArray(h,e)<0){e.push(h)}});if(!e.length){return false}return d(e).bind("dragend."+c.livekey,function(){b.remove(this,"."+c.livekey)})},hijack:function(f,m,p,n,h){if(!p){return}var o={event:f.originalEvent,type:f.type},k=m.indexOf("drop")?"drag":"drop",r,j=n||0,g,e,q,l=!isNaN(n)?n:p.interactions.length;f.type=m;f.originalEvent=null;p.results=[];do{if(g=p.interactions[j]){if(m!=="dragend"&&g.cancelled){continue}q=c.properties(f,p,g);g.results=[];d(h||g[k]||p.droppable).each(function(s,i){q.target=i;r=i?b.handle.call(i,f,q):null;if(r===false){if(k=="drag"){g.cancelled=true;p.propagates-=1}if(m=="drop"){g[k][s]=null}}else{if(m=="dropinit"){g.droppable.push(c.element(r)||i)}}if(m=="dragstart"){g.proxy=d(c.element(r)||g.drag)[0]}g.results.push(r);delete f.result;if(m!=="dropinit"){return r}});p.results[j]=c.flatten(g.results);if(m=="dropinit"){g.droppable=c.flatten(g.droppable)}if(m=="dragstart"&&!g.cancelled){q.update()}}}while(++j<l);f.type=o.type;f.originalEvent=o.event;return c.flatten(p.results)},properties:function(g,e,f){var h=f.callback;h.drag=f.drag;h.proxy=f.proxy||f.drag;h.startX=e.pageX;h.startY=e.pageY;h.deltaX=g.pageX-e.pageX;h.deltaY=g.pageY-e.pageY;h.originalX=f.offset.left;h.originalY=f.offset.top;h.offsetX=g.pageX-(e.pageX-h.originalX);h.offsetY=g.pageY-(e.pageY-h.originalY);h.drop=c.flatten((f.drop||[]).slice());h.available=c.flatten((f.droppable||[]).slice());return h},element:function(e){if(e&&(e.jquery||e.nodeType==1)){return e}},flatten:function(e){return d.map(e,function(f){return f&&f.jquery?d.makeArray(f):f&&f.length?c.flatten(f):f})},textselect:function(e){var f=d(document)[e?"unbind":"bind"]("selectstart",c.dontstart);if(f.length==1&&f[0]==document){return}f.attr("unselectable",e?"off":"on").css("MozUserSelect",e?"":"none")},dontstart:function(){return false},callback:function(){}};c.callback.prototype={update:function(){if(a.drop&&this.available.length){d.each(this.available,function(e){a.drop.locate(this,e)})}}};a.draginit=a.dragstart=a.dragend=c})(jQuery);
/*! 
 * jquery.event.drop - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(e){e.fn.drop=function(j,b,i){var f=typeof j=="string"?j:"",h=e.isFunction(j)?j:e.isFunction(b)?b:null;if(f.indexOf("drop")!==0){f="drop"+f}i=(j==h?b:i)||{};return h?this.bind(f,i,h):this.trigger(f)};e.drop=function(b){b=b||{};a.multi=b.multi===true?Infinity:b.multi===false?1:!isNaN(b.multi)?b.multi:a.multi;a.delay=b.delay||a.delay;a.tolerance=e.isFunction(b.tolerance)?b.tolerance:b.tolerance===null?null:a.tolerance;a.mode=b.mode||a.mode||"intersect"};var c=e.event,d=c.special,a=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",livekey:"livedrop",add:function(f){var b=e.data(this,a.datakey);b.related+=1;if(!b.live&&f.selector){b.live=true;c.add(this,"dropinit."+a.livekey,a.delegate)}},remove:function(){e.data(this,a.datakey).related-=1},setup:function(){if(!e.data(this,a.datakey)){e.data(this,a.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}});a.targets.push(this)}},teardown:function(){if(!e.data(this,a.datakey).related){e.removeData(this,a.datakey);c.remove(this,"dropinit",a.delegate);var b=this;a.targets=e.grep(a.targets,function(f){return f!==b})}},handler:function(g,b){var f;if(b){switch(g.type){case"mousedown":f=e(a.targets);if(typeof b.drop=="string"){f=f.filter(b.drop)}f.each(function(){var h=e.data(this,a.datakey);h.active=[];h.anyactive=0;h.winner=0});b.droppable=f;a.delegates=[];d.drag.hijack(g,"dropinit",b);a.delegates=e.unique(d.drag.flatten(a.delegates));break;case"mousemove":a.event=g;a.timer||a.tolerate(b);break;case"mouseup":a.timer=clearTimeout(a.timer);if(b.propagates){d.drag.hijack(g,"drop",b);d.drag.hijack(g,"dropend",b);e.each(a.delegates||[],function(){c.remove(this,"."+a.livekey)})}break}}},delegate:function(i){var b=[],h,f=e.data(this,"events")||{};e.each(f.live||[],function(j,g){if(g.preType.indexOf("drop")===0){h=e(i.currentTarget).find(g.selector);h.length&&h.each(function(){c.add(this,g.origType+"."+a.livekey,g.origHandler,g.data);e.inArray(this,b)<0&&b.push(this)})}});a.delegates.push(b);return b.length?e(b):false},locate:function(l,b){var k=e.data(l,a.datakey),i=e(l),j=i.offset()||{},f=i.outerHeight();i=i.outerWidth();j={elem:l,width:i,height:f,top:j.top,left:j.left,right:j.left+i,bottom:j.top+f};if(k){k.location=j;k.index=b;k.elem=l}return j},contains:function(f,b){return(b[0]||b.left)>=f.left&&(b[0]||b.right)<=f.right&&(b[1]||b.top)>=f.top&&(b[1]||b.bottom)<=f.bottom},modes:{intersect:function(g,b,f){return this.contains(f,[g.pageX,g.pageY])?1000000000:this.modes.overlap.apply(this,arguments)},overlap:function(g,b,f){return Math.max(0,Math.min(f.bottom,b.bottom)-Math.max(f.top,b.top))*Math.max(0,Math.min(f.right,b.right)-Math.max(f.left,b.left))},fit:function(g,b,f){return this.contains(f,b)?1:0},middle:function(g,b,f){return this.contains(f,[b.left+b.width*0.5,b.top+b.height*0.5])?1:0}},sort:function(f,b){return b.winner-f.winner||f.index-b.index},tolerate:function(w){var x,v,t,u,s,l,r=0,q,b=w.interactions.length,i=[a.event.pageX,a.event.pageY],f=a.tolerance||a.modes[a.mode];do{if(q=w.interactions[r]){if(!q){return}q.drop=[];s=[];l=q.droppable.length;if(f){t=a.locate(q.proxy)}x=0;do{if(v=q.droppable[x]){u=e.data(v,a.datakey);if(v=u.location){u.winner=f?f.call(a,a.event,t,v):a.contains(v,i)?1:0;s.push(u)}}}while(++x<l);s.sort(a.sort);x=0;do{if(u=s[x]){if(u.winner&&q.drop.length<a.multi){if(!u.active[r]&&!u.anyactive){if(d.drag.hijack(a.event,"dropstart",w,r,u.elem)[0]!==false){u.active[r]=1;u.anyactive+=1}else{u.winner=0}}u.winner&&q.drop.push(u.elem)}else{if(u.active[r]&&u.anyactive==1){d.drag.hijack(a.event,"dropend",w,r,u.elem);u.active[r]=0;u.anyactive-=1}}}}while(++x<l)}}while(++r<b);if(a.last&&i[0]==a.last.pageX&&i[1]==a.last.pageY){delete a.timer}else{a.timer=setTimeout(function(){a.tolerate(w)},a.delay)}a.last=a.event}};d.dropinit=d.dropstart=d.dropend=a})(jQuery);(function(g){g.extend(true,window,{Slick:{Event:b,EventData:e,Range:h,NonDataRow:d,Group:c,GroupTotals:a,EditorLock:f,GlobalEditorLock:new f()}});function e(){var i=false;var j=false;this.stopPropagation=function(){i=true};this.isPropagationStopped=function(){return i};this.stopImmediatePropagation=function(){j=true};this.isImmediatePropagationStopped=function(){return j}}function b(){var i=[];this.subscribe=function(j){i.push(j)};this.unsubscribe=function(k){for(var j=i.length-1;j>=0;j--){if(i[j]===k){i.splice(j,1)}}};this.notify=function(j,n,m){n=n||new e();m=m||this;var l;for(var k=0;k<i.length&&!(n.isPropagationStopped()||n.isImmediatePropagationStopped());k++){l=i[k].call(m,n,j)}return l}}function h(j,i,k,l){if(k===undefined&&l===undefined){k=j;l=i}this.fromRow=Math.min(j,k);this.fromCell=Math.min(i,l);this.toRow=Math.max(j,k);this.toCell=Math.max(i,l);this.isSingleRow=function(){return this.fromRow==this.toRow};this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell};this.contains=function(n,m){return n>=this.fromRow&&n<=this.toRow&&m>=this.fromCell&&m<=this.toCell};this.toString=function(){if(this.isSingleCell()){return"("+this.fromRow+":"+this.fromCell+")"}else{return"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}}function d(){this.__nonDataRow=true}function c(){this.__group=true;this.__updated=false;this.count=0;this.value=null;this.title=null;this.collapsed=false;this.totals=null}c.prototype=new d();c.prototype.equals=function(i){return this.value===i.value&&this.count===i.count&&this.collapsed===i.collapsed};function a(){this.__groupTotals=true;this.group=null}a.prototype=new d();function f(){var i=null;this.isActive=function(k){return(k?i===k:i!==null)};this.activate=function(k){if(k===i){return}if(i!==null){throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController"}if(!k.commitCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()"}if(!k.cancelCurrentEdit){throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()"}i=k};this.deactivate=function(k){if(i!==k){throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one"}i=null};this.commitCurrentEdit=function(){return(i?i.commitCurrentEdit():true)};this.cancelCurrentEdit=function j(){return(i?i.cancelCurrentEdit():true)}}})(jQuery);if(typeof jQuery==="undefined"){throw"SlickGrid requires jquery module to be loaded"}if(!jQuery.fn.drag){throw"SlickGrid requires jquery.event.drag module to be loaded"}if(typeof Slick==="undefined"){throw"slick.core.js not loaded"}(function($){$.extend(true,window,{Slick:{Grid:SlickGrid}});var scrollbarDimensions;function SlickGrid(container,data,columns,options){var defaults={headerHeight:25,rowHeight:25,defaultColumnWidth:80,enableAddRow:false,leaveSpaceForNewRows:false,editable:false,autoEdit:true,enableCellNavigation:true,enableCellRangeSelection:false,enableColumnReorder:true,asyncEditorLoading:false,asyncEditorLoadDelay:100,forceFitColumns:false,enableAsyncPostRender:false,asyncPostRenderDelay:60,autoHeight:false,editorLock:Slick.GlobalEditorLock,showHeaderRow:false,headerRowHeight:25,showTopPanel:false,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:true,enableTextSelectionOnCells:false};var columnDefaults={name:"",resizable:true,sortable:false,minWidth:30,rerenderOnResize:false,headerCssClass:null};var maxSupportedCssHeight;var th;var h;var ph;var n;var cj;var page=0;var offset=0;var scrollDir=1;var $container;var uid="slickgrid_"+Math.round(1000000*Math.random());var self=this;var $headerScroller;var $headers;var $headerRow,$headerRowScroller;var $topPanelScroller;var $topPanel;var $viewport;var $canvas;var $style;var stylesheet;var viewportH,viewportW;var viewportHasHScroll;var headerColumnWidthDiff,headerColumnHeightDiff,cellWidthDiff,cellHeightDiff;var absoluteColumnMinWidth;var activePosX;var activeRow,activeCell;var activeCellNode=null;var currentEditor=null;var serializedEditorValue;var editController;var rowsCache={};var renderedRows=0;var numVisibleRows;var prevScrollTop=0;var scrollTop=0;var lastRenderedScrollTop=0;var prevScrollLeft=0;var avgRowRenderTime=10;var selectionModel;var selectedRows=[];var plugins=[];var cellCssClasses={};var columnsById={};var sortColumnId;var sortAsc=true;var h_editorLoader=null;var h_render=null;var h_postrender=null;var postProcessedRows={};var postProcessToRow=null;var postProcessFromRow=null;var counter_rows_rendered=0;var counter_rows_removed=0;function init(){$container=$(container);if($container.length<1){throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.")}maxSupportedCssHeight=getMaxSupportedCssHeight();scrollbarDimensions=scrollbarDimensions||measureScrollbar();options=$.extend({},defaults,options);columnDefaults.width=options.defaultColumnWidth;if(options.enableColumnReorder&&!$.fn.sortable){throw new Error('SlickGrid\'s "enableColumnReorder = true" option requires jquery-ui.sortable module to be loaded')}editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit};$container.empty().attr("tabIndex",0).attr("hideFocus",true).css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget");if(!/relative|absolute|fixed/.test($container.css("position"))){$container.css("position","relative")}$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headers=$("<div class='slick-header-columns' style='width:10000px; left:-1000px' />").appendTo($headerScroller);$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$headerRow=$("<div class='slick-headerrow-columns' style='width:10000px;' />").appendTo($headerRowScroller);$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container);$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller);if(!options.showTopPanel){$topPanelScroller.hide()}if(!options.showHeaderRow){$headerRowScroller.hide()}$viewport=$("<div class='slick-viewport' tabIndex='0' hideFocus style='width:100%;overflow-x:auto;outline:0;position:relative;overflow-y:auto;'>").appendTo($container);$canvas=$("<div class='grid-canvas' tabIndex='0' hideFocus />").appendTo($viewport);measureCellPaddingAndBorder();disableSelection($headers);if(!options.enableTextSelectionOnCells){$viewport.bind("selectstart.ui",function(event){return $(event.target).is("input,textarea")})}viewportW=parseFloat($.css($container[0],"width",true));createColumnHeaders();setupColumnSort();createCssRules();resizeAndRender();bindAncestorScrollEvents();$viewport.bind("scroll.slickgrid",handleScroll);$container.bind("resize.slickgrid",resizeAndRender);$headerScroller.bind("contextmenu.slickgrid",handleHeaderContextMenu).bind("click.slickgrid",handleHeaderClick);$canvas.bind("keydown.slickgrid",handleKeyDown).bind("click.slickgrid",handleClick).bind("dblclick.slickgrid",handleDblClick).bind("contextmenu.slickgrid",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd);$canvas.delegate(".slick-cell","mouseenter",handleMouseEnter);$canvas.delegate(".slick-cell","mouseleave",handleMouseLeave)}function registerPlugin(plugin){plugins.unshift(plugin);plugin.init(self)}function unregisterPlugin(plugin){for(var i=plugins.length;i>=0;i--){if(plugins[i]===plugin){if(plugins[i].destroy){plugins[i].destroy()}plugins.splice(i,1);break}}}function setSelectionModel(model){if(selectionModel){selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged);if(selectionModel.destroy){selectionModel.destroy()}}selectionModel=model;selectionModel.init(self);selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged)}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var $c=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");var dim={width:$c.width()-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};$c.remove();return dim}function getRowWidth(){var rowWidth=0;var i=columns.length;while(i--){rowWidth+=(columns[i].width||columnDefaults.width)}return rowWidth}function setCanvasWidth(width){$canvas.width(width);viewportHasHScroll=(width>viewportW-scrollbarDimensions.width)}function disableSelection($target){if($target&&$target.jquery){$target.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}}function getMaxSupportedCssHeight(){var increment=1000000;var supportedHeight=increment;var testUpTo=($.browser.mozilla)?5000000:1000000000;var div=$("<div style='display:none' />").appendTo(document.body);while(supportedHeight<=testUpTo){div.css("height",supportedHeight+increment);if(div.height()!==supportedHeight+increment){break}else{supportedHeight+=increment}}div.remove();return supportedHeight}function bindAncestorScrollEvents(){var elem=$canvas[0];while((elem=elem.parentNode)!=document.body){if(elem==$viewport[0]||elem.scrollWidth!=elem.clientWidth||elem.scrollHeight!=elem.clientHeight){$(elem).bind("scroll.slickgrid",handleActiveCellPositionChange)}}}function unbindAncestorScrollEvents(){$canvas.parents().unbind("scroll.slickgrid")}function updateColumnHeader(columnId,title,toolTip){var idx=getColumnIndex(columnId);var $header=$headers.children().eq(idx);if($header){columns[idx].name=title;columns[idx].toolTip=toolTip;$header.attr("title",toolTip||title||"").children().eq(0).html(title)}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(columnId){var idx=getColumnIndex(columnId);var $header=$headerRow.children().eq(idx);return $header&&$header[0]}function createColumnHeaders(){var i;function hoverBegin(){$(this).addClass("ui-state-hover")}function hoverEnd(){$(this).removeClass("ui-state-hover")}$headers.empty();$headerRow.empty();columnsById={};for(i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i;var header=$("<div class='ui-state-default slick-header-column' id='"+uid+m.id+"' />").html("<span class='slick-column-name'>"+m.name+"</span>").width(m.width-headerColumnWidthDiff).attr("title",m.toolTip||m.name||"").data("fieldId",m.id).addClass(m.headerCssClass||"").appendTo($headers);if(options.enableColumnReorder||m.sortable){header.hover(hoverBegin,hoverEnd)}if(m.sortable){header.append("<span class='slick-sort-indicator' />")}if(options.showHeaderRow){$("<div class='ui-state-default slick-headerrow-column c"+i+"'></div>").appendTo($headerRow)}}setSortColumn(sortColumnId,sortAsc);setupColumnResize();if(options.enableColumnReorder){setupColumnReorder()}}function setupColumnSort(){$headers.click(function(e){if($(e.target).hasClass("slick-resizable-handle")){return}var $col=$(e.target).closest(".slick-header-column");if(!$col.length){return}var column=columns[getColumnIndex($col.data("fieldId"))];if(column.sortable){if(!getEditorLock().commitCurrentEdit()){return}if(column.id===sortColumnId){sortAsc=!sortAsc}else{sortColumnId=column.id;sortAsc=true}setSortColumn(sortColumnId,sortAsc);trigger(self.onSort,{sortCol:column,sortAsc:sortAsc})}})}function setupColumnReorder(){$headers.sortable({containment:"parent",axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:true,start:function(e,ui){$(ui.helper).addClass("slick-header-column-active")},beforeStop:function(e,ui){$(ui.helper).removeClass("slick-header-column-active")},stop:function(e){if(!getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}var reorderedIds=$headers.sortable("toArray");var reorderedColumns=[];for(var i=0;i<reorderedIds.length;i++){reorderedColumns.push(columns[getColumnIndex(reorderedIds[i].replace(uid,""))])}setColumns(reorderedColumns);trigger(self.onColumnsReordered,{});e.stopPropagation();setupColumnResize()}})}function setupColumnResize(){var $col,j,c,pageX,columnElements,minPageX,maxPageX,firstResizable,lastResizable,originalCanvasWidth;columnElements=$headers.children();columnElements.find(".slick-resizable-handle").remove();columnElements.each(function(i,e){if(columns[i].resizable){if(firstResizable===undefined){firstResizable=i}lastResizable=i}});if(firstResizable===undefined){return}columnElements.each(function(i,e){if(i<firstResizable||(options.forceFitColumns&&i>=lastResizable)){return}$col=$(e);$("<div class='slick-resizable-handle' />").appendTo(e).bind("dragstart",function(e,dd){if(!getEditorLock().commitCurrentEdit()){return false}pageX=e.pageX;$(this).parent().addClass("slick-header-column-active");var shrinkLeewayOnRight=null,stretchLeewayOnRight=null;columnElements.each(function(i,e){columns[i].previousWidth=$(e).outerWidth()});if(options.forceFitColumns){shrinkLeewayOnRight=0;stretchLeewayOnRight=0;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnRight!==null){if(c.maxWidth){stretchLeewayOnRight+=c.maxWidth-c.previousWidth}else{stretchLeewayOnRight=null}}shrinkLeewayOnRight+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}}var shrinkLeewayOnLeft=0,stretchLeewayOnLeft=0;for(j=0;j<=i;j++){c=columns[j];if(c.resizable){if(stretchLeewayOnLeft!==null){if(c.maxWidth){stretchLeewayOnLeft+=c.maxWidth-c.previousWidth}else{stretchLeewayOnLeft=null}}shrinkLeewayOnLeft+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth)}}if(shrinkLeewayOnRight===null){shrinkLeewayOnRight=100000}if(shrinkLeewayOnLeft===null){shrinkLeewayOnLeft=100000}if(stretchLeewayOnRight===null){stretchLeewayOnRight=100000}if(stretchLeewayOnLeft===null){stretchLeewayOnLeft=100000}maxPageX=pageX+Math.min(shrinkLeewayOnRight,stretchLeewayOnLeft);minPageX=pageX-Math.min(shrinkLeewayOnLeft,stretchLeewayOnRight);originalCanvasWidth=$canvas.width()}).bind("drag",function(e,dd){var actualMinWidth,d=Math.min(maxPageX,Math.max(minPageX,e.pageX))-pageX,x,ci;if(d<0){x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}}else{if(options.syncColumnCellResize){setCanvasWidth(originalCanvasWidth+d)}}}else{x=d;for(j=i;j>=0;j--){c=columns[j];if(c.resizable){if(x&&c.maxWidth&&(c.maxWidth-c.previousWidth<x)){x-=c.maxWidth-c.previousWidth;c.width=c.maxWidth}else{c.width=c.previousWidth+x;x=0}}}if(options.forceFitColumns){x=-d;for(j=i+1;j<columnElements.length;j++){c=columns[j];if(c.resizable){actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth);if(x&&c.previousWidth+x<actualMinWidth){x+=c.previousWidth-actualMinWidth;c.width=actualMinWidth}else{c.width=c.previousWidth+x;x=0}}}}else{if(options.syncColumnCellResize){setCanvasWidth(originalCanvasWidth+d)}}}applyColumnHeaderWidths();if(options.syncColumnCellResize){applyColumnWidths()}}).bind("dragend",function(e,dd){var newWidth;$(this).parent().removeClass("slick-header-column-active");for(j=0;j<columnElements.length;j++){c=columns[j];newWidth=$(columnElements[j]).outerWidth();if(c.previousWidth!==newWidth&&c.rerenderOnResize){invalidateAllRows()}}applyColumnWidths();resizeCanvas();trigger(self.onColumnsResized,{})})})}function getVBoxDelta($el){var p=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];var delta=0;$.each(p,function(n,val){delta+=parseFloat($el.css(val))||0});return delta}function measureCellPaddingAndBorder(){var el;var h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"];var v=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];el=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers);headerColumnWidthDiff=headerColumnHeightDiff=0;$.each(h,function(n,val){headerColumnWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){headerColumnHeightDiff+=parseFloat(el.css(val))||0});el.remove();var r=$("<div class='slick-row' />").appendTo($canvas);el=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(r);cellWidthDiff=cellHeightDiff=0;$.each(h,function(n,val){cellWidthDiff+=parseFloat(el.css(val))||0});$.each(v,function(n,val){cellHeightDiff+=parseFloat(el.css(val))||0});r.remove();absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));var rowHeight=(options.rowHeight-cellHeightDiff);var rules=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+rowHeight+"px; }","."+uid+" .slick-row { width:"+getRowWidth()+"px; }","."+uid+" .lr { float:none; position:absolute; }"];var rowWidth=getRowWidth();var x=0,w;for(var i=0;i<columns.length;i++){w=columns[i].width;rules.push("."+uid+" .l"+i+" { left: "+x+"px; }");rules.push("."+uid+" .r"+i+" { right: "+(rowWidth-x-w)+"px; }");rules.push("."+uid+" .c"+i+" { width:"+(w-cellWidthDiff)+"px; }");x+=columns[i].width}if($style[0].styleSheet){$style[0].styleSheet.cssText=rules.join(" ")}else{$style[0].appendChild(document.createTextNode(rules.join(" ")))}var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){if((sheets[i].ownerNode||sheets[i].owningElement)==$style[0]){stylesheet=sheets[i];break}}}function findCssRule(selector){var rules=(stylesheet.cssRules||stylesheet.rules);for(var i=0;i<rules.length;i++){if(rules[i].selectorText==selector){return rules[i]}}return null}function removeCssRules(){$style.remove()}function destroy(){getEditorLock().cancelCurrentEdit();trigger(self.onBeforeDestroy,{});for(var i=0;i<plugins.length;i++){unregisterPlugin(plugins[i])}if(options.enableColumnReorder&&$headers.sortable){$headers.sortable("destroy")}unbindAncestorScrollEvents();$container.unbind(".slickgrid");removeCssRules();$canvas.unbind("draginit dragstart dragend drag");$container.empty().removeClass(uid)}function trigger(evt,args,e){e=e||new Slick.EventData();args=args||{};args.grid=self;return evt.notify(args,e,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(id){return columnsById[id]}function autosizeColumns(){var i,c,widths=[],shrinkLeeway=0,availWidth=(options.autoHeight?viewportW:viewportW-scrollbarDimensions.width),total=0,existingTotal=0;for(i=0;i<columns.length;i++){c=columns[i];widths.push(c.width);existingTotal+=c.width;shrinkLeeway+=c.width-Math.max(c.minWidth||0,absoluteColumnMinWidth)}total=existingTotal;invalidateAllRows();while(total>availWidth){if(!shrinkLeeway){return}var shrinkProportion=(total-availWidth)/shrinkLeeway;for(i=0;i<columns.length&&total>availWidth;i++){c=columns[i];if(!c.resizable||c.minWidth===c.width||c.width===absoluteColumnMinWidth){continue}var shrinkSize=Math.floor(shrinkProportion*(c.width-Math.max(c.minWidth||0,absoluteColumnMinWidth)))||1;total-=shrinkSize;widths[i]-=shrinkSize}}var previousTotal=total;while(total<availWidth){var growProportion=availWidth/total;for(i=0;i<columns.length&&total<availWidth;i++){c=columns[i];if(!c.resizable||c.maxWidth<=c.width){continue}var growSize=Math.min(Math.floor(growProportion*c.width)-c.width,(c.maxWidth-c.width)||1000000)||1;total+=growSize;widths[i]+=growSize}if(previousTotal==total){break}previousTotal=total}for(i=0;i<columns.length;i++){columns[i].width=widths[i]}applyColumnHeaderWidths();applyColumnWidths();resizeCanvas()}function applyColumnHeaderWidths(){var h;for(var i=0,headers=$headers.children(),ii=headers.length;i<ii;i++){h=$(headers[i]);if(h.width()!==columns[i].width-headerColumnWidthDiff){h.width(columns[i].width-headerColumnWidthDiff)}}}function applyColumnWidths(){var rowWidth=getRowWidth();var x=0,w,rule;for(var i=0;i<columns.length;i++){w=columns[i].width;rule=findCssRule("."+uid+" .c"+i);rule.style.width=(w-cellWidthDiff)+"px";rule=findCssRule("."+uid+" .l"+i);rule.style.left=x+"px";rule=findCssRule("."+uid+" .r"+i);rule.style.right=(rowWidth-x-w)+"px";x+=columns[i].width}rule=findCssRule("."+uid+" .slick-row");rule.style.width=rowWidth+"px"}function setSortColumn(columnId,ascending){sortColumnId=columnId;sortAsc=ascending;var columnIndex=getColumnIndex(sortColumnId);$headers.children().removeClass("slick-header-column-sorted");$headers.find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc");if(columnIndex!=null){$headers.children().eq(columnIndex).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")}}function handleSelectedRangesChanged(e,ranges){selectedRows=[];var hash={};for(var i=0;i<ranges.length;i++){for(var j=ranges[i].fromRow;j<=ranges[i].toRow;j++){if(!hash[j]){selectedRows.push(j)}hash[j]={};for(var k=ranges[i].fromCell;k<=ranges[i].toCell;k++){if(canCellBeSelected(j,k)){hash[j][columns[k].id]=options.selectedCellCssClass}}}}setCellCssStyles(options.selectedCellCssClass,hash);trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},e)}function getColumns(){return columns}function setColumns(columnDefinitions){columns=columnDefinitions;invalidateAllRows();createColumnHeaders();removeCssRules();createCssRules();resizeAndRender();handleScroll()}function getOptions(){return options}function setOptions(args){if(!getEditorLock().commitCurrentEdit()){return}makeActiveCellNormal();if(options.enableAddRow!==args.enableAddRow){invalidateRow(getDataLength())}options=$.extend(options,args);render()}function setData(newData,scrollToTop){invalidateAllRows();data=newData;if(scrollToTop){scrollTo(0)}}function getData(){return data}function getDataLength(){if(data.getLength){return data.getLength()}else{return data.length}}function getDataItem(i){if(data.getItem){return data.getItem(i)}else{return data[i]}}function getTopPanel(){return $topPanel[0]}function showTopPanel(){options.showTopPanel=true;$topPanelScroller.slideDown("fast",resizeCanvas)}function hideTopPanel(){options.showTopPanel=false;$topPanelScroller.slideUp("fast",resizeCanvas)}function showHeaderRowColumns(){options.showHeaderRow=true;$headerRowScroller.slideDown("fast",resizeCanvas)}function hideHeaderRowColumns(){options.showHeaderRow=false;$headerRowScroller.slideUp("fast",resizeCanvas)}function scrollTo(y){var oldOffset=offset;page=Math.min(n-1,Math.floor(y/ph));offset=Math.round(page*cj);var newScrollTop=y-offset;if(offset!=oldOffset){var range=getVisibleRange(newScrollTop);cleanupRows(range.top,range.bottom);updateRowPositions()}if(prevScrollTop!=newScrollTop){scrollDir=(prevScrollTop+oldOffset<newScrollTop+offset)?1:-1;$viewport[0].scrollTop=(lastRenderedScrollTop=scrollTop=prevScrollTop=newScrollTop);trigger(self.onViewportChanged,{})}}function defaultFormatter(row,cell,value,columnDef,dataContext){return(value===null||value===undefined)?"":value}function getFormatter(row,column){var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnOverrides=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[column.id]||rowMetadata.columns[getColumnIndex(column.id)]);return(columnOverrides&&columnOverrides.formatter)||(rowMetadata&&rowMetadata.formatter)||column.formatter||(options.formatterFactory&&options.formatterFactory.getFormatter(column))||defaultFormatter}function getEditor(row,cell){var column=columns[cell];var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[column.id]&&columnMetadata[column.id].editor!==undefined){return columnMetadata[column.id].editor}if(columnMetadata&&columnMetadata[cell]&&columnMetadata[cell].editor!==undefined){return columnMetadata[cell].editor}return column.editor||(options.editorFactory&&options.editorFactory.getEditor(column))}function appendRowHtml(stringArray,row){var d=getDataItem(row);var dataLoading=row<getDataLength()&&!d;var cellCss;var rowCss="slick-row "+(dataLoading?" loading":"")+(row%2==1?" odd":" even");var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(metadata&&metadata.cssClasses){rowCss+=" "+metadata.cssClasses}stringArray.push("<div class='ui-widget-content "+rowCss+"' row='"+row+"' style='top:"+(options.rowHeight*row-offset)+"px'>");var colspan;var rowHasColumnData=metadata&&metadata.columns;for(var i=0,cols=columns.length;i<cols;i++){var m=columns[i];colspan=getColspan(row,i);if(true||rowHasColumnData){cellCss="slick-cell lr l"+i+" r"+Math.min(columns.length-1,i+colspan-1)+(m.cssClass?" "+m.cssClass:"")}else{cellCss="slick-cell c"+i+(m.cssClass?" "+m.cssClass:"")}if(row===activeRow&&i===activeCell){cellCss+=(" active")}for(var key in cellCssClasses){if(cellCssClasses[key][row]&&cellCssClasses[key][row][m.id]){cellCss+=(" "+cellCssClasses[key][row][m.id])}}stringArray.push("<div class='"+cellCss+"'>");if(d){stringArray.push(getFormatter(row,m)(row,i,d[m.field],m,d))}stringArray.push("</div>");if(colspan){i+=(colspan-1)}}stringArray.push("</div>")}function cleanupRows(rangeToKeep){for(var i in rowsCache){if(((i=parseInt(i,10))!==activeRow)&&(i<rangeToKeep.top||i>rangeToKeep.bottom)){removeRowFromCache(i)}}}function invalidate(){updateRowCount();invalidateAllRows();render()}function invalidateAllRows(){if(currentEditor){makeActiveCellNormal()}for(var row in rowsCache){removeRowFromCache(row)}}function removeRowFromCache(row){var node=rowsCache[row];if(!node){return}$canvas[0].removeChild(node);delete rowsCache[row];delete postProcessedRows[row];renderedRows--;counter_rows_removed++}function invalidateRows(rows){var i,rl;if(!rows||!rows.length){return}scrollDir=0;for(i=0,rl=rows.length;i<rl;i++){if(currentEditor&&activeRow===i){makeActiveCellNormal()}if(rowsCache[rows[i]]){removeRowFromCache(rows[i])}}}function invalidateRow(row){invalidateRows([row])}function updateCell(row,cell){var cellNode=getCellNode(row,cell);if(!cellNode){return}var m=columns[cell],d=getDataItem(row);if(currentEditor&&activeRow===row&&activeCell===cell){currentEditor.loadValue(d)}else{cellNode.innerHTML=d?getFormatter(row,m)(row,cell,d[m.field],m,d):"";invalidatePostProcessingResults(row)}}function updateRow(row){if(!rowsCache[row]){return}$(rowsCache[row]).children().each(function(i){var m=columns[i];if(row===activeRow&&i===activeCell&&currentEditor){currentEditor.loadValue(getDataItem(activeRow))}else{if(getDataItem(row)){this.innerHTML=getFormatter(row,m)(row,i,getDataItem(row)[m.field],m,getDataItem(row))}else{this.innerHTML=""}}});invalidatePostProcessingResults(row)}function getViewportHeight(){return parseFloat($.css($container[0],"height",true))-options.headerHeight-getVBoxDelta($headers)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function resizeCanvas(){if(options.autoHeight){viewportH=options.rowHeight*(getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0))}else{viewportH=getViewportHeight()}numVisibleRows=Math.ceil(viewportH/options.rowHeight);viewportW=parseFloat($.css($container[0],"width",true));$viewport.height(viewportH);var w=0,i=columns.length;while(i--){w+=columns[i].width}setCanvasWidth(w);updateRowCount();render()}function resizeAndRender(){if(options.forceFitColumns){autosizeColumns()}else{resizeCanvas()}}function updateRowCount(){var newRowCount=getDataLength()+(options.enableAddRow?1:0)+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var oldH=h;var l=options.enableAddRow?getDataLength():getDataLength()-1;for(var i in rowsCache){if(i>=l){removeRowFromCache(i)}}th=Math.max(options.rowHeight*newRowCount,viewportH-scrollbarDimensions.height);if(th<maxSupportedCssHeight){h=ph=th;n=1;cj=0}else{h=maxSupportedCssHeight;ph=h/100;n=Math.floor(th/ph);cj=(th-h)/(n-1)}if(h!==oldH){$canvas.css("height",h);scrollTop=$viewport[0].scrollTop}var oldScrollTopInRange=(scrollTop+offset<=th-viewportH);if(th==0||scrollTop==0){page=offset=0}else{if(oldScrollTopInRange){scrollTo(scrollTop+offset)}else{scrollTo(th-viewportH)}}if(h!=oldH&&options.autoHeight){resizeCanvas()}}function getVisibleRange(viewportTop){if(viewportTop==null){viewportTop=scrollTop}return{top:Math.floor((scrollTop+offset)/options.rowHeight),bottom:Math.ceil((scrollTop+offset+viewportH)/options.rowHeight)}}function getRenderedRange(viewportTop){var range=getVisibleRange(viewportTop);var buffer=Math.round(viewportH/options.rowHeight);var minBuffer=3;if(scrollDir==-1){range.top-=buffer;range.bottom+=minBuffer}else{if(scrollDir==1){range.top-=minBuffer;range.bottom+=buffer}else{range.top-=minBuffer;range.bottom+=minBuffer}}range.top=Math.max(0,range.top);range.bottom=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,range.bottom);return range}function renderRows(range){var i,l,parentNode=$canvas[0],rowsBefore=renderedRows,stringArray=[],rows=[],startTimestamp=new Date(),needToReselectCell=false;for(i=range.top;i<=range.bottom;i++){if(rowsCache[i]){continue}renderedRows++;rows.push(i);appendRowHtml(stringArray,i);if(activeCellNode&&activeRow===i){needToReselectCell=true}counter_rows_rendered++}var x=document.createElement("div");x.innerHTML=stringArray.join("");var i=0;while(x.firstChild){try{rowsCache[rows[i]]=parentNode.appendChild(x.firstChild);i+=1}catch(e){var _debug=123;throw (e)}}if(needToReselectCell){activeCellNode=getCellNode(activeRow,activeCell)}if(renderedRows-rowsBefore>5){avgRowRenderTime=(new Date()-startTimestamp)/(renderedRows-rowsBefore)}}function startPostProcessing(){if(!options.enableAsyncPostRender){return}clearTimeout(h_postrender);h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay)}function invalidatePostProcessingResults(row){delete postProcessedRows[row];postProcessFromRow=Math.min(postProcessFromRow,row);postProcessToRow=Math.max(postProcessToRow,row);startPostProcessing()}function updateRowPositions(){for(var row in rowsCache){rowsCache[row].style.top=(row*options.rowHeight-offset)+"px"}}function render(){var visible=getVisibleRange();var rendered=getRenderedRange();cleanupRows(rendered);renderRows(rendered);postProcessFromRow=visible.top;postProcessToRow=Math.min(options.enableAddRow?getDataLength():getDataLength()-1,visible.bottom);startPostProcessing();lastRenderedScrollTop=scrollTop;h_render=null}function handleScroll(){scrollTop=$viewport[0].scrollTop;var scrollLeft=$viewport[0].scrollLeft;var scrollDist=Math.abs(scrollTop-prevScrollTop);if(scrollLeft!==prevScrollLeft){prevScrollLeft=scrollLeft;$headerScroller[0].scrollLeft=scrollLeft;$topPanelScroller[0].scrollLeft=scrollLeft;$headerRowScroller[0].scrollLeft=scrollLeft}if(scrollDist){scrollDir=prevScrollTop<scrollTop?1:-1;prevScrollTop=scrollTop;if(scrollDist<viewportH){scrollTo(scrollTop+offset)}else{var oldOffset=offset;page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph)));offset=Math.round(page*cj);if(oldOffset!=offset){invalidateAllRows()}}if(h_render){clearTimeout(h_render)}if(Math.abs(lastRenderedScrollTop-scrollTop)<viewportH){render()}else{h_render=setTimeout(render,50)}trigger(self.onViewportChanged,{})}trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){while(postProcessFromRow<=postProcessToRow){var row=(scrollDir>=0)?postProcessFromRow++:postProcessToRow--;var rowNode=rowsCache[row];if(!rowNode||postProcessedRows[row]||row>=getDataLength()){continue}var d=getDataItem(row),cellNodes=rowNode.childNodes;for(var i=0,j=0,l=columns.length;i<l;++i){var m=columns[i];if(m.asyncPostRender){m.asyncPostRender(cellNodes[j],postProcessFromRow,d,m)}++j}postProcessedRows[row]=true;h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay);return}}function addCellCssStyles(key,hash){if(cellCssClasses[key]){throw"addCellCssStyles: cell CSS hash with key '"+key+"' already exists."}cellCssClasses[key]=hash;var node;for(var row in rowsCache){if(hash[row]){for(var columnId in hash[row]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).addClass(hash[row][columnId])}}}}}function removeCellCssStyles(key){if(!cellCssClasses[key]){return}var node;for(var row in rowsCache){if(cellCssClasses[key][row]){for(var columnId in cellCssClasses[key][row]){node=getCellNode(row,getColumnIndex(columnId));if(node){$(node).removeClass(cellCssClasses[key][row][columnId])}}}}delete cellCssClasses[key]}function setCellCssStyles(key,hash){removeCellCssStyles(key);addCellCssStyles(key,hash)}function flashCell(row,cell,speed){speed=speed||100;if(rowsCache[row]){var $cell=$(getCellNode(row,cell));function toggleCellClass(times){if(!times){return}setTimeout(function(){$cell.queue(function(){$cell.toggleClass(options.cellFlashingCssClass).dequeue();toggleCellClass(times-1)})},speed)}toggleCellClass(4)}}function handleDragInit(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}retval=trigger(self.onDragInit,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDragStart(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell)){return false}var retval=trigger(self.onDragStart,dd,e);if(e.isImmediatePropagationStopped()){return retval}return false}function handleDrag(e,dd){return trigger(self.onDrag,dd,e)}function handleDragEnd(e,dd){trigger(self.onDragEnd,dd,e)}function handleKeyDown(e){trigger(self.onKeyDown,{},e);var handled=e.isImmediatePropagationStopped();if(!handled){if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){if(e.which==27){if(!getEditorLock().isActive()){return}cancelEditAndSetFocus()}else{if(e.which==37){navigateLeft()}else{if(e.which==39){navigateRight()}else{if(e.which==38){navigateUp()}else{if(e.which==40){navigateDown()}else{if(e.which==9){navigateNext()}else{if(e.which==13){if(options.editable){if(currentEditor){if(activeRow===getDataLength()){navigateDown()}else{commitEditAndSetFocus()}}else{if(getEditorLock().commitCurrentEdit()){makeActiveCellEditable()}}}}else{return}}}}}}}}else{if(e.which==9&&e.shiftKey&&!e.ctrlKey&&!e.altKey){navigatePrev()}else{return}}}e.stopPropagation();e.preventDefault();try{e.originalEvent.keyCode=0}catch(error){}}function handleClick(e){var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if(canCellBeActive(cell.row,cell.cell)){if(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit()){scrollRowIntoView(cell.row,false);setActiveCellInternal(getCellNode(cell.row,cell.cell),(cell.row===getDataLength())||options.autoEdit)}}}function handleContextMenu(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if($cell.length===0){return}if(activeCellNode===$cell[0]&&currentEditor!==null){return}trigger(self.onContextMenu,{},e)}function handleDblClick(e){var cell=getCellFromEvent(e);if(!cell||(currentEditor!==null&&activeRow==cell.row&&activeCell==cell.cell)){return}trigger(self.onDblClick,{row:cell.row,cell:cell.cell},e);if(e.isImmediatePropagationStopped()){return}if(options.editable){gotoCell(cell.row,cell.cell,true)}}function handleHeaderContextMenu(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&columns[self.getColumnIndex($header.data("fieldId"))];trigger(self.onHeaderContextMenu,{column:column},e)}function handleHeaderClick(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns");var column=$header&&columns[self.getColumnIndex($header.data("fieldId"))];trigger(self.onHeaderClick,{column:column},e)}function handleMouseEnter(e){trigger(self.onMouseEnter,{},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{},e)}function cellExists(row,cell){return !(row<0||row>=getDataLength()||cell<0||cell>=columns.length)}function getCellFromPoint(x,y){var row=Math.floor((y+offset)/options.rowHeight);var cell=0;var w=0;for(var i=0;i<columns.length&&w<x;i++){w+=columns[i].width;cell++}if(cell<0){cell=0}return{row:row,cell:cell-1}}function getCellFromNode(node){var cls=/l\d+/.exec(node.className)||/c\d+/.exec(node.className);if(!cls){throw"getCellFromNode: cannot get cell - "+node.className}return parseInt(cls[0].substr(1,cls[0].length-1),10)}function getCellFromEvent(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if(!$cell.length){return null}return{row:$cell.parent().attr("row")|0,cell:getCellFromNode($cell[0])}}function getCellNodeBox(row,cell){if(!cellExists(row,cell)){return null}var y1=row*options.rowHeight-offset;var y2=y1+options.rowHeight-1;var x1=0;for(var i=0;i<cell;i++){x1+=columns[i].width}var x2=x1+columns[cell].width;return{top:y1,left:x1,bottom:y2,right:x2}}function resetActiveCell(){setActiveCellInternal(null,false)}function setFocus(){if($.browser.msie){$canvas[0].setActive()}else{$canvas[0].focus()}}function scrollActiveCellIntoView(){if(activeCellNode){var left=$(activeCellNode).position().left,right=left+$(activeCellNode).outerWidth(),scrollLeft=$viewport.scrollLeft(),scrollRight=scrollLeft+$viewport.width();if(left<scrollLeft){$viewport.scrollLeft(left)}else{if(right>scrollRight){$viewport.scrollLeft(Math.min(left,right-$viewport[0].clientWidth))}}}}function setActiveCellInternal(newCell,editMode){if(activeCellNode!==null){makeActiveCellNormal();$(activeCellNode).removeClass("active")}var activeCellChanged=(activeCellNode!==newCell);activeCellNode=newCell;if(activeCellNode!=null){activeRow=parseInt($(activeCellNode).parent().attr("row"));activeCell=activePosX=getCellFromNode(activeCellNode);$(activeCellNode).addClass("active");if(options.editable&&editMode&&isCellPotentiallyEditable(activeRow,activeCell)){clearTimeout(h_editorLoader);if(options.asyncEditorLoading){h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay)}else{makeActiveCellEditable()}}else{setFocus()}}else{activeRow=activeCell=null}if(activeCellChanged){scrollActiveCellIntoView();trigger(self.onActiveCellChanged,getActiveCell())}}function clearTextSelection(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var sel=window.getSelection();if(sel&&sel.removeAllRanges){sel.removeAllRanges()}}}}function isCellPotentiallyEditable(row,cell){if(row<getDataLength()&&!getDataItem(row)){return false}if(columns[cell].cannotTriggerInsert&&row>=getDataLength()){return false}if(!getEditor(row,cell)){return false}return true}function makeActiveCellNormal(){if(!currentEditor){return}trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor});currentEditor.destroy();currentEditor=null;if(activeCellNode){$(activeCellNode).removeClass("editable invalid");if(getDataItem(activeRow)){var column=columns[activeCell];activeCellNode.innerHTML=getFormatter(activeRow,column)(activeRow,activeCell,getDataItem(activeRow)[column.field],column,getDataItem(activeRow));invalidatePostProcessingResults(activeRow)}}if($.browser.msie){clearTextSelection()}getEditorLock().deactivate(editController)}function makeActiveCellEditable(editor){if(!activeCellNode){return}if(!options.editable){throw"Grid : makeActiveCellEditable : should never get called when options.editable is false"}clearTimeout(h_editorLoader);if(!isCellPotentiallyEditable(activeRow,activeCell)){return}var columnDef=columns[activeCell];var item=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:item,column:columnDef})===false){setFocus();return}getEditorLock().activate(editController);$(activeCellNode).addClass("editable");if(!editor){activeCellNode.innerHTML=""}currentEditor=new (editor||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:columnDef,item:item||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus});if(item){currentEditor.loadValue(item)}serializedEditorValue=currentEditor.serializeValue();if(currentEditor.position){handleActiveCellPositionChange()}}function commitEditAndSetFocus(){if(getEditorLock().commitCurrentEdit()){setFocus();if(options.autoEdit){navigateDown()}}}function cancelEditAndSetFocus(){if(getEditorLock().cancelCurrentEdit()){setFocus()}}function absBox(elem){var box={top:elem.offsetTop,left:elem.offsetLeft,bottom:0,right:0,width:$(elem).outerWidth(),height:$(elem).outerHeight(),visible:true};box.bottom=box.top+box.height;box.right=box.left+box.width;var offsetParent=elem.offsetParent;while((elem=elem.parentNode)!=document.body){if(box.visible&&elem.scrollHeight!=elem.offsetHeight&&$(elem).css("overflowY")!="visible"){box.visible=box.bottom>elem.scrollTop&&box.top<elem.scrollTop+elem.clientHeight}if(box.visible&&elem.scrollWidth!=elem.offsetWidth&&$(elem).css("overflowX")!="visible"){box.visible=box.right>elem.scrollLeft&&box.left<elem.scrollLeft+elem.clientWidth}box.left-=elem.scrollLeft;box.top-=elem.scrollTop;if(elem===offsetParent){box.left+=elem.offsetLeft;box.top+=elem.offsetTop;offsetParent=elem.offsetParent}box.bottom=box.top+box.height;box.right=box.left+box.width}return box}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(!activeCellNode){return}var cellBox;trigger(self.onActiveCellPositionChanged,{});if(currentEditor){cellBox=cellBox||getActiveCellPosition();if(currentEditor.show&&currentEditor.hide){if(!cellBox.visible){currentEditor.hide()}else{currentEditor.show()}}if(currentEditor.position){currentEditor.position(cellBox)}}}function getCellEditor(){return currentEditor}function getActiveCell(){if(!activeCellNode){return null}else{return{row:activeRow,cell:activeCell}}}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(row,doPaging){var rowAtTop=row*options.rowHeight;var rowAtBottom=(row+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);if((row+1)*options.rowHeight>scrollTop+viewportH+offset){scrollTo(doPaging?rowAtTop:rowAtBottom);render()}else{if(row*options.rowHeight<scrollTop+offset){scrollTo(doPaging?rowAtBottom:rowAtTop);render()}}}function getColspan(row,cell){var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(!metadata||!metadata.columns){return 1}var columnData=metadata.columns[columns[cell].id]||metadata.columns[cell];var colspan=(columnData&&columnData.colspan);if(colspan==="*"){colspan=columns.length-cell}return(colspan||1)}function findFirstFocusableCell(row){var cell=0;while(cell<columns.length){if(canCellBeActive(row,cell)){return cell}cell+=getColspan(row,cell)}return null}function findLastFocusableCell(row){var cell=0;var lastFocusableCell=null;while(cell<columns.length){if(canCellBeActive(row,cell)){lastFocusableCell=cell}cell+=getColspan(row,cell)}return lastFocusableCell}function gotoRight(row,cell,posX){if(cell>=columns.length){return null}do{cell+=getColspan(row,cell)}while(cell<columns.length&&!canCellBeActive(row,cell));if(cell<columns.length){return{row:row,cell:cell,posX:cell}}return null}function gotoLeft(row,cell,posX){if(cell<=0){return null}var firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell===null||firstFocusableCell>=cell){return null}var prev={row:row,cell:firstFocusableCell,posX:firstFocusableCell};var pos;while(true){pos=gotoRight(prev.row,prev.cell,prev.posX);if(!pos){return null}if(pos.cell>=cell){return prev}prev=pos}}function gotoDown(row,cell,posX){var prevCell;while(true){if(++row>=getDataLength()+(options.enableAddRow?1:0)){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoUp(row,cell,posX){var prevCell;while(true){if(--row<0){return null}prevCell=cell=0;while(cell<=posX){prevCell=cell;cell+=getColspan(row,cell)}if(canCellBeActive(row,prevCell)){return{row:row,cell:prevCell,posX:posX}}}}function gotoNext(row,cell,posX){var pos=gotoRight(row,cell,posX);if(pos){return pos}var firstFocusableCell=null;while(++row<getDataLength()+(options.enableAddRow?1:0)){firstFocusableCell=findFirstFocusableCell(row);if(firstFocusableCell!==null){return{row:row,cell:firstFocusableCell,posX:firstFocusableCell}}}return null}function gotoPrev(row,cell,posX){var pos;var lastSelectableCell;while(!pos){pos=gotoLeft(row,cell,posX);if(pos){break}if(--row<0){return null}cell=0;lastSelectableCell=findLastFocusableCell(row);if(lastSelectableCell!==null){pos={row:row,cell:lastSelectableCell,posX:lastSelectableCell}}}return pos}function navigateRight(){navigate("right")}function navigateLeft(){navigate("left")}function navigateDown(){navigate("down")}function navigateUp(){navigate("up")}function navigateNext(){navigate("next")}function navigatePrev(){navigate("prev")}function navigate(dir){if(!activeCellNode||!options.enableCellNavigation){return}if(!getEditorLock().commitCurrentEdit()){return}var stepFunctions={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext};var stepFn=stepFunctions[dir];var pos=stepFn(activeRow,activeCell,activePosX);if(pos){var isAddNewRow=(pos.row==getDataLength());scrollRowIntoView(pos.row,!isAddNewRow);setActiveCellInternal(getCellNode(pos.row,pos.cell),isAddNewRow||options.autoEdit);activePosX=pos.posX}}function getCellNode(row,cell){if(rowsCache[row]){var cells=$(rowsCache[row]).children();var nodeCell;for(var i=0;i<cells.length;i++){nodeCell=getCellFromNode(cells[i]);if(nodeCell===cell){return cells[i]}else{if(nodeCell>cell){return null}}}}return null}function setActiveCell(row,cell){if(row>getDataLength()||row<0||cell>=columns.length||cell<0){return}if(!options.enableCellNavigation){return}scrollRowIntoView(row,false);setActiveCellInternal(getCellNode(row,cell),false)}function canCellBeActive(row,cell){if(!options.enableCellNavigation||row>=getDataLength()+(options.enableAddRow?1:0)||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.focusable==="boolean"){return rowMetadata.focusable}var columnMetadata=rowMetadata&&rowMetadata.columns;if(columnMetadata&&columnMetadata[columns[cell].id]&&typeof columnMetadata[columns[cell].id].focusable==="boolean"){return columnMetadata[columns[cell].id].focusable}if(columnMetadata&&columnMetadata[cell]&&typeof columnMetadata[cell].focusable==="boolean"){return columnMetadata[cell].focusable}if(typeof columns[cell].focusable==="boolean"){return columns[cell].focusable}return true}function canCellBeSelected(row,cell){if(row>=getDataLength()||row<0||cell>=columns.length||cell<0){return false}var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&typeof rowMetadata.selectable==="boolean"){return rowMetadata.selectable}var columnMetadata=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[columns[cell].id]||rowMetadata.columns[cell]);if(columnMetadata&&typeof columnMetadata.selectable==="boolean"){return columnMetadata.selectable}if(typeof columns[cell].selectable==="boolean"){return columns[cell].selectable}return true}function gotoCell(row,cell,forceEdit){if(!canCellBeActive(row,cell)){return}if(!getEditorLock().commitCurrentEdit()){return}scrollRowIntoView(row,false);var newCell=getCellNode(row,cell);setActiveCellInternal(newCell,forceEdit||(row===getDataLength())||options.autoEdit);if(!currentEditor){setFocus()}}function commitCurrentEdit(){var item=getDataItem(activeRow);var column=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var validationResults=currentEditor.validate();if(validationResults.valid){if(activeRow<getDataLength()){var editCommand={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(item,this.serializedValue);updateRow(this.row)},undo:function(){this.editor.applyValue(item,this.prevSerializedValue);updateRow(this.row)}};if(options.editCommandHandler){makeActiveCellNormal();options.editCommandHandler(item,column,editCommand)}else{editCommand.execute();makeActiveCellNormal()}trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:item})}else{var newItem={};currentEditor.applyValue(newItem,currentEditor.serializeValue());makeActiveCellNormal();trigger(self.onAddNewRow,{item:newItem,column:column})}return !getEditorLock().isActive()}else{$(activeCellNode).addClass("invalid");$(activeCellNode).stop(true,true).effect("highlight",{color:"red"},300);trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:validationResults,row:activeRow,cell:activeCell,column:column});currentEditor.focus();return false}}makeActiveCellNormal()}return true}function cancelCurrentEdit(){makeActiveCellNormal();return true}function rowsToRanges(rows){var ranges=[];var lastCell=columns.length-1;for(var i=0;i<rows.length;i++){ranges.push(new Slick.Range(rows[i],0,rows[i],lastCell))}return ranges}function getSelectedRows(){if(!selectionModel){throw"Selection model is not set"}return selectedRows}function setSelectedRows(rows){if(!selectionModel){throw"Selection model is not set"}selectionModel.setSelectedRanges(rowsToRanges(rows))}this.debug=function(){var s="";s+=("\ncounter_rows_rendered:  "+counter_rows_rendered);s+=("\ncounter_rows_removed:  "+counter_rows_removed);s+=("\nrenderedRows:  "+renderedRows);s+=("\nnumVisibleRows:  "+numVisibleRows);s+=("\nmaxSupportedCssHeight:  "+maxSupportedCssHeight);s+=("\nn(umber of pages):  "+n);s+=("\n(current) page:  "+page);s+=("\npage height (ph):  "+ph);s+=("\nscrollDir:  "+scrollDir);alert(s)};this.eval=function(expr){return eval(expr)};$.extend(this,{slickGridVersion:"2.0a1",onScroll:new Slick.Event(),onSort:new Slick.Event(),onHeaderContextMenu:new Slick.Event(),onHeaderClick:new Slick.Event(),onMouseEnter:new Slick.Event(),onMouseLeave:new Slick.Event(),onClick:new Slick.Event(),onDblClick:new Slick.Event(),onContextMenu:new Slick.Event(),onKeyDown:new Slick.Event(),onAddNewRow:new Slick.Event(),onValidationError:new Slick.Event(),onViewportChanged:new Slick.Event(),onColumnsReordered:new Slick.Event(),onColumnsResized:new Slick.Event(),onCellChange:new Slick.Event(),onBeforeEditCell:new Slick.Event(),onBeforeCellEditorDestroy:new Slick.Event(),onBeforeDestroy:new Slick.Event(),onActiveCellChanged:new Slick.Event(),onActiveCellPositionChanged:new Slick.Event(),onDragInit:new Slick.Event(),onDragStart:new Slick.Event(),onDrag:new Slick.Event(),onDragEnd:new Slick.Event(),onSelectedRowsChanged:new Slick.Event(),registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,getCanvasNode:getCanvasNode,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,gotoCell:gotoCell,getTopPanel:getTopPanel,showTopPanel:showTopPanel,hideTopPanel:hideTopPanel,showHeaderRowColumns:showHeaderRowColumns,hideHeaderRowColumns:hideHeaderRowColumns,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController});init()}}(jQuery));(function(b){b.extend(true,window,{Slick:{Data:{GroupItemMetadataProvider:a}}});function a(m){var i;var f={groupCssClass:"slick-group",totalsCssClass:"slick-group-totals",groupFocusable:true,totalsFocusable:false,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:true};m=b.extend(true,{},f,m);function h(r,n,q,o,p){if(!m.enableExpandCollapse){return p.title}return"<span class='"+m.toggleCssClass+" "+(p.collapsed?m.toggleCollapsedCssClass:m.toggleExpandedCssClass)+"'></span>"+p.title}function d(r,n,q,o,p){return(o.groupTotalsFormatter&&o.groupTotalsFormatter(p,o))||""}function l(n){i=n;i.onClick.subscribe(e);i.onKeyDown.subscribe(j)}function k(){if(i){i.onClick.unsubscribe(e);i.onKeyDown.unsubscribe(j)}}function e(p,n){var o=this.getDataItem(n.row);if(o&&o instanceof Slick.Group&&b(p.target).hasClass(m.toggleCssClass)){if(o.collapsed){this.getData().expandGroup(o.value)}else{this.getData().collapseGroup(o.value)}p.stopImmediatePropagation();p.preventDefault()}}function j(q,o){if(m.enableExpandCollapse&&(q.which==b.ui.keyCode.SPACE)){var n=this.getActiveCell();if(n){var p=this.getDataItem(n.row);if(p&&p instanceof Slick.Group){if(p.collapsed){this.getData().expandGroup(p.value)}else{this.getData().collapseGroup(p.value)}q.stopImmediatePropagation();q.preventDefault()}}}}function c(n){return{selectable:false,focusable:m.groupFocusable,cssClasses:m.groupCssClass,columns:{0:{colspan:"*",formatter:h,editor:null}}}}function g(n){return{selectable:false,focusable:m.totalsFocusable,cssClasses:m.totalsCssClass,formatter:d,editor:null}}return{init:l,destroy:k,getGroupRowMetadata:c,getTotalsRowMetadata:g}}})(jQuery);(function(d){d.extend(true,window,{Slick:{Data:{DataView:e,Aggregators:{Avg:c,Min:b,Max:a}}}});function e(I){var o=this;var R={groupItemMetadataProvider:null};var Y="id";var C=[];var ah=[];var r={};var B=null;var S=null;var j=null;var K=false;var ak=true;var p;var k;var ac;var s;var f;var n;var q=[];var af={};var aa;var H=false;var X=0;var L=0;var W=0;var i=new Slick.Event();var l=new Slick.Event();var h=new Slick.Event();I=d.extend(true,{},R,I);function t(){K=true}function ar(at){K=false;an(at)}function V(av){av=av||0;var aw;for(var au=av,at=C.length;au<at;au++){aw=C[au][Y];if(aw===undefined){throw"Each data element must implement a unique 'id' property"}r[aw]=au}}function F(){var av;for(var au=0,at=C.length;au<at;au++){av=C[au][Y];if(av===undefined||r[av]!==au){throw"Each data element must implement a unique 'id' property"}}}function z(){return C}function v(au,at){if(at!==undefined){Y=at}C=au;r={};V();F();an()}function y(at){if(at.pageSize!=undefined){X=at.pageSize}if(at.pageNum!=undefined){L=Math.min(at.pageNum,Math.ceil(W/X))}h.notify(ag(),null,o);an()}function ag(){return{pageSize:X,pageNum:L,totalRows:W}}function al(au,at){ak=at;k=au;p=null;if(at===false){C.reverse()}C.sort(au);if(at===false){C.reverse()}r={};V();an()}function P(av,au){ak=au;p=av;k=null;var at=Object.prototype.toString;Object.prototype.toString=(typeof av=="function")?av:function(){return this[av]};if(au===false){C.reverse()}C.sort();Object.prototype.toString=at;if(au===false){C.reverse()}r={};V();an()}function aq(){if(k){al(k,ak)}else{if(p){P(p,ak)}}}function x(at){S=at;an()}function ap(at,au,av){if(!I.groupItemMetadataProvider){I.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider()}ac=at;s=typeof ac==="function";f=au;n=av;af={};q=[];an()}function ao(au,at){aa=au;H=at!==undefined?at:H;an()}function O(at){return C[at]}function U(at){return r[at]}function Q(av){if(!B){B={};for(var au=0,at=ah.length;au<at;++au){B[ah[au][Y]]=au}}return B[av]}function ae(at){return C[r[at]]}function Z(au,at){if(r[au]===undefined||au!==at[Y]){throw"Invalid or non-matching id"}C[r[au]]=at;if(!j){j={}}j[au]=true;an()}function E(at,au){C.splice(at,0,au);V(at);an()}function aj(at){C.push(at);V(C.length-1);an()}function m(au){var at=r[au];if(at===undefined){throw"Invalid id"}delete r[au];C.splice(at,1);V(at);an()}function am(){return ah.length}function g(at){return ah[at]}function ai(at){var au=ah[at];if(au===undefined){return null}if(au.__group){return I.groupItemMetadataProvider.getGroupRowMetadata(au)}if(au.__groupTotals){return I.groupItemMetadataProvider.getTotalsRowMetadata(au)}return null}function G(at){af[at]=true;an()}function A(at){delete af[at];an()}function ab(){return q}function ad(ay){var az;var aA;var at=[];var ax={};var aw;for(var av=0,au=ay.length;av<au;av++){aw=ay[av];aA=(s)?ac(aw):aw[ac];az=ax[aA];if(!az){az=new Slick.Group();az.count=0;az.value=aA;az.rows=[];at[at.length]=az;ax[aA]=az}az.rows[az.count++]=aw}return at}function N(ay){var ax,at;if(ay.collapsed&&!H){return}at=aa.length;while(at--){aa[at].init()}for(var au=0,aw=ay.rows.length;au<aw;au++){ax=ay.rows[au];at=aa.length;while(at--){aa[at].accumulate(ax)}}var av=new Slick.GroupTotals();at=aa.length;while(at--){aa[at].storeResult(av)}av.group=ay;ay.totals=av}function D(au){var at=au.length;while(at--){N(au[at])}}function u(au){var at=au.length,av;while(at--){av=au[at];av.collapsed=(av.value in af);av.title=f?f(av):av.value}}function M(au){var av=[],az=0,aC,aD,aB,at;for(var ay=0,aw=au.length;ay<aw;ay++){aB=au[ay];av[az++]=aB;if(!aB.collapsed){for(var ax=0,aA=aB.rows.length;ax<aA;ax++){av[az++]=aB.rows[ax]}}if(aB.totals&&(!aB.collapsed||H)){av[az++]=aB.totals}}return av}function J(az,av){var aw=X*L;var aB=aw+X;var at=0,au=0,aC;var ay=[];if(av){for(var ax=0,aA=az.length;ax<aA;++ax){aC=az[ax];if(!av||av(aC)){if(!X||(at>=aw&&at<aB)){ay[au]=aC;au++}at++}}}else{ay=X?az.slice(aw,aB):az.concat();at=az.length}return{totalRows:at,rows:ay}}function T(aB,ax){var aA,at,au,az=[];for(var av=0,ay=aB.length,aw=ax.length;av<aw;av++){if(av>=ay){az[az.length]=av}else{aA=ax[av];at=aB[av];if((ac&&(au=(aA.__nonDataRow)||(at.__nonDataRow))&&aA.__group!==at.__group||aA.__updated||aA.__group&&!aA.equals(at))||(aa&&au&&(aA.__groupTotals||at.__groupTotals))||aA[Y]!=at[Y]||(j&&j[aA[Y]])){az[az.length]=av}}}return az}function w(ax,au,ay){B=null;var at=[];var av=J(ax,ay);W=av.totalRows;at=av.rows;q=[];if(ac!=null){q=ad(at);if(q.length){u(q);if(aa){D(q)}q.sort(n);at=M(q)}}var aw=T(au,at);ah=at;return aw}function an(){if(K){return}var at=ah.length;var au=W;var av=w(C,ah,S);if(X&&W<L*X){L=Math.floor(W/X);av=w(C,ah,S)}j=null;if(au!=W){h.notify(ag(),null,o)}if(at!=ah.length){i.notify({previous:at,current:ah.length},null,o)}if(av.length>0){l.notify({rows:av},null,o)}}return{beginUpdate:t,endUpdate:ar,setPagingOptions:y,getPagingInfo:ag,getItems:z,setItems:v,setFilter:x,sort:al,fastSort:P,reSort:aq,groupBy:ap,setAggregators:ao,collapseGroup:G,expandGroup:A,getGroups:ab,getIdxById:U,getRowById:Q,getItemById:ae,getItemByIdx:O,refresh:an,updateItem:Z,insertItem:E,addItem:aj,deleteItem:m,getLength:am,getItem:g,getItemMetadata:ai,onRowCountChanged:i,onRowsChanged:l,onPagingInfoChanged:h}}function c(i){var h;var f;var g;this.init=function(){h=0;f=0;g=0};this.accumulate=function(j){var k=j[i];h++;if(k!=null&&k!=NaN){f++;g+=1*k}};this.storeResult=function(j){if(!j.avg){j.avg={}}if(f!=0){j.avg[i]=g/f}}}function b(g){var f;this.init=function(){f=null};this.accumulate=function(h){var i=h[g];if(i!=null&&i!=NaN){if(f==null||i<f){f=i}}};this.storeResult=function(h){if(!h.min){h.min={}}h.min[g]=f}}function a(g){var f;this.init=function(){f=null};this.accumulate=function(h){var i=h[g];if(i!=null&&i!=NaN){if(f==null||i>f){f=i}}};this.storeResult=function(h){if(!h.max){h.max={}}h.max[g]=f}}})(jQuery);(function(d){var c=function(){if(window.console&&console.log){console.log(Array.prototype.slice.call(arguments))}};var b=function(l,h,k,i,g){var j="./"+g.name;var f='<a href="'+j+'">'+k+"</a>";return f};var a=function(l,h,k,i,g){var j=g.profile_url;var f='<a href="'+j+'">'+k+"</a>";return f};var e=function(p,o,n,i,g){var l=n.substring(0,4);var j=n.substring(5,7);var m=n.substring(8,10);if(j.charAt(0)=="0"){j=j.substring(1)}if(m.charAt(0)=="0"){m=m.substring(1)}var f=(window.head_data||{}).date_format;if(!f){f=karl_client_data.date_format}var k=new Date(l,j-1,m);var h=Globalize.format(k,"d",Globalize.culture(f));return h};d.widget("karl.karlwikitoc",{options:{},_create:function(){var n=this;var j=this.options.ux2?'<button class="btn karl-wikitoc-button-inspector">Options</button>':'<a href="#" class="karl-wikitoc-button-inspector">Options</a>';var k=this.options.ux2?"karl-wikitoc-footer paginationBar":"karl-wikitoc-footer ui-widget-header";this.element.append('<div class="karl-wikitoc-gridwrapper ui-helper-clearfix"><div class="karl-wikitoc-widthconstrainer"><div class="karl-wikitoc-grid"></div></div><div class="karl-wikitoc-inspector"><div class="karl-wikitoc-inspector-wrapper"><div class="karl-wikitoc-inspector-wrapper2"><fieldset class="karl-wikitoc-livesearch"><legend>Find in text</legend><div><p>Letters anywhere in title, tags, or author</p><div><span class="karl-wikitoc-icon-search ui-icon ui-icon-search"></span><input class="karl-wikitoc-input-livesearch" type="text"></input></div><div class="ui-helper-clearfix"></div></div></fieldset><fieldset class="karl-wikitoc-grouping"><legend>Grouping</legend><div><p>Column, if any, to group by</p><div><input type="checkbox" class="karl-wikitoc-cb-grouping"></input><label>Group by tags</label></div></div></fieldset><fieldset class="karl-wikitoc-columnselectors"><legend>Columns</legend><div><p>Which columns to show in the grid, in addition to title</p><div><input class="karl-wikitoc-cb-title" type="checkbox" checked="checked"></input><label>Title</label></div><div><input class="karl-wikitoc-cb-author_name" type="checkbox" checked="checked"></input><label>Author</label></div><div><input class="karl-wikitoc-cb-tags" type="checkbox"></input><label>Tags</label></div><div><input class="karl-wikitoc-cb-created" type="checkbox" checked="checked"></input><label>Created</label></div><div><input class="karl-wikitoc-cb-modified" type="checkbox"></input><label>Modified</label></div></div></fieldset></div></div></div></div><div class="'+k+'"><span class="karl-wikitoc-items"><span class="karl-wikitoc-items-num">0</span> items</span>'+j+"</div>");this.el_gridwrapper=this.element.find(".karl-wikitoc-gridwrapper");this.el_widthconstrainer=this.element.find(".karl-wikitoc-widthconstrainer");this.el_grid=this.el_gridwrapper.find(".karl-wikitoc-grid");this.el_inspector=this.el_gridwrapper.find(".karl-wikitoc-inspector");this.el_columnselectors=this.el_inspector.find(".karl-wikitoc-columnselectors");this.el_footer=this.element.find(".karl-wikitoc-footer");this.el_button_inspector=this.el_footer.find(".karl-wikitoc-button-inspector");this.el_input_livesearch=this.el_inspector.find(".karl-wikitoc-input-livesearch");this.el_cb_grouping=this.el_inspector.find(".karl-wikitoc-cb-grouping");this.el_label_items_num=this.el_footer.find(".karl-wikitoc-items-num");this.inspector_width=d(".karl-wikitoc-inspector-wrapper").width();this.el_column_selectors={title:this.el_inspector.find(".karl-wikitoc-cb-title"),author_name:this.el_inspector.find(".karl-wikitoc-cb-author_name"),tags:this.el_inspector.find(".karl-wikitoc-cb-tags"),created:this.el_inspector.find(".karl-wikitoc-cb-created"),modified:this.el_inspector.find(".karl-wikitoc-cb-modified")};d.each(this.el_column_selectors,function(r,q){q.click(function(){n.grid_columns=n.grid.getColumns();n.filterGridColumns();n.grid.setColumns(n.grid_columns)})});if(!this.options.ux2){this.el_button_inspector.button({icons:{primary:"ui-icon-triangle-1-w"}})}this.el_button_inspector.click(function(q){n.grid_columns=n.grid.getColumns();n.toggleInspector(q);return false});this.searchString="";this.el_input_livesearch.keyup(function(q){Slick.GlobalEditorLock.cancelCurrentEdit();if(q.which==27){this.value=""}n.searchString=this.value;n.dataView.refresh()});this.el_cb_grouping.click(function(q){var r=d(this).is(":checked");if(r){n.enableGrouping()}else{n.disableGrouping()}});this.el_grid.find(".slick-row").live("mouseenter mouseleave",function(q){var r=d(this);if(r.is(".slick-group")){return}if(q.type=="mouseenter"){r.addClass("karl-wikitoc-grid-row-hover")}else{r.removeClass("karl-wikitoc-grid-row-hover")}});this.inactive_columns={};this.grid_columns=[{id:"title",name:"Title",field:"title",formatter:b,width:320,minWidth:20,sortable:true},{id:"author_name",name:"Author",field:"author_name",formatter:a,width:80,minWidth:20,sortable:true},{id:"tags",name:"Tags",field:"tags",width:140,minWidth:20,sortable:false},{id:"created",name:"Created",field:"created",formatter:e,width:60,minWidth:20,sortable:true},{id:"modified",name:"Modified",field:"modified",formatter:e,width:60,minWidth:20,sortable:true}];this.filterGridColumns();var h=this.grid_columns;var p={enableCellNavigation:true,editable:false,forceFitColumns:true,rowHeight:this.options.rowHeight,headerHeight:this.options.headerHeight};var o=new Slick.Data.GroupItemMetadataProvider();var m=this.dataView=new Slick.Data.DataView({groupItemMetadataProvider:o});var g=this.grid=new Slick.Grid(this.el_grid,m,h,p);g.registerPlugin(o);function i(r,q){var t=r[n.sortCol].toLowerCase();var s=q[n.sortCol].toLowerCase();return(t==s?0:(t>s?1:-1))}this.sortCol="title";this.sortDir=1;g.onSort.subscribe(function(r,q){n.sortDir=q.sortAsc?1:-1;n.sortCol=q.sortCol.field;m.sort(i,q.sortAsc)});m.onRowCountChanged.subscribe(function(r,q){g.updateRowCount();g.render()});m.onRowsChanged.subscribe(function(r,q){g.invalidateRows(q.rows);g.render()});m.beginUpdate();m.setItems(this.options.items);m.setFilter(function f(q){return n._contentFilter(q)});g.setSortColumn(this.sortCol,this.sortDir);m.sort(i,this.sortDir==1);m.endUpdate();this.el_label_items_num.text(this.options.items.length);if(this.options.ux2){this.element.find(".ui-widget").removeClass("ui-widget");this.element.find(".ui-widget-header").removeClass("ui-widget-header");this.element.find(".ui-widget-content").removeClass("ui-widget-content")}var l=this.element.find(".slick-header-column").eq(0);this.headerColumnPadding=parseInt(l.css("padding-left"),10)+parseInt(l.css("padding-right"),10);this.grid.setColumns(this.grid_columns)},_addFakeRecords:function(){var g=this;if(!this._fake_records_added){this._fake_records_added=true;this.dataView.beginUpdate();var f=this.dataView.getItems();d.each(f,function(i,j){var h=j.tags;j.original=true;if(h.length===0){j.effective_tag=""}else{j.effective_tag=h[0];d.each(h,function(l,k){if(l===0){return}var m=d.extend({},j,{effective_tag:k,original:false});g.dataView.addItem(m)})}});this.dataView.endUpdate()}},enableGrouping:function(){var f=this;this.groupingEnabled=true;this._addFakeRecords();this.dataView.groupBy("effective_tag",function(h){if(h.value!==""){return'<span class="karl-wikitoc-groupheader">Tag: '+h.value+"</span>"}else{return'<span class="karl-wikitoc-groupheader">Untagged:</span>'}},function(h,g){var j=h.value.toLowerCase();var i=g.value.toLowerCase();if(j==i){return 0}if(j===""){return +1}if(i===""){return -1}return j<i?-1:+1})},disableGrouping:function(){this.groupingEnabled=false;this.dataView.groupBy(null)},_contentFilter:function(h){if(!this.groupingEnabled&&this._fake_records_added&&!h.original){return false}var g=this.searchString.toLowerCase();if(g===""){return true}if(h.title.toLowerCase().indexOf(g)!=-1){return true}if(h.author_name.toLowerCase().indexOf(g)!=-1){return true}var f=false;d.each(h.tags,function(j,i){if(i.toLowerCase().indexOf(g)!=-1){f=true;return false}});return f},filterGridColumns:function(){var h=this;var f=this.inactive_columns;d.each(f,function(o,m){var n=m.data;var k=h.el_column_selectors[o].is(":checked");if(k){var l=[];var j=false;if(!m.prev_column){l.push(n);j=true}d.each(h.grid_columns,function(p,q){l.push(q);if(m.prev_column&&q.id==m.prev_column.id){l.push(n);j=true}});if(!j){l.push(n)}delete f[o];h.grid_columns=l}});var g=[];var i=null;d.each(this.grid_columns,function(j,l){var m=l.id;var k=h.el_column_selectors[m].is(":checked");if(k){g.push(l)}else{f[l.id]={data:l,prev_column:i}}i=l});this.grid_columns=g},toggleInspector:function(f){var g=this;if(this.inspector_button_locked){return}this.inspector_button_locked=true;var k=this.inspector_width;var i=this._inspector_open;var l=this._inspector_open=!i;var h=this.el_widthconstrainer.width();if(l){if(!this.options.ux2){this.el_button_inspector.button("option","icons",{primary:"ui-icon-triangle-1-e"})}this.el_inspector.animate({width:""+k+"px"},{complete:function(){var m=(h-k)/h;d.each(g.grid_columns,function(n,o){o.width=Math.round(o.width*m)});g.el_widthconstrainer.width(h-k);g.grid.resizeCanvas();g.grid.setColumns(g.grid_columns);g.inspector_button_locked=false}})}else{if(!this.options.ux2){this.el_button_inspector.button("option","icons",{primary:"ui-icon-triangle-1-w"})}this.el_inspector.animate({width:"0px"},{complete:function(){g.inspector_button_locked=false}});this.el_widthconstrainer.css("width","100%");this.grid.resizeCanvas();var j=(h+k)/h;d.each(this.grid_columns,function(m,n){n.width=Math.round(n.width*j)});this.grid.setColumns(this.grid_columns)}},resizeColumns:function(m){var n=this;if(this.inspector_button_locked){return}this.inspector_button_locked=true;var i=this.el_gridwrapper.width();if(this._inspector_open){i=i-this.inspector_width;this.el_widthconstrainer.width(i)}var g=0;d.each(this.grid_columns,function(o,p){g+=p.width});var k=i/g;this.grid.autosizeColumns();this.grid.resizeCanvas();this.grid.setColumns(this.grid_columns);var h=this.element.find(".slick-header-column");var l=h.eq(0);var f=parseInt(l.css("padding-left"),10)+parseInt(l.css("padding-right"),10);var j=this.headerColumnPadding-f;this.element.find(".slick-header-column").each(function(){var o=d(this);o.width(o.width()+j)});this.inspector_button_locked=false}})})(jQuery);