{"version":3,"sources":["check-browser.js","livesearch-wire.js","jquery.ui.selectmenu.js","karl.calendar.js","karl.js"],"names":[],"mappings":"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","file":"karl-custom.min.js","sourcesContent":["/* jshint globalstrict: true */\n/* global document: true */\n\n(function () {\n    'use strict';\n\n    /**\n     * detect IE\n     * returns version of IE or false, if browser is not Internet Explorer\n     */\n    function detectIE() {\n        var ua = window.navigator.userAgent;\n\n        var msie = ua.indexOf('MSIE ');\n        if (msie > 0) {\n            // IE 10 or older => return version number\n            return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n        }\n\n        var trident = ua.indexOf('Trident/');\n        if (trident > 0) {\n            // IE 11 => return version number\n            var rv = ua.indexOf('rv:');\n            return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n        }\n\n        var edge = ua.indexOf('Edge/');\n        if (edge > 0) {\n            // IE 12 => return version number\n            return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n        }\n\n        // other browser\n        return false;\n    }\n\n    // Show the status on the top of the page\n    function showHtml(html) {\n        window.onload = function () {\n            var div = document.createElement(\"div\");\n            div.style.width = '100%';\n            div.style.background = '#eddb33';\n            div.style.color = 'black';\n            div.style.padding = '0.75em';\n            div.style.fontSize = '14px';\n            div.style.zIndex = '99999';\n            // position must be relative, otherwise on IE8 on the login\n            // page the message will not be shown because another\n            // absolutely positioned node covers it.\n            div.style.position = 'relative';\n            div.innerHTML = html;\n            document.body.insertBefore(div, document.body.firstChild);\n        };\n    }\n\n    function showStatus(/* arguments */) {\n        // wrap to table for cross browser centering\n        var html = Array.prototype.slice.call(arguments, 0).join(' ');\n        showHtml([\n                     '<table style=\"width: 100%; height: 30px;\">',\n                     '<tr>',\n                     '<td style=\"text-align: center; vertical-align: middle;\">',\n                     html,\n                     '</td>',\n                     '</tr>',\n                     '</table>',\n                 ].join(' '));\n    }\n\n    var meta = document.getElementById('karl-browser-upgrade-url');\n    var browser_upgrade_url = meta ? meta.getAttribute('content') || '' : '';\n    var serviceSwitch = document.location.hash == '#bad-browser';\n    if (browser_upgrade_url || serviceSwitch) {\n        var matched = detectIE();\n        var isBadBrowser = matched && matched < 9;\n        // Show status if we have a bad browser,\n        // or if the #bad-browser service switch hash is added to the url.\n        // (Note: you may need to reload to see the effect.)\n        if (serviceSwitch && browser_upgrade_url === '') {\n            // If this is a testing, let's warn the tester that\n            // not everything is all right.\n            showStatus(\n                'The browser compatibility check is not enabled',\n                '(see browser_upgrade_url configuration option).'\n            );\n        } else if (isBadBrowser || serviceSwitch) {\n            showStatus(\n                'You are using an unsupported version of Internet Explorer.',\n                'Please ',\n                '<a href=\"' + browser_upgrade_url + '\">',\n                'click here to learn more</a>.'\n            );\n        }\n    }\n\n})();\n","(function($) {\n\nfunction createUrlFn(urlPrefix, kind) {\n    return function(query) {\n        return kind\n            ? urlPrefix + '?kind=' + escape($.trim(kind))\n                        + '&val='  + escape($.trim(query))\n            : urlPrefix + '?val='  + escape($.trim(query));\n    }\n}\n\nvar appUrl = $(\"#karl-app-url\").eq(0).attr('content');\nvar livesearchUrl = appUrl + \"/jquery_livesearch\";\nvar advancedSearchUrl = appUrl + \"/searchresults.html\";\n\nfunction lookup_type(name) {\n    var types = {\n        profile: {name: \"people\", title: \"People\"},\n        page: {name: \"wiki\", title: \"Wikis\"},\n        post: {name: \"blog\", title: \"Blogs\"},\n        file: {name: \"files\", title: \"Files\"},\n        community: {name: \"communities\", title: \"Communities\"},\n        calendarevent: {name: \"events\", title: \"Events\"}\n    };\n    return types[name] || {name: null, title: null};\n    /*\n    var type = types[name];\n    if (type === undefined) {\n        type = {name: null, title: null};\n    }\n    return type;\n    */\n}\n\n// mapping from kind in live search to kind in advanced search\nvar liveToAdvancedKind = {\n};\n\nfunction getSearchValue() {\n    return $('.bc-livesearch-autocomplete').val();\n}\n\nfunction advancedSearchResultsUrl(query, kind) {\n    if (!kind) {\n        // grab current filter and use that\n        kind = $.trim($('.bc-livesearch-btn-select').parent().attr('name'));\n    }\n    kind = escape(kind);\n    var typeQueryString = (kind === \"all_content\")\n                              ? ''\n                              : \"&kind=\" + (liveToAdvancedKind[kind] || kind);\n    var queryString = '?body=' + escape(query) + typeQueryString;\n    return advancedSearchUrl + queryString;\n}\n\n// while waiting for data to return, if a search is triggered, like if\n// the user presses return or clicks on the search button, the ajax\n// query gets cancelled and triggers an error. We use this flag to\n// suppress displaying the error in that situation\nvar shouldDisplayError = true;\n\nfunction ajaxError(xhr, status, exc) {\n    var errDisplayer = this.errorDisplayer();\n    if (errDisplayer && shouldDisplayError) {\n        errDisplayer.show('We encountered an error. Please try your search again ... and contact a KARL admin if the problem persists.');\n    }\n}\n\n$(function() {\n    $('#searchbox li').each(function(index) {\n        var item = $(this);\n        var to_advanced = item.attr('advanced_search');\n        if (to_advanced) {\n            liveToAdvancedKind[item.attr('name')] = to_advanced;\n        }\n    });\n\n    $('.bc-livesearch').livesearch({\n        urlFn: createUrlFn(livesearchUrl),\n        search: function(event, ui) {\n            var searchText = $.trim(getSearchValue());\n            // in ie, the globbed character can be in the wrong place\n            // we'll always just grab it from the field and put it on the end\n\n            // suppress error displaying when searching\n            // we don't have to worry about toggling it back\n            // because we are loading a new page\n            shouldDisplayError = false;\n            window.location = (\n                advancedSearchResultsUrl(searchText, ui.item['name']));\n        },\n        menu: function(event, ui) {\n            var kind = $.trim(ui.name);\n            var urlFn = kind === \"all_content\"\n                ? createUrlFn(livesearchUrl)\n                : createUrlFn(livesearchUrl, kind);\n            $('.bc-livesearch').livesearch('option', 'urlFn', urlFn);\n        },\n        validationFn: $.bottlecap.livesearch.prototype.numCharsValidate,\n        queryTransformFn: $.bottlecap.livesearch.prototype.globQueryTransform,\n        errorFn: $.bottlecap.livesearch.prototype.displayError,\n        ajaxErrorFn: ajaxError,\n        selectedFn: function(event, item) {\n            if (item.url) {\n                window.location = item.url;\n                return false;\n            }\n            return true;\n        },\n        renderCompletions: renderCompletions,\n        noresults: noResults\n    });\n    if ($.browser.msie && parseInt($.browser.version) == 7) {\n        $('.bc-livesearch-btn-select').css('width', '120px');\n    }\n});\n\nfunction renderDate(isoDateString) {\n    return $.timeago(isoDateString);\n}\n\nfunction renderCompletions(ul, items) {\n    var self = this,\n        currentType = \"\";\n    $.each(items, function(index, item) {\n        // Change autocomplete behavior which overrides the\n        // searchterm\n        item.data_value = item.value;\n        item.value = self.term;\n         if (item.type !== currentType) {\n            var li = $('<li class=\"bc-livesearch-autocomplete-category\"></li>');\n            li.append(\n                $('<span class=\"bc-livesearch-category-text\"></span>')\n                    .text(lookup_type(item.type)['title'] || item.type || \"Unknown\")\n            );\n            li.append(\n                $('<span class=\"bc-livesearch-more\"></span>')\n                    .attr('href', '/search/more')\n                    .text('more')\n                    .click((function(type) {\n                        return function() {\n                            var searchText = $.trim(getSearchValue());\n                            var searchType = lookup_type(type)['name'] || \"all_content\";\n                            window.location = (\n                                advancedSearchResultsUrl(searchText, searchType));\n                            return false;\n                        };\n                    })(item.type))\n            );\n            ul.append(li);\n            currentType = item.type;\n        }\n        renderItem(ul, item);\n    });\n    // Set a class on the first item, to remove a border on\n    // the first row\n    ul.find('li:first').addClass('bc-livesearch-autocomplete-first');\n\n    // groupings that have only one element need a little bit more spacing\n    // or the category label/more link on the left look cramped\n    var nElements = 0;\n    var prevElement = null;\n    ul.find('li').each(function() {\n        if ($(this).hasClass('bc-livesearch-autocomplete-category')) {\n            if (nElements === 1) {\n                prevElement.css('margin-bottom', '1em');\n            }\n            prevElement = null;\n            nElements = 0;\n        } else {\n            nElements += 1;\n            prevElement = $(this);\n        }\n    });\n}\n\nfunction noResults(event, item) {\n    var el = item.el;\n    var displayer = el.errorDisplayer();\n    var query  = item.query.replace('*', '');\n    var msg = $('<span />').text('No results found. ');\n    var selectButtonText = el.selectButtonText;\n    var curFilter = $.trim(selectButtonText.text());\n    if (curFilter !== 'All Content') {\n        msg\n            .append('Try searching in ')\n            .append($('<a />')\n                    .attr('href', '#')\n                    .attr('class', 'bc-livesearch-all-content')\n                    .text('All Content')\n                    .click(function () {\n                        displayer.hide();\n                        selectButtonText.text('All Content')\n                                        .attr('name', 'all_content');\n                        el.menuSelected(0, {item: selectButtonText});\n                        return false;\n                    }))\n            .append('.');\n    }\n    displayer.replaceWith(msg);\n}\n\nvar renderDispatchTable = {\n    \"profile\":       renderPersonEntry,\n    \"page\":          renderPageEntry,\n    \"reference\":     renderPageEntry,\n    \"blogentry\":     renderBlogEntry,\n    \"forum\":         renderForumEntry,\n    \"forumtopic\":    renderForumTopicEntry,\n    \"comment\":       renderCommentEntry,\n    \"file\":          renderFileEntry,\n    \"calendarevent\": renderCalendarEventEntry,\n    \"community\":     renderCommunity,\n    \"office\":        renderOffice\n};\n\nfunction _normalized(val) {\n    // the server can return None or null\n    // treat these values as empty\n    return !val || val === \"None\" || val === \"null\"\n           ? ''\n           : val;\n}\n\nfunction renderPersonEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-profile\" />');\n    var titleDiv = $('<div />').append($('<span />').text(item.title));\n    if (_normalized(item.department)) {\n        titleDiv.append($('<span class=\"discreet\" />').text(\n            \" - \" + item.department));\n    }\n    var contactDiv = $('<div />');\n    if (_normalized($.trim(item.extension))) {\n        contactDiv.append($('<span class=\"extension\" />')\n                              .text('x' + item.extension));\n    }\n    if (_normalized(item.email)) {\n        contactDiv.append(\n            $('<a class=\"email\" />')\n                .attr('href', 'mailto:' + item.email)\n                .text(item.email)\n                .click(function() {\n                    window.location = $(this).attr('href');\n                    return false;\n                }));\n    }\n    entry\n        .append($('<img />')\n                     .attr('src', item.thumbnail))\n        .append(titleDiv)\n        .append(contactDiv);\n    return entry;\n}\n\nfunction renderGenericEntry(item) {\n    return $(\"<a></a>\").text(item.title);\n}\n\nfunction _meta_text(author, date) {\n    // helper to generate the meta byline\n    var authorText = _normalized(author)\n                     ? ' - by ' + author + ' '\n                     : ' - ';\n    return authorText + renderDate(date);\n}\n\nfunction renderPageEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-page\" />');\n    entry\n        .append($('<div />')\n                .append($('<span />').text(item.title))\n                .append($('<span class=\"discreet\" />').text(\n                    _meta_text(item.modified_by, item.modified)))\n                .append($('<div class=\"discreet\" />').text(\n                    _normalized(item.community))));\n    return entry;\n}\n\nfunction renderBlogEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-blog\" />');\n    entry\n        .append($('<div />')\n                .append($('<span />').text(item.title))\n                .append($('<span class=\"discreet\" />').text(\n                    _meta_text(item.modified_by, item.modified)))\n        .append($('<div class=\"discreet\" />').text(_normalized(\n            item.community))));\n    return entry;\n}\n\nfunction renderForumEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-forum\" />');\n    entry\n        .append($('<div />')\n                .append($('<span />').text(item.title))\n                .append($('<span class=\"discreet\" />').text(\n                    _meta_text(item.creator, item.created))));\n    return entry;\n}\n\nfunction renderForumTopicEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-forumtopic\" />');\n    entry\n        .append($('<div />')\n                .append($('<span />').text(item.title))\n                .append($('<span class=\"discreet\" />').text(\n                    _meta_text(item.creator, item.created))))\n        .append($('<div class=\"discreet\" />').append(item.forum));\n    return entry;\n}\n\nfunction renderCommentEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-comment\" />');\n    entry\n        .append($('<div />')\n                .append($('<span />').text(item.title))\n                .append($('<span class=\"discreet\" />').text(\n                    _meta_text(item.creator, item.created))))\n        .append($('<div class=\"discreet\" />').text(\n            _normalized(item.blog) ||\n            _normalized(item.forum) ||\n            _normalized(item.community)));\n    return entry;\n}\n\nfunction renderFileEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-file\" />');\n    entry\n        .append($('<img class=\"icon\" />')\n                .attr('src', item.icon))\n        .append($('<div />')\n                .append($('<span />').text(item.title))\n                .append($('<span class=\"discreet\" />').text(\n                    _meta_text(item.modified_by, item.modified))))\n        .append(\n            $('<div class=\"discreet\" />').text(_normalized(item.community)));\n    return entry;\n}\n\nfunction _renderCalendarDate(isoDateString) {\n    var d = $.timeago.parse(isoDateString);\n    var minutes = \"\" + d.getMinutes();\n    if (minutes.length === 1) {\n        minutes = \"0\" + minutes;\n    }\n    return (d.getMonth()+1) + '/' + d.getDate() + '/' + d.getFullYear() + ' ' +\n           d.getHours() + ':' + minutes;\n}\n\nfunction renderCalendarEventEntry(item) {\n    var entry = $('<a class=\"bc-livesearch-calendarevent\" />');\n    var titleDiv = $('<div />').text(item.title);\n    if (_normalized(item.location)) {\n        titleDiv.append($('<span class=\"discreet\" />')\n                            .text(' - at ' + item.location))\n    }\n    entry\n        .append(titleDiv)\n        .append($('<div class=\"discreet\" />').text(\n            _renderCalendarDate(item.start) + ' -> ' +\n            _renderCalendarDate(item.end)))\n        .append($('<div class=\"discreet\" />').text(\n            _normalized(item.community)));\n    return entry;\n}\n\nfunction renderCommunity(item) {\n    var entry = $('<a class=\"bc-livesearch-community\" />');\n    entry\n        .append($('<div />').text(item.title)\n                    .append($('<span class=\"discreet\" />')\n                                .text(\" - \" + item.num_members + \" member\" +\n                                      (item.num_members === 1 ? '' : 's'))));\n    return entry;\n}\n\nfunction renderOffice(item) {\n    var entry = $('<a class=\"bc-livesearch-office\" />');\n    function joinElements(elts) {\n        var nonnulls = $.grep(elts, function(x) { return x !== null; });\n        return nonnulls.join(', ');\n    }\n    entry\n        .append($('<div />')\n                .text(item.title + ' Office')\n                .append($('<span class=\"discreet telephone\" />')\n                        .text(item.telephone))\n                .append($('<div class=\"discreet\" />').text(item.address))\n                .append($('<div class=\"discreet\" />').text(joinElements([item.city, item.state])))\n                .append($('<div class=\"discreet\" />').text(item.zipcode)));\n    return entry;\n}\n\nfunction renderItem(ul, item) {\n    // Render different items in different ways\n    // dispatch based on the category of the item\n    var category = item.category,\n        renderFn = renderDispatchTable[category] || renderGenericEntry,\n        entry    = renderFn(item);\n    return $(\"<li></li>\")\n        .data(\"item.autocomplete\", item)\n        .append(entry)\n        .appendTo(ul);\n}\n\n})(jQuery);\n"," /*\n * jQuery UI selectmenu dev version\n *\n * Copyright (c) 2009 AUTHORS.txt (http://jqueryui.com/about)\n * Dual licensed under the MIT (MIT-LICENSE.txt)\n * and GPL (GPL-LICENSE.txt) licenses.\n *\n * http://docs.jquery.com/UI\n * https://github.com/fnagel/jquery-ui/wiki/Selectmenu\n */\n\n(function($) {\n\n$.widget(\"ui.selectmenu\", {\n\tgetter: \"value\",\n\tversion: \"1.8\",\n\teventPrefix: \"selectmenu\",\n\toptions: {\n\t\ttransferClasses: true,\n\t\ttypeAhead: \"sequential\",\n\t\tstyle: 'dropdown',\n\t\tpositionOptions: {\n\t\t\tmy: \"left top\",\n\t\t\tat: \"left bottom\",\n\t\t\toffset: null\n\t\t},\n\t\twidth: null,\n\t\tmenuWidth: null,\n\t\thandleWidth: 26,\n\t\tmaxHeight: null,\n\t\ticons: null,\n\t\tformat: null,\n\t\tbgImage: function() {},\n\t\twrapperElement: \"\"\n\t},\n\n\t_create: function() {\n\t\tvar self = this, o = this.options;\n\n\t\t// set a default id value, generate a new random one if not set by developer\n\t\tvar selectmenuId = this.element.attr('id') || 'ui-selectmenu-' + Math.random().toString(16).slice(2, 10);\n\n\t\t// quick array of button and menu id's\n\t\tthis.ids = [ selectmenuId + '-button', selectmenuId + '-menu' ];\n\n\t\t// define safe mouseup for future toggling\n\t\tthis._safemouseup = true;\n\n\t\t// create menu button wrapper\n\t\tthis.newelement = $('<a class=\"' + this.widgetBaseClass + ' ui-widget ui-state-default ui-corner-all\" id=\"' + this.ids[0] + '\" role=\"button\" href=\"#\" tabindex=\"0\" aria-haspopup=\"true\" aria-owns=\"' + this.ids[1] + '\"></a>')\n\t\t\t.insertAfter(this.element);\n\t\tthis.newelement.wrap(o.wrapperElement);\n\n\t\t// transfer tabindex\n\t\tvar tabindex = this.element.attr('tabindex');\n\t\tif (tabindex) {\n\t\t\tthis.newelement.attr('tabindex', tabindex);\n\t\t}\n\n\t\t// save reference to select in data for ease in calling methods\n\t\tthis.newelement.data('selectelement', this.element);\n\n\t\t// menu icon\n\t\tthis.selectmenuIcon = $('<span class=\"' + this.widgetBaseClass + '-icon ui-icon\"></span>')\n\t\t\t.prependTo(this.newelement);\n\n\t\t// append status span to button\n\t\tthis.newelement.prepend('<span class=\"' + self.widgetBaseClass + '-status\" />');\n\n\t\t// make associated form label trigger focus\n\t\t$( 'label[for=\"' + selectmenuId + '\"]' )\n\t\t\t.attr( 'for', this.ids[0] )\n\t\t\t.bind( 'click.selectmenu', function() {\n\t\t\t\tself.newelement[0].focus();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t// click toggle for menu visibility\n\t\tthis.newelement\n\t\t\t.bind('mousedown.selectmenu', function(event) {\n\t\t\t\tself._toggle(event, true);\n\t\t\t\t// make sure a click won't open/close instantly\n\t\t\t\tif (o.style == \"popup\") {\n\t\t\t\t\tself._safemouseup = false;\n\t\t\t\t\tsetTimeout(function() { self._safemouseup = true; }, 300);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.bind('click.selectmenu', function() {\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.bind(\"keydown.selectmenu\", function(event) {\n\t\t\t\tvar ret = false;\n\t\t\t\tswitch (event.keyCode) {\n\t\t\t\t\tcase $.ui.keyCode.ENTER:\n\t\t\t\t\t\tret = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.SPACE:\n\t\t\t\t\t\tself._toggle(event);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.UP:\n\t\t\t\t\t\tif (event.altKey) {\n\t\t\t\t\t\t\tself.open(event);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself._moveSelection(-1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.DOWN:\n\t\t\t\t\t\tif (event.altKey) {\n\t\t\t\t\t\t\tself.open(event);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself._moveSelection(1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.LEFT:\n\t\t\t\t\t\tself._moveSelection(-1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.RIGHT:\n\t\t\t\t\t\tself._moveSelection(1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.TAB:\n\t\t\t\t\t\tret = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tret = true;\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t})\n\t\t\t.bind('keypress.selectmenu', function(event) {\n\t\t\t\tself._typeAhead(event.which, 'mouseup');\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.bind('mouseover.selectmenu focus.selectmenu', function() {\n\t\t\t\tif (!o.disabled) {\n\t\t\t\t\t$(this).addClass(self.widgetBaseClass + '-focus ui-state-hover');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('mouseout.selectmenu blur.selectmenu', function() {\n\t\t\t\tif (!o.disabled) {\n\t\t\t\t\t$(this).removeClass(self.widgetBaseClass + '-focus ui-state-hover');\n\t\t\t\t}\n\t\t\t});\n\n\t\t// document click closes menu\n\t\t$(document).bind(\"mousedown.selectmenu\", function(event) {\n\t\t\tself.close(event);\n\t\t});\n\n\t\t// change event on original selectmenu\n\t\tthis.element\n\t\t\t.bind(\"click.selectmenu\", function() {\n\t\t\t\tself._refreshValue();\n\t\t\t})\n\t\t\t// FIXME: newelement can be null under unclear circumstances in IE8\n\t\t\t// TODO not sure if this is still a problem (fnagel 20.03.11)\n\t\t\t.bind(\"focus.selectmenu\", function() {\n\t\t\t\tif (self.newelement) {\n\t\t\t\t\tself.newelement[0].focus();\n\t\t\t\t}\n\t\t\t});\n\n\t\t// set width when not set via options\n\t\tif (!o.width) {\n\t\t\to.width = this.element.outerWidth();\n\t\t}\n\t\t// set menu button width\n\t\tthis.newelement.width(o.width);\n\n\t\t// hide original selectmenu element\n\t\tthis.element.hide();\n\n\t\t// create menu portion, append to body\n\t\tthis.list = $('<ul class=\"' + self.widgetBaseClass + '-menu ui-widget ui-widget-content\" aria-hidden=\"true\" role=\"listbox\" aria-labelledby=\"' + this.ids[0] + '\" id=\"' + this.ids[1] + '\"></ul>').appendTo('body');\n\t\tthis.list.wrap(o.wrapperElement);\n\n\t\t// transfer menu click to menu button\n\t\tthis.list\n\t\t\t.bind(\"keydown.selectmenu\", function(event) {\n\t\t\t\tvar ret = false;\n\t\t\t\tswitch (event.keyCode) {\n\t\t\t\t\tcase $.ui.keyCode.UP:\n\t\t\t\t\t\tif (event.altKey) {\n\t\t\t\t\t\t\tself.close(event, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself._moveFocus(-1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.DOWN:\n\t\t\t\t\t\tif (event.altKey) {\n\t\t\t\t\t\t\tself.close(event, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself._moveFocus(1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.LEFT:\n\t\t\t\t\t\tself._moveFocus(-1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.RIGHT:\n\t\t\t\t\t\tself._moveFocus(1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.HOME:\n\t\t\t\t\t\tself._moveFocus(':first');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.PAGE_UP:\n\t\t\t\t\t\tself._scrollPage('up');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.PAGE_DOWN:\n\t\t\t\t\t\tself._scrollPage('down');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.END:\n\t\t\t\t\t\tself._moveFocus(':last');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.ENTER:\n\t\t\t\t\tcase $.ui.keyCode.SPACE:\n\t\t\t\t\t\tself.close(event, true);\n\t\t\t\t\t\t$(event.target).parents('li:eq(0)').trigger('mouseup');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.TAB:\n\t\t\t\t\t\tret = true;\n\t\t\t\t\t\tself.close(event, true);\n\t\t\t\t\t\t$(event.target).parents('li:eq(0)').trigger('mouseup');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase $.ui.keyCode.ESCAPE:\n\t\t\t\t\t\tself.close(event, true);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tret = true;\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t})\n\t\t\t.bind('keypress.selectmenu', function(event) {\n\t\t\t\tself._typeAhead(event.which, 'focus');\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t// this allows for using the scrollbar in an overflowed list\n\t\t\t.bind( 'mousedown.selectmenu mouseup.selectmenu', function() { return false; });\n\n\n\t\t// needed when window is resized\n\t\t$(window).bind( \"resize.selectmenu\", $.proxy( self._refreshPosition, this ) );\n\t},\n\n\t_init: function() {\n\t\tvar self = this, o = this.options;\n\n\t\t// serialize selectmenu element options\n\t\tvar selectOptionData = [];\n\t\tthis.element\n\t\t\t.find('option')\n\t\t\t.each(function() {\n\t\t\t\tselectOptionData.push({\n\t\t\t\t\tvalue: $(this).attr('value'),\n\t\t\t\t\ttext: self._formatText($(this).text()),\n\t\t\t\t\tselected: $(this).attr('selected'),\n\t\t\t\t\tdisabled: $(this).attr('disabled'),\n\t\t\t\t\tclasses: $(this).attr('class'),\n\t\t\t\t\ttypeahead: $(this).attr('typeahead'),\n\t\t\t\t\tparentOptGroup: $(this).parent('optgroup'),\n\t\t\t\t\tbgImage: o.bgImage.call($(this))\n\t\t\t\t});\n\t\t\t});\n\n\t\t// active state class is only used in popup style\n\t\tvar activeClass = (self.options.style == \"popup\") ? \" ui-state-active\" : \"\";\n\n\t\t// empty list so we can refresh the selectmenu via selectmenu()\n\t\tthis.list.html(\"\");\n\n\t\t// write li's\n\t\tfor (var i = 0; i < selectOptionData.length; i++) {\n\t\t\t\tvar thisLi = $('<li role=\"presentation\"' + (selectOptionData[i].disabled ? ' class=\"' + this.namespace + '-state-disabled' + '\"' : '' ) + '><a href=\"#\" tabindex=\"-1\" role=\"option\"' + (selectOptionData[i].disabled ? ' aria-disabled=\"true\"' : '' ) + ' aria-selected=\"false\"' + (selectOptionData[i].typeahead ? ' typeahead=\"' + selectOptionData[i].typeahead + '\"' : '' ) + '>'+ selectOptionData[i].text +'</a></li>')\n\t\t\t\t.data('index', i)\n\t\t\t\t.addClass(selectOptionData[i].classes)\n\t\t\t\t.data('optionClasses', selectOptionData[i].classes || '')\n\t\t\t\t.bind(\"mouseup.selectmenu\", function(event) {\n\t\t\t\t\tif (self._safemouseup && !self._disabled(event.currentTarget) && !self._disabled($( event.currentTarget ).parents( \"ul>li.\" + self.widgetBaseClass + \"-group \" )) ) {\n\t\t\t\t\t\tvar changed = $(this).data('index') != self._selectedIndex();\n\t\t\t\t\t\tself.index($(this).data('index'));\n\t\t\t\t\t\tself.select(event);\n\t\t\t\t\t\tif (changed) {\n\t\t\t\t\t\t\tself.change(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.close(event, true);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t})\n\t\t\t\t.bind(\"click.selectmenu\", function() {\n\t\t\t\t\treturn false;\n\t\t\t\t})\n\t\t\t\t.bind('mouseover.selectmenu focus.selectmenu', function(e) {\n\t\t\t\t\t// no hover if diabled\n\t\t\t\t\tif (!$(e.currentTarget).hasClass(self.namespace + '-state-disabled') && !$(e.currentTarget).parent(\"ul\").parent(\"li\").hasClass(self.namespace + '-state-disabled')) {\n\t\t\t\t\t\tself._selectedOptionLi().addClass(activeClass);\n\t\t\t\t\t\tself._focusedOptionLi().removeClass(self.widgetBaseClass + '-item-focus ui-state-hover');\n\t\t\t\t\t\t$(this).removeClass('ui-state-active').addClass(self.widgetBaseClass + '-item-focus ui-state-hover');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('mouseout.selectmenu blur.selectmenu', function() {\n\t\t\t\t\tif ($(this).is(self._selectedOptionLi().selector)) {\n\t\t\t\t\t\t$(this).addClass(activeClass);\n\t\t\t\t\t}\n\t\t\t\t\t$(this).removeClass(self.widgetBaseClass + '-item-focus ui-state-hover');\n\t\t\t\t});\n\n\t\t\t// optgroup or not...\n\t\t\tif ( selectOptionData[i].parentOptGroup.length ) {\n\t\t\t\tvar optGroupName = self.widgetBaseClass + '-group-' + this.element.find( 'optgroup' ).index( selectOptionData[i].parentOptGroup );\n\t\t\t\tif (this.list.find( 'li.' + optGroupName ).length ) {\n\t\t\t\t\tthis.list.find( 'li.' + optGroupName + ':last ul' ).append( thisLi );\n\t\t\t\t} else {\n\t\t\t\t\t$(' <li role=\"presentation\" class=\"' + self.widgetBaseClass + '-group ' + optGroupName + (selectOptionData[i].parentOptGroup.attr(\"disabled\") ? ' ' + this.namespace + '-state-disabled\" aria-disabled=\"true\"' : '\"' ) + '><span class=\"' + self.widgetBaseClass + '-group-label\">' + selectOptionData[i].parentOptGroup.attr('label') + '</span><ul></ul></li> ')\n\t\t\t\t\t\t.appendTo( this.list )\n\t\t\t\t\t\t.find( 'ul' )\n\t\t\t\t\t\t.append( thisLi );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthisLi.appendTo(this.list);\n\t\t\t}\n\n\t\t\t// append icon if option is specified\n\t\t\tif (o.icons) {\n\t\t\t\tfor (var j in o.icons) {\n\t\t\t\t\tif (thisLi.is(o.icons[j].find)) {\n\t\t\t\t\t\tthisLi\n\t\t\t\t\t\t\t.data('optionClasses', selectOptionData[i].classes + ' ' + self.widgetBaseClass + '-hasIcon')\n\t\t\t\t\t\t\t.addClass(self.widgetBaseClass + '-hasIcon');\n\t\t\t\t\t\tvar iconClass = o.icons[j].icon || \"\";\n\t\t\t\t\t\tthisLi\n\t\t\t\t\t\t\t.find('a:eq(0)')\n\t\t\t\t\t\t\t.prepend('<span class=\"' + self.widgetBaseClass + '-item-icon ui-icon ' + iconClass + '\"></span>');\n\t\t\t\t\t\tif (selectOptionData[i].bgImage) {\n\t\t\t\t\t\t\tthisLi.find('span').css('background-image', selectOptionData[i].bgImage);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// we need to set and unset the CSS classes for dropdown and popup style\n\t\tvar isDropDown = ( o.style == 'dropdown' );\n\t\tthis.newelement\n\t\t\t.toggleClass( self.widgetBaseClass + '-dropdown', isDropDown )\n\t\t\t.toggleClass( self.widgetBaseClass + '-popup', !isDropDown );\n\t\tthis.list\n\t\t\t.toggleClass( self.widgetBaseClass + '-menu-dropdown ui-corner-bottom', isDropDown )\n\t\t\t.toggleClass( self.widgetBaseClass + '-menu-popup ui-corner-all', !isDropDown )\n\t\t\t// add corners to top and bottom menu items\n\t\t\t.find( 'li:first' )\n\t\t\t.toggleClass( 'ui-corner-top', !isDropDown )\n\t\t\t.end().find( 'li:last' )\n\t\t\t.addClass( 'ui-corner-bottom' );\n\t\tthis.selectmenuIcon\n\t\t\t.toggleClass( 'ui-icon-triangle-1-s', isDropDown )\n\t\t\t.toggleClass( 'ui-icon-triangle-2-n-s', !isDropDown );\n\n\t\t// transfer classes to selectmenu and list\n\t\tif ( o.transferClasses ) {\n\t\t\tvar transferClasses = this.element.attr( 'class' ) || '';\n\t\t\tthis.newelement.add( this.list ).addClass( transferClasses );\n\t\t}\n\n\t\t// set menu width to either menuWidth option value, width option value, or select width\n\t\tif ( o.style == 'dropdown' ) {\n\t\t\tthis.list.width( o.menuWidth ? o.menuWidth : o.width );\n\t\t} else {\n\t\t\tthis.list.width( o.menuWidth ? o.menuWidth : o.width - o.handleWidth );\n\t\t}\n\n\t\t// reset height to auto\n\t\tthis.list.css(\"height\", \"auto\");\n\t\tvar listH = this.list.height();\n\t\t// calculate default max height\n\t\tif ( o.maxHeight && o.maxHeight < listH) {\n\t\t\tthis.list.height( o.maxHeight );\n\t\t} else {\n\t\t\tvar winH = $( window ).height() / 3;\n\t\t\tif ( winH < listH ) this.list.height( winH );\t\n\t\t}\n\t\t\n\t\t// save reference to actionable li's (not group label li's)\n\t\tthis._optionLis = this.list.find( 'li:not(.' + self.widgetBaseClass + '-group)' );\n\n\t\t// transfer disabled state\n\t\tif ( this.element.attr( 'disabled' ) === true ) {\n\t\t\tthis.disable();\n\t\t} else {\n\t\t\tthis.enable()\n\t\t}\n\t\t\n\t\t// update value\n\t\tthis.index( this._selectedIndex() );\n\n\t\t// needed when selectmenu is placed at the very bottom / top of the page\n\t\twindow.setTimeout( function() {\n\t\t\tself._refreshPosition();\n\t\t}, 200 );\n\t},\n\n\tdestroy: function() {\n\t\tthis.element.removeData( this.widgetName )\n\t\t\t.removeClass( this.widgetBaseClass + '-disabled' + ' ' + this.namespace + '-state-disabled' )\n\t\t\t.removeAttr( 'aria-disabled' )\n\t\t\t.unbind( \".selectmenu\" );\n\n\t\t$( window ).unbind( \".selectmenu\" );\n\t\t$( document ).unbind( \".selectmenu\" );\n\n\t\t// unbind click on label, reset its for attr\n\t\t$( 'label[for=' + this.newelement.attr('id') + ']' )\n\t\t\t.attr( 'for', this.element.attr( 'id' ) )\n\t\t\t.unbind( '.selectmenu' );\n\n\t\tif ( this.options.wrapperElement ) {\n\t\t\tthis.newelement.find( this.options.wrapperElement ).remove();\n\t\t\tthis.list.find( this.options.wrapperElement ).remove();\n\t\t} else {\n\t\t\tthis.newelement.remove();\n\t\t\tthis.list.remove();\n\t\t}\n\t\tthis.element.show();\n\n\t\t// call widget destroy function\n\t\t$.Widget.prototype.destroy.apply(this, arguments);\n\t},\n\n\t_typeAhead: function(code, eventType){\n\t\tvar self = this, focusFound = false, C = String.fromCharCode(code).toUpperCase();\n\t\tc = C.toLowerCase();\n\n\t\tif (self.options.typeAhead == 'sequential') {\n\t\t\t// clear the timeout so we can use _prevChar\n\t\t\twindow.clearTimeout('ui.selectmenu-' + self.selectmenuId);\n\n\t\t\t// define our find var\n\t\t\tvar find = typeof(self._prevChar) == 'undefined' ? '' : self._prevChar.join('');\n\n\t\t\tfunction focusOptSeq(elem, ind, c){\n\t\t\t\tfocusFound = true;\n\t\t\t\t$(elem).trigger(eventType);\n\t\t\t\ttypeof(self._prevChar) == 'undefined' ? self._prevChar = [c] : self._prevChar[self._prevChar.length] = c;\n\t\t\t}\n\t\t\tthis.list.find('li a').each(function(i) {\n\t\t\t\tif (!focusFound) {\n\t\t\t\t\t// allow the typeahead attribute on the option tag for a more specific lookup\n\t\t\t\t\tvar thisText = $(this).attr('typeahead') || $(this).text();\n\t\t\t\t\tif (thisText.indexOf(find+C) == 0) {\n\t\t\t\t\t\tfocusOptSeq(this,i,C)\n\t\t\t\t\t} else if (thisText.indexOf(find+c) == 0) {\n\t\t\t\t\t\tfocusOptSeq(this,i,c)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t// set a 1 second timeout for sequenctial typeahead\n\t\t\t//  \tkeep this set even if we have no matches so it doesnt typeahead somewhere else\n\t\t\twindow.setTimeout(function(el) {\n\t\t\t\tself._prevChar = undefined;\n\t\t\t}, 1000, self);\n\n\t\t} else {\n\t\t\t//define self._prevChar if needed\n\t\t\tif (!self._prevChar){ self._prevChar = ['',0]; }\n\n\t\t\tvar focusFound = false;\n\t\t\tfunction focusOpt(elem, ind){\n\t\t\t\tfocusFound = true;\n\t\t\t\t$(elem).trigger(eventType);\n\t\t\t\tself._prevChar[1] = ind;\n\t\t\t}\n\t\t\tthis.list.find('li a').each(function(i){\n\t\t\t\tif(!focusFound){\n\t\t\t\t\tvar thisText = $(this).text();\n\t\t\t\t\tif( thisText.indexOf(C) == 0 || thisText.indexOf(c) == 0){\n\t\t\t\t\t\t\tif(self._prevChar[0] == C){\n\t\t\t\t\t\t\t\tif(self._prevChar[1] < i){ focusOpt(this,i); }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{ focusOpt(this,i); }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis._prevChar[0] = C;\n\t\t}\n\t},\n\n\t// returns some usefull information, called by callbacks only\n\t_uiHash: function() {\n\t\tvar index = this.index();\n\t\treturn {\n\t\t\tindex: index,\n\t\t\toption: $(\"option\", this.element).get(index),\n\t\t\tvalue: this.element[0].value\n\t\t};\n\t},\n\n\topen: function(event) {\n\t\tvar self = this;\n\t\tif ( this.newelement.attr(\"aria-disabled\") != 'true' ) {\n\t\t\tthis._closeOthers(event);\n\t\t\tthis.newelement\n\t\t\t\t.addClass('ui-state-active');\n\t\t\tif (self.options.wrapperElement) {\n\t\t\t\tthis.list.parent().appendTo('body');\n\t\t\t} else {\n\t\t\t\tthis.list.appendTo('body');\n\t\t\t}\n\n\t\t\tthis.list.addClass(self.widgetBaseClass + '-open')\n\t\t\t\t.attr('aria-hidden', false)\n\t\t\t\t.find('li:not(.' + self.widgetBaseClass + '-group):eq(' + this._selectedIndex() + ') a')[0].focus();\n\t\t\tif ( this.options.style == \"dropdown\" ) {\n\t\t\t\tthis.newelement.removeClass('ui-corner-all').addClass('ui-corner-top');\n\t\t\t}\n\t\t\tthis._refreshPosition();\n\t\t\tthis._trigger(\"open\", event, this._uiHash());\n\t\t}\n\t},\n\n\tclose: function(event, retainFocus) {\n\t\tif ( this.newelement.is('.ui-state-active') ) {\n\t\t\tthis.newelement\n\t\t\t\t.removeClass('ui-state-active');\n\t\t\tthis.list\n\t\t\t\t.attr('aria-hidden', true)\n\t\t\t\t.removeClass(this.widgetBaseClass + '-open');\n\t\t\tif ( this.options.style == \"dropdown\" ) {\n\t\t\t\tthis.newelement.removeClass('ui-corner-top').addClass('ui-corner-all');\n\t\t\t}\n\t\t\tif ( retainFocus ) {\n\t\t\t\tthis.newelement.focus();\n\t\t\t}\n\t\t\tthis._trigger(\"close\", event, this._uiHash());\n\t\t}\n\t},\n\n\tchange: function(event) {\n\t\tthis.element.trigger(\"change\");\n\t\tthis._trigger(\"change\", event, this._uiHash());\n\t},\n\n\tselect: function(event) {\n\t\tif (this._disabled(event.currentTarget)) { return false; }\n\t\tthis._trigger(\"select\", event, this._uiHash());\n\t},\n\n\t_closeOthers: function(event) {\n\t\t$('.' + this.widgetBaseClass + '.ui-state-active').not(this.newelement).each(function() {\n\t\t\t$(this).data('selectelement').selectmenu('close', event);\n\t\t});\n\t\t$('.' + this.widgetBaseClass + '.ui-state-hover').trigger('mouseout');\n\t},\n\n\t_toggle: function(event, retainFocus) {\n\t\tif ( this.list.is('.' + this.widgetBaseClass + '-open') ) {\n\t\t\tthis.close(event, retainFocus);\n\t\t} else {\n\t\t\tthis.open(event);\n\t\t}\n\t},\n\n\t_formatText: function(text) {\n\t\treturn (this.options.format ? this.options.format(text) : text);\n\t},\n\n\t_selectedIndex: function() {\n\t\treturn this.element[0].selectedIndex;\n\t},\n\n\t_selectedOptionLi: function() {\n\t\treturn this._optionLis.eq(this._selectedIndex());\n\t},\n\n\t_focusedOptionLi: function() {\n\t\treturn this.list.find('.' + this.widgetBaseClass + '-item-focus');\n\t},\n\n\t_moveSelection: function(amt, recIndex) {\n\t\t// do nothing if disabled\n\t\tif (!this.options.disabled) {\n\t\t\tvar currIndex = parseInt(this._selectedOptionLi().data('index') || 0, 10);\n\t\t\tvar newIndex = currIndex + amt;\n\t\t\t// do not loop when using up key\n\n\t\t\tif (newIndex < 0) {\n\t\t\t\tnewIndex = 0;\n\t\t\t}\n\t\t\tif (newIndex > this._optionLis.size() - 1) {\n\t\t\t\tnewIndex = this._optionLis.size() - 1;\n\t\t\t}\n\t\t\t// Occurs when a full loop has been made\n\t\t\tif (newIndex === recIndex) { return false; }\n\n\t\t\tif (this._optionLis.eq(newIndex).hasClass( this.namespace + '-state-disabled' )) {\n\t\t\t\t// if option at newIndex is disabled, call _moveFocus, incrementing amt by one\n\t\t\t\t(amt > 0) ? ++amt : --amt;\n\t\t\t\tthis._moveSelection(amt, newIndex);\n\t\t\t} else {\n\t\t\t\treturn this._optionLis.eq(newIndex).trigger('mouseup');\n\t\t\t}\n\t\t}\n\t},\n\n\t_moveFocus: function(amt, recIndex) {\n\t\tif (!isNaN(amt)) {\n\t\t\tvar currIndex = parseInt(this._focusedOptionLi().data('index') || 0, 10);\n\t\t\tvar newIndex = currIndex + amt;\n\t\t}\n\t\telse {\n\t\t\tvar newIndex = parseInt(this._optionLis.filter(amt).data('index'), 10);\n\t\t}\n\n\t\tif (newIndex < 0) {\n\t\t\tnewIndex = 0;\n\t\t}\n\t\tif (newIndex > this._optionLis.size() - 1) {\n\t\t\tnewIndex = this._optionLis.size() - 1;\n\t\t}\n\n\t\t//Occurs when a full loop has been made\n\t\tif (newIndex === recIndex) { return false; }\n\n\t\tvar activeID = this.widgetBaseClass + '-item-' + Math.round(Math.random() * 1000);\n\n\t\tthis._focusedOptionLi().find('a:eq(0)').attr('id', '');\n\n\t\tif (this._optionLis.eq(newIndex).hasClass( this.namespace + '-state-disabled' )) {\n\t\t\t// if option at newIndex is disabled, call _moveFocus, incrementing amt by one\n\t\t\t(amt > 0) ? ++amt : --amt;\n\t\t\tthis._moveFocus(amt, newIndex);\n\t\t} else {\n\t\t\tthis._optionLis.eq(newIndex).find('a:eq(0)').attr('id',activeID).focus();\n\t\t}\n\n\t\tthis.list.attr('aria-activedescendant', activeID);\n\t},\n\n\t_scrollPage: function(direction) {\n\t\tvar numPerPage = Math.floor(this.list.outerHeight() / this.list.find('li:first').outerHeight());\n\t\tnumPerPage = (direction == 'up' ? -numPerPage : numPerPage);\n\t\tthis._moveFocus(numPerPage);\n\t},\n\n\t_setOption: function(key, value) {\n\t\tthis.options[key] = value;\n\t\t// set\n\t\tif (key == 'disabled') {\n\t\t\tthis.close();\n\t\t\tthis.element\n\t\t\t\t.add(this.newelement)\n\t\t\t\t.add(this.list)[value ? 'addClass' : 'removeClass'](\n\t\t\t\t\tthis.widgetBaseClass + '-disabled' + ' ' +\n\t\t\t\t\tthis.namespace + '-state-disabled')\n\t\t\t\t.attr(\"aria-disabled\", value);\n\t\t}\n\t},\n\n\tdisable: function(index, type){\n\t\t\t// if options is not provided, call the parents disable function\n\t\t\tif ( typeof( index ) == 'undefined' ) {\n\t\t\t\tthis._setOption( 'disabled', true );\n\t\t\t} else {\n\t\t\t\tif ( type == \"optgroup\" ) {\n\t\t\t\t\tthis._disableOptgroup(index);\n\t\t\t\t} else {\n\t\t\t\t\tthis._disableOption(index);\n\t\t\t\t}\n\t\t\t}\n\t},\n\n\tenable: function(index, type) {\n\t\t\t// if options is not provided, call the parents enable function\n\t\t\tif ( typeof( index ) == 'undefined' ) {\n\t\t\t\tthis._setOption('disabled', false);\n\t\t\t} else {\n\t\t\t\tif ( type == \"optgroup\" ) {\n\t\t\t\t\tthis._enableOptgroup(index);\n\t\t\t\t} else {\n\t\t\t\t\tthis._enableOption(index);\n\t\t\t\t}\n\t\t\t}\n\t},\n\n\t_disabled: function(elem) {\n\t\t\treturn $(elem).hasClass( this.namespace + '-state-disabled' );\n\t},\n\n\n\t_disableOption: function(index) {\n\t\t\tvar optionElem = this._optionLis.eq(index);\n\t\t\tif (optionElem) {\n\t\t\t\toptionElem.addClass(this.namespace + '-state-disabled')\n\t\t\t\t\t.find(\"a\").attr(\"aria-disabled\", true);\n\t\t\t\tthis.element.find(\"option\").eq(index).attr(\"disabled\", \"disabled\");\n\t\t\t}\n\t},\n\n\t_enableOption: function(index) {\n\t\t\tvar optionElem = this._optionLis.eq(index);\n\t\t\tif (optionElem) {\n\t\t\t\toptionElem.removeClass( this.namespace + '-state-disabled' )\n\t\t\t\t\t.find(\"a\").attr(\"aria-disabled\", false);\n\t\t\t\tthis.element.find(\"option\").eq(index).removeAttr(\"disabled\");\n\t\t\t}\n\t},\n\n\t_disableOptgroup: function(index) {\n\t\t\tvar optGroupElem = this.list.find( 'li.' + this.widgetBaseClass + '-group-' + index );\n\t\t\tif (optGroupElem) {\n\t\t\t\toptGroupElem.addClass(this.namespace + '-state-disabled')\n\t\t\t\t\t.attr(\"aria-disabled\", true);\n\t\t\t\tthis.element.find(\"optgroup\").eq(index).attr(\"disabled\", \"disabled\");\n\t\t\t}\n\t},\n\n\t_enableOptgroup: function(index) {\n\t\t\tvar optGroupElem = this.list.find( 'li.' + this.widgetBaseClass + '-group-' + index );\n\t\t\tif (optGroupElem) {\n\t\t\t\toptGroupElem.removeClass(this.namespace + '-state-disabled')\n\t\t\t\t\t.attr(\"aria-disabled\", false);\n\t\t\t\tthis.element.find(\"optgroup\").eq(index).removeAttr(\"disabled\");\n\t\t\t}\n\t},\n\n\tindex: function(newValue) {\n\t\tif (arguments.length) {\n\t\t\tif (!this._disabled($(this._optionLis[newValue]))) {\n\t\t\t\tthis.element[0].selectedIndex = newValue;\n\t\t\t\tthis._refreshValue();\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\treturn this._selectedIndex();\n\t\t}\n\t},\n\n\tvalue: function(newValue) {\n\t\tif (arguments.length) {\n\t\t\tthis.element[0].value = newValue;\n\t\t\tthis._refreshValue();\n\t\t} else {\n\t\t\treturn this.element[0].value;\n\t\t}\n\t},\n\n\t_refreshValue: function() {\n\t\tvar activeClass = (this.options.style == \"popup\") ? \" ui-state-active\" : \"\";\n\t\tvar activeID = this.widgetBaseClass + '-item-' + Math.round(Math.random() * 1000);\n\t\t// deselect previous\n\t\tthis.list\n\t\t\t.find('.' + this.widgetBaseClass + '-item-selected')\n\t\t\t.removeClass(this.widgetBaseClass + \"-item-selected\" + activeClass)\n\t\t\t.find('a')\n\t\t\t.attr('aria-selected', 'false')\n\t\t\t.attr('id', '');\n\t\t// select new\n\t\tthis._selectedOptionLi()\n\t\t\t.addClass(this.widgetBaseClass + \"-item-selected\" + activeClass)\n\t\t\t.find('a')\n\t\t\t.attr('aria-selected', 'true')\n\t\t\t.attr('id', activeID);\n\n\t\t// toggle any class brought in from option\n\t\tvar currentOptionClasses = (this.newelement.data('optionClasses') ? this.newelement.data('optionClasses') : \"\");\n\t\tvar newOptionClasses = (this._selectedOptionLi().data('optionClasses') ? this._selectedOptionLi().data('optionClasses') : \"\");\n\t\tthis.newelement\n\t\t\t.removeClass(currentOptionClasses)\n\t\t\t.data('optionClasses', newOptionClasses)\n\t\t\t.addClass( newOptionClasses )\n\t\t\t.find('.' + this.widgetBaseClass + '-status')\n\t\t\t.html(\n\t\t\t\tthis._selectedOptionLi()\n\t\t\t\t\t.find('a:eq(0)')\n\t\t\t\t\t.html()\n\t\t\t);\n\n\t\tthis.list.attr('aria-activedescendant', activeID);\n\t},\n\n\t_refreshPosition: function() {\n\t\tvar o = this.options;\n\t\t// if its a native pop-up we need to calculate the position of the selected li\n\t\tif (o.style == \"popup\" && !o.positionOptions.offset) {\n\t\t\tvar selected = this._selectedOptionLi();\n\t\t\tvar _offset = \"0 -\" + (selected.outerHeight() + selected.offset().top - this.list.offset().top);\n\t\t}\n\t\t// update zIndex if jQuery UI is able to process\n\t\tvar zIndexElement = this.element.zIndex();\n\t\tif (zIndexElement) {\n\t\t\tthis.list.css({\n\t\t\t\tzIndex: zIndexElement\n\t\t\t});\n\t\t}\n\t\tthis.list.position({\n\t\t\t\t// set options for position plugin\n\t\t\t\tof: o.positionOptions.of || this.newelement,\n\t\t\t\tmy: o.positionOptions.my,\n\t\t\t\tat: o.positionOptions.at,\n\t\t\t\toffset: o.positionOptions.offset || _offset,\n\t\t\t\tcollision: o.positionOptions.collision || 'flip'\n\t\t\t});\n\t}\n});\n\n})(jQuery);\n","(function($) {\n\nvar log = function() {\n    if (window.console && console.log) {\n        // log for FireBug or WebKit console\n        console.log(Array.prototype.slice.call(arguments));\n    }\n};\n\n\n$.widget('karl.karlcalendarbuttons', {\n\n    options: {\n        // selection = {\n        //     viewtype: 'calendar' or 'list',\n        //     term: 'day' or 'month' or 'year',\n        //     year: 2011,\n        //     month: 9,\n        //     day: 23\n        // }\n        // change: function(evt, selection) {} // data is the same format as this.options.selection\n        ddRoundies: false,                   // use DD_roundies on IE?\n        ie8OnePixelCompensate: true          // compensate the 1-px differences on IE8? (only if ddRoundies == true)\n    },\n\n    _create: function() {\n        var self = this;   \n\n        this.element.append(\n            '<span class=\"karl-calendar-buttonset-term\">' +\n                '<input type=\"radio\" name=\"karl-calendar-buttonset-term\" id=\"karl-calendar-button-day\" class=\"karl-calendar-button-day\"></input><label for=\"karl-calendar-button-day\">Day</label>' +\n                '<input type=\"radio\" name=\"karl-calendar-buttonset-term\" id=\"karl-calendar-button-week\" class=\"karl-calendar-button-week\"></input><label for=\"karl-calendar-button-week\">Week</label>' +\n                '<input type=\"radio\" name=\"karl-calendar-buttonset-term\" id=\"karl-calendar-button-month\" class=\"karl-calendar-button-month\"></input><label for=\"karl-calendar-button-month\">Month</label>' +\n            '</span>' +\n            '<span class=\"karl-calendar-buttonset-viewtype\">' +\n                '<input type=\"radio\" name=\"karl-calendar-buttonset-viewtype\" id=\"karl-calendar-button-calendar\" class=\"karl-calendar-button-calendar\"></input><label for=\"karl-calendar-button-calendar\">Calendar</label>' +\n                '<input type=\"radio\" name=\"karl-calendar-buttonset-viewtype\" id=\"karl-calendar-button-list\" class=\"karl-calendar-button-list\"></input><label for=\"karl-calendar-button-list\">List</label>' +\n            '</span>' +\n\n            '<button class=\"karl-calendar-button-today\">Today</button>' +\n            '<span class=\"karl-calendar-buttonset-navigate\">' +\n                '<input type=\"radio\" name=\"karl-calendar-buttonset-navigate\" id=\"karl-calendar-button-prev\" class=\"karl-calendar-button-prev\"></input><label for=\"karl-calendar-button-prev\" class=\"karl-calendar-label-prev\">&nbsp;</label>' +\n                '<input type=\"radio\" name=\"karl-calendar-buttonset-navigate\" id=\"karl-calendar-button-next\" class=\"karl-calendar-button-next\"></input><label for=\"karl-calendar-button-next\" class=\"karl-calendar-label-next\">&nbsp;</label>' +\n            '</span>' +\n            '<select class=\"karl-calendar-dropdown-year\">' +\n            '</select>' +\n            '<select class=\"karl-calendar-dropdown-month\">' +\n                '<option value=\"1\">Jan</option>' +\n                '<option value=\"2\">Feb</option>' +\n                '<option value=\"3\">Mar</option>' +\n                '<option value=\"4\">Apr</option>' +\n                '<option value=\"5\">May</option>' +\n                '<option value=\"6\">Jun</option>' +\n                '<option value=\"7\">Jul</option>' +\n                '<option value=\"8\">Aug</option>' +\n                '<option value=\"9\">Sep</option>' +\n                '<option value=\"10\">Oct</option>' +\n                '<option value=\"11\">Nov</option>' +\n                '<option value=\"12\">Dec</option>' +\n            '</select>' +\n            '<select class=\"karl-calendar-dropdown-day\">' +\n            '</select>'\n        );\n\n        this.el_b_today = this.element.find('.karl-calendar-button-today');\n\n        this.el_bs_navigate = this.element.find('.karl-calendar-buttonset-navigate');\n        this.el_b_prev = this.element.find('.karl-calendar-button-prev');\n        this.el_b_next = this.element.find('.karl-calendar-button-next');\n\n        this.el_dd_year = this.element.find('.karl-calendar-dropdown-year');\n        this.el_dd_month = this.element.find('.karl-calendar-dropdown-month');\n        this.el_dd_day = this.element.find('.karl-calendar-dropdown-day');\n\n        this.el_bs_viewtype = this.element.find('.karl-calendar-buttonset-viewtype');\n        this.el_b_calendar = this.element.find('.karl-calendar-button-calendar');\n        this.el_b_list = this.element.find('.karl-calendar-button-list');\n\n        this.el_bs_term = this.element.find('.karl-calendar-buttonset-term');\n        this.el_b_day = this.element.find('.karl-calendar-button-day');\n        this.el_b_week = this.element.find('.karl-calendar-button-week');\n        this.el_b_month = this.element.find('.karl-calendar-button-month');\n\n        \n        this.el_b_today.button({\n        });\n        this.el_b_today.click(function(evt) {\n            var d = new Date();\n            var selection = self.options.selection || {};\n            var year = d.getFullYear();\n            var month = d.getMonth() + 1;\n            var day = d.getDate();\n            if (selection.year != year || selection.month != month ||\n                    selection.day != day) {\n                self.options.selection.year = year;\n                self.options.selection.month = month;\n                self.options.selection.day = day;\n                return self._change(evt);\n            }\n        });\n\n        this.el_bs_navigate.buttonset({\n        });\n        this.el_b_prev\n            .button('option', 'icons', {\n                primary: 'ui-icon-triangle-1-w'\n            })\n            .change(function(evt) {\n                return self._navigate(evt, -1);\n            });\n\n        this.el_b_next\n            .button('option', 'icons', {\n                primary: 'ui-icon-triangle-1-e'\n            })\n            .change(function(evt) {\n                return self._navigate(evt, +1);\n            });\n            \n\n        for(var i=2000; i<2025; i++) {\n            this.el_dd_year.append('<option value=\"' + i + '\">' + i + '</option>');\n        }\n\n        this.el_dd_year.find('option').addClass('karl-calendar-dropdown-item');\n        this.el_dd_year.selectmenu({\n            type: 'dropdown',\n            select: function(evt, uiHash) {\n                var value = Number(uiHash.value);\n                if (value > 0 && self.options.selection.year != value) {\n                    self.options.selection.year = value;\n                    return self._change(evt);\n                }\n            }\n        });\n\n        this.el_dd_month.find('option').addClass('karl-calendar-dropdown-item');\n        this.el_dd_month.selectmenu({\n            type: 'dropdown',\n            select: function(evt, uiHash) {\n                var value = Number(uiHash.value);\n                if (value > 0 && self.options.selection.month != value) {\n                    self.options.selection.month = value;\n                    return self._change(evt);\n                }\n            }\n        });\n\n        this.el_bs_viewtype.buttonset({\n        });\n\n        this.el_b_calendar.change(function(evt) {\n            if (self.options.selection.viewtype != 'calendar') {\n                self.options.selection.viewtype = 'calendar';\n                return self._change(evt);\n            }\n        });\n        this.el_b_list.change(function(evt) {\n            if (self.options.selection.viewtype != 'list') {\n                self.options.selection.viewtype = 'list';\n                return self._change(evt);\n            }\n        });\n\n        this.el_bs_term.buttonset({\n        });\n\n        this.el_b_day.change(function(evt) {\n            if (self.options.selection.term != 'day') {\n                self.options.selection.term = 'day';\n                return self._change(evt);\n            }\n        });\n        this.el_b_week.change(function(evt) {\n            if (self.options.selection.term != 'week') {\n                self.options.selection.term = 'week';\n                return self._change(evt);\n            }\n        });\n        this.el_b_month.change(function(evt) {\n            if (self.options.selection.term != 'month') {\n                self.options.selection.term = 'month';\n                return self._change(evt);\n            }\n        });\n\n        this._updateSelection();\n        \n        this.element.find('a.ui-selectmenu').each(function () {\n                $(this).css('margin-top', '-4px');\n            });\n        // Dropdowns need a -2px top offset. margin-top: -4px does not\n        // work well on IE7.\n        if ($.browser.msie && $.browser.version <= 7) {\n            this.element.find('a.ui-selectmenu').each(function () {\n                $(this)\n                    .css('top', '-2px');\n            });\n            this.element.find('.karl-calendar-label-prev, .karl-calendar-label-next').each(function () {\n                $(this)\n                    .css('top', '-2px')\n                    .height($(this).height() + 1);\n            });\n        }\n        \n\n        // Use DD_roundies to give the rounded corners on IE.\n        if (this.options.ddRoundies) {\n            if (! DD_roundies) {\n                throw new Error('DD_roundies must be present, or ddRoundies=false option must be specified.');\n            }\n            DD_roundies.addRule('.cal-buttonbar .ui-corner-left', '4px 0 0 4px');\n            DD_roundies.addRule('.cal-buttonbar .ui-corner-right', '0 4px 4px 0');\n            DD_roundies.addRule('.cal-buttonbar .ui-corner-all', '4px 4px 4px 4px');\n        }\n\n        if (this.options.ddRoundies && this.options.ie8OnePixelCompensate) {         // compensate the 1-px differences on IE8\n            if ($.browser.msie && $.browser.version == 8) {\n                // DD_roundies broken? adds a -1px offset\n                // so, let's take it away\n                this.element.find('.ui-corner-left, .ui-corner-right, ' + \n                            '.ui-corner-all')\n                    .each(function () {\n                        $(this)\n                            .css('top', '1px')\n                            .css('left', '1px')\n                            // ... and add it back to the children\n                            .children().each(function () {\n                                // act only on static position\n                                var el = $(this);\n                                if (el.css('position') == 'static') {\n                                    el\n                                        .css('position', 'relative')\n                                        .css('top', '' + (this.offsetTop - 2) + 'px')\n                                        .css('left', '' + (this.offsetLeft - 2) + 'px');\n                                }\n                            });\n                    });\n            }\n        }\n    },\n    \n    disable: function(evt) {\n        // grey everything\n        // (before leaving the page)\n        this.el_b_today.button('option', 'disabled', true);\n        this.el_bs_navigate.buttonset('option', 'disabled', true);\n        this.el_dd_year.selectmenu('option', 'disabled', true);\n        this.el_dd_month.selectmenu('option', 'disabled', true);\n        this.el_dd_day.selectmenu('option', 'disabled', true);\n        this.el_bs_viewtype.buttonset('option', 'disabled', true);\n        this.el_bs_term.buttonset('option', 'disabled', true);\n    },\n\n    _navigate: function(evt, direction) {\n        var selection = this.options.selection || {};\n        var term = selection.term;\n        var msecsInADay = 86400000;\n        var d1;\n        var d2;\n        if (term == 'month') {\n            this.options.selection.month += direction;\n            if (this.options.selection.month === 0) {\n                this.options.selection.month = 12;\n                this.options.selection.year -= 1;\n            } else if (this.options.selection.month == 13) {\n                this.options.selection.month = 1;\n                this.options.selection.year += 1;\n            }\n        } else if (term == 'week') {\n            d1 = new Date(selection.year, selection.month - 1, selection.day);\n            d2 = new Date(d1.getTime() + direction * 7 * msecsInADay);\n            this.options.selection.year = d2.getFullYear();\n            this.options.selection.month = d2.getMonth() + 1;\n            this.options.selection.day = d2.getDate();\n        } else if (term == 'day') {\n            d1 = new Date(selection.year, selection.month - 1, selection.day);\n            d2 = new Date(d1.getTime() + direction * msecsInADay);\n            this.options.selection.year = d2.getFullYear();\n            this.options.selection.month = d2.getMonth() + 1;\n            this.options.selection.day = d2.getDate();\n        }\n        return this._change(evt);\n    },\n\n    _change: function(evt) {\n        this._updateSelection();\n        this._trigger('change', evt, this.options.selection);\n    },\n    \n    _setOption: function(key, value) {\n        \n        var selectionChanged = (key == 'selection') && \n            this._isSelectionChanged(this.options.selection, value);\n\n        $.Widget.prototype._setOption.call(this, key, value);\n\n        if (selectionChanged) {\n            this._updateSelection();\n        }\n\n    },\n\n    _isSelectionChanged: function(sel1, sel2) {\n        if (!sel1 && !sel2) {\n            return false;\n        }\n        if (!sel1 || !sel2) {\n            return true;\n        }\n        return (\n            (sel1.viewtype != sel2.viewtype) ||\n            (sel1.term != sel2.term) ||\n            (sel1.year != sel2.year) ||\n            (sel1.month != sel2.month) ||\n            (sel1.day != sel2.day)\n        );\n    },\n\n    _updateDays: function() {\n        var self = this;\n\n        if (this.el_dd_day.data('selectmenu')) {\n            this.el_dd_day.selectmenu('destroy');\n        }\n\n        var selection = this.options.selection || {};\n        this.el_dd_day.empty();\n        var month = selection.month;\n        var days;\n        if (month == 2) {\n            // February\n            var year = selection.year;\n            // leap years\n            if (year % 4 === 0 && (year == 2000 || year % 100 > 0)) {\n                days = 29;\n            } else {\n                days = 28;\n            }\n        } else if (month == 4 || month == 6 || month == 9 || month == 11) {\n            // April, June, September, November\n            days = 30;\n        } else {\n            days = 31;\n        }\n        for (var i=1; i<=days; i++) {\n            this.el_dd_day.append('<option value=\"' + i + '\">' + i + '</option>');\n        }\n\n        // rebind\n        this.el_dd_day.find('option').addClass('karl-calendar-dropdown-item');\n        this.el_dd_day.selectmenu({\n            type: 'dropdown',\n            select: function(evt, uiHash) {\n                var value = Number(uiHash.value);\n                if (value > 0 && self.options.selection.day != value) {\n                    self.options.selection.day = value;\n                    return self._change(evt);\n                }\n            }\n        });\n        // re-set the margin for this newly created element\n        this.element.find('a.ui-selectmenu').each(function () {\n                $(this).css('margin-top', '-4px');\n        });\n\n        // Adjust the selection value: for example, Feb. 31 will be\n        // set back to Feb 28... This overcomes the problem of jumping\n        // one month forward, if the next month has no such day.\n        if (this.options.selection.day > days) {\n            this.options.selection.day = days;\n        }\n\n    },\n\n    _updateSelection: function() {\n        var selection = this.options.selection || {};\n\n        // update the number of days in this month\n        this._updateDays();\n\n        // disabling or enabling Today\n        var d = new Date();\n        var year = d.getFullYear();\n        var month = d.getMonth() + 1;\n        var day = d.getDate();\n        var isToday = (selection.year == year && selection.month == month &&\n                selection.day == day);\n        this.el_b_today.button('option', 'disabled', isToday);\n\n        // select the selection date in the dropdowns\n        this.el_dd_year.selectmenu('value', '' + selection.year);\n        this.el_dd_month.selectmenu('value', '' + selection.month);\n        this.el_dd_day.selectmenu('value', '' + selection.day);\n\n        var el_selected_viewtype = {\n            calendar: this.el_b_calendar,\n            list: this.el_b_list\n        }[selection.viewtype];\n\n        if (el_selected_viewtype) {\n            el_selected_viewtype.attr('checked', 'checked');\n        }\n        this.el_bs_viewtype.buttonset('refresh');\n       \n        var el_selected_term = {\n            day: this.el_b_day,\n            week: this.el_b_week,\n            month: this.el_b_month\n        }[selection.term];\n\n        if (el_selected_term) {\n            el_selected_term.attr('checked', 'checked');\n        }\n        this.el_bs_term.buttonset('refresh');\n    },\n\n    destroy: function() {\n        this.el_b_today.button('destroy');\n        this.el_bs_navigate.buttonset('destroy');\n        this.el_dd_year.selectmenu('destroy');\n        this.el_dd_month.selectmenu('destroy');\n        if (this.el_dd_day.data('selectmenu')) {\n            this.el_dd_day.selectmenu('destroy');\n        }\n        this.el_bs_viewtype.buttonset('destroy');\n        this.el_bs_term.buttonset('destroy');\n        $.Widget.prototype.destroy.call( this );\n    }\n\n});\n\n\n\n})(jQuery);\n"," // $Id$\n //\n\nnew (function() {                  // BEGIN CLOSURE Karl\n\nvar Karl = window.Karl = window.Karl || {};\nwindow.Karl.loadTinyMCE = function() {};\n\nvar t = this;\n\n// Some defaults and constants\nKarl.NAME = \"Karl\";\nKarl.VERSION = \"3.00\";\n\nvar createLiveForms = function createLiveForms() {\n    $('.mceEditor').each(function () {\n        var el = this;\n        for(var node=this; node.parentNode; node = node.parentNode) {\n            if(node.tagName.toLowerCase() == 'form') {\n                node.onsubmit = function (e) {\n                    tinyMCE.triggerSave();\n                    ////var editor = tinyMCE.get(el.id)\n                    ////el.value = editor.getContent();\n                };\n                break;\n            }\n        }\n    });\n};\n\n\n\n/**\n * Navigation menus\n *\n * Required for IE only\n * fakes :hover handling\n * see http://www.htmldog.com/articles/suckerfish/dropdowns/ for explanation\n *\n * The following is a port of the Karl2 navmenus.\n */\nvar enableOldStyleDropdowns = function () {\n    if (jQuery.browser.msie) {\n        $('#left li.submenu').each(function() {\n            $(this).mouseover(function() {\n                $(this).addClass('iehover');\n            });\n            $(this).mouseout(function() {\n                $(this).removeClass('iehover');\n            });\n        });\n    }\n};\n\n\n\n// Custom jquery extensions\n\n$.widget('ui.karlstatusbox', {\n\n    options: {\n        clsItem: 'statusbox-item',\n        hasCloseButton: true\n    },\n\n    _create: function() {\n        // initialize the queue\n        this.queue = [];\n    },\n\n    /*\n     * Public methods\n     **/\n\n    /* Clear all messages, or all messages with a given queueCategory */\n    clear: function(/*optional*/ queueCategory) {\n        if (queueCategory === undefined) {\n            // shortcut: clear all items\n            this.element.empty();\n            this.queue = [];\n        } else {\n            // Clear items of the given category\n            var newQueue = [];\n            $(this.queue).each(function() {\n                // The element may have been deleted (by closebutton),\n                // but we don't check for this, since remove() works\n                // safe with elements already removed.\n                if (this.queueCategory == queueCategory) {\n                    this.item.remove();\n                } else {\n                    // keep item in queue\n                    newQueue.push(this);\n                }\n            });\n            this.queue = newQueue;\n        }\n    },\n\n    /* Append a message */\n    append: function(message, /*optional*/ queueCategory) {\n        // default queue category is null.\n        if (queueCategory === undefined) {\n            queueCategory = null;\n        }\n        // Append the item\n        var item = $('<div class=\"' + this.options.clsItem + '\"></div>');\n        item.append($('<div class=\"message\"></div>').append(message));\n        if (this.options.hasCloseButton) {\n            item.append($('<a href=\"#\" class=\"statusbox-closebutton\">X</a>')\n                        .click(function(e) {\n                            item.remove();\n                            e.preventDefault();\n                        })\n            );\n        }\n        // clearing floats\n        if (jQuery.browser.msie) {\n            item.addClass('clear-ie-container');\n        } else {\n            item.append('<div class=\"clear\"></div>');\n        }\n        this.element.append(item);\n        // Remember it on the queue\n        this.queue.push({\n            item: item,\n            queueCategory: queueCategory\n        });\n    },\n\n    /* Append a message after clearing previous messages.\n     * If queueCategory is specified, only the messages added with the\n     * same category are cleared. */\n    clearAndAppend: function(message, /*optional*/ queueCategory) {\n        this.clear(queueCategory);\n        this.append(message, queueCategory);\n    }\n\n\n    /*\n     * Private methods\n     **/\n\n\n});\n\n/*\n$.widget('ui.karllivesearch', $.extend({}, $.ui.autobox3.prototype, {\n\n    options: $.extend({}, $.ui.autobox3.prototype.options, {\n        selectHoverable: '.result .item, .showall .item',\n        // start search from 3rd input character only\n        minQueryLength: 3\n    }),\n\n    activate: function() {\n        if (this.active && this.active[0] && $.data(this.active[0], \"originalObject\")) {\n            var href = $.data(this.active[0], \"originalObject\").href;\n            window.location = href;\n        } else {\n            // submit the form\n            document.forms['ff'].submit();\n        }\n    },\n\n    _setupWidget: function() {\n        var self = this;\n        this.input = this._bindInput(this.element);\n\n        // to be sure there is no FF-autocomplete\n        this.input.attr('autocomplete', 'off');\n\n        // If a click bubbles all the way up to the window, close the autobox\n        // (Note, bind to document and not to windows.\n        // If windows is used, event does not bubble up on IE.\n        $(document).bind(\"click.autobox\", function(){\n            self.cancel();\n        });\n\n    },\n\n    _getBoxOnEnter: function(){\n        // When enter is pressed, always submit the form.\n        // This is needed when autobox is inactive.\n        document.forms['ff'].submit();\n        // Prevent add from happening.\n    },\n\n    _handleActive: function() {\n        // Don't copy the value to the input,\n        // like superclass does.\n    }\n\n}));\n*/\n\n\nKarl.makeSnippets = function(snippetmap) {\n    // compile templates\n    var compiled_map = {};\n    for (var snippet in snippetmap) {\n        compiled_map[snippet] = $.makeTemplate(snippetmap[snippet], \"<%\", \"%>\");\n    }\n    return function(record) {\n        var snippet = record.snippet || '';\n        var template = compiled_map[snippet];\n        return template(record);\n    };\n};\n\nvar wid = 0;\n\nKarl.getJSON = function getJSON(url, data, callback, error) {\n    return jQuery.ajax({\n            type: \"POST\",\n            url: url,\n            data: data,\n            success: callback,\n            error: error,\n            dataType: 'json'\n    });\n};\n\nvar _snip_pre =     '<span>' +\n                    '<a class=\"showtag-link\" href=\"<%= showtag_url %>\"><%= tag %></a>' +\n                    '<span class=\"count\">&nbsp;(' +\n                    '<a class=\"tagusers-link\"  href=\"<%= tagusers_url %>\"><%= count %></a>)</span>';\nvar _snip_input =   '<input type=\"hidden\" name=\"<%= _name %>\" value=\"<%= tag %>\" />';\nvar _snip_post =    '</span>' +\n                    '</li>';\n\n\n$.widget('ui.karltagbox', $.extend({}, $.ui.autobox3.prototype, {\n\n    options: $.extend({}, $.ui.autobox3.prototype.options, {\n        //\n        // Livesearch results with better highlighting\n        //\n        match: function(typed) {\n            this.typed = typed;\n            this.pre_match = this.text;\n            this.match = this.post_match = '';\n            if (!this.ajax && !typed || typed.length === 0) {\n                return true;\n            }\n            var match_at = this.text.search(new RegExp(\"\\\\b\" + typed, \"i\"));\n            if (match_at != -1) {\n                this.pre_match = this.text.slice(0,match_at);\n                this.match = this.text.slice(match_at,match_at + typed.length);\n                this.post_match = this.text.slice(match_at + typed.length);\n                return true;\n            }\n            return false;\n        },\n        insertText: function(obj) {\n            return obj.tag;\n        },\n        templateText: \"<li><%= pre_match %><span class='matching' ><%= match %></span><%= post_match %></li>\",\n        //\n        // Snippets for more flexible client side rendering\n        //\n        snippets: Karl.makeSnippets({\n            '':\n                '<li id=\"<%= _wid %>\" class=\"bit-box\">' +\n                _snip_pre +\n                '<a href=\"#\" class=\"closebutton\"></a>' +\n                _snip_input +\n                _snip_post,\n            nondeleteable:\n                '<li id=\"<%= _wid %>\" class=\"bit-box nondeleteable\">' +\n                _snip_pre +\n                _snip_post\n        }),\n        // The only items addable are the one from the search result.\n        strictAdd: false,\n        selectFirst: false,\n        validateRegexp: null\n    }),\n\n    _addBox: function (record, /*optional*/ initializing) {\n        var self = this;\n        // Update bubble if we already have it\n        var cachekey = record.id || record.tag;\n        var cached = this.bubbles[cachekey];\n        if (cached) {\n            // Is this my tag already?\n            var cachedrecord = cached.record;\n            if (cachedrecord.snippet != 'nondeleteable') {\n                // Don't worry then. We have this tag,\n                // just ignore the event.\n                return;\n            }\n            // Change the snippet, increase the counter,\n            // and update the widget.\n            cachedrecord.snippet = '';\n            cachedrecord.count++;\n            this._updateBox(cached);\n        } else {\n            // Add the bubble.\n            // tagusers_url depends on if we have the data available\n            var tagusers_url;\n            if (this.options.docid) {\n                tagusers_url = this.options.tagusers_url +\n                        '?tag=' + record.tag +\n                        '&docid=' + this.options.docid;\n            } else {\n                // if there is no docid (for example a page being added)\n                // just don't make the link clickable.\n                tagusers_url = 'javascript://return false;';\n            }\n            // add extra info to the records\n            record = $.extend({\n                    // default values for when we add the tag from code\n                    count: 1,\n                    tagusers_url: tagusers_url\n                },\n                record,\n                {\n                    _name: this.options.name || 'box',\n                    _wid: 'bit-' + wid,\n                    showtag_url: this.options.showtag_url + (record.id || record.tag)\n                });\n            wid++;\n            // render the bubble\n            var rendered = this._renderBox(record);\n\n            // Validate the tag on client side.\n            // If this fails the add will not happen.\n            if (! initializing) {\n                var error = this._validateTag(record.tag);\n                if (error) {\n                    // Report the error.\n                    this._appendStatusWithBubble(\n                        'Adding tag failed: ' + error,\n                        rendered);\n                    rendered.remove();\n                    // Finish here.\n                    return;\n                }\n            }\n\n            // cache the record internally\n            this.bubbles[cachekey] = cached = {record:record, li:rendered[0]};\n        }\n        // Ajax save is skipped in the boxes that are added initially.\n        if (! initializing && this.options.ajaxAdd) {\n            Karl.getJSON(this.options.ajaxAdd, \"val=\" + record.tag,\n                function(json) {self._ajaxAddSuccess(cached, json);},\n                function(json) {self._ajaxAddFailure(cached, json);}\n                );\n        }\n    },\n\n    _validateTag: function(tag) {\n        if (this.options.validateRegexp) {\n            if (tag.match(this.options.validateRegexp) === null) {\n                return 'Value contains characters that are not allowed in a tag.';\n            }\n        }\n        // No error.\n        return;\n    },\n\n    _ajaxAddSuccess: function (cached, json) {\n        // use error sent by server, if available\n        var error = json && json.error;\n        if (error) {\n            this._ajaxAddFailure(cached, json);\n        }\n    },\n\n    _ajaxAddFailure: function (cached, json) {\n        // use error sent by server, if available\n        var error = json && json.error;\n        if (! error) {\n            error = 'Adding tag failed';\n        }\n        // Report the error\n        this._appendStatusWithBubble(error, cached.li);\n        // Remove bubble\n        this._delBox(cached.li, true);\n    },\n\n    _renderBox: function (record) {\n        var self = this;\n        // render the snippet\n        var rendered = this.options.snippets(record);\n        rendered = this.holder.find('.autobox-input').before(rendered).prev();\n        this.input.val('');\n        // Bind the close button\n        $('.closebutton', rendered).bind('click', function(e) {\n                  self._delBox(rendered);\n                  e.preventDefault();\n              });\n        return rendered;\n    },\n\n    _delBox: function(li, /*optional*/ initializing) {\n        var self = this;\n        li = $(li);\n        // Update bubble if counter > 1\n        var tagkey = li.find('input')[0].value;\n        var cached = this.bubbles[tagkey];\n\n        if (cached && cached.record.count > 1) {\n            // This is also a global tag.\n            var cachedrecord = cached.record;\n            // Change the snippet, increase the counter,\n            // and update the widget.\n            cachedrecord.snippet = 'nondeleteable';\n            cachedrecord.count--;\n            this._updateBox(cached);\n        } else {\n\n            // Else proceed with deletion\n            $.ui.autobox3.prototype._delBox.call(this, li);\n\n            // And delete it from the cache too\n            delete this.bubbles[tagkey];\n        }\n        // Do the ajax in any case\n        if (! initializing && this.options.ajaxDel) {\n            Karl.getJSON(this.options.ajaxDel, \"val=\" + tagkey,\n                function(json) {self._ajaxDelSuccess(cached, json);},\n                function(json) {self._ajaxDelFailure(cached, json);}\n                );\n        }\n    },\n\n    _ajaxDelSuccess: function (cached, json) {\n        // use error sent by server, if available\n        var error = json && json.error;\n        if (error) {\n            this._ajaxDelFailure(cached, json);\n        }\n    },\n\n    _ajaxDelFailure: function (cached, json) {\n        // use error sent by server, if available\n        var error = json && json.error;\n        if (! error) {\n            error = 'Deleting tag failed';\n        }\n        // Report the error\n        this._appendStatusWithBubble(error, cached.li);\n        // add back the bubble\n        this._addBox(cached.record, true);\n    },\n\n\n    _updateBox: function(cached) {\n        // render the bubble\n        var rendered = this._renderBox(cached.record);\n        // and replace the original li with it\n        $(cached.li).after(rendered).remove();\n        cached.li = rendered;\n    },\n\n    _createHolder: function (element) {\n        var holder = $.ui.autobox3.prototype._createHolder.call(this, element);\n        // Add a div around it and place the original widget and a status box\n        // into this wrapper div\n        var newholder = holder.wrap('<div class=\"statusbox-wrapper\"></div>').parent()\n            .append(\n                $('<div class=\"statusbox\"></div>')\n                    .karlstatusbox()\n                );\n        this.statusbox = $(\"*:last\", newholder);\n        return newholder;\n    },\n\n    _clearStatus: function() {\n        this.statusbox.karlstatusbox('clear');\n    },\n\n    _appendStatus: function(message) {\n        this.statusbox.karlstatusbox('append', message);\n    },\n\n    _appendStatusWithBubble: function(message, bubble) {\n        // clone the bubble and remove the input from it\n        // to avoid collision in case it gets submitted in form\n        bubble = $(bubble).clone();\n        bubble.find('input').remove();\n        var fullmessage = $('<span class=\"message-span\"></span><span class=\"bubble-span\"></span>');\n        fullmessage.eq(0).text(message);\n        fullmessage.eq(1).append(bubble);\n        this._appendStatus(fullmessage);\n        // bind the bubble's closebutton\n        var item = this.statusbox.find('>:last-child');\n        $('.closebutton', bubble)\n            .bind('click', function(e) {\n                item.remove();\n                e.preventDefault();\n            });\n    },\n\n    _setupWidget: function() {\n        // initialize tag cache\n        this.bubbles = {};\n        $.ui.autobox3.prototype._setupWidget.call(this);\n        var self = this;\n        // add a button after the input\n        // also wrap it to avoid breaking\n        this.input.wrap('<span></span>');\n        $('<button class=\"button primary_button inline addtag-button\" type=\"button\"><span>Add</span></button>')\n            .bind('click', function(e) {\n                // We generate the record first...\n                // (null result means we need not add it)\n                var record = self._getBoxOnEnter();\n                if (record) { self._addBox(record); }\n                e.preventDefault();\n            })\n            .insertAfter(this.input);\n\n\n        // populate additional methods from options\n        if (this.options.validateTag) {\n            this._validateTag = this.options.validateTag;\n        }\n    },\n\n    _updateList: function(list){\n        // store the value\n        this.cached_result = list;\n        $.ui.autobox3.prototype._updateList.call(this, list);\n        if (this.options.selectFirst) {\n            // is there at least one selectable in the list?\n            var children = $(\"> *\", this.container);\n            if (children.length > 0) {\n                // Select the first element\n                this.active = children.eq(0);\n                this.active.addClass('active');\n            }\n        }\n    },\n\n    _getCurrentValsHash: function(input) {\n        // (XXX ignore \"input\" really... the parameter seems\n        // to serve little or no role here.)\n        var hash = {};\n        // The hash that we construct will serve to exclude\n        // these elements from the new searches.\n        for (var tagkey in this.bubbles) {\n            var cachedrecord = this.bubbles[tagkey].record;\n            if (cachedrecord.snippet != 'nondeleteable') {\n                // This value will be exluded from search results.\n                // We _always_ use the tag text here.\n                hash[cachedrecord.tag] = true;\n            }\n        }\n        return hash;\n    }\n\n\n}));\n\n\n/*\n * A variant of the tagbox, used for members.\n * It only allows entering the items from the search result set.\n */\n$.widget('ui.karlmemberbox', $.extend({}, $.ui.karltagbox.prototype, {\n\n    options: $.extend({}, $.ui.karltagbox.prototype.options, {\n        strictAdd: true,\n        selectFirst: true,\n        getBoxFromSelection: function() {\n            // Is there an active object?\n            var record = this.active && this.active[0] && $.data(this.active[0], \"originalObject\");\n            if (! record) {\n                // Prevent it from happen.\n                return;\n            }\n            return {\n                tag: record.text,\n                id: record.id\n            };\n        },\n        getBoxOnEnter: function() {\n            return this._getBoxFromSelection();\n        },\n        snippets: Karl.makeSnippets({\n            '':\n                '<li id=\"<%= _wid %>\" class=\"bit-box\">' +\n                '<span>' +\n                '<a class=\"showtag-link\" href=\"<%= showtag_url %>\"><%= tag %></a>' +\n                '<a href=\"#\" class=\"closebutton\"></a>' +\n                '<input type=\"hidden\" name=\"<%= _name %>\" value=\"<%= id %>\" />' +\n                '</span>' +\n                '</li>'\n        })\n\n    })\n\n}));\n\n\n$.widget('ui.karlgrid', $.extend({}, $.ui.grid.prototype, {\n\n    options: $.extend({}, $.ui.grid.prototype.options, {\n        width: 500,\n        height: 300,\n\n        limit: false,\n        pagination: true,\n        allocateRows: true, //Only used for infinite scrolling\n        chunk: 20, //Only used for infinite scrolling\n\n        footer: true,\n        toolbar: false,\n\n        multipleSelection: true,\n\n        evenRowClass: 'even',\n        oddRowClass: 'odd',\n\n        sortColumn: '',\n        sortDirection: '',\n\n        initialState: null,\n\n        allocateWidthForScrollbar: false,  // if set to true, the space for\n            // scrollbar will be reserved next to the rightest column\n        scrollbarWidth: 15\n            // only effective of allocateWidthForScrollbar is true\n\n\n    }),\n\n    _create: function() {\n        // null out the scrollbar width if it is not allowed\n        if (! this.options.allocateWidthForScrollbar) {\n            this.options.scrollbarWidth = 0; // no scrollbar - no width\n        }\n        $.ui.grid.prototype._create.call(this, arguments);\n\n        // Set the width of the content div\n        // this is needed for sake of IE7, who otherwise\n        // place a scrollbar outside the box\n        this.contentDiv.width(this.options.width);\n    },\n\n    _generateColumns: function() {\n\n        this.columnsContainer = $('<tr class=\"ui-grid-columns\"><td><div class=\"ui-grid-columns-constrainer\"><table cellpadding=\"0\" cellspacing=\"0\"><tbody><tr class=\"ui-grid-header ui-grid-inner\"></tr></tbody></table></div></td></tr>')\n            .appendTo(this.grid).find('table tbody tr');\n\n        $('.ui-grid-columns-constrainer', this.grid).css({\n            width: this.options.width,\n            overflow: 'hidden'\n        });\n\n        // columns will have borders collapsed\n        $('table', this.grid).css({\n            'border-collapse': 'collapse'\n        });\n\n        // XXX Do _not_ make it sortable.\n        //this.columnsContainer.gridSortable({ instance: this });\n\n    },\n\n    _syncColumnWidth: function() {\n        var self = this;\n\n        // calculate desired widths\n        var column_widths = [];\n        var totalWidth = 0;\n        $('td', this.columnsContainer).each(function() {\n            var width = $(this).outerWidth();\n            column_widths.push(width);\n            totalWidth += width;\n        });\n        // we have to subsctract the scrollbar width, as we\n        // have created a placeholder column\n        if (this.options.scrollbarWidth > 0) {\n            totalWidth -= this.options.scrollbarWidth;   // this was the last added width.\n        }\n\n        // set width on all cells\n        // XXX This would probably work bad with infinite scrolling!\n        $('> tr', this.content).each(function() {\n            $('> td', this).each(function(i) {\n                var elem = $(this);\n                var width = column_widths[i];\n                // Take offset into consideration\n                var offset = elem.outerWidth() - elem.width();\n                if (i==0) {\n                    // Since we have no bordercollapse in the column part:\n                    // increase first field's width with the left border\n                    offset -= self.leftBorder;\n                }\n                width -= offset;\n                // adjust cell width\n                elem\n                    // overflow is essential for column width\n                    .css('overflow', 'hidden')\n                    .width(width);\n            });\n\n        });\n\n        // set the width of the whole table\n        this.content.parent()     // this.content is the <tbody>, parent is the <table>.\n            .width(totalWidth + this.options.scrollbarWidth)\n            //.css('overflow', 'hidden')\n            // table-layout is essential for column width\n            .css('table-layout', 'fixed');\n\n    },\n\n    _addColumns: function(columns) {\n\n        this.columns = columns;\n        var totalWidth = 0;\n        this.columns_by_id = {};\n\n        // Use sort column and direction as set by _onClick handler,\n        // allow to provide initial defaults by options.\n        var sortColumn = this.sortColumn || this.options.sortColumn;\n        var sortDirection = this.sortDirection || this.options.sortDirection;\n\n        for (var i=0; i < columns.length; i++) {\n            var column_meta = columns[i];\n\n            var sortDirectionClass = '';\n            // Do we have a sorting direction?\n            if (sortColumn == column_meta.id) {\n                sortDirectionClass = ' ui-icon ' + (sortDirection == 'asc' ? 'ui-icon-carat-1-s' : 'ui-icon-carat-1-n');\n            }\n\n            var column = $('<td class=\"ui-grid-column-header ui-state-default\">' +\n                           '  <div style=\"position: relative;\">' + // inner div is needed for relativizing position\n                           '    <a href=\"javascript://return false;\">' +\n                           '      <span class=\"ui-grid-column-header-text\">' + column_meta.label + '</span>' +\n                           '    </a>' +\n                           '    <span class=\"ui-grid-visual-sorting-indicator' + sortDirectionClass + '\"></span>' +\n                           '  </div>' +\n                           '</td>')\n                .data('grid-column-header', column_meta)\n                .appendTo(this.columnsContainer);\n\n            var offset = column.outerWidth() - column.width();\n            if (i==0) {\n                // the first column gets the left offset\n                // subscribed from width as well\n                // this is needed to compensate for left column border\n                //this.leftBorder = column[0].offsetLeft;\n                if (jQuery.browser.msie) {\n                    this.leftBorder = 0;\n                } else {\n                    // FF, Safari\n                    // XXX for now we suppose a (table) border of 1\n                    this.leftBorder = 1;\n                }\n                offset += this.leftBorder;\n            }\n            column.width(column_meta.width - offset);\n\n            totalWidth += column_meta.width;\n\n            // XXX Do not make the columns resizable.\n            //column.gridResizable();\n        };\n\n        //This column is the last and only used to serve as placeholder for a scrollbar\n        if (this.options.scrollbarWidth > 0) {\n            $('<td class=\"ui-state-default ui-grid-column-scrollbar\"><div></div></td>')\n                .width(this.options.scrollbarWidth)\n                .appendTo(this.columnsContainer);\n        }\n\n        //Update the total width of the wrapper of the column headers\n        var header_table = this.columnsContainer.parent().parent();\n        header_table.width(totalWidth + this.options.scrollbarWidth);\n\n        // Send event that columns are setup\n        this.element.trigger('karlgrid_columns_set');\n\n    },\n\n    _handleClick: function(event) {\n\n        var el = $(event.target);\n\n        // Click on column header toggles sorting\n        if (el.is('.ui-grid-column-header, .ui-grid-column-header *')) {\n            return this._onClickHeader(el);\n        }\n\n        // Handle click on pagination buttons\n        if (el.is('.ui-grid-pagination a, .ui-grid-pagination a *')) {\n            var current= Math.floor((this.offset + this.options.limit - 1) / this.options.limit) + 1;\n            if (el.hasClass('ui-icon-circle-arrow-w') || el.find('.ui-icon-circle-arrow-w').length > 0) current --;\n            if (el.hasClass('ui-icon-circle-arrow-e') || el.find('.ui-icon-circle-arrow-e').length > 0) current ++;\n            if (! isNaN(parseInt(event.target.innerHTML, 10))) current = parseInt(event.target.innerHTML, 10);\n\n            this.offset = (current - 1) * this.options.limit;\n            this._update();\n        }\n\n        return false;\n    },\n\n    _onClickHeader: function(el) {\n        // Header clicked: toggle sorting\n        var header = el.hasClass('ui-grid-column-header') ? el : el.parents('.ui-grid-column-header');\n        var data = header.data('grid-column-header');\n        this.sortDirection = this.sortDirection == 'desc' ? 'asc' : 'desc';\n        this.sortColumn = data.id;\n        this._update ({columns: false, refresh: true});\n        // prevent default\n        return false;\n    },\n\n    _makeRowsSelectable: function() {\n        // We don't really make the row selectable, rather use\n        // this method to set up our click handler.\n        var self = this;\n        var table = this.content.parent().parent();\n        table.bind('mousedown', function(event) {\n            return self._onClickRow($(event.target));\n        });\n    },\n\n    _onClickRow: function(target) {\n        // Clicking on a row follows the first link in it.\n        var filter = 'tr';\n        var item;\n\n        // find out the row that has been clicked\n        var table = this.content.parent().parent();\n        target.parents().andSelf().each(function() {\n            if ($('tr', table).index(this) != -1) item = this;\n        });\n\n        if (item) {\n            // follow the (first) link in it\n            var links = $('a', item);\n            if (links.length > 0) {\n                window.location = links[0].href;\n            }\n        }\n\n        // prevent default\n        return false;\n    },\n\n    _addRow: function(item, dontAdd) {\n\n        var row = $.ui.grid.prototype._addRow.call(this, item, dontAdd);\n\n        if (this.options.scrollbarWidth > 0) {\n            $('<td class=\"ui-grid-column ui-state-active\"><div>&nbsp;</div></td>')\n                .width(this.options.scrollbarWidth)\n                .appendTo(row);\n        }\n\n\n        // Calculate the oddity of the newly added row. We do the\n        // following check after the row has already been added.\n        var oddity = (this.content.find('tr').length % 2 == 1);\n\n        // Add class based on oddity and options\n        if (oddity && this.options.oddRowClass) {\n            row.addClass(this.options.oddRowClass);\n        }\n\n        if (! oddity && this.options.evenRowClass) {\n            row.addClass(this.options.evenRowClass);\n        }\n\n        return row;\n\n    },\n\n    _generateFooter: function() {\n        this.footer = $('<tr class=\"ui-grid-footer ui-widget-header\"><td>'+\n        '<span class=\"ui-grid-footer-text ui-grid-limits\"></span>'+\n        '</td></tr>').appendTo(this.grid).find('td');\n    },\n\n    _generatePagination: function(response) {\n        this.pagination = $('<span class=\"ui-grid-pagination clearafter\"></span>').appendTo(this.footer);\n        this.footerResultsBox = $('.ui-grid-limits, .ui-grid-no-limits', this.footer);\n        this._updatePagination(response);\n    },\n\n    /* XXX need to overwrite this for not showing\n     * pagination if there are 0 or 1 pages */\n    _updatePagination: function(response) {\n\n        var pages = Math.floor((response.totalRecords + this.options.limit - 1) / this.options.limit),\n            current= Math.floor((this.offset + this.options.limit - 1) / this.options.limit) + 1,\n            displayed = [];\n\n        this.pagination.empty();\n\n        if (pages <= 1) {\n            // Deactivate the Results: box\n            // This means that if it does not have the ui-grid-limits\n            // class, the updater won't update the Results: infoline on it\n            this.footerResultsBox\n                .removeClass('ui-grid-limits')\n                .addClass('ui-grid-no-limits')\n                .html('');\n            return;\n        }\n\n        // Activate the Results: box\n        this.footerResultsBox\n            .removeClass('ui-grid-no-limits')\n            .addClass('ui-grid-limits');\n\n        for (var i=current-1; i > 0 && i > current-3; i--) {\n            this.pagination.prepend('<a href=\"#\" class=\"ui-state-default\">'+i+'</a>');\n            displayed.push(i);\n        };\n\n        for (var i=current; i < pages+1 && i < current+3; i++) {\n            this.pagination.append(i==current? '<span class=\"ui-state-active\">'+i+'</span>' :\n                    '<a href=\"#\" class=\"ui-state-default\">'+i+'</a>' );\n            displayed.push(i);\n        };\n\n\n        if(pages > 1 && $.inArray(2, displayed) == -1) //Show front dots if the '2' is not already displayed and there are more pages than 1\n            // XXX XXX\n            this.pagination.prepend('<span class=\"ui-grid-pagination-dots\">...</span>');\n\n        if($.inArray(1, displayed) == -1) //Show the '1' if it's not already shown\n            this.pagination.prepend('<a href=\"#\" class=\"ui-state-default\">1</a>');\n\n        if($.inArray(pages-1, displayed) == -1) //Show the dots between the current elipse and the last if the one before last is not shown\n            // XXX XXX\n            this.pagination.append('<span class=\"ui-grid-pagination-dots\">...</span>');\n\n        if($.inArray(pages, displayed) == -1) //Show the last if it's not already shown\n            this.pagination.append('<a href=\"#\" class=\"ui-state-default\">'+pages+'</a>');\n\n        this.pagination.prepend(current-1 > 0 ?\n                '<a href=\"#\" class=\"ui-state-default ui-grid-pagination-icon\"><div class=\"ui-icon ui-icon-circle-arrow-w\">Prev</div></a>' :\n                '<span class=\"ui-state-default ui-state-disabled ui-grid-pagination-icon\"><div class=\"ui-icon ui-icon-circle-arrow-w\">Prev</div></span>');\n        this.pagination.append(current+1 > pages ?\n                '<span href=\"#\" class=\"ui-state-default ui-state-disabled ui-grid-pagination-icon\"><div class=\"ui-icon ui-icon-circle-arrow-e\">Next</div></span>' :\n                '<a href=\"#\" class=\"ui-state-default ui-grid-pagination-icon\"><div class=\"ui-icon ui-icon-circle-arrow-e\">Next</div></a>');\n\n        this.pagination.find('a.ui-state-default')\n            .hover(\n                function() {\n                    $(this).addClass('ui-state-hover');\n                },\n                function() {\n                    $(this).removeClass('ui-state-hover');\n                }\n            );\n\n    },\n\n    _extendFetchOptions: function(fetchOptions) {\n        return $.extend({}, fetchOptions, {\n            limit: this.options.limit,\n            start: (! (fetchOptions && fetchOptions.refresh) && this.offset) || 0,\n            refresh: (fetchOptions && fetchOptions.refresh) || (fetchOptions && fetchOptions.columns)\n        })\n    },\n\n    /* XXX need to overwrite this to be able to customize\n     * behaviour like displaying Results data.  */\n    _update: function(o) {\n        var self = this;\n\n        var fetchOptions = $.extend({}, this._extendFetchOptions(fetchOptions), {\n        // XXX Is this needed?\n        //    fill: null\n        });\n\n        if (fetchOptions.refresh) {\n            fetchOptions.start = this.infiniteScrolling ? 0 : (this.offset || 0);\n        }\n        //Somehow the keys for these must stay undefined no matter what\n        if(this.sortColumn) fetchOptions.sortColumn = this.sortColumn;\n        if(this.sortDirection) fetchOptions.sortDirection = this.sortDirection;\n\n        //Do the ajax call\n        this.gridmodel.fetch(fetchOptions, function(state) {\n            self._doUpdate(state, o);\n        });\n\n    },\n\n    _initialUpdate: function() {\n        // Override the options for the grid model. The model bundles the ajax\n        // call including the parsing of the received data into a dictionary.\n        // In order to convert the records from list-format to dictionary-format,\n        // it does not pass the entire\n        // response data as-is, to _doUpdate.\n        // In order to do this, we need to modify the parse function of the\n        // grid model - foolishly, this is not easy. (So why is it an option\n        // then, at all??)\n        //\n        // we need to enable this to be overwritten...\n        if (! this._grid_model_parse) {\n            this._grid_model_parse = $.ui.grid.model.defaults.parse;\n        }\n\n        // overwrite this, after created originally\n        this.gridmodel = $.ui.grid.model({\n            url: this.options.url,\n            parse: this._grid_model_parse\n        });\n        //\n        var initialState = this.options.initialState;\n        if (initialState) {\n            // Initial state: use it to load content\n            // Need to convert each record from a flat list to a keyed dict\n            //initialState = $.ui.grid.model.defaults.parse(initialState);\n            initialState = this._grid_model_parse(initialState);\n            // load them to the table\n            this._doUpdate(initialState, {columns: true});\n        } else {\n            // Query the content from the server\n            this._update({columns: true});\n        }\n    },\n\n    _doUpdate: function(state, o) {\n        var self = this;\n\n        //Generate or update pagination\n        if (this.options.pagination && ! this.pagination) {\n            this._generatePagination(state);\n        } else if (this.options.pagination && this.pagination) {\n            this._updatePagination(state);\n        }\n\n        var self = this;\n        var fetchOptions = this._extendFetchOptions(o);\n\n        //Empty the content if we either use pagination or we have to restart infinite scrolling\n        if (!this.infiniteScrolling || fetchOptions.refresh)\n            this.content.empty();\n\n        //Empty the columns\n        if (fetchOptions.refresh) {\n            this.columnsContainer.empty();\n            this._addColumns(state.columns);\n        }\n\n        //If infiniteScrolling is used and there's no full refresh, fill rows\n        if(this.infiniteScrolling && ! fetchOptions.refresh) {\n\n            var data = [];\n            for (var i=0; i < state.records.length; i++) {\n                data.push(this._addRow(state.records[i]));\n            };\n\n            o.fill({\n                chunk: o.chunk,\n                data: data\n            });\n\n        } else { //otherwise, simply append the rows to the now emptied list\n\n            for (var i=0; i < state.records.length; i++) {\n                this._addRow(state.records[i]);\n            };\n\n            this._syncColumnWidth();\n\n            //If we're using infinite scrolling, we have to restart it\n            if(this.infiniteScrolling) {\n                this.contentDiv.infiniteScrolling('restart');\n            }\n\n        }\n\n        //Initiate infinite scrolling if we don't use pagination and total records exceed the displayed records\n        if(!this.infiniteScrolling && !this.options.pagination && fetchOptions.limit < state.totalRecords) {\n\n            this.infiniteScrolling = true;\n            this.contentDiv.infiniteScrolling({\n                total: self.options.allocateRows ? state.totalRecords : false,\n                chunk: self.options.chunk,\n                scroll: function(e, ui) {\n                    self.offset = ui.start;\n                    self._update({ fill: ui.fill, chunk: ui.chunk });\n                },\n                update: function(e, ui) {\n                    $('.ui-grid-limits', self.footer).html('Result ' + ui.firstItem + '-' + ui.lastItem + (ui.total ? ' of '+ui.total : ''));\n                }\n            });\n\n        }\n\n        if (! this.infiniteScrolling) {\n            // start numbering from 1\n            var firstItem = fetchOptions.start + 1;\n            // last  should not be more than the total records\n            var lastItem = Math.min(fetchOptions.start + fetchOptions.limit, state.totalRecords);\n            $('.ui-grid-limits', this.footer).html('Result ' +\n                    (firstItem == lastItem ? firstItem : firstItem + '-' + lastItem) +\n                    ' of ' + state.totalRecords);\n        }\n    }\n\n}));\n\n\n$.widget('ui.karlfilegrid', $.extend({}, $.ui.karlgrid.prototype, {\n\n    options: $.extend({}, $.ui.karlgrid.prototype.options, {\n        delete_url: 'delete_files.json',  // url relative to the context\n        moveto_url: 'move_files.json',  // url relative to the context\n        download_url: 'download_zipped',  // url relative to the context\n        selectionColumnId: 'sel',  // the column id of the column that does the selection\n        folderMenuIndent: 16       // indentation for subfolder levels in pixel\n    }),\n\n\n    _create: function() {\n        var self = this;\n\n        // create dialogs\n        this.dialogDeleteConfirm = $(\n            '<div class=\"ui-grid-dialog-content\">' +\n                '<p>Are you sure you want to delete the selected files and/or folders?</p>' +\n            '</div>'\n        );\n        this.dialogDeleteConfirm\n            .appendTo('body')\n            .hide()\n            .karldialog({\n                width: 400,\n                buttons: {\n                    Cancel: function() {\n                        $(this).karldialog('close');\n                    },\n                    'Delete': function() {\n                        $(this).karldialog('close');\n                        self._onDeleteConfirmed();\n                    }\n\t\t},\n                open: function() {\n                },\n                close: function() {\n                }\n            });\n\n\n        this.dialogMoveConfirm = $(\n            '<div class=\"ui-grid-dialog-content\">' +\n                '<p>Are you sure you want to move these files/folders to \"<span></span>\"?</p>' +\n            '</div>'\n        );\n        this.dialogMoveFolderName = this.dialogMoveConfirm.find('span');\n        this.dialogMoveConfirm\n            .appendTo('body')\n            .hide()\n            .karldialog({\n                width: 400,\n                buttons: {\n                    Cancel: function() {\n                        $(this).karldialog('close');\n                    },\n                    'Move': function() {\n                        $(this).karldialog('close');\n                        var selected = self.dialogMoveFolderName.data('folder');\n                        self._onMoveConfirmed(selected);\n                    }\n\t\t},\n                open: function() {\n                },\n                close: function() {\n                }\n            });\n\n\n        this.dialogDownloadConfirm = $(\n            '<div class=\"ui-grid-dialog-content\">' +\n                '<p>Are you sure you want to download the <span></span> selected files and/or folders?</p>' +\n            '</div>'\n        );\n        this.dialogDownloadItems = this.dialogDownloadConfirm.find('span');\n        this.dialogDownloadConfirm\n            .appendTo('body')\n            .hide()\n            .karldialog({\n                width: 400,\n                buttons: {\n                    Cancel: function() {\n                        $(this).karldialog('close');\n                    },\n                    'Download': function() {\n                        $(this).karldialog('close');\n                        var items = self.dialogDownloadItems.data('items');\n                        self._onDownloadConfirmed(items);\n                    }\n\t\t},\n                open: function() {\n                },\n                close: function() {\n                }\n            });\n\n\n        $.ui.karlgrid.prototype._create.call(this, arguments);\n    },\n\n    setTargetFolders: function(state, callback) {\n        var self = this;\n        // set target folders\n        // XXX do this in async.\n        if (this.moveToLoading) {\n            // loading already - ignore\n            log('Ignored MoveTo menu update, because the previous update is still in progress');\n            // enable or disable the reorganize buttons\n            this._enableDisableButtons();\n            return;\n        }\n        this.moveToLoading = true;\n        //this.button_move.button('option', 'icons', {primary: 'ui-icon-arrowrefresh-1-e'});\n        this.button_move.button('option', 'icons', {primary: 'karl-icon-loading'});\n        // enable or disable the reorganize buttons\n        this._enableDisableButtons();\n        setTimeout(function() {\n            self._do_setTargetFolders(state);\n            self.moveToLoading = false;\n            self.button_move.button('option', 'icons', {primary: 'ui-icon-folder-open'});\n            self._enableDisableButtons();\n            // finish deferred click\n            if (callback) {\n                callback.call(this);\n            }\n        }, 10);\n    },\n\n    _do_setTargetFolders: function(state) {\n        var folders = state.targetFolders;\n        var current_folder = state.currentFolder;\n        // We assume that folders are sorted,\n        // otherwise the containment stucture would not work nicely\n        var self = this;\n        this.menuMove.find('li').remove();\n        function countSlashes(s) {\n            var n = 0;\n            for (var i = 1; i < s.length; i++) {\n                if (s.charAt(i) === \"/\") {\n                    n++;\n                }\n            }\n            return n;\n        }\n\n        window.startTime = (new Date()).valueOf();\n\n        // XXX\n        // ie chokes on a large number of folders, so we are limiting it for now\n        var limit = ($.browser.msie ? Math.min(folders.length, 400) : folders.length);\n        for (var i = 0; i < limit; i++) {\n            var folder = folders[i];\n            var folder_path = folder.path;\n            var folder_title = folder.title;\n            if (! folder_path || folder_path.charAt(0) != '/') {\n                throw new Error('Fatal error: folder path must start with a \"/\"');\n            }\n            var level;\n            if (folder_path == '/') {\n                // special case, handle differently.\n                level = 0;\n            } else {\n                if (folder_path && folder_path.charAt(folder_path.length - 1) == '/') {\n                    throw new Error('Fatal error: folder path must not end with a \"/\"');\n                }\n                // The folder path is like /f1/f2/f3\n                // we want to produce leafFolder = f3, level = 2 from this.\n                //level = folder_path.match(/\\//g).length - 1;\n                level = countSlashes(folder_path);\n            }\n            // create the item\n            var item = $('<li></li>')\n                .css('textAlign', 'left')\n                .data('folder', folder)\n                .appendTo(self.menuMove);\n\n            // create the label. If this is not the current folder, it will be an <a>.\n            // If this is the target folder, it will be a <span>. Also in this case\n            // it needs the appear in the results, but it should not be selectable.\n            var label;\n            if (folder_path != current_folder) {\n                label = $('<a></a>');\n            } else {\n                label = $('<span></span>');\n            }\n            label\n                .appendTo(item)\n                .text(folder_title)\n                .css('marginLeft', '' + (level * self.options.folderMenuIndent) + 'px');\n        }\n        window.midTime = (new Date()).valueOf();\n        this.menuMove.menu('refresh');\n\n        window.endTime = (new Date()).valueOf();\n        window.movetoLoadingTime = 'MoveTo menu loading: ' + (window.midTime - window.startTime) + ' + ' + (window.endTime - window.midTime);\n        ////alert(window.movetoLoadingTime);\n    },\n\n    getSelectedFiles: function() {\n        // Returns the list of selected files\n        var self = this;\n        var filenames = [];\n        this.content.find('input.ui-grid-selector[type=\"checkbox\"]:checked')\n            .each(function(index, cb) {\n                var data = $(cb).parents('.ui-grid-row').data('karlfilegrid-rowdata');\n                // we saved the name of the file and retrieve it now\n                filenames.push(data._name);\n            });\n            return filenames;\n    },\n\n    getSelectedTotalSize: function() {\n        // Returns the sum of selected file sizes\n        var self = this;\n        var size = 0;\n        this.content.find('input.ui-grid-selector[type=\"checkbox\"]:checked')\n            .each(function(index, cb) {\n                var data = $(cb).parents('.ui-grid-row').data('karlfilegrid-rowdata');\n                size += data._size;\n            });\n            return size;\n    },\n\n    _enableDisableButtons: function() {\n        // Enable or disable the buttons based on the number of selections\n        var selected = this.getSelectedFiles().length > 0;\n        var canDelete = selected && this.options.initialState.canDelete;\n        this.button_delete.button('option', 'disabled', ! canDelete);\n        this.button_download.button('option', 'disabled', ! selected);\n        var enabled = (selected && ! this.moveToLoading)\n        this.button_move.button('option', 'disabled', ! canDelete);\n    },\n\n    _addColumns: function(columns) {\n        var self = this;\n        $.ui.karlgrid.prototype._addColumns.call(this, columns);\n        // Add the checbox in the 'sel' column.\n        var sel_column = this.columnsContainer\n            .find('.ui-grid-column-header')\n            .filter(function(index) {\n                return columns[index].id == self.options.selectionColumnId;\n            })\n            .html('');\n        var globalselect_wrapper = $('<div class=\"ui-grid-globalselector\"></div>')\n            .appendTo(sel_column);\n        this.cb_globalselect = $('<input type=\"checkbox\" title=\"Select/Unselect all items\">')\n            .change(function() {\n                self._onGlobalSelect($(this).attr('checked'));\n            })\n            .appendTo(globalselect_wrapper);\n    },\n\n    _addRow: function(item, dontAdd) {\n        var row = $.ui.karlgrid.prototype._addRow.call(this, item, dontAdd);\n        // annotate the data on the row\n        row.data('karlfilegrid-rowdata', item);\n        return row;\n    },\n\n    _initialUpdate: function() {\n        var self = this;\n        // manually include the additional fields we need.\n        var oldparse = $.ui.grid.model.defaults.parse;\n        this._grid_model_parse = function(response) {\n            var d = oldparse(response);\n            // add the data needed for the reorganization\n            // as it will be needed for each _doUpdate\n            d.targetFolders = response.targetFolders;\n            d.currentFolder = response.currentFolder;\n            d.canDelete = response.canDelete;\n            // Also:\n            // overwrite the 'sel' field in all records.\n            // This means that the server needs not send over\n            // the values, only an empty string.\n            $.each(d.records, function(index, record) {\n                // In the selector column, the server _must_ send the original filename (id)\n                // We remember this and replace the column with a rendered checkbox\n                record_data = record[self.options.selectionColumnId];\n                record._name = record_data[0];\n                record._size = record_data[1];\n                record[self.options.selectionColumnId] =\n                    '<input type=\"checkbox\" class=\"ui-grid-selector\" title=\"Select item\">';\n            });\n            return d;\n        };\n        // mark that we are in the initial load (but only if we have initiel state)\n        this.deferredLoad = this.options.initialState;\n        // call it\n        $.ui.karlgrid.prototype._initialUpdate.call(this);\n        this.deferredLoad = false;\n    },\n\n    _doUpdate: function(state, o) {\n        var self = this;\n        $.ui.karlgrid.prototype._doUpdate.call(this, state, o);\n        // If the grid is updated, we need to uncheck the global selector.\n        this.cb_globalselect.removeAttr('checked');\n        if (this.deferredLoad) {\n            // will load at button click\n            this.doDeferredLoadState = state;\n            // enable or disable the reorganize buttons\n            this._enableDisableButtons();\n        } else {\n            // just do it now in async\n            this.setTargetFolders(state);\n        }\n    },\n\n    _onGlobalSelect: function(checked) {\n        // the global selector changed.\n        // change all checkboxes\n        this.content.find('input.ui-grid-selector[type=\"checkbox\"]').each(function() {\n            var target = $(this);\n            if (checked) {\n                target.attr('checked', 'checked');\n            } else {\n                target.removeAttr('checked');\n            }\n        });\n        // enable or disable the reorganize buttons\n        this._enableDisableButtons();\n    },\n\n    _onClickRow: function(target) {\n        // Clicking on a checkbox toggles selection in that row\n        // (only 1 checkbox per row is supported)\n        // Clicking on the rest of the row follows the first link in it. (as normally)\n\n        var is_selection = target.is('input[type=\"checkbox\"]');\n\n        if (! is_selection) {\n            // not a checkbox. Do as the supertype wants to.\n            return $.ui.karlgrid.prototype._onClickRow.call(this, target);\n        }\n\n        // Let the checkbox toggle.\n        var selected = target.attr('checked');\n\n        var new_selected = ! selected;\n\n        if (new_selected) {\n            target.attr('checked', 'checked');\n        } else {\n            target.removeAttr('checked');\n        }\n\n        // enable or disable the reorganize buttons\n        this._enableDisableButtons();\n\n        // prevent default.\n        return false;\n    },\n\n    _onClickHeader: function(target) {\n        // Header clicked: toggle sorting\n        var header = target.hasClass('ui-grid-column-header') ? target : target.parents('.ui-grid-column-header');\n        var data = header.data('grid-column-header');\n\n        // The id of the selection column is 'sel'.\n        var is_selection = data.id == this.options.selectionColumnId;\n        if (! is_selection) {\n            // not a checkbox. Do as the supertype wants to.\n            return $.ui.karlgrid.prototype._onClickHeader.call(this, target);\n        }\n\n        // make sure that the user clicked the checkbox itself.\n        if (! target.is('.ui-grid-globalselector input[type=\"checkbox\"]')) {\n            // if we clicked in the header but outside the checkbox,\n            // prevent default.\n            return false;\n        }\n\n        // Let's read the checkbox selection.\n        // var selected = target.attr('checked');\n        // var new_selected = ! selected;\n\n        // Do not prevent the default: this lets the browser to\n        // toggle the checkbox.\n        return true;\n    },\n\n    _generateFooter: function() {\n        var self = this;\n        $.ui.karlgrid.prototype._generateFooter.call(this);\n        var positioner = $('<span class=\"ui-grid-footer-button-positioner\"></span>')\n            .appendTo(this.footer);\n        this.button_delete = $('<a>Delete</a>')\n            .button({\n                icons: {primary: 'ui-icon-trash'}\n            })\n            .click(function() {\n                if (! $(this).button('option', 'disabled')) {\n                    self._onDeleteClicked();\n                }\n                return false;\n            })\n            .appendTo(positioner);\n        this.button_move = $('<a>Move To</a>')\n            .button({\n                icons: {primary: 'ui-icon-folder-open'}\n            })\n            .click(function() {\n                if (! $(this).button('option', 'disabled')) {\n                    // is the load deferred?\n                    var state = self.doDeferredLoadState;\n                    if (state) {\n                        self.doDeferredLoadState = false;\n                        self.setTargetFolders(state, function() {\n                            self._onMoveClicked();\n                        });\n                    } else {\n                        self._onMoveClicked();\n                    }\n                }\n                return false;\n            })\n            .appendTo(positioner);\n        this.button_download= $('<a>Download</a>')\n            .button({\n                icons: {primary: 'ui-icon-circle-arrow-s'}\n            })\n            .click(function() {\n                if (! $(this).button('option', 'disabled')) {\n                    self._onDownloadClicked();\n                }\n                return false;\n            })\n            .appendTo(positioner);\n\n        // create menu for move\n        this.menuMove = $('<ul></ul>')\n            .insertAfter(this.button_move)\n            .hide()\n            .width(250)\n            .css('max-height', '325px')\n            .css('position', 'absolute')\n            .css('overflow-x', 'hidden')\n            .css('overflow-y', 'auto')\n            .menu({\n                select: function(evt, selection) {\n                    self.menuMove.hide();\n                    var selected = selection.item;\n                    if (selected) {\n                        var folder_info = selected.data('folder');\n                        self._onMoveSelected(folder_info);\n                    }\n                }\n            });\n            ////.popup();\n        // XXX escape from the menu needs to be done manually,\n        // this will arrive in jquery-ui 1.9 when this will not\n        // be needed any longer (or it will simply break)\n        this.menuMove.bind(\"keydown\", function(event) {\n            if (self.menuMove.menu('option', 'disabled')) {\n                return;\n            }\n            switch (event.keyCode) {\n                case $.ui.keyCode.ESCAPE:\n                    self.menuMove.hide();\n                    event.preventDefault();\n                    event.stopImmediatePropagation();\n                    break;\n            }\n        });\n        $('body').bind(\"mousedown\", function(event) {\n            if (self.menuMove.menu('option', 'disabled')\n                // escape if the menu is disabled\n                || self.menuMove.is(':hidden')\n                // or if the menu is hidden\n                || $(event.target).is('.ui-grid-footer .ui-menu')\n                || $(event.target).is('.ui-grid-footer .ui-menu *')) {\n                // or if we are not outside the menu\n                return;\n            }\n            self.menuMove.hide();\n            event.preventDefault();\n            event.stopImmediatePropagation();\n        });\n\n\n    },\n\n    _onDeleteClicked: function() {\n        this.dialogDeleteConfirm.karldialog('open');\n    },\n\n    _onDeleteConfirmed: function() {\n        var self = this;\n        var filenames = this.getSelectedFiles();\n        $.ajax({\n            url: this.options.delete_url,\n            type: 'POST',\n            dataType: 'json',\n            timeout: 20000,\n            data: {\n                file: filenames\n            },\n            success: function(data, textStatus, jqXHR) {\n                if (data && data.result == 'OK') {\n                    self._onDeleteSuccess(data);\n                } else {\n                    self._onDeleteError(data);\n                }\n            },\n            error: function(jqXHR, textStatus, errorThrown) {\n                self._onDeleteError({result: 'ERROR', error: 'Unknown server error: ' + textStatus});\n            }\n        });\n    },\n\n    _onDeleteSuccess: function(data) {\n        // XXX let's reuse the statusbox that the tagbox already activated\n        var message = '' + data.deleted + ' file(s) succesfully deleted';\n        $('.statusbox').karlstatusbox('clearAndAppend', message);\n        this._update ({columns: false, refresh: true});\n    },\n\n    _onDeleteError: function(data) {\n        // XXX let's reuse the statusbox that the tagbox already activated\n        // XXX TODO: this should be error....\n        // maybe, use the multistatusbox?\n        var message = 'Deletion failed: ' + data.error;\n        $('.statusbox').karlstatusbox('clearAndAppend', message);\n    },\n\n    _onMoveClicked: function() {\n        this.menuMove.show();\n        this.menuMove.position({my: 'left bottom', at: 'left top', of: this.button_move, collision: 'fit'});\n        this.menuMove.focus();\n    },\n\n    _onMoveSelected: function(selected) {\n        this.dialogMoveFolderName\n            .text(selected.title)\n            .data('folder', selected);\n        this.dialogMoveConfirm.karldialog('open');\n    },\n\n    _onMoveConfirmed: function(selected) {\n        var self = this;\n        var filenames = this.getSelectedFiles();\n        $.ajax({\n            url: this.options.moveto_url,\n            type: 'POST',\n            dataType: 'json',\n            timeout: 20000,\n            data: {\n                file: filenames,\n                target_folder: selected.path\n            },\n            success: function(data, textStatus, jqXHR) {\n                if (data && data.result == 'OK') {\n                    self._onMoveSuccess(data);\n                } else {\n                    self._onMoveError(data);\n                }\n            },\n            error: function(jqXHR, textStatus, errorThrown) {\n                self._onMoveError({result: 'ERROR', error: 'Unknown server error: ' + textStatus});\n            }\n        });\n    },\n\n    _onMoveSuccess: function(data) {\n        // XXX let's reuse the statusbox that the tagbox already activated\n        var message = 'Moved ' +data.moved + ' selected files/folders to <a href=\"' +\n                data.targetFolderUrl + '\">' + data.targetFolderTitle + '</a>';\n        $('.statusbox').karlstatusbox('clearAndAppend', message);\n        this._update ({columns: false, refresh: true});\n    },\n\n    _onMoveError: function(data) {\n        // XXX let's reuse the statusbox that the tagbox already activated\n        // XXX TODO: this should be error....\n        // maybe, use the multistatusbox?\n        var message = 'Move To failed: ' + data.error;\n        $('.statusbox').karlstatusbox('clearAndAppend', message);\n    },\n\n    _onDownloadClicked: function() {\n\tvar size = this.getSelectedTotalSize();\n\tif (size<20971520) {\n\t    var num_selected = this.getSelectedFiles().length;\n\t    this.dialogDownloadItems\n                .text(num_selected)\n\t\t.data('items', num_selected);\n            this.dialogDownloadConfirm.karldialog('open');\n\t} else {\n\t    alert('Maximum download size is 20 MB. Total size for selected files is ' + parseInt(size/1000000) + ' MB.');\n\t}\n    },\n\n    _onDownloadConfirmed: function() {\n        var filenames = this.getSelectedFiles();\n        var url = this.options.download_url;\n\tvar param = $.param({filenames: filenames});\n\twindow.location.href = url + '?' + param;\n    }\n\n}));\n\n\n$.widget('ui.karldialog', $.extend({}, $.ui.dialog.prototype, {\n\n    options: $.extend({}, $.ui.dialog.prototype.options, {\n        autoOpen: false,\n        modal: true,\n        draggable: false,\n        resizable: false,\n        bgiframe: true,    // XXX bgiFrame is currently needed for modal\n        hide: 'fold'\n    }),\n\n    /* Need to replicate this, because we do not want\n     * to scroll down to the first tabbable element when\n     * the dialog opens. */\n    open: function() {\n        if (this._isOpen) { return; }\n\n        var options = this.options,\n            uiDialog = this.uiDialog;\n\n        this.overlay = options.modal ? new $.ui.dialog.overlay(this) : null;\n        (uiDialog.next().length && uiDialog.appendTo('body'));\n        this._size();\n        this._position(options.position);\n        uiDialog.show(options.show);\n        this.moveToTop(true);\n\n        // prevent tabbing out of modal dialogs\n        (options.modal && uiDialog.bind('keypress.ui-dialog', function(event) {\n            if (event.keyCode != $.ui.keyCode.TAB) {\n                return;\n            }\n\n            var tabbables = $(':tabbable', this),\n                first = tabbables.filter(':first')[0],\n                last  = tabbables.filter(':last')[0];\n\n            if (event.target == last && !event.shiftKey) {\n                setTimeout(function() {\n                    first.focus();\n                }, 1);\n            } else if (event.target == first && event.shiftKey) {\n                setTimeout(function() {\n                    last.focus();\n                }, 1);\n            }\n        }));\n\n        //// set focus to the first tabbable element in the content area or the first button\n        //// if there are no tabbable elements, set focus on the dialog itself\n        //$([])\n        //    .add(uiDialog.find('.ui-dialog-content :tabbable:first'))\n        //    .add(uiDialog.find('.ui-dialog-buttonpane :tabbable:first'))\n        //    .add(uiDialog)\n        //    .filter(':first')\n        //    .focus();\n        // XXX Always focus on the dialog itself\n        uiDialog.focus();\n\n        this._trigger('open');\n        this._isOpen = true;\n    },\n\n    // allow to use position on the dialog directly.\n    // like: el.karldialog('position', {...});\n    // Why is this good? Because, it seems the 'position' option\n    // has a different semantics from the newest option plugin.\n    // This allows positioning with the same parameters as the\n    // option plugin, but without a need to look up the dialog object.\n    position: function(param) {\n        return this.uiDialog.position(param);\n    }\n\n\n}));\n\n\n$.widget('ui.karlmultiupload', {\n\n    options: {\n        selectorStub: '.muf-stub',\n        selectorCloseButton: '.muf-closebutton',\n        selectorAddButton: '.muf-addbutton'\n    },\n\n    _create: function() {\n        var self = this;\n        this.stub = this.element.find(this.options.selectorStub);\n        // Set up the stub\n        var input = this.stub\n            .hide()\n            .find('input')\n        this.name = input.attr('name');\n        input.removeAttr('name');\n        // Set up the add button\n        this.element.find(this.options.selectorAddButton)\n            .click(function(e) {\n                self._add();\n                e.preventDefault();\n            });\n    },\n\n    // Add a new stub\n    _add: function() {\n        var new_stub = this.stub.clone()\n            .insertBefore(this.stub);\n        var input = new_stub.find('input')\n        input.attr('name', this.name + this._getCounter());\n        // bind the close button\n        new_stub.find(this.options.selectorCloseButton)\n            .click(function(e) {\n                new_stub.remove();\n                e.preventDefault();\n            });\n        new_stub.show();\n    },\n\n    _getCounter: function() {\n        this.counter = this.counter || 0;\n        return this.counter++;\n    }\n\n});\n\n\n$.widget('ui.karlsingleupload', {\n\n    options: {\n        selectorStub: '.sif-stub',\n        selectorNoChange: '.sif-nochange',\n        selectorUpload: '.sif-upload'\n    },\n\n    _create: function() {\n        var self = this;\n        this.stub = this.element.find(this.options.selectorStub);\n        // Set up the stub\n        var input = this.stub\n            .hide()\n            .find('input')\n        this.name = input.attr('name');\n        input.removeAttr('name');\n        // Set up the options\n        this.element.find(this.options.selectorNoChange)\n            .click(function(e) {\n                if (self.real) {\n                    self._del();\n                }\n            });\n        this.element.find(this.options.selectorUpload)\n            .click(function(e) {\n                if (! self.real) {\n                    self._add();\n                }\n            });\n\n    },\n\n    // Add a new stub\n    _add: function() {\n        var _r = this.real = this.stub.clone()\n            .insertBefore(this.stub);\n        var input = _r.find('input')\n        input.attr('name', this.name);\n        _r.show();\n    },\n\n    // Delete the stub\n    _del: function() {\n        this.real.remove();\n        this.real = null;\n    }\n\n});\n\n\n/**\n * Quotable comments\n *\n * - The widget is bound to a comment.\n * - The \"pasteToActiveTiny\" event pastes the designated text area\n *   into the selection of the active tinymce window\n * - A click to the \"Quote\" link will trigger above event.\n *\n */\n$.widget('ui.karlquotablecomment', {\n\n    options: {\n        selectorText: '.commentText',\n        selectorPasteButton: '.quo-paste',\n        wrapperPre: '<div class=\"quotedreplytext\">',\n        // An empty paragraph must be added after the quote.\n        wrapperPost: '</div><div><p></p></div>'\n    },\n\n    _create: function() {\n        var self = this;\n        this.text = this.element.find(this.options.selectorText);\n        // Set up the paste button\n        this.element.find(this.options.selectorPasteButton)\n            .click(function(e) {\n                self.pasteToActiveTiny();\n                e.preventDefault();\n            })\n    },\n\n    // Paste into the active tinymce window\n    pasteToActiveTiny: function() {\n        var raw_text = this.text.html()\n        var editor = tinyMCE.activeEditor;\n        // set focus to this editor\n        editor.focus();\n        // paste the content\n        editor.selection.setContent(\n            this.options.wrapperPre +\n            raw_text +\n            this.options.wrapperPost\n        );\n    }\n\n});\n\n\n/**\n * Date time picker field\n *\n * Bound to a single input field. This field is made hidden, and\n * three input fields yyy-date yyy-hour and yyy-minute are created.\n * The date field is bound as an ui-datepicker.\n *\n */\n$.widget('ui.karldatetimepicker', {\n\n    options: {\n        //dateFormat: undefined,\n        zIndex: undefined\n    },\n\n    _create: function() {\n        var self = this;\n        if (! jQuery.nodeName(this.element[0], 'input')) {\n            throw new Error('ui.karldatetimepicker can only be bound to <input> nodes.');\n        }\n        // Create a container to hold the new inputs.\n        this.container = $('<span class=\"ui-karldatetimepicker-container\"></span>');\n        // Position the container after the old input element,\n        // which in turn gets hidden.\n        this.element\n            .hide()\n            .after(this.container);\n        // Create the date and time inputs inside the container.\n        this.dateinput = $('<input class=\"ui-karldatetimepicker-dateinput\"></input>')\n            .appendTo(this.container);\n        // fix the z-index\n        if (this.options.zIndex) {\n            // The component will always set $(input).zIndex() + 1\n            // as the z-index of the popup. However, for static\n            // elements zIndex is always 0. This means that the\n            // z-index will mostly be 1, which is a problem because\n            // we have higher z-indexes (3) on certain elements, like\n            // all old-style IE rounded corner hacks.\n            //\n            // So, we provide a way to set the z-index. But\n            // we have to actually set it on the input we just created.\n            // We also have to make it position relative, otherwise\n            // the popup will not pick up the index we want.\n            // Not very elegant.\n            this.dateinput\n                .css('position', 'relative')\n                .zIndex(this.options.zIndex - 1);\n        }\n        var dateFormat = this.options.dateFormat || undefined;  // be tolerant, \"\" -> undefined\n        this.dateinput\n            .datepicker({\n                dateFormat: dateFormat\n            })\n            .change(function(evt) {\n                self.setDate($(evt.target).val());\n            });\n\n        this.hourinput = $('<select class=\"ui-karldatetimepicker-hourinput\"></input>')\n            .appendTo(this.container)\n            .change(function(evt) {\n                self.setHour($(evt.target).val());\n            });\n        for (var i=0; i<24; i++) {\n            $('<option>')\n                .val(i)\n                .text(i)\n                .appendTo(this.hourinput);\n        }\n        this.container.append('<span class=\"ui-karldatetimepicker-colon\">:</span>');\n        this.minuteinput = $('<select class=\"ui-karldatetimepicker-hourinput\"></input>')\n            .appendTo(this.container)\n            .change(function(evt) {\n                self.setMinute($(evt.target).val());\n            });\n        for (var i=0; i<4; i++) {\n            var strmin = ('0' + i * 15).slice(-2);\n            $('<option>')\n                .val(strmin)\n                .text(strmin)\n                .appendTo(this.minuteinput);\n        }\n\n        // Set composite value from the input element's content.\n        this.set(this.element.val());\n    },\n\n    // set the composite value (as string)\n    set: function(value) {\n        // Split the value\n        // Everything before the first space goes to date, the rest to time\n        var split_pos = value.search(' ');\n        var timestr = value.substr(split_pos + 1);\n        // Time is further split to hours and minutes by the colon\n        var time_split_pos = timestr.search(':');\n        this.composite_value = {\n            datestr: value.substr(0, split_pos),\n            hourstr: value.substr(split_pos + 1, time_split_pos).replace(/^0/, ''),\n            minutestr: value.substr(split_pos + time_split_pos + 2)\n        };\n        // Sets all input values we manage\n        this.dateinput.val(this.composite_value.datestr);\n        this.hourinput.val(this.composite_value.hourstr);\n        this.minuteinput.val(this.composite_value.minutestr);\n        this.element.val(value);\n        this.element.trigger('change.karldatetimepicker');\n    },\n\n    // Set date part (as string)\n    setDate: function(value) {\n        // Remember the value, so we are always in possession\n        // of the full array of values we composite\n        this.composite_value.datestr = value;\n        this.dateinput.val(this.composite_value.datestr);\n        this._updateComposite();\n    },\n\n    // Set hour part (as string)\n    setHour: function(value) {\n        // Remember the value, so we are always in possession\n        // of the full array of values we composite\n        this.composite_value.hourstr = value;\n        this.hourinput.val(this.composite_value.hourstr);\n        this._updateComposite();\n    },\n\n    // Set minute part (as string)\n    setMinute: function(value) {\n        // Remember the value, so we are always in possession\n        // of the full array of values we composite\n        this.composite_value.minutestr = value;\n        this.minuteinput.val(this.composite_value.minutestr);\n        this._updateComposite();\n    },\n\n    _updateComposite: function() {\n        // Update the composite value, which will be submitted in the original\n        // input.\n        var value = this.composite_value.datestr + ' ' +\n                    this.composite_value.hourstr + ':' + this.composite_value.minutestr;\n        this.element.val(value);\n        this.element.trigger('change.karldatetimepicker');\n    },\n\n    // gets the value as a javascript Date object\n    getAsDate: function () {\n        var datetimestring = this.element.val();\n        var separator = datetimestring.lastIndexOf(' ');\n        var colon = datetimestring.lastIndexOf(':');\n        var datestring = datetimestring.substring(0, separator);\n        var hourstring = datetimestring.substring(separator + 1, colon);\n        var minutestring = datetimestring.substring(colon + 1);\n        var date = $.datepicker.parseDate(this.options.dateFormat, datestring);\n        var datetime = new Date(\n            date.getFullYear(), date.getMonth(), date.getDate(),\n            Number(hourstring), Number(minutestring)\n        );\n        return datetime;\n    },\n\n    // gets the value as a javascript Date object\n    setAsDate: function (da) {\n        var _pad = function (num) {\n            var str = '0' + num;\n            return str.substr(str.length - 2, 2);\n        };\n        // Format the date as string\n        var datestring = $.datepicker.formatDate(this.options.dateFormat, da);\n        var datetimestring = datestring +\n            ' ' + _pad(da.getHours()) + ':' + _pad(da.getMinutes());\n        // set the value\n        this.set(datetimestring);\n    },\n\n    // limit minimum or maximum.\n    // minval and maxval have to be javascript Date objects, or null.\n    limitMinMax: function(minval, maxval) {\n        var value = this.getAsDate();\n        var set_value = null;\n        if (minval && value < minval) {\n            set_value = minval;\n        }\n        if (maxval && value > maxval) {\n            set_value = maxval;\n        }\n        if (set_value != null) {\n            // Element changed.\n            this.setAsDate(set_value);\n            this.dateinput.effect(\"pulsate\", {times: 1}, 800);\n\n            if (this.hourinput.is(\":visible\")) {\n              this.hourinput.effect(\"pulsate\", {times: 1}, 800);\n              this.minuteinput.effect(\"pulsate\", {times: 1}, 800);\n            }\n\n        }\n\n    }\n\n});\n\n\n/**\n * Dropdown menu\n *\n *  <li class=\"karldropdown\">\n *     <a class=\"karldropdown-heading\" href=\"#\">Add</a>\n *     <ul class=\"karldropdown-menu\">\n *       <li>\n *         <a href=\"#\">Folder</a>\n *       </li>\n *       <li>\n *         <a href=\"#\">Forum</a>\n *       </li>\n *       <li>\n *         <a href=\"#\">File</a>\n *       </li>\n *     </ul>\n *   </li>\n *\n * It may appear on a menubar:\n *\n *   <ul class=\"menubar\">\n *     <li>...</li>\n *     <li class=\"karldropdown\">\n *     <li>...</li>\n *   </ul>\n *\n */\n\n$.widget('ui.karldropdown', {\n\n    options: {\n    },\n\n    _create: function() {\n        var self = this;\n        this._locate();\n\n        // to be on the safe side...\n        this.menu.hide();\n\n        // add the dropdown indicator\n        $('<div>')\n            .attr('class', 'karldropdown-indicator ui-icon ui-icon-triangle-1-s')\n            .insertBefore(this.menu);\n\n        // bind the menu\n        this.element\n            .mouseenter(function() {self.show();})\n            .mouseleave(function() {self.hide();});\n        this.items\n            .mouseover(function() {self.hoverItem(this);})\n\n        // needed to control the item hovers\n        this.current_item = null;\n        this.padding_left = 0;\n    },\n\n    _locate: function() {\n        this.heading = this.element.find('> .karldropdown-heading');\n        this.menu = this.element.find('> .karldropdown-menu');\n        this.items = this.menu.find('> li');\n    },\n\n    // --\n    // Control\n    // --\n\n    // show the dropdown\n    show: function() {\n        // position and size it\n        var top = this.element.height();\n        this.menu\n            .css('position', 'absolute')\n            .css('left', 0)\n            .css('top', top);\n        // calculate the padding to fit first child's padding\n        var first_child = this.element.find(':first');\n        this.padding_left = Math.round(first_child.position().left +\n                                parseFloat(first_child.css('padding-left')) || 0);\n        this.resetAllItems();\n        // show it\n        this.menu\n            .stop(true, true)\n            .slideDown(150);\n        // Make the item widths expand the menu\n        // We would not need this if there were no IE\n        var max_width = 0;\n        this.items\n            .each(function() {\n                // XXX I don't like it!\n                var width;\n                if (jQuery.browser.msie) {\n                    width = this.offsetWidth;\n                } else {\n                    width = $(this).width();\n                }\n                max_width = Math.max(max_width, width);\n            })\n            .each(function() {\n                $(this)\n                    .width(max_width)\n            });\n    },\n\n    // hide the dropdown\n    hide: function() {\n        // Reset all items\n        this.resetAllItems();\n        this.current_item = null;\n        this.menu\n            .stop(true, true)\n            .fadeOut(50);\n    },\n\n    // reset all items to initial state\n    resetAllItems: function() {\n        var self = this;\n        this.items.each(function() {self.resetItem(this);});\n    },\n\n    // reset an item to initial state\n    resetItem: function(item) {\n        // Reset animation and css\n        $(item)\n            .stop(true, true)\n            .css('backgroundColor', '#666666')\n            .css('color', '#000000')\n            .css('paddingLeft', this.padding_left)\n            .css('paddingRight', '11px');\n    },\n\n    // hover an item\n    hoverItem: function(item) {\n        var self = this;\n        // Lazy leaving of element eliminates juggling effects.\n        // Prevent anything from happening if we return to same element.\n        if (this.items.index(this.current_item) == this.items.index(item)) {\n            return;\n        }\n        // If there was a previous item, leave it now.\n        if (this.current_item) {\n            this.leaveItem(this.current_item);\n        }\n        var item = $(item);\n        item\n            .stop(true, true)\n            .animate({\n                backgroundColor: '#cecece',\n                color: '#ffffff'\n            }, 100)\n            .animate({\n                paddingLeft: self.padding_left + 6,\n                paddingRight: '5px'\n            }, 150);\n        this.current_item = item;\n    },\n\n    // leave an item\n    leaveItem: function(item) {\n        var self = this;\n        var item = $(item);\n        item\n            .stop(true, true)\n            .animate({\n                paddingLeft: self.padding_left,\n                paddingRight: '11px'\n                }, 50)\n            .css('backgroundColor', '#666666')\n            .css('color', '#000000');\n        this.current_item = null;\n    }\n\n});\n\n\n/* auto create anon ids (used by calendar) */\njQuery.fn.identify = function() {\n    var i = 0;\n    return this.each(function() {\n        if ($(this).attr('id')) return;\n        do {\n            i++;\n            var id = 'anon_' + i;\n        } while ($('#' + id).length > 0);\n\n        $(this).attr('id', id);\n    }).attr(\"id\");\n};\n\n/** =CALENDAR TIME SLOT HOVER\n----------------------------------------------- */\nvar hov = {};\n\nfunction mouseOverHour(evt) {\n  var elt = $(evt.target);\n  if (!elt.hasClass('cal_hour_event')) {\n    var elt = elt.parents(\".cal_hour_event\");\n  }\n  if (!elt) { return; }\n\n  var id  = elt.identify(\"a\");\n  hov[id] = true;\n\n  // only display if still hovered after some time\n  setTimeout(function() {\n    if (hov[id]) {\n      elt.addClass('hov');\n      elt.next().addClass('hov_below');\n    }\n  }, 200);\n}\n\nfunction mouseOutHour(evt) {\n  var elt = $(evt.target);\n  if (!elt.hasClass('cal_hour_event')) {\n    var elt = elt.parents(\".cal_hour_event\");\n  }\n  if (!elt) { return; }\n\n  var id  = elt.identify(\"a\");\n  delete hov[id];\n\n  // only hide if we've outed for number of time\n  setTimeout(function() {\n    if (!hov[id]) {\n      elt.removeClass('hov');\n      elt.next().removeClass('hov_below');\n    }\n  }, 200);\n}\n\n\nfunction mouseOverDay(evt) {\n  var elt = $(this);\n  var id  = elt.identify(\"a\");\n  hov[id] = true;\n\n  // only display if still hovered after some time\n  setTimeout(function() {\n    if (hov[id]) { elt.addClass('hov'); }\n  }, 200);\n}\n\nfunction mouseOutDay(evt) {\n  var elt = $(this);\n  var id  = elt.identify(\"a\");\n  delete hov[id];\n\n  // only hide if we've outed for number of time\n  setTimeout(function() {\n    if (!hov[id]) { elt.removeClass('hov');     }\n  }, 200);\n}\n\n/** =CALENDAR TIME SCROLLING\n----------------------------------------------- */\nfunction scrollToTime() {\n  var time = $('#cal_time');\n  if (time.length == 0) { return; }\n\n  // Scroll to current time for today\n  if (time.hasClass('today')) {\n    // find current time - determine % of day passed\n    var curTime = new Date();\n\n    // total minutes passed today & total mins in a day\n    var mins = curTime.getHours() * 60 + curTime.getMinutes();\n    var scrollDuration = 1000;\n\n  // go to ~ 8:00am\n  } else {\n    var mins = 740;\n    var scrollDuration = 0;\n    time.css(\"visibility\", \"hidden\");\n  }\n\n  var day  = 1440;\n  var perc = parseInt(mins / day * 100);\n\n  // get height of entire calendar and set position of time\n  var calHeight = $('#cal_scroll').height();\n  var top       = parseInt(calHeight * perc / 100);\n  time.css('top', top + \"px\").show();\n\n  // scroll to make time centered if possible\n  var scrollPos = top - 250 > 0 ? top - 250 : 0;\n\n  $(\"#cal_hours_scroll\").scrollTo(scrollPos, { duration: scrollDuration });\n}\n\n\n/* My tooltip: add a wrapper so we can handle\n * the overflow correctly */\n$.fn.myTooltip = function(options) {\n    return this.each(function() {\n        var el = $(this);\n        var tt = el.next();\n        var wrapper = $('<div></div>')\n            .height(tt.height())\n            .css('overflow', 'hidden');\n        tt.wrapInner(wrapper);\n        el.tooltip(options);\n    });\n};\n\n\n\n\n/** =CALENDAR INIT JAVASCRIPT\n----------------------------------------------- */\nfunction initCalendar() {\n\n  // ALL VIEWS - calendar layer switcher\n  $(\"#cal_picker\").change(function() {\n    var values = this.options[this.selectedIndex].value.split(\"?filter=\");\n    javascript:document.location = values[0] + \"?filter=\" + escape(values[1]);\n  })\n\n  // MONTH VIEW - hover to show (+) icon to add events\n  $(\"#cal_month td\").hover(mouseOverDay, mouseOutDay);\n  $(\"#cal_month .with_tooltip\").myTooltip({ tip: '.tooltip', offset: [8, 50], predelay: 250});\n\n  // WEEK/DAY VIEW -\n  var scrollHours = $(\"#cal_hours_scroll\");\n  scrollHours.mouseover(mouseOverHour);\n  scrollHours.mouseout(mouseOutHour);\n  $(\"#all_day td\").hover(mouseOverDay, mouseOutDay);\n\n  // Week tooltips\n  var calScroll = $(\"#cal_scroll\");\n  if (calScroll.hasClass('cal_week')) {\n    $(\"#all_day .with_tooltip\").myTooltip({ tip: '.tooltip', offset: [8, -48], predelay: 250});\n    $(\"#cal_scroll .cal_hour_event .with_tooltip\").myTooltip({ tip: '.tooltip', offset: [12, 5], predelay: 250});\n  }\n\n  var here_url = $(\"#karl-here-url\").eq(0).attr('content');\n  // calendar (new) buttonbar\n  $('.cal-buttonbar').karlcalendarbuttons({\n      selection: window.karl_client_data && karl_client_data.calendar_selection || null,\n      change: function(evt, selection) {\n            // For now, we submit to the correct url.\n            // In the future, we will want to do ajax here.\n            var view_name;\n            var more = '';\n            if (selection.viewtype == 'list') {\n                view_name = 'list.html';\n                more = '&term=' + selection.term;\n            } else {\n                view_name = {\n                    month: 'month.html',\n                    week: 'week.html',\n                    day: 'day.html'\n                }[selection.term];\n            }\n            var url = here_url + view_name +\n                '?year=' + selection.year +\n                '&month=' + selection.month +\n                '&day=' + selection.day +\n                more;\n            // user cannot click now, cue this\n            $(this).karlcalendarbuttons('disable');\n\n            document.location.href = url;\n      }\n\n\n  });\n\n  /* calendar print action */\n\n  $('.cal_actions a.cal_print').click(function() {\n        // I cannot seem to show the entire\n        // calendar from css, so to avoid\n        // scrolling / overflow, the height\n        // is manipulated directly here.\n        var inner =  $('.cal_scroll');\n        var outer = $('.cal_hours_scroll');\n        var fullheight = inner.height();\n        var oldheight = outer.height();\n        outer.height(fullheight);\n        // Also, replace the styling to wide for the time of printing.\n        var el = $('.karl-calendar-narrow')\n            .removeClass('karl-calendar-narrow')\n            .addClass('karl-calendar-wide');\n        // Mark the body for the time of the printing and\n        // the printing css can refer to this marker class. This\n        // is simpler than putting it to the outside of all calendar views,\n        // which would also be good but that marker does not exist.\n        $('body').addClass('karl-calendar-printing');\n        // Print now.\n        window.focus();\n        window.print();\n        // Resume original state.\n        outer.height(oldheight);\n        el\n            .removeClass('karl-calendar-wide')\n            .addClass('karl-calendar-narrow');\n        $('body').removeClass('karl-calendar-printing');\n        return false;\n  });\n\n  scrollToTime();\n}\n\n/** =ADD/EDIT CALENDAR EVENT\n----------------------------------------------- */\nfunction initNewEvent() {\n  if ($(\"#save-start_date\").length == 0 || $(\"#save-end_date\").length == 0) { return; }\n\n  initStartDatePicker();\n  initEndDatePicker();\n\n  // initial all-day state\n  if ($(\"#save-all_day\").val() == 'True') {\n    var checked = 'checked=\"checked\"';\n    hideEditCalendarEventTimes();\n  } else {\n    var checked = '';\n    showEditCalendarEventTimes();\n  }\n\n  // add the \"all-day\" checkbox\n  var checkbox = '<span class=\"all_day\">' +\n                  '<input type=\"checkbox\" id=\"cal_all_day\" name=\"allDay\" ' + checked + ' />' +\n                  '<label for=\"cal_all_day\">All-day</label>' +\n                 '</span>';\n  $(\"div.save-start_date > div.inputs\").append(checkbox);\n\n  // all-day checkbox handler\n  $(\"#cal_all_day\").click(function() {\n    removeEditCalendarEventValidationErrors();\n\n    if (this.checked) {\n      $('#save-all_day').val('True');\n      hideEditCalendarEventTimes();\n    } else {\n      $('#save-all_day').val('False');\n      showEditCalendarEventTimes();\n    }\n  });\n}\n\nfunction initStartDatePicker() {\n  $('#save-start_date')\n      .karldatetimepicker({\n            dateFormat: karl_client_data.js_date_format,\n            // make sure the date select popup comes over everything\n            // most notably, buttons. A problem on IE7. */\n            zIndex: 20000\n      })\n      .bind('change.karldatetimepicker', function() {\n          $('#save-end_date').karldatetimepicker('limitMinMax',\n                  // add one hour\n                  new Date($(this).karldatetimepicker('getAsDate').valueOf() + 3600000),\n                  null);\n      });\n}\n\nfunction initEndDatePicker() {\n  $('#save-end_date')\n      .karldatetimepicker({\n            dateFormat: karl_client_data.js_date_format,\n            // make sure the date select popup comes over everything\n            // most notably, buttons. A problem on IE7. */\n            zIndex: 20000\n      })\n      .bind('change.karldatetimepicker', function() {\n          $(this).karldatetimepicker('limitMinMax', $('#save-start_date').karldatetimepicker('getAsDate'), null);\n      });\n}\n\nfunction hideEditCalendarEventTimes() {\n  $('div.save-start_date select').hide();\n  $('div.save-start_date .ui-karldatetimepicker-colon').hide();\n  $('div.save-end_date select').hide();\n  $('div.save-end_date .ui-karldatetimepicker-colon').hide();\n}\n\nfunction showEditCalendarEventTimes() {\n  $('div.save-start_date select').show();\n  $('div.save-start_date .ui-karldatetimepicker-colon').show();\n  $('div.save-end_date select').show();\n  $('div.save-end_date .ui-karldatetimepicker-colon').show();\n}\n\nfunction removeEditCalendarEventValidationErrors() {\n  $('div.save-start_date').removeClass('error');\n  $('div.save-start_date > span.error').remove();\n  $('div.save-end_date').removeClass('error');\n  $('div.save-end_date > span.error').remove();\n}\n\n/** =CALENDAR SETUP\n----------------------------------------------- */\nfunction initCalendarSetup() {\n  // toggle add layers/categories calendar form\n  $(\".add_button\").click(function(eventObject) {\n    eventObject.preventDefault();\n    var group = $(eventObject.target).parents(\".setup_group\");\n\n    group.find(\".add_button\").hide(\"fast\");\n    group.find(\".cal_add\").show(\"slow\");\n  });\n  $('.cal_add button[name=\"form.cancel\"]').click(function(eventObject) {\n    eventObject.preventDefault();\n    var validationErrors = $(\"div.portalMessage\");\n    if (validationErrors) { validationErrors.remove(); }\n\n    var group = $(eventObject.target).parents(\".setup_group\");\n    group.find(\".add_button\").show(\"fast\");\n    group.find(\".cal_add\").hide(\"slow\");\n\n    $(this).parents(\"form\")[0].reset();\n  });\n\n  // automatically show form if submission failed with validation errors\n  var fielderrors_target = $('#fielderrors_target').val();\n  if (fielderrors_target.length > 0) {\n    if (fielderrors_target == \"__add_category__\") {\n        var formSelector = \"#setup_add_category_form\";\n    } else if (fielderrors_target == \"__add_layer__\") {\n        var formSelector = \"#setup_add_layer_form\";\n    } else {\n        var formSelector = \"#edit_\" + fielderrors_target + \"_form\";\n    }\n    $(formSelector).show();\n  }\n\n  // toggle edit layer/categories calendar form\n  $(\".cal_all .edit_action\").click(function(eventObject) {\n    eventObject.preventDefault();\n    var group = $(eventObject.target).parents(\".setup_group\");\n\n    group.find(\"form\").hide(\"slow\");\n    group.find(\".add_button\").hide(\"fast\");\n\n    var formId = \"#\" + $(this).identify() + \"_form\";\n    $(formId).show(\"slow\");\n  });\n  $('.cal_edit button[name=\"form.cancel\"]').click(function(eventObject) {\n    eventObject.preventDefault();\n    var validationErrors = $(\"div.portalMessage\");\n    if (validationErrors) { validationErrors.remove(); }\n\n    var group = $(eventObject.target).parents(\".setup_group\");\n    group.find(\".add_button\").show(\"fast\");\n    group.find(\"form\").hide(\"slow\");\n\n    $(this).parents(\"form\")[0].reset();\n  });\n\n  // delete layer / category\n  initCalendarLayersOrCategoriesDelete();\n\n  if ($(\"select.category_paths\").length > 0) {\n    initCalendarLayersEdit();\n  }\n}\n\nfunction initCalendarLayersEdit() {\n    // add category to a layer\n    $('a.add').click(function(eventObject) {\n      eventObject.preventDefault();\n\n      var layers = $(this).parents(\"fieldset\").find(\".layers\");\n      var row = layers.find(\"tr:last\");\n      row.clone().appendTo(layers).find(\"option\").removeAttr(\"selected\");\n\n      _updateRemoveLinks();\n    });\n\n    // remove category from a layer\n    $('a.remove').live('click', function(eventObject) {\n      eventObject.preventDefault();\n\n      $(this).parents('tr').remove();\n\n      _updateRemoveLinks();\n    });\n\n    // only show \"Remove\" if more than one category is present\n    function _updateRemoveLinks() {\n      $(\".layers\").each(function() {\n        var elts = $(this).find('td a.remove');\n        elts.css('display', elts.length > 1 ? \"inline\" : \"none\");\n      })\n    }\n\n    // update remove links on page load\n    _updateRemoveLinks();\n}\n\nfunction initCalendarLayersOrCategoriesDelete() {\n    $('a.delete_category_action').bind('click', function(e) {\n      if (confirm(\"Are you sure?\")) {\n        var category = this.id.substring(16); // delete_category_*\n        $('#cal_delete_category_form > input[name=form.delete]').val(category);\n        $('#cal_delete_category_form').submit();\n      }\n      return false;\n    });\n\n    $('a.delete_layer_action').bind('click', function(e) {\n      if (confirm(\"Are you sure?\")) {\n        var layer = this.id.substring(13); // delete_layer_*\n        $('#cal_delete_layer_form > input[name=form.delete]').val(layer);\n        $('#cal_delete_layer_form').submit();\n      }\n      return false;\n    });\n}\n\n\n\n// Initialize jquery\n$(document).ready(function() {\n\n    // Initialize tinymce live forms\n    createLiveForms();\n\n    var app_url = $(\"#karl-app-url\").eq(0).attr('content');\n    var here_url = $(\"#karl-here-url\").eq(0).attr('content');\n\n    /*\n    $(\"#livesearch-input\").karllivesearch({\n        ajax: app_url + \"/jquery_livesearch\",\n        match: function(typed) { return true; },\n        insertText: function(obj) { return obj.title },\n        wrapper: '<ul class=\"livesearch-list\"></ul>',\n        templateText: '<li class=\"<%= rowclass %>\"><%= pre %><div class=\"item\"><a href=\"<%= href %>\"><%= title %></a></div><%= post %></li>',\n        minQueryNotice: {\"pre\": \"\", \"post\": \"\", \"header\": \"\", \"href\": \"#\", \"rowclass\": \"notice\",\n                         \"title\":  \"Words must contain at least 3 characters to narrow the search\"}\n    });\n    */\n\n    var tagbox_data = window.karl_client_data && karl_client_data.tagbox || {};\n\n    var _check_tagbox_data = function() {\n        if (! tagbox_data.records) {\n            throw 'karl_client_data.tagbox not specified or has no records.';\n        }\n    };\n    var tagsearch_input = $(\"#tagsearch-input\");\n\n    // check karl_client_data.tagbox only if we have a tagbox in the page\n    if (tagsearch_input.length > 0) _check_tagbox_data();\n    tagsearch_input.karltagbox({\n        validateRegexp: \"^[a-zA-Z0-9\\-\\._]+$\",\n        ajax: app_url + \"/jquery_tag_search\",\n        ajaxAdd: here_url + \"jquery_tag_add\",\n        ajaxDel: here_url + \"jquery_tag_del\",\n        prevals: tagbox_data.records,\n        docid: tagbox_data.docid,\n        showtag_url: app_url + '/showtag/',\n        tagusers_url: app_url + '/tagusers.html'\n    });\n\n    var membersearch_input = $(\"#membersearch-input\");\n    // XXX this widget has no init data atm\n    //if (box_input.length > 0) _check_tagbox_data();\n    membersearch_input.karlmemberbox({\n        ajax: here_url + \"jquery_member_search\",\n        showtag_url: app_url + '/profiles/',\n        name: 'users'\n    });\n\n    // quotable comments\n\n    $('.blogComment').karlquotablecomment({\n    });\n\n    // Captioned images\n    $('img.tiny-imagedrawer-captioned').karlcaptionedimage({\n    });\n\n    // Enable old style dropdowns\n    enableOldStyleDropdowns();\n\n    // initialize button\n    if ($('.button').length > 0) {\n      $(\"#form-submit\").click(function() {\n        $(\"#form-cancel\").attr(\"disabled\", \"disabled\");\n      });\n      $(\"#form-cancel\").click(function() {\n        $(\"#form-submit\").attr(\"disabled\", \"disabled\");\n      });\n      $(\"form.k3_genericForm\").keyup(function(eventObj) {\n        if (eventObj.keyCode == 13) { $(\"#form-cancel\").attr(\"disabled\", \"disabled\"); }\n      });\n    }\n\n    // Search Community button\n    var searchCommunityButton = $('.search-community-button')\n        .button({\n        })\n        .css('verticalAlign', 'top');\n    var searchCommunityInput = $('.search-community-input');\n    // dynamically set height to match. This makes sure that\n    // the button is aligned to the input _always, on all browsers_.\n    var _height = searchCommunityButton.outerHeight();\n    var _searchCommunityInputWrapper = $('<span></span>');\n    _searchCommunityInputWrapper\n        .css('display', 'inline-block')\n        .css('margin', '0')\n        .css('padding', '0')\n        .css('border', '0')\n        .css('height', _height +'px')\n        .css('verticalAlign', 'top');\n    searchCommunityInput\n        .wrap(_searchCommunityInputWrapper)\n        .css('margin', '0')\n        .css('padding', '0 3px')\n        .css('height', '' + (_height - 2) + 'px')\n        .css('lineHeight', '' + (_height - 2) + 'px');\n    var _searchCommunityMarginTop = searchCommunityButton.css('marginTop');\n    // this  is essential _sometimes_ on WebKit\n    searchCommunityInput.css('marginTop', _searchCommunityMarginTop);\n    // hack IE7 that handles top margin differently\n    if ($.browser.msie && parseInt($.browser.version) == 7) {\n        searchCommunityButton.css('marginTop', '1px');\n    }\n    if ($.browser.msie && parseInt($.browser.version) == 8) {\n        searchCommunityButton.css('marginTop', '1px');\n    }\n\n\n    // add class to #center if there are no right portlets\n    //\n    // XXX Would like to remove the code, but needed for the current layout.\n    rcol = $(\".generic-layout .rightcol\").html();\n    if ($.trim(rcol) == '') {\n        //console.log(\"true\");\n        $(\".generic-layout #center\").addClass(\"fill-width\");\n    }\n\n\n    /** =CALENDAR ATTACH EVENTS\n    ----------------------------------------------- */\n    if ($('table.cal').length > 0) {\n      initCalendar();\n    }\n    if ($(\"div.save-category\").length > 0) {\n      initNewEvent();\n    }\n    // calendar setup pages\n    if ($('#setup_add_cal').length > 0) {\n      initCalendarSetup();\n    }\n\n    // portlet item hover effect\n    $(\".generic-portlet .portlet-item\").hover(\n        function() {\n            $(this).css(\"background-color\",\"#f0f2f4\");\n        },\n        function() {\n            $(this).css(\"background-color\",\"transparent\");\n        }\n    );\n\n    // LP #1211859, re-order calendar notes\n    $('#calendarnotes').sortable(\n        {\n            handle: \".notehandle\",\n            update: function () {\n                // Send updated order to the server\n                var self = $(this);\n                var url = self.data('posturl');\n\n                var data = $('#calendarnotes tr').map(function (k,v) {\n                    return $(v).data('noteid')\n                });\n                $.ajax({\n                    type: \"POST\",\n                    url: url,\n                    data: {\n                        \"form.reorder\": true,\n                        order_ids: jQuery.makeArray(data).join(',')\n                    },\n                    success: function () {\n                        console.log(99);\n                    },\n                    error: function () {\n                        alert('Failed to save re-ordering data');\n                    },\n                    dataType: null\n                });\n        }}\n    );\n\n    // LP #1386234: certain <a> links must POST instead of GET\n    function parseUrl(url) {\n        var a = document.createElement('a');\n        a.href = url;\n        return a;\n    }\n    var parseQueryString = function(queryString) {\n        // we will return a list of (key, value) tuples\n        var result = [];\n        var paramString = queryString.substring(1);\n        var tuples = paramString.split('&');\n        for (var i = 0; i < tuples.length; i++ ) {\n            var split = tuples[i].split('=');\n            result.push(split);\n        }\n        return result;\n    };\n\n    $('a.force-post').click(function(evt) {\n        evt.preventDefault();\n        var el = $(this);\n        // build up a hidden form with all parameters, and submit it\n        var form = $('<form name=\"forcePost\" method=\"post\"></form>')\n            .appendTo('body');\n        var params = parseQueryString(parseUrl(el.attr('href')).search);\n        for (var i = 0; i < params.length; i++) {\n            var tuple = params[i];\n            $('<input type=\"hidden\"></input>')\n                .attr('name', tuple[0])\n                .attr('value', tuple[1])\n                .appendTo(form);\n        }\n        form[0].submit();\n    });\n\n}); // END document ready handler\n\n// For debugging and development.\n// (only works on FF)\nKarl.themeroller = function() {\n    if (window.jquitr) {\n        jquitr.addThemeRoller();\n    } else {\n        jquitr = {};\n        jquitr.s = document.createElement('script');\n        jquitr.s.src = 'http://jqueryui.com/themeroller/developertool/developertool.js.php';\n        document.getElementsByTagName('head')[0].appendChild(jquitr.s);\n    }\n};\n\n\n//\n// A console.log replacement that works on all browsers\n// If the browser does not have a console, it's silent\n//\n// usage: Karl.log('This happened.');\n// or:    Karl.log('Variables:', var1, var2, var3);\n//\nKarl.log = function() {\n    if (window.console && console.log) {\n        // log for FireBug or WebKit console\n        console.log(Array.prototype.slice.call(arguments));\n    }\n};\n\n\n// Make debugging more fun by providing outerHtml.\n// Credit for this code: http://ivorycity.com/blog/2009/08/18/3/\njQuery.fn.extend({\n    outerHtml: function(replacement) {\n        // We just want to replace the entire node and contents with\n        // some new html value\n        if (replacement) {\n            return this.each(function() { $(this).replaceWith(replacement); });\n        }\n\n        /*\n        * Now, clone the node, we want a duplicate so we don't remove\n        * the contents from the DOM. Then append the cloned node to\n        * an anonymous div.\n        * Once you have the anonymous div, you can get the innerHtml,\n        * which includes the original tag.\n        */\n        var tmp_node = $(\"<div></div>\").append($(this).clone());\n        var markup = tmp_node.html();\n\n        // Don't forget to clean up or we will leak memory.\n        tmp_node.remove();\n        return markup;\n    }\n});\n\nKarl.clear_lock_on_unload = function() {\n    var here_url = $(\"#karl-here-url\").eq(0).attr('content');\n    var maybeSlash = here_url.match(/\\/$/) ? '' : '/';\n    var unlock_url = here_url + maybeSlash + 'unlock.html';\n    $(window).bind('unload', function() {\n        if (! window.preventUnlock) {\n            $.ajax({type: 'POST',\n                    url: unlock_url,\n                    data: {},\n                    async: false\n                   });\n        }\n    });\n};\n\n})();                   // END CLOSURE Karl\n"]}